/*! For license information please see avalon.d70258d2f8c30cac6f33.js.LICENSE.txt */
!function(e){function webpackJsonpCallback(s){for(var o,a,u=s[0],g=s[1],_=0,b=[];_<u.length;_++)a=u[_],Object.prototype.hasOwnProperty.call(n,a)&&n[a]&&b.push(n[a][0]),n[a]=0;for(o in g)Object.prototype.hasOwnProperty.call(g,o)&&(e[o]=g[o]);for(f&&f(s);b.length;)b.shift()()}var s={},n={2:0,160:0};function __webpack_require__(n){if(s[n])return s[n].exports;var o=s[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}__webpack_require__.e=function requireEnsure(e){var s=[],o=n[e];if(0!==o)if(o)s.push(o[2]);else{var a=new Promise((function(s,a){o=n[e]=[s,a]}));s.push(o[2]=a);var u,f=document.createElement("script");f.charset="utf-8",f.timeout=120,__webpack_require__.nc&&f.setAttribute("nonce",__webpack_require__.nc),f.src=function jsonpScriptSrc(e){return __webpack_require__.p+""+({0:"markdown",1:"regex",4:"chat",6:"featured-follow",7:"host-options",8:"i18n-0",9:"i18n-1",10:"i18n-10",11:"i18n-100",12:"i18n-101",13:"i18n-102",14:"i18n-103",15:"i18n-104",16:"i18n-105",17:"i18n-106",18:"i18n-107",19:"i18n-108",20:"i18n-109",21:"i18n-11",22:"i18n-110",23:"i18n-111",24:"i18n-112",25:"i18n-113",26:"i18n-114",27:"i18n-115",28:"i18n-116",29:"i18n-117",30:"i18n-118",31:"i18n-119",32:"i18n-12",33:"i18n-120",34:"i18n-121",35:"i18n-122",36:"i18n-123",37:"i18n-124",38:"i18n-125",39:"i18n-126",40:"i18n-127",41:"i18n-128",42:"i18n-129",43:"i18n-13",44:"i18n-130",45:"i18n-131",46:"i18n-132",47:"i18n-133",48:"i18n-134",49:"i18n-135",50:"i18n-136",51:"i18n-137",52:"i18n-138",53:"i18n-139",54:"i18n-14",55:"i18n-140",56:"i18n-15",57:"i18n-16",58:"i18n-17",59:"i18n-18",60:"i18n-19",61:"i18n-2",62:"i18n-20",63:"i18n-21",64:"i18n-22",65:"i18n-23",66:"i18n-24",67:"i18n-25",68:"i18n-26",69:"i18n-27",70:"i18n-28",71:"i18n-29",72:"i18n-3",73:"i18n-30",74:"i18n-31",75:"i18n-32",76:"i18n-33",77:"i18n-34",78:"i18n-35",79:"i18n-36",80:"i18n-37",81:"i18n-38",82:"i18n-39",83:"i18n-4",84:"i18n-40",85:"i18n-41",86:"i18n-42",87:"i18n-43",88:"i18n-44",89:"i18n-45",90:"i18n-46",91:"i18n-47",92:"i18n-48",93:"i18n-49",94:"i18n-5",95:"i18n-50",96:"i18n-51",97:"i18n-52",98:"i18n-53",99:"i18n-54",100:"i18n-55",101:"i18n-56",102:"i18n-57",103:"i18n-58",104:"i18n-59",105:"i18n-6",106:"i18n-60",107:"i18n-61",108:"i18n-62",109:"i18n-63",110:"i18n-64",111:"i18n-65",112:"i18n-66",113:"i18n-67",114:"i18n-68",115:"i18n-69",116:"i18n-7",117:"i18n-70",118:"i18n-71",119:"i18n-72",120:"i18n-73",121:"i18n-74",122:"i18n-75",123:"i18n-76",124:"i18n-77",125:"i18n-78",126:"i18n-79",127:"i18n-8",128:"i18n-80",129:"i18n-81",130:"i18n-82",131:"i18n-83",132:"i18n-84",133:"i18n-85",134:"i18n-86",135:"i18n-87",136:"i18n-88",137:"i18n-89",138:"i18n-9",139:"i18n-90",140:"i18n-91",141:"i18n-92",142:"i18n-93",143:"i18n-94",144:"i18n-95",145:"i18n-96",146:"i18n-97",147:"i18n-98",148:"i18n-99",149:"main-menu",150:"menu-md0",151:"menu-md1",152:"menu-md4",153:"menu-md5",154:"menu-md6",155:"overrides",157:"queries",158:"rich_tokens",159:"site-css-tweaks",161:"translation-ui",162:"vue",163:"vue-chat",164:"zip"}[e]||e)+"."+{0:"32ab22cb35622b414166",1:"8d4a3174ad49f79c5082",4:"09527f538d94cc8194cd",6:"15a0d35e1ce241203331",7:"1ad64ee5c21bf42f721e",8:"ed9ee93aa19f27167da5",9:"1e7ba59f90fe7c3d98de",10:"dce6121d19eee901e514",11:"173d0e39b5623a64ad14",12:"99f30af7d4d90bdc6ae2",13:"299599aa31011d36dad4",14:"42ae07d3e1ae754c55db",15:"b95d21aedbc22fb437a1",16:"ac91a93c3c0a96f8a090",17:"7ae1b777ae2c7367a064",18:"e25ade420a9d6348c121",19:"763593b2710a91553c28",20:"e7c4a6076397367416f4",21:"55af3c41979ee77481af",22:"5bfdb34e734f077d7fda",23:"962ecc4f0b639fed49c8",24:"de7836c697e4c9938ec2",25:"ebcdeda10853fdc0091a",26:"dfa13df74fd6a3fa800c",27:"932190ee7b012ef1ce8a",28:"4d5823982ace136f37ae",29:"d6b3619306c92f4b8656",30:"b2d7b94ba12460ee5b0a",31:"e02322dede582db41e13",32:"a4759e057d625a310f3c",33:"0d777c643e52ee05902a",34:"d797c731cca8c621a80e",35:"e6754bca5c3cb01ea4bd",36:"d733d2a425c7641a29f2",37:"6d69d679b498e9e7ab23",38:"9ab29556ff80f4bc4008",39:"d42dedbb1c9714b7fd11",40:"58ca397625e747858d05",41:"fec53eb773b1ce3d83f8",42:"3ff80c4cea5edba72c88",43:"cffe1b77f728174dedea",44:"44fac9275c099e8eac00",45:"2c61d6db17312a36f100",46:"44cca92196b73816ece7",47:"d748dee193cdd4308101",48:"a1833bf03d07c029500d",49:"8c06d1c67fdac0ed369c",50:"a4cf0ecc39314e321d7e",51:"2d655b824efba26c13a0",52:"74c85fa6a0c6adc9d24a",53:"b415987071bd8e22be8d",54:"23f206924cbc92fc36e6",55:"8fc753b688d3dc17f7eb",56:"705facc6117e9e6f82dc",57:"cbf75c0e3e06167ffe87",58:"2e6c197bde1b0140ba4d",59:"9741b792fffd5f0fa557",60:"e931d8613a0d1377823f",61:"50c6fac229b3843b4002",62:"7b80732a42df6c8b479a",63:"a3c9de442d4ec34ef020",64:"179a956918fa06b165ca",65:"50eaf672e69af2e8286c",66:"93b46e927bd6ecfbbf62",67:"85c7a0d9ee9cbf831932",68:"69fcc5ba6306419524b8",69:"6936cdcc4c6793936322",70:"538a2b07705895f148e0",71:"edd3c068d3c1f4c32d8e",72:"426869e4b2c12923eccd",73:"fce977b9df808c862318",74:"c90ca265a2680b5efc27",75:"6fdfc8240dcb22c2fb01",76:"81e90f739cf15e9debf8",77:"369483c5b451c1fb50c8",78:"2b20f6f0250a4516159a",79:"8f28d615a8b3b7bb8a78",80:"9ffefd973213453e0e8b",81:"1413e8d50e152c081b78",82:"13667fd3f27e7c5ff53c",83:"13e0f129fd4280ad2c6d",84:"346f58450b7d2ff5e816",85:"6c7a4b1dbcf496491a5b",86:"23d9e15845ba57e6cf67",87:"9b9e3e30cbe807154558",88:"8c47c5a71308c1d7fe8e",89:"a8cf387efc85d9e67c0b",90:"2c02c988ab6b02f1f328",91:"33546eaa314e6b09e6d6",92:"46dd731d16c4d456ca39",93:"25cfddb36baa01d7aa25",94:"cbc38062a5e98c5aa23a",95:"eacbad5b40f3fbc8ab3b",96:"324d551882f575590213",97:"d1eafac94c291cd6f8bc",98:"517db676455efa66b51b",99:"93c625b6df0ec0a0701a",100:"5facd76723377cf6501f",101:"8c90b6fea701272dded5",102:"1341c2c203009695e3ac",103:"0187ce532e9c36c3a8b9",104:"ecb8f6857da1fa8b29b2",105:"c413a4a93b7715650b1b",106:"4fde87d5a0dd5dab7400",107:"6ce157f3e1c671d56c52",108:"d61df26e28b91ec9dea3",109:"3654c2388f81e84e720c",110:"b2848b49c575476d02bc",111:"3282d112578297ec9dfa",112:"f3c9f5fcd1a24fa5f5c3",113:"e4d500fee13940322f30",114:"3cf6812efaed603b1d1e",115:"ec1b03e3ab424bbb4d81",116:"66b61ebab1dfa50afac5",117:"4aae519a3ec821217f4f",118:"6e21846cbc1c55aa2d5c",119:"939a33e568227f28664f",120:"9b34c0bb2bd582141696",121:"5bfc55e51e1c2d8bd7d0",122:"03670a5a662b4aff6685",123:"06a74761675742f9554f",124:"c8966ea6530e87a7b062",125:"a93a7daba8b2814fe7a1",126:"f72204a6cd5a09b2c5ed",127:"95a05e49e03922ca85d2",128:"94478c26c6ae38b4f2b3",129:"4459e03eeb160d799e1e",130:"fcdc2ed692576cc5085f",131:"07ea70048f81687aac62",132:"6d57693b84ac2d329b3e",133:"d335d9c2268840e86c57",134:"e7677322cd835309cd7f",135:"caf240c776d10c95afed",136:"9affbf411bf434a13140",137:"5a73d3a2229e4be82ba9",138:"9773210f78d9197897ce",139:"bbc0a710912c2287b792",140:"b0ddbfc314064449b6a2",141:"ef01b17361b1f3fb83cd",142:"a9b183439eb8109cf809",143:"236a1f6ef73e3bfd4378",144:"10d189c1d3fa007c2ff0",145:"2da3cd24a2def5e9f60f",146:"6cc714b9c2444cf474e7",147:"083e13888fe0aca9bb18",148:"0566aac7c834e2919f77",149:"ad4a9f2c8f38900d227b",150:"c65d4db8f94584fb5704",151:"951185246521d9d489fd",152:"26c59e5e693449c8aa77",153:"3482a9feb76c8f106661",154:"bd9085664ea8b9c9eb22",155:"7c599ad97610452422c8",157:"fb150fe965c6da498d70",158:"3c8eb4eccc90ce1c04c9",159:"e58a4fd0772862515fc4",161:"9fd28e7b0e34b73ab428",162:"b44cb11f2f4bf72e2407",163:"8125474b23aa96b3fc66",164:"5f71d8d8cf98eda26f6b"}[e]+".js"}(e),0!==f.src.indexOf(window.location.origin+"/")&&(f.crossOrigin="anonymous");var g=new Error;u=function(s){f.onerror=f.onload=null,clearTimeout(_);var o=n[e];if(0!==o){if(o){var a=s&&("load"===s.type?"missing":s.type),u=s&&s.target&&s.target.src;g.message="Loading chunk "+e+" failed.\n("+a+": "+u+")",g.name="ChunkLoadError",g.type=a,g.request=u,o[1](g)}n[e]=void 0}};var _=setTimeout((function(){u({type:"timeout",target:f})}),12e4);f.onerror=f.onload=u,document.head.appendChild(f)}return Promise.all(s)},__webpack_require__.m=e,__webpack_require__.c=s,__webpack_require__.d=function(e,s,n){__webpack_require__.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,s){if(1&s&&(e=__webpack_require__(e)),8&s)return e;if(4&s&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&s&&"string"!=typeof e)for(var o in e)__webpack_require__.d(n,o,function(s){return e[s]}.bind(null,o));return n},__webpack_require__.n=function(e){var s=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(s,"a",s),s},__webpack_require__.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},__webpack_require__.p="//cdn.frankerfacez.com/static/",__webpack_require__.oe=function(e){throw console.error(e),e},__webpack_require__.h="d70258d2f8c30cac6f33",__webpack_require__.cn="avalon";var o=window.ffzWebpackJsonp=window.ffzWebpackJsonp||[],a=o.push.bind(o);o.push=webpackJsonpCallback,o=o.slice();for(var u=0;u<o.length;u++)webpackJsonpCallback(o[u]);var f=a;__webpack_require__(__webpack_require__.s=378)}([function(e,s,n){"use strict";n.r(s),n.d(s,"getTwitchEmoteURL",(function(){return getTwitchEmoteURL})),n.d(s,"getTwitchEmoteSrcSet",(function(){return getTwitchEmoteSrcSet})),n.d(s,"isValidShortcut",(function(){return isValidShortcut})),n.d(s,"generateUUID",(function(){return generateUUID})),n.d(s,"has",(function(){return has})),n.d(s,"sleep",(function(){return sleep})),n.d(s,"make_enum",(function(){return make_enum})),n.d(s,"timeout",(function(){return timeout})),n.d(s,"Mutex",(function(){return Mutex})),n.d(s,"debounce",(function(){return debounce})),n.d(s,"once",(function(){return once})),n.d(s,"array_equals",(function(){return array_equals})),n.d(s,"deep_equals",(function(){return deep_equals})),n.d(s,"shallow_object_equals",(function(){return shallow_object_equals})),n.d(s,"map_equals",(function(){return map_equals})),n.d(s,"set_equals",(function(){return set_equals})),n.d(s,"filter_match",(function(){return filter_match})),n.d(s,"substr_count",(function(){return substr_count})),n.d(s,"get",(function(){return get})),n.d(s,"shallow_copy",(function(){return shallow_copy})),n.d(s,"deep_copy",(function(){return deep_copy})),n.d(s,"maybe_call",(function(){return maybe_call})),n.d(s,"split_chars",(function(){return split_chars})),n.d(s,"pick_random",(function(){return pick_random})),n.d(s,"escape_regex",(function(){return f})),n.d(s,"glob_to_regex",(function(){return glob_to_regex})),n.d(s,"truncate",(function(){return truncate})),n.d(s,"generateHex",(function(){return generateHex})),n.d(s,"SourcedSet",(function(){return SourcedSet}));var o=n(2);const a=Object.prototype.hasOwnProperty;function getTwitchEmoteURL(e,s,n=!1,a=!0){return`${o.TWITCH_EMOTE_V2}/${e}/${n?"default":"static"}/${a?"dark":"light"}/${4==s?3:s}.0`}function getTwitchEmoteSrcSet(e,s=!1,n=!0,o=!1){return o?`${getTwitchEmoteURL(e,2,s,n)} 1x, ${getTwitchEmoteURL(e,4,s,n)} 2x`:`${getTwitchEmoteURL(e,1,s,n)} 1x, ${getTwitchEmoteURL(e,2,s,n)} 2x, ${getTwitchEmoteURL(e,4,s,n)} 4x`}function isValidShortcut(e){return!!e&&(e=e.toLowerCase().trim(),!o.BAD_HOTKEYS.includes(e))}function generateUUID(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,generateUUID)}function has(e,s){return!!e&&a.call(e,s)}function sleep(e){return new Promise((s=>setTimeout(s,e)))}function make_enum(...e){const s={};for(let n=0;n<e.length;n++){const o=e[n];s[o]=n,s[n]=o}return s}function timeout(e,s){return new Promise(((n,o)=>{let a=!1;const u=setTimeout((()=>{a||(a=!0,o(new Error("timeout")))}),s);e.then((e=>{a||(a=!0,clearTimeout(u),n(e))})).catch((e=>{a||(a=!0,clearTimeout(u),o(e))}))}))}class Mutex{constructor(e=1){this.limit=e,this._active=0,this._waiting=[],this._done=this._done.bind(this)}get available(){return this._active<this.limit}_done(){for(this._active--;this._active<this.limit&&this._waiting.length>0;){this._active++;this._waiting.shift()(this._done)}}wait(){return this._active<this.limit?(this._active++,Promise.resolve(this._done)):new Promise((e=>this._waiting.push(e)))}}function debounce(e,s,n){let o;if(n){const later=()=>o=null;return 2===n?function(...n){o?(clearTimeout(o),o=setTimeout((()=>{o=null,e.apply(this,n)}),s)):(e.apply(this,n),o=setTimeout(later,s))}:function(...n){o?clearTimeout(o):e.apply(this,n),o=setTimeout(later,s)}}return function(...n){o&&clearTimeout(o),o=setTimeout(e.bind(this,...n),s)}}function once(e){let s;return function(...n){return new Promise((async(o,a)=>{if(s)return s.push([o,a]);let u;s=[[o,a]];try{u=await e.call(this,...n)}catch(e){for(const n of s)n[1](e);return void(s=null)}for(const e of s)e[0](u);s=null}))}}function array_equals(e,s){if(!Array.isArray(e)||!Array.isArray(s)||e.length!==s.length)return!1;let n=e.length;for(;n--;)if(e[n]!==s[n])return!1;return!0}function deep_equals(e,s,n=!1,o,a){if(e===s)return!0;if(typeof e!=typeof s)return!1;if("object"!=typeof e)return!1;if(null===e!=(null===s))return!1;if(o||(o=new Set),a||(a=new Set),o.has(e)||a.has(s))throw new Error("recursive structure detected");o.add(e),a.add(s);const u=Object.keys(e),f=Object.keys(s);if(!n&&!set_equals(new Set(u),new Set(f)))return!1;for(const f of u)if(!deep_equals(e[f],s[f],n,new Set(o),new Set(a)))return!1;if(n)for(const g of f)if(!u.includes(g)&&!deep_equals(e[g],s[g],n,new Set(o),new Set(a)))return!1;return!0}function shallow_object_equals(e,s){if("object"!=typeof e||"object"!=typeof s)return!1;const n=Object.keys(e);if(!set_equals(new Set(n),new Set(Object.keys(s))))return!1;for(const o of n)if(e[o]!==s[o])return!1;return!0}function map_equals(e,s){if(!(e instanceof Map&&s instanceof Map&&e.size===s.size))return!1;for(const[n,o]of e)if(!s.has(n)||s.get(n)!==o)return!1;return!0}function set_equals(e,s){if(!(e instanceof Set&&s instanceof Set&&e.size===s.size))return!1;for(const n of e)if(!s.has(n))return!1;return!0}function filter_match(e,s){for(const n in e)if(a.call(e,n)){const o=e[n],a=s[n],u=typeof o;if("function"===u){if(!o(a))return!1}else if(Array.isArray(o)){if(Array.isArray(a)){for(const e of o)if(!a.includes(e))return!1}else if(!o.include(a))return!1}else{if(typeof a!==u)return!1;if("object"===u){if(!filter_match(o,a))return!1}else if(o!==a)return!1}}return!0}function substr_count(e,s){let n=0,o=0;for(;o<e.length;){const a=e.indexOf(s,o);if(-1===a)break;n++,o=a+1}return n}function get(e,s){if(a.call(s,e))return s[e];"string"==typeof e&&(e=e.split("."));for(let n=0,o=e.length;n<o;n++){const o=e[n];if("@each"===o){const o=e.slice(n+1);if(o.length)if(Array.isArray)s=s.map((e=>get(o,e)));else{const e={};for(const n in s)a.call(s,n)&&(e[n]=get(o,s[n]));s=e}break}if(!(s="@last"===o?s[s.length-1]:s[e[n]]))break}return s}function shallow_copy(e,s=2,n=null){if(null==e)return e;if(e instanceof Promise||"function"==typeof e)return null;if("object"!=typeof e)return e;if(0===s)return null;if(n||(n=new Set),n.add(e),Array.isArray(e)){const o=[];for(const a of e)n.has(a)||o.push(shallow_copy(a,s-1,new Set(n)));return o}const o={};for(const[a,u]of Object.entries(e))n.has(u)||(o[a]=shallow_copy(u,s-1,new Set(n)));return o}function deep_copy(e,s){if(null===e)return null;if(void 0===e)return;if(e instanceof Promise)return new Promise(((s,n)=>e.then(s).catch(n)));if("function"==typeof e)return function(...s){return e.apply(this,s)};if("object"!=typeof e)return e;if(s||(s=new Set),s.has(e))throw new Error("recursive structure detected");if(s.add(e),Array.isArray(e))return e.map((e=>deep_copy(e,new Set(s))));const n={};for(const o in e)if(a.call(e,o)){const a=e[o];n[o]="object"==typeof a?deep_copy(a,new Set(s)):a}return n}function maybe_call(e,s,...n){return"function"==typeof e?s?e.call(s,...n):e(...n):e}const u=/[^\uD800-\uDFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDFFF]/g;function split_chars(e){return""===e?[]:e.match(u)}function pick_random(e){return e?Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e[pick_random(Object.keys(e))]:null}const f=RegExp.escape||function escape_regex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},g="/$^+.()=!|";function glob_to_regex(e){if("string"!=typeof e)throw new TypeError("input must be a string");let s="",n=0;for(let o=0,a=e.length;o<a;o++){const a=e[o];if(g.includes(a))s+=`\\${a}`;else if("\\"===a){o++;const n=e[o];n&&(g.includes(n)?s+=`\\${n}`:s+=n)}else if("?"===a)s+=".";else if("["===a){s+=a;"!"===e[o+1]&&(o++,s+="^")}else if("]"===a)s+=a;else if("{"===a)s+="(?:",n++;else if("}"===a)n>0&&(s+=")",n--);else if(","===a&&n>0)s+="|";else if("*"===a){let n=1;for(;"*"===e[o+1];)n++,o++;s+=n>1?".*?":"[^\\s]*?"}else s+=a}return s}function truncate(e,s=100,n=15,o="…",a=!0,u=!0){if(!e||!e.length)return e;u&&(e=e.trim());let f=a?e.indexOf("\n"):-1;if((-1===f||f>s)&&(f=s),e.length<=f)return e;let g=e.slice(0,f).trimRight();if(n>0&&g.length>=f){let s=e.slice(f).search(/\s+/);if(-1===s&&n+f>e.length&&(s=e.length-f),-1!==s&&s<=n){if(e.length<=f+s)return e;g=e.slice(0,f+s)}}return g+o}function decimalToHex(e){return e.toString(16).padStart(2,"0")}function generateHex(e=40){const s=new Uint8Array(e/2);return window.crypto.getRandomValues(s),Array.from(s,decimalToHex).join("")}class SourcedSet{constructor(e=!1){this._use_set=e,this._cache=e?new Set:[]}_rebuild(){if(!this._sources)return;const e=this._use_set,s=this._cache=e?new Set:[];for(const n of this._sources.values())for(const o of n)e?s.add(o):s.includes(o)||this._cache.push(o)}get(e){return this._sources&&this._sources.get(e)}has(e){return!!this._sources&&this._sources.has(e)}sourceIncludes(e,s){const n=this._sources&&this._sources.get(e);return n&&n.includes(s)}includes(e){return this._use_set?this._cache.has(e):this._cache.includes(e)}delete(e){this._sources&&this._sources.has(e)&&(this._sources.delete(e),this._rebuild())}extend(e,...s){this._sources||(this._sources=new Map);const n=this.has(e);if(n&&(s=[...this._sources.get(e),...s]),this._sources.set(e,s),n)this._rebuild();else for(const e of s)this._use_set?this._cache.add(e):this._cache.includes(e)||this._cache.push(e)}set(e,s){this._sources||(this._sources=new Map);const n=this.has(e);if(Array.isArray(s)||(s=[s]),this._sources.set(e,s),n)this._rebuild();else for(const e of s)this._use_set?this._cache.add(e):this._cache.includes(e)||this._cache.push(e)}push(e,s){if(!this._sources)return this.set(e,s);const n=this._sources.get(e);if(void 0===n)return this.set(e,s);n.includes(s)||(n.push(s),this._use_set?this._cache.add(s):this._cache.includes(s)||this._cache.push(s))}remove(e,s){if(!this.has(e))return;const n=this._sources.get(e),o=n.indexOf(s);-1!==o&&(n.splice(o,1),this._rebuild())}}},function(e,s,n){"use strict";n.r(s),n.d(s,"on",(function(){return on})),n.d(s,"off",(function(){return off})),n.d(s,"findReactFragment",(function(){return findReactFragment})),n.d(s,"createElement",(function(){return createElement})),n.d(s,"setChildren",(function(){return setChildren})),n.d(s,"findSharedParent",(function(){return findSharedParent})),n.d(s,"openFile",(function(){return openFile})),n.d(s,"readFile",(function(){return readFile})),n.d(s,"sanitize",(function(){return sanitize})),n.d(s,"ManagedStyle",(function(){return ManagedStyle})),n.d(s,"ClickOutside",(function(){return ClickOutside}));var o=n(0);const a=["accept","accept-charset","accesskey","action","align","alt","async","autocomplete","autofocus","autoplay","bgcolor","border","buffered","challenge","charset","checked","cite","class","code","codebase","color","cols","colspan","content","contenteditable","contextmenu","controls","coords","crossorigin","data","data-*","datetime","default","defer","dir","dirname","download","draggable","dropzone","enctype","for","form","formaction","headers","height","hidden","high","href","hreflang","http-equiv","icon","id","integrity","ismap","itemprop","keytype","kind","label","lang","language","list","loop","low","manifest","max","maxlength","minlength","media","method","min","multiple","name","novalidate","open","optimum","pattern","ping","placeholder","poster","preload","radiogroup","readonly","rel","required","reversed","rows","rowspan","sandbox","scope","scoped","seamless","selected","shape","size","sizes","slot","span","spellcheck","src","srcdoc","srclang","srcset","start","step","style","summary","tabindex","target","title","type","usemap","value","width","wrap"],u=["controls","autoplay","loop"],f=document.createRange();function camelCase(e){return e.replace(/[-_]\w/g,(e=>e[1].toUpperCase()))}function on(e,...s){return e.addEventListener(...s)}function off(e,...s){return e.removeEventListener(...s)}function findReactFragment(e,s,n=25,o=0,a=null){if(a){if(a.has(e))return null}else a=new Set;if(s(e))return e;if(o>=n)return null;if(a.add(e),e&&e.props&&Array.isArray(e.props.children))for(const u of e.props.children)if(u)if(Array.isArray(u))for(const e of u){const u=findReactFragment(e,s,n,o+1,a);if(u)return u}else{const e=findReactFragment(u,s,n,o+1,a);if(e)return e}return null}function createElement(e,s,...n){const f=document.createElement(e);if(0===n.length?n=null:1===n.length&&(n=n[0]),"string"==typeof s)f.className=s;else if(s)for(const e in s)if(Object(o.has)(s,e)){const n=e.toLowerCase(),g=s[e];if("style"===n)if("string"==typeof g)f.style.cssText=g;else for(const e in g)Object(o.has)(g,e)&&(Object(o.has)(f.style,e)||Object(o.has)(Object.getPrototypeOf(f.style),e)?f.style[e]=g[e]:f.style.setProperty(e,g[e]));else if("dataset"===n)for(const e in g)Object(o.has)(g,e)&&(f.dataset[camelCase(e)]=g[e]);else"dangerouslySetInnerHTML"===e?g&&g.__html&&(f.innerHTML=g.__html):n.startsWith("on")?f.addEventListener(n.slice(2),g):n.startsWith("data-")?f.dataset[camelCase(n.slice(5))]=g:u.includes(n)?g&&"false"!==g&&f.setAttribute(e,g):n.startsWith("aria-")||a.includes(n)?f.setAttribute(e,g):f[e]=g}return n&&setChildren(f,n),f}function setChildren(e,s,n,o){if(s instanceof Node)o||(e.innerHTML=""),e.appendChild(s);else if(Array.isArray(s)){o||(e.innerHTML="");for(const o of s)if(o instanceof Node)e.appendChild(o);else if(Array.isArray(o))setChildren(e,o,n,!0);else if(o){const s="string"==typeof o?o:String(o);e.appendChild(n?f.createContextualFragment(s):document.createTextNode(s))}}else if(s){const o="string"==typeof s?s:String(s);e.appendChild(n?f.createContextualFragment(o):document.createTextNode(o))}}function findSharedParent(e,s,n){for(;e;){if(e.contains(s))return!0;e=e.parentElement,n&&(e=e&&e.closest(n))}return!1}function openFile(e,s){return new Promise((n=>{const o=document.createElement("input");o.type="file",o.accept=e,o.multiple=s;let a=!1;o.onchange=()=>{if(!a){a=!0;const e=Array.from(o.files);n(s?e:e[0])}},o.click()}))}function readFile(e,s="utf-8"){return new Promise(((n,o)=>{const a=new FileReader;a.readAsText(e,s),a.onload=()=>n(a.result),a.onerror=e=>o(e)}))}const g=createElement("span");function sanitize(e){return g.textContent=e,g.innerHTML}let _=0;class ManagedStyle{constructor(e){this.id=e||_++,this._blocks={},this._style=createElement("style",{type:"text/css",id:`ffz--managed-style--${this.id}`}),document.head.appendChild(this._style)}destroy(){this._style.remove(),this._blocks=null,this._style=null}set(e,s,n){const o=this._blocks[e];if(o){if(!n&&o.textContent===s)return;o.textContent=s}else this._style.appendChild(this._blocks[e]=document.createTextNode(s))}delete(e){const s=this._blocks[e];s&&(this._style.contains(s)&&this._style.removeChild(s),this._blocks[e]=null)}}class ClickOutside{constructor(e,s){this.el=e,this.cb=s,this._fn=this.handleClick.bind(this),document.documentElement.addEventListener("click",this._fn)}destroy(){this._fn&&document.documentElement.removeEventListener("click",this._fn),this.cb=this.el=this._fn=null}handleClick(e){this.el&&!this.el.contains(e.target)&&this.cb(e)}}},function(e,s,n){"use strict";n.r(s),n.d(s,"DEBUG",(function(){return a})),n.d(s,"SERVER",(function(){return u})),n.d(s,"CLIENT_ID",(function(){return f})),n.d(s,"API_SERVER",(function(){return g})),n.d(s,"NEW_API",(function(){return _})),n.d(s,"SENTRY_ID",(function(){return b})),n.d(s,"LV_SERVER",(function(){return v})),n.d(s,"LV_SOCKET_SERVER",(function(){return k})),n.d(s,"BAD_HOTKEYS",(function(){return x})),n.d(s,"RERENDER_SETTINGS",(function(){return C})),n.d(s,"UPDATE_BADGE_SETTINGS",(function(){return E})),n.d(s,"UPDATE_TOKEN_SETTINGS",(function(){return z})),n.d(s,"KEYS",(function(){return j})),n.d(s,"TWITCH_EMOTE_BASE",(function(){return O})),n.d(s,"TWITCH_EMOTE_V2",(function(){return A})),n.d(s,"KNOWN_CODES",(function(){return T})),n.d(s,"REPLACEMENT_BASE",(function(){return D})),n.d(s,"REPLACEMENTS",(function(){return B})),n.d(s,"WS_CLUSTERS",(function(){return P})),n.d(s,"IS_OSX",(function(){return L})),n.d(s,"IS_WIN",(function(){return I})),n.d(s,"IS_WEBKIT",(function(){return N})),n.d(s,"IS_FIREFOX",(function(){return R})),n.d(s,"WEBKIT_CSS",(function(){return U})),n.d(s,"TWITCH_GLOBAL_SETS",(function(){return q})),n.d(s,"TWITCH_POINTS_SETS",(function(){return H})),n.d(s,"TWITCH_PRIME_SETS",(function(){return G})),n.d(s,"EmoteTypes",(function(){return V}));var o=n(0);const a="true"===localStorage.ffzDebugMode&&document.body.classList.contains("ffz-dev"),u=a?"//localhost:8000":"https://cdn.frankerfacez.com",f="a3bc9znoz6vi8ozsoca0inlcr4fcvkl",g="//api.frankerfacez.com",_="//api2.frankerfacez.com",b="https://74b46b3894114f399d51949c6d237489@sentry.frankerfacez.com/2",v="https://cbenni.com/api",k="wss://cbenni.com/socket.io/",x=["f","space","k","shift+up","shift+down","esc","m","?","alt+t","alt+x"],C=["chat.name-format","chat.me-style","chat.rituals.show","chat.subs.show","chat.subs.compact","chat.actions.inline","chat.timestamp-format","chat.points.allow-highlight","chat.filtering.display-deleted","chat.filtering.display-mod-action","chat.replies.style","chat.bits.cheer-notice"],E=["chat.badges.style","chat.badges.hidden","chat.badges.custom-mod","chat.badges.custom-vip"],z=["chat.emotes.enabled","chat.emotes.2x","chat.emotes.animated","chat.emoji.style","chat.emoji.replace-joiner","chat.bits.stack","chat.rich.enabled","chat.rich.want-mid","chat.rich.hide-tokens","chat.rich.all-links","chat.rich.minimum-level","chat.filtering.process-own","chat.filtering.mention-priority","chat.filtering.debug","chat.fix-bad-emotes","__filter:highlight-terms","__filter:highlight-users","__filter:highlight-badges","__filter:block-terms","__filter:block-users","__filter:block-badges"],j={Tab:9,Enter:13,Shift:16,Control:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Meta:91,Context:93},O="//static-cdn.jtvnw.net/emoticons/v1/",A="//static-cdn.jtvnw.net/emoticons/v2",T={"#-?[\\\\/]":"#-/",":-?(?:7|L)":":-7","\\&lt\\;\\]":"<]","\\:-?(S|s)":":-S","\\:-?\\\\":":-\\","\\:\\&gt\\;":":>","B-?\\)":"B-)","\\:-?[z|Z|\\|]":":-Z","\\:-?\\)":":-)","\\:-?\\(":":-(","\\:-?(p|P)":":-P","\\;-?(p|P)":";-P","\\&lt\\;3":"<3","\\:-?[\\\\/]":":-/","\\;-?\\)":";-)","R-?\\)":"R-)","[oO](_|\\.)[oO]":"O.o","[o|O](_|\\.)[o|O]":"O.o","\\:-?D":":-D","\\:-?(o|O)":":-O","\\&gt\\;\\(":">(","Gr(a|e)yFace":"GrayFace"},D=`${u}/static/replacements/`,B={15:"15-JKanStyle.png",16:"16-OptimizePrime.png",17:"17-StoneLightning.png",18:"18-TheRinger.png",22:"22-RedCoat.png",26:"26-JonCarnage.png",30:"30-BCWarrior.png",33:"33-DansGame.png",36:"36-PJSalt.png"},P={Production:[["wss://catbag.frankerfacez.com/",.25],["wss://andknuckles.frankerfacez.com/",.8],["wss://tuturu.frankerfacez.com/",.7],["wss://lilz.frankerfacez.com/",1],["wss://yoohoo.frankerfacez.com/",1],["wss://pog.frankerfacez.com/",1],["wss://ayaya.frankerfacez.com/",1],["wss://champ.frankerfacez.com/",1]],Development:[["wss://127.0.0.1:8003/",1]]},L=navigator.platform?-1!==navigator.platform.indexOf("Mac"):/OS X/.test(navigator.userAgent),I=navigator.platform?-1!==navigator.platform.indexOf("Win"):/Windows/.test(navigator.userAgent),N=-1!==navigator.userAgent.indexOf("AppleWebKit/")&&-1===navigator.userAgent.indexOf("Edge/"),R=-1!==navigator.userAgent.indexOf("Firefox/")||void 0!==window.InstallTrigger,U=N?"-webkit-":"",q=[0,33,42],H=[300238151],G=[457,793,19151,19194],V=Object(o.make_enum)("Unknown","Prime","Turbo","LimitedTime","ChannelPoints","Unavailable","Subscription","BitsTier","Global","TwoFactor","Follower")},function(e,s,n){"use strict";n.d(s,"u",(function(){return o})),n.d(s,"i",(function(){return a})),n.d(s,"s",(function(){return u})),n.d(s,"l",(function(){return f})),n.d(s,"d",(function(){return g})),n.d(s,"e",(function(){return _})),n.d(s,"t",(function(){return b})),n.d(s,"k",(function(){return v})),n.d(s,"j",(function(){return k})),n.d(s,"w",(function(){return x})),n.d(s,"p",(function(){return C})),n.d(s,"r",(function(){return E})),n.d(s,"v",(function(){return z})),n.d(s,"o",(function(){return j})),n.d(s,"g",(function(){return O})),n.d(s,"q",(function(){return A})),n.d(s,"b",(function(){return T})),n.d(s,"f",(function(){return D})),n.d(s,"m",(function(){return B})),n.d(s,"a",(function(){return P})),n.d(s,"h",(function(){return L})),n.d(s,"x",(function(){return I})),n.d(s,"c",(function(){return N})),n.d(s,"n",(function(){return R}));var o="top",a="bottom",u="right",f="left",g="auto",_=[o,a,u,f],b="start",v="end",k="clippingParents",x="viewport",C="popper",E="reference",z=_.reduce((function(e,s){return e.concat([s+"-"+b,s+"-"+v])}),[]),j=[].concat(_,[g]).reduce((function(e,s){return e.concat([s,s+"-"+b,s+"-"+v])}),[]),O="beforeRead",A="read",T="afterRead",D="beforeMain",B="main",P="afterMain",L="beforeWrite",I="write",N="afterWrite",R=[O,A,T,D,B,P,L,I,N]},function(e,s,n){"use strict";n.r(s),n.d(s,"State",(function(){return u})),n.d(s,"Module",(function(){return Module})),n.d(s,"SiteModule",(function(){return SiteModule})),n.d(s,"ModuleError",(function(){return ModuleError})),n.d(s,"CyclicDependencyError",(function(){return CyclicDependencyError}));var o=n(7),a=n(0);const u={UNLOADED:0,LOADING:1,LOADED:2,UNLOADING:3,DISABLED:0,ENABLING:1,ENABLED:2,DISABLING:3};class Module extends o.default{constructor(e,s){!s&&e instanceof Module&&(s=e,e=null),super(e,s),this.__modules=s?s.__modules:{},this.children={},s&&!s.children[this.name]&&(s.children[this.name]=this),this.root===this&&(this.__modules[this.__path||""]=this),this.__load_state=this.onLoad?u.UNLOADED:u.LOADED,this.__state=this.onLoad||this.onEnable?u.DISABLED:u.ENABLED,this.__time("instance"),this.emit(":registered")}get state(){return this.__state}get load_state(){return this.__load_state}get loaded(){return this.__load_state===u.LOADED}get loading(){return this.__load_state===u.LOADING}get enabled(){return this.__state===u.ENABLED}get enabling(){return this.__state===u.ENABLING}get log(){return this.__log||(this.__log=this.parent&&this.parent.log.get(this.name)),this.__log}set log(e){this.__log=e}__time(e){this.root.timing&&("object"!=typeof e&&(e={event:e}),e.module=this.__path||"core",this.root.timing.addEvent(e))}load(...e){return this.__load(e,this.__path,[])}unload(...e){return this.__unload(e,this.__path,[])}enable(...e){return this.__enable(e,this.__path,[])}disable(...e){return this.__disable(e,this.__path,[])}__load(e,s,n){const o=this.__path||this.name,a=this.__load_state;if(n.includes(this))return Promise.reject(new CyclicDependencyError(`cyclic load requirements when loading ${s}`,[...n,this]));if(this.load_requires)for(const e of this.load_requires){const o=this.resolve(e);if(o&&n.includes(o))return Promise.reject(new CyclicDependencyError(`cyclic load requirements when loading ${s}`,[...n,this,o]))}return n.push(this),a===u.LOADING?this.__load_promise:a===u.LOADED?Promise.resolve():a===u.UNLOADING?Promise.reject(new ModuleError(`attempted to load module ${o} while module is being unloaded`)):(this.__time("load-start"),this.__load_state=u.LOADING,this.__load_promise=(async()=>{if(this.load_requires){const e=[];for(const a of this.load_requires){const u=this.resolve(a);if(!(u&&u instanceof Module))throw new ModuleError(`cannot find required module ${a} when loading ${o}`);e.push(u.__enable([],s,Array.from(n)))}await Promise.all(e)}if(this.onLoad)return this.__time("load-self"),this.onLoad(...e)})().then((e=>(this.__load_state=u.LOADED,this.__load_promise=null,this.__time("load-end"),this.emit(":loaded",this),e))).catch((e=>{throw this.__load_state=u.UNLOADED,this.__load_promise=null,this.__time("load-end"),e})))}__unload(e,s,n){const o=this.__path||this.name,a=this.__load_state;if(n.includes(this))return Promise.reject(new CyclicDependencyError(`cyclic load requirements when unloading ${s}`,[...n,this]));if(this.load_dependents)for(const e of this.load_dependents){const o=this.resolve(e);if(o&&n.includes(o))return Promise.reject(new CyclicDependencyError(`cyclic load requirements when unloading ${s}`,[...n,this,o]))}return n.push(this),a===u.UNLOADING?this.__load_promise:a===u.UNLOADED?Promise.resolve():this.onUnload?a===u.LOADING?Promise.reject(new ModuleError(`attempted to unload module ${o} while module is being loaded`)):(this.__time("unload-start"),this.__load_state=u.UNLOADING,this.__load_promise=(async()=>{if(this.__state!==u.DISABLED&&await this.disable(),this.load_dependents){const e=[];for(const o of this.load_dependents){const a=this.resolve(o);a&&e.push(a.__unload([],s,Array.from(n)))}await Promise.all(e)}return this.__time("unload-self"),this.onUnload(...e)})().then((e=>(this.__load_state=u.UNLOADED,this.__load_promise=null,this.__time("unload-end"),this.emit(":unloaded",this),e))).catch((e=>{throw this.__load_state=u.LOADED,this.__load_promise=null,this.__time("unload-end"),e}))):Promise.reject(new ModuleError(`attempted to unload module ${o} but module cannot be unloaded`))}__enable(e,s,n){const o=this.__path||this.name,a=this.__state;if(n.includes(this))return Promise.reject(new CyclicDependencyError(`cyclic requirements when enabling ${s}`,[...n,this]));if(this.requires)for(const e of this.requires){const o=this.resolve(e);if(o&&n.includes(o))return Promise.reject(new CyclicDependencyError(`cyclic requirements when enabling ${s}`,[...n,this,o]))}return n.push(this),a===u.ENABLING?this.__state_promise:a===u.ENABLED?Promise.resolve():a===u.DISABLING?Promise.reject(new ModuleError(`attempted to enable module ${o} while module is being disabled`)):(this.__time("enable-start"),this.__state=u.ENABLING,this.__state_promise=(async()=>{const a=[],f=this.requires,g=this.__load_state;if(g===u.UNLOADING)throw new ModuleError(`attempted to load module ${o} while module is being unloaded`);if(g!==u.LOADING&&g!==u.UNLOADED||a.push(this.load()),f)for(const e of f){const u=this.resolve(e);if(!(u&&u instanceof Module))throw new ModuleError(`cannot find required module ${e} when enabling ${o}`);a.push(u.__enable([],s,Array.from(n)))}if(await Promise.all(a),this.onEnable)return this.__time("enable-self"),this.onEnable(...e)})().then((e=>(this.__state=u.ENABLED,this.__state_promise=null,this.__time("enable-end"),this.emit(":enabled",this),e))).catch((e=>{throw this.__state=u.DISABLED,this.__state_promise=null,this.__time("enable-end"),e})))}__disable(e,s,n){const o=this.__path||this.name,a=this.__state;if(n.includes(this))return Promise.reject(new CyclicDependencyError(`cyclic requirements when disabling ${s}`,[...n,this]));if(this.dependents)for(const e of this.dependents){const o=this.resolve(e);if(o&&n.includes(o))return Promise.reject(new CyclicDependencyError(`cyclic requirements when disabling ${s}`,[...n,this,e]))}return n.push(this),a===u.DISABLING?this.__state_promise:a===u.DISABLED?Promise.resolve():this.onDisable?a===u.ENABLING?Promise.reject(new ModuleError(`attempted to disable module ${o} but module is being enabled`)):(this.__time("disable-start"),this.__state=u.DISABLING,this.__state_promise=(async()=>{if(this.__load_state!==u.LOADED)throw new ModuleError(`attempted to disable module ${o} but module is unloaded -- weird state`);if(this.dependents){const e=[];for(const o of this.dependents){const a=this.resolve(o);a&&e.push(a.__disable([],s,Array.from(n)))}await Promise.all(e)}return this.__time("disable-self"),this.onDisable(...e)})().then((e=>(this.__state=u.DISABLED,this.__state_promise=null,this.__time("disable-end"),this.emit(":disabled",this),e))).catch((e=>{throw this.__state=u.ENABLED,this.__state_promise=null,this.__time("disable-end"),e}))):Promise.reject(new ModuleError(`attempted to disable module ${o} but module cannot be disabled`))}on(e,s,n){return super.on(e,s,void 0===n?this:n)}prependOn(e,s,n){return super.prependOn(e,s,void 0===n?this:n)}many(e,s,n,o){return super.many(e,s,n,void 0===o?this:o)}prependMany(e,s,n,o){return super.prependMany(e,s,n,void 0===o?this:o)}once(e,s,n){return super.once(e,s,void 0===n?this:n)}prependOnce(e,s,n){return super.prependOnce(e,s,void 0===n?this:n)}off(e,s,n){return super.off(e,s,void 0===n?this:n)}loadModules(...e){return Promise.all(e.map((e=>this.resolve(e).load())))}unloadModules(...e){return Promise.all(e.map((e=>this.resolve(e).unload())))}enableModules(...e){return Promise.all(e.map((e=>this.resolve(e).enable())))}disableModules(...e){return Promise.all(e.map((e=>this.resolve(e).disable())))}resolve(e){return e instanceof Module?e:this.__modules[this.abs_path(e)]}hasModule(e){return this.__modules[this.abs_path(e)]instanceof Module}__get_requires(){return Object(a.has)(this,"requires")?this.requires:Object(a.has)(this.constructor,"requires")?this.constructor.requires:void 0}__get_load_requires(){return Object(a.has)(this,"load_requires")?this.load_requires:Object(a.has)(this.constructor,"load_requires")?this.constructor.load_requires:void 0}inject(e,s,n=!0){(e instanceof Module||e.prototype instanceof Module)&&(n=null==s||s,s=e,e=null);const o=this.requires=this.__get_requires()||[];if(s instanceof Module)e||(e=s.constructor.name.toSnakeCase());else if(s&&s.prototype instanceof Module)e||(e=s.name.toSnakeCase()),s=this.register(e,s);else{if(!e)throw new TypeError("must provide a valid module name or class");{const n=e;if(e=e.replace(/^(?:[^.]*\.)+/,""),!((s=this.resolve(n))&&s instanceof Module))return s?s[2].push([this.__path,e]):this.__modules[this.abs_path(n)]=[[],[],[[this.__path,e]]],o.push(this.abs_path(n)),this[e]=null}}if(!s)throw new Error(`cannot find module ${e} or no module provided`);return n&&o.push(s.abs_path(".")),this.enabled&&!s.enabled&&s.enable(),this[e]=s}injectAs(e,s,n,o=!0){(s instanceof Module||s.prototype instanceof Module)&&(o=null==n||n,n=s,s=null);const a=this.requires=this.__get_requires()||[];if(n instanceof Module)s||(s=n.constructor.name.toSnakeCase());else if(n&&n.prototype instanceof Module)s||(s=n.name.toSnakeCase()),n=this.register(s,n);else{if(!s)throw new TypeError("must provide a valid module name or class");{const o=s;if(s=s.replace(/^(?:[^.]*\.)+/,""),!((n=this.resolve(o))&&n instanceof Module))return n?n[2].push([this.__path,e]):this.__modules[this.abs_path(o)]=[[],[],[[this.__path,e]]],a.push(this.abs_path(o)),this[e]=null}}if(!n)throw new Error(`cannot find module ${s} or no module provided`);return o&&a.push(n.abs_path(".")),this.enabled&&!n.enabled&&n.enable(),this[e]=n}register(e,s,n){e.prototype instanceof Module&&(n=s,e=(s=e).name.toSnakeCase());const o=this.abs_path(`.${e}`),a=s.prototype,u=this.__modules[o];if(!(a instanceof Module))throw new TypeError(`Module ${e} is not subclass of Module.`);if(u instanceof Module)throw new ModuleError(`Name Collision for Module ${o}`);const f=u||[[],[],[]],g=this.__modules[o]=new s(e,this),_=g.requires=g.__get_requires()||[],b=g.load_requires=g.__get_load_requires()||[];g.dependents=f[0],g.load_dependents=f[1],g instanceof SiteModule&&!_.includes("site")&&_.push("site");for(const e of _){const s=g.abs_path(e),n=this.__modules[s];n?Array.isArray(n)?n[0].push(o):n.dependents.push(o):this.__modules[s]=[[o],[],[]]}for(const e of b){const s=g.abs_path(e),n=this.__modules[s];n?Array.isArray(n)?n[1].push(o):n.load_dependents.push(o):this.__modules[s]=[[],[o],[]]}for(const[e,s]of f[2]){const n=this.resolve(e);n?n[s]=g:this.log.warn(`Unable to find module "${e}" that wanted "${s}".`)}return n&&(this[e]=g),g}async populate(e,s){s=s||this.log;const n={};for(const o of e.keys()){const a=await e(o),u=a.module||a.default,f=o.lastIndexOf("."),g=f>2?o.slice(2,f):o,_=g.endsWith("/index")?g.slice(0,-6):g;try{n[_]=this.register(_,u)}catch(e){s&&s.capture(e,{extra:{module:_,path:o}}),s&&s.warn(e,`Skipping ${o}`)}}return n}}Module.State=u,Module.prototype.State=u;class SiteModule extends Module{constructor(e,s){super(e,s),this.site=this.resolve("site")}}s.default=Module;class ModuleError extends Error{}class CyclicDependencyError extends ModuleError{constructor(e,s){super(`${e} (${s.map((e=>e.path)).join(" => ")})`),this.modules=s}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return isElement})),n.d(s,"b",(function(){return isHTMLElement})),n.d(s,"c",(function(){return isShadowRoot}));var o=n(8);function isElement(e){return e instanceof Object(o.a)(e).Element||e instanceof Element}function isHTMLElement(e){return e instanceof Object(o.a)(e).HTMLElement||e instanceof HTMLElement}function isShadowRoot(e){return"undefined"!=typeof ShadowRoot&&(e instanceof Object(o.a)(e).ShadowRoot||e instanceof ShadowRoot)}},function(e,s,n){"use strict";n.d(s,"a",(function(){return o})),n.d(s,"b",(function(){return a})),n.d(s,"c",(function(){return u}));var o=Math.max,a=Math.min,u=Math.round},function(e,s,n){"use strict";n.r(s),n.d(s,"EventEmitter",(function(){return EventEmitter})),n.d(s,"FFZEvent",(function(){return FFZEvent})),n.d(s,"HierarchicalEventEmitter",(function(){return HierarchicalEventEmitter}));var o=n(0);const a=Symbol("Detach"),u=Symbol("StopPropagation"),f=/([a-z])([A-Z])/g,g=/[ \t\W]/g,_=/^_+|_+$/g;String.prototype.toSnakeCase=function(){return this.replace(f,"$1_$2").replace(g,"_").replace(_,"").toLowerCase()};class EventEmitter{constructor(){this.__listeners={},this.__running=new Set,this.__dead_events=0}__cleanListeners(){if(!this.__dead_events)return;const e={},s=this.__listeners;for(const n in s)if(Object(o.has)(s,n)){const o=s[n];o&&(e[n]=o)}this.__listeners=e,this.__dead_events=0}on(e,s,n){if("function"!=typeof s)throw new TypeError("fn must be a function");(this.__listeners[e]=this.__listeners[e]||[]).push([s,n,!1])}prependOn(e,s,n){if("function"!=typeof s)throw new TypeError("fn must be a function");(this.__listeners[e]=this.__listeners[e]||[]).unshift([s,n,!1])}once(e,s,n){return this.many(e,1,s,n)}prependOnce(e,s,n){return this.prependMany(e,1,s,n)}many(e,s,n,o){if("function"!=typeof n)throw new TypeError("fn must be a function");if("number"!=typeof s||isNaN(s)||!isFinite(s)||s<1)throw new TypeError("ttl must be a positive, finite number");(this.__listeners[e]=this.__listeners[e]||[]).push([n,o,s])}prependMany(e,s,n,o){if("function"!=typeof n)throw new TypeError("fn must be a function");if("number"!=typeof s||isNaN(s)||!isFinite(s)||s<1)throw new TypeError("ttl must be a positive, finite number");(this.__listeners[e]=this.__listeners[e]||[]).unshift([n,o,s])}waitFor(e){return new Promise((s=>{(this.__listeners[e]=this.__listeners[e]||[]).push([s,null,1])}))}off(e,s,n){if(this.__running.has(e))throw new Error("concurrent modification: tried removing event listener while event is running");let o=this.__listeners[e];o&&(s?(o=o.filter((([e,o])=>!(e===s&&(!n||n===o)))),o.length||(o=null)):o=null,this.__listeners[e]=o,o||this.__dead_events++)}events(){return this.__cleanListeners(),Object.keys(this.__listeners)}listeners(e){const s=this.__listeners[e];return s?Array.from(s):[]}hasListeners(e){return!!this.__listeners[e]}emitUnsafe(e,...s){let n=this.__listeners[e];if(!n)return;if(this.__running.has(e))throw new Error("concurrent access: tried to emit event while event is running");const o=new Set;this.__listeners[e]=null,this.__running.add(e);for(const e of n){const[n,f,g]=e,_=n.apply(f,s);if(_===a?o.add(e):!1!==g&&(g<=1?o.add(e):e[2]=g-1),s[0]instanceof FFZEvent&&s[0].propagationStopped||_===u)break}if(o.size)for(const e of o){const s=n.indexOf(e);-1!==s&&n.splice(s,1)}this.__listeners[e]&&(n=n.concat(this.__listeners[e])),n.length?this.__listeners[e]=n:(this.__listeners[e]=null,this.__dead_events++),this.__running.delete(e)}emit(e,...s){let n=this.__listeners[e];if(!n)return;if(this.__running.has(e))throw new Error("concurrent access: tried to emit event while event is running");const o=new Set;this.__listeners[e]=null,this.__running.add(e);for(const f of n){const[n,g,_]=f;let b;try{b=n.apply(g,s)}catch(n){this.log&&(this.log.capture(n,{tags:{event:e},extra:{args:s}}),this.log.error(n))}if(b===a?o.add(f):!1!==_&&(_<=1?o.add(f):f[2]=_-1),s[0]instanceof FFZEvent&&s[0].propagationStopped||b===u)break}if(o.size)for(const e of o){const s=n.indexOf(e);-1!==s&&n.splice(s,1)}this.__listeners[e]&&(n=n.concat(this.__listeners[e])),n.length?this.__listeners[e]=n:(this.__listeners[e]=null,this.__dead_events++),this.__running.delete(e)}async emitAsync(e,...s){let n=this.__listeners[e];if(!n)return[];if(this.__running.has(e))throw new Error("concurrent access: tried to emit event while event is running");const o=new Set,u=[];this.__listeners[e]=null,this.__running.add(e);for(const f of n){const[n,g]=f;let _;try{_=n.apply(g,s)}catch(n){this.log&&this.log.capture(n,{tags:{event:e},extra:{args:s}})}_ instanceof Promise||(_=Promise.resolve(_)),u.push(_.then((e=>{const s=f[2];if(e===a?o.add(f):!1!==s&&(s<=1?o.add(f):f[2]=s-1),_!==a)return _})).catch((n=>(this.log&&this.log.capture(n,{event:e,args:s}),null))))}const f=await Promise.all(u);if(o.size)for(const e of o){const s=n.indexOf(e);-1!==s&&n.splice(s,1)}return this.__listeners[e]&&(n=n.concat(this.__listeners[e])),n.length?this.__listeners[e]=n:(this.__listeners[e]=null,this.__dead_events++),this.__running.delete(e),f}}EventEmitter.Detach=a,EventEmitter.StopPropagation=u;class FFZEvent{constructor(e){this.defaultPrevented=!1,this.propagationStopped=!1,Object.assign(this,e)}_reset(){this.defaultPrevented=!1,this.propagationStopped=!1}stopPropagation(){this.propagationStopped=!0}preventDefault(){this.defaultPrevented=!0}}class HierarchicalEventEmitter extends EventEmitter{constructor(e,s){super(),this.name=e||(this.constructor.name||"").toSnakeCase(),this.parent=s,s?(this.root=s.root,this.__listeners=s.__listeners,this.__path=e&&s.__path?`${s.__path}.${e}`:e):(this.root=this,this.__path=void 0),this.__path_parts=this.__path?this.__path.split("."):[]}get path(){return this.__path}abs_path(e){if("string"!=typeof e||!e.length)throw new TypeError("path must be a non-empty string");let s,n=0;const o=this.__path_parts,a=o.length;do{if(s=e.charAt(n),"."!==e.charAt(n))break;if(n>a)throw new Error("invalid path: reached top of stack")}while(++n<e.length);const u=":"===s;if(0===n)return u&&this.__path?`${this.__path}${e}`:e;const f=o.slice(0,a-(n-1)).join("."),g=e.slice(n);return f.length?g.length?u?f+g:`${f}.${g}`:f:g}on(e,s,n){return super.on(this.abs_path(e),s,n)}prependOn(e,s,n){return super.prependOn(this.abs_path(e),s,n)}once(e,s,n){return super.once(this.abs_path(e),s,n)}prependOnce(e,s,n){return super.prependOnce(this.abs_path(e),s,n)}many(e,s,n,o){return super.many(this.abs_path(e),s,n,o)}prependMany(e,s,n,o){return super.prependMany(this.abs_path(e),s,n,o)}waitFor(e){return super.waitFor(this.abs_path(e))}off(e,s,n){return super.off(this.abs_path(e),s,n)}listeners(e){return super.listeners(this.abs_path(e))}hasListeners(e){return super.hasListeners(this.abs_path(e))}emit(e,...s){return super.emit(this.abs_path(e),...s)}emitUnsafe(e,...s){return super.emitUnsafe(this.abs_path(e),...s)}emitAsync(e,...s){return super.emitAsync(this.abs_path(e),...s)}events(e){this.__cleanListeners();const s=Object.keys(this.__listeners),n=this.__path||"",o=n.length;return s.filter((s=>{const a=s.charAt(o);return s.startsWith(n)&&(""===a||e&&"."===a||":"===a)}))}}s.default=HierarchicalEventEmitter},function(e,s,n){"use strict";function getWindow(e){if(null==e)return window;if("[object Window]"!==e.toString()){var s=e.ownerDocument;return s&&s.defaultView||window}return e}n.d(s,"a",(function(){return getWindow}))},function(e,s,n){"use strict";function getBasePlacement(e){return e.split("-")[0]}n.d(s,"a",(function(){return getBasePlacement}))},function(e,s,n){"use strict";function getBuster(e=5){const s=Math.floor(Date.now()/1e3);return s-s%e}function duration_to_string(e,s,n,o,a){const u=e%60;let f=Math.floor(e/60),g=Math.floor(f/60),_="";if(f%=60,s){if(_=Math.floor(g/24),g%=24,n&&_>0)return`${_} days`;_=_>0?`${_} days, `:""}const b=!o||_||g;return`${_}${b?`${_&&g<10?"0":""}${g}:`:""}${b&&f<10?"0":""}${f}${a?"":`:${u<10?"0":""}${u}`}`}function print_duration(e){let s=Math.floor(e/60);const n=Math.floor(s/60);return s%=60,`${n>0?`${n}:${s<10?"0":""}`:""}${s}:${(e%=60)<10?"0":""}${e}`}function durationForChat(e){const s=e%60;let n=Math.floor(e/60),o=Math.floor(n/60);const a=Math.floor(o/24);return n%=60,o%=24,`${a>0?`${a}d`:""}${o>0?`${o}h`:""}${n>0?`${n}m`:""}${s>0?`${s}s`:""}`}function durationForURL(e){const s=e%60;let n=Math.floor(e/60);const o=Math.floor(n/60);return n%=60,`${o>0?`${o}h`:""}${n>0?`${n}m`:""}${s>0?`${s}s`:""}`}n.r(s),n.d(s,"getBuster",(function(){return getBuster})),n.d(s,"duration_to_string",(function(){return duration_to_string})),n.d(s,"print_duration",(function(){return print_duration})),n.d(s,"durationForChat",(function(){return durationForChat})),n.d(s,"durationForURL",(function(){return durationForURL}))},function(e,s,n){"use strict";function hue2rgb(e,s,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(s-e)*n:n<.5?s:n<2/3?e+(s-e)*(2/3-n)*6:e}function bit2linear(e){return e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function linear2bit(e){return e<=.0031308?12.92*e:Math.pow(1.055*e,1/2.4)-.055}n.r(s),n.d(s,"hue2rgb",(function(){return hue2rgb})),n.d(s,"bit2linear",(function(){return bit2linear})),n.d(s,"linear2bit",(function(){return linear2bit})),n.d(s,"Color",(function(){return o})),n.d(s,"ColorAdjuster",(function(){return ColorAdjuster}));const o={_canvas:null,_context:null,CVDMatrix:{protanope:[0,2.02344,-2.52581,0,1,0,0,0,1],deuteranope:[1,0,0,.494207,0,1.24827,0,0,1],tritanope:[1,0,0,0,1,0,-.395913,.801109,0]}},a=o.RGBA=function(e,s,n,o){this.r=e||0,this.g=s||0,this.b=n||0,this.a=o||0},u=o.HSVA=function(e,s,n,o){this.h=e||0,this.s=s||0,this.v=n||0,this.a=o||0},f=o.HSLA=function(e,s,n,o){this.h=e||0,this.s=s||0,this.l=n||0,this.a=o||0},g=o.XYZA=function(e,s,n,o){this.x=e||0,this.y=s||0,this.z=n||0,this.a=o||0},_=o.LUVA=function(e,s,n,o){this.l=e||0,this.u=s||0,this.v=n||0,this.a=o||0};a.prototype.eq=function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b&&e.a===this.a},a.fromName=function(e){let s=o._context;if(!s){const e=o._canvas=document.createElement("canvas");s=o._context=e.getContext("2d")}s.clearRect(0,0,1,1),s.fillStyle=e,s.fillRect(0,0,1,1);const n=s.getImageData(0,0,1,1);return n&&n.data&&4===n.data.length?new a(n.data[0],n.data[1],n.data[2],n.data[3]/255):null},a.fromCSS=function(e){if(!e)return null;if("#"===(e=e.trim()).charAt(0))return a.fromHex(e);const s=/rgba?\( *(\d+%?) *, *(\d+%?) *, *(\d+%?) *(?:, *([\d.]+))?\)/i.exec(e);if(s){let e=s[1],n=s[2],o=s[3],u=s[4];return e="%"===e.charAt(e.length-1)?parseInt(e,10)/100*255:parseInt(e,10),n="%"===n.charAt(n.length-1)?parseInt(n,10)/100*255:parseInt(n,10),o="%"===o.charAt(o.length-1)?parseInt(o,10)/100*255:parseInt(o,10),u=u?"%"===u.charAt(u.length-1)?parseInt(u,10)/100:parseFloat(u):1,new a(Math.min(Math.max(0,e),255),Math.min(Math.max(0,n),255),Math.min(Math.max(0,o),255),Math.min(Math.max(0,u),1))}return a.fromName(e)},a.fromHex=function(e,s=1){if("#"===e.charAt(0)&&(e=e.slice(1)),3===e.length?e=`${e[0]}${e[0]}${e[1]}${e[1]}${e[2]}${e[2]}`:4===e.length&&(e=`${e[0]}${e[0]}${e[1]}${e[1]}${e[2]}${e[2]}${e[3]}${e[3]}`),8===e.length)s=parseInt(e.slice(6),16)/255,e=e.slice(0,6);else if(6!==e.length)throw new Error("invalid hex code");const n=parseInt(e,16);return new a(n>>16,n>>8&255,255&n,s)},a.fromHSVA=function(e,s,n,o){let u,f,g;const _=Math.floor(6*e),b=6*e-_,v=n*(1-s),k=n*(1-b*s),x=n*(1-(1-b)*s);switch(_%6){case 0:u=n,f=x,g=v;break;case 1:u=k,f=n,g=v;break;case 2:u=v,f=n,g=x;break;case 3:u=v,f=k,g=n;break;case 4:u=x,f=v,g=n;break;case 5:u=n,f=v,g=k}return new a(Math.round(Math.min(Math.max(0,255*u),255)),Math.round(Math.min(Math.max(0,255*f),255)),Math.round(Math.min(Math.max(0,255*g),255)),void 0===o?1:o)},a.fromXYZA=function(e,s,n,o){const u=3.240479*e-1.53715*s-.498535*n,f=-.969256*e+1.875992*s+.041556*n,g=.055648*e-.204043*s+1.057311*n;return new a(Math.max(0,Math.min(255,255*linear2bit(u))),Math.max(0,Math.min(255,255*linear2bit(f))),Math.max(0,Math.min(255,255*linear2bit(g))),void 0===o?1:o)},a.fromHSLA=function(e,s,n,o){if(0===s){const e=Math.round(Math.min(Math.max(0,255*n),255));return new a(e,e,e,void 0===o?1:o)}const u=n<.5?n*(1+s):n+s-n*s,f=2*n-u;return new a(Math.round(Math.min(Math.max(0,255*hue2rgb(f,u,e+1/3)),255)),Math.round(Math.min(Math.max(0,255*hue2rgb(f,u,e)),255)),Math.round(Math.min(Math.max(0,255*hue2rgb(f,u,e-1/3)),255)),void 0===o?1:o)},a.prototype.toRGBA=function(){return this},a.prototype.toHSVA=function(){return u.fromRGBA(this.r,this.g,this.b,this.a)},a.prototype.toHSLA=function(){return f.fromRGBA(this.r,this.g,this.b,this.a)},a.prototype.toCSS=function(){return`rgb${1!==this.a?"a":""}(${Math.round(this.r)},${Math.round(this.g)},${Math.round(this.b)}${1!==this.a?`,${this.a}`:""})`},a.prototype.toXYZA=function(){return g.fromRGBA(this.r,this.g,this.b,this.a)},a.prototype.toLUVA=function(){return this.toXYZA().toLUVA()},a.prototype.toHex=function(){return`#${(16777216+(this.b|this.g<<8|this.r<<16)).toString(16).slice(1)}`},a.prototype.get_Y=function(){return(.299*this.r+.587*this.g+.114*this.b)/255},a.prototype.luminance=function(){return.2126*bit2linear(this.r/255)+.7152*bit2linear(this.g/255)+.0722*bit2linear(this.b/255)},a.prototype.brighten=function(e){return e="number"==typeof e?e:1,e=Math.round(e/100*255),new a(Math.max(0,Math.min(255,this.r+e)),Math.max(0,Math.min(255,this.g+e)),Math.max(0,Math.min(255,this.b+e)),this.a)},a.prototype.daltonize=function(e){let s;if("string"==typeof e){if(!o.CVDMatrix.hasOwnProperty(e))throw new Error("Invalid CVD matrix");s=o.CVDMatrix[e]}else s=e;const n=s[0],u=s[1],f=s[2],g=s[3],_=s[4],b=s[5],v=s[6],k=s[7],x=s[8],C=17.8824*this.r+43.5161*this.g+4.11935*this.b,E=3.45565*this.r+27.1554*this.g+3.86714*this.b,z=.0299566*this.r+.184309*this.g+1.46709*this.b,j=n*C+u*E+f*z,O=g*C+_*E+b*z,A=v*C+k*E+x*z;let T=.0809444479*j+-.130504409*O+.116721066*A,D=-.0102485335*j+.0540193266*O+-.113614708*A,B=-.000365296938*j+-.00412161469*O+.693511405*A;T=this.r-T,D=this.g-D,B=this.b-B;const P=0*T+0*D+0*B,L=.7*T+1*D+0*B,I=.7*T+0*D+1*B;return T=Math.min(Math.max(0,P+this.r),255),D=Math.min(Math.max(0,L+this.g),255),B=Math.min(Math.max(0,I+this.b),255),new a(T,D,B,this.a)},a.prototype._r=function(e){return new a(e,this.g,this.b,this.a)},a.prototype._g=function(e){return new a(this.r,e,this.b,this.a)},a.prototype._b=function(e){return new a(this.r,this.g,e,this.a)},a.prototype._a=function(e){return new a(this.r,this.g,this.b,e)},f.prototype.eq=function(e){return e.h===this.h&&e.s===this.s&&e.l===this.l&&e.a===this.a},f.fromRGBA=function(e,s,n,o){e/=255,s/=255,n/=255;const a=Math.max(e,s,n),u=Math.min(e,s,n),g=Math.min(Math.max(0,(a+u)/2),1),_=Math.min(Math.max(0,a-u),1);let b,v;if(0===_)b=v=0;else{switch(v=g>.5?_/(2-a-u):_/(a+u),a){case e:b=(s-n)/_+(s<n?6:0);break;case s:b=(n-e)/_+2;break;case n:b=(e-s)/_+4}b/=6}return new f(b,v,g,void 0===o?1:o)},f.prototype.targetLuminance=function(e){let s=this.s,n=0,o=1;s*=Math.pow(this.l>.5?-this.l:this.l-1,7)+1;let u=(o-n)/2,g=n+u;for(;u>1/65536;u/=2,g=n+u){a.fromHSLA(this.h,s,g,1).luminance()>e?o=g:n=g}return new f(this.h,s,g,this.a)},f.prototype.toRGBA=function(){return a.fromHSLA(this.h,this.s,this.l,this.a)},f.prototype.toCSS=function(){return`hsl${1!==this.a?"a":""}(${Math.round(360*this.h)},${Math.round(100*this.s)}%,${Math.round(100*this.l)}%${1!==this.a?`,${this.a}`:""})`},f.prototype.toHSLA=function(){return this},f.prototype.toHSVA=function(){return this.toRGBA().toHSVA()},f.prototype.toXYZA=function(){return this.toRGBA().toXYZA()},f.prototype.toLUVA=function(){return this.toRGBA().toLUVA()},f.prototype._h=function(e){return new f(e,this.s,this.l,this.a)},f.prototype._s=function(e){return new f(this.h,e,this.l,this.a)},f.prototype._l=function(e){return new f(this.h,this.s,e,this.a)},f.prototype._a=function(e){return new f(this.h,this.s,this.l,e)},u.prototype.eq=function(e){return e.h===this.h&&e.s===this.s&&e.v===this.v&&e.a===this.a},u.fromRGBA=function(e,s,n,o){e/=255,s/=255,n/=255;const a=Math.max(e,s,n),f=Math.min(e,s,n),g=Math.min(Math.max(0,a-f),1),_=0===a?0:g/a,b=a;let v;if(0===g)v=0;else{switch(a){case e:v=(s-n)/g+(s<n?6:0);break;case s:v=(n-e)/g+2;break;case n:v=(e-s)/g+4}v/=6}return new u(v,_,b,void 0===o?1:o)},u.prototype.toRGBA=function(){return a.fromHSVA(this.h,this.s,this.v,this.a)},u.prototype.toHSVA=function(){return this},u.prototype.toHSLA=function(){return this.toRGBA().toHSLA()},u.prototype.toXYZA=function(){return this.toRGBA().toXYZA()},u.prototype.toLUVA=function(){return this.toRGBA().toLUVA()},u.prototype._h=function(e){return new u(e,this.s,this.v,this.a)},u.prototype._s=function(e){return new u(this.h,e,this.v,this.a)},u.prototype._v=function(e){return new u(this.h,this.s,e,this.a)},u.prototype._a=function(e){return new u(this.h,this.s,this.v,e)},g.prototype.eq=function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},g.fromRGBA=function(e,s,n,o){const a=bit2linear(e/255),u=bit2linear(s/255),f=bit2linear(n/255);return new g(.412453*a+.35758*u+.180423*f,.212671*a+.71516*u+.072169*f,.019334*a+.119193*u+.950227*f,void 0===o?1:o)},g.fromLUVA=function(e,s,n,o){const a=1/(g.WHITE.x+15*g.WHITE.y+3*g.WHITE.z),u=4*g.WHITE.x*a,f=9*g.WHITE.y*a,_=e>8?Math.pow((e+16)/116,3):e/g.KAPPA,b=1/3*(52*e/(s+13*e*u)-1),v=-5*_,k=(_*(39*e/(n+13*e*f)-5)-v)/(b- -1/3);return new g(k,_,k*b+v,void 0===o?1:o)},g.prototype.toRGBA=function(){return a.fromXYZA(this.x,this.y,this.z,this.a)},g.prototype.toLUVA=function(){return _.fromXYZA(this.x,this.y,this.z,this.a)},g.prototype.toHSLA=function(){return this.toRGBA().toHSLA()},g.prototype.toHSVA=function(){return this.toRGBA().toHSVA()},g.prototype.toXYZA=function(){return this},g.prototype._x=function(e){return new g(e,this.y,this.z,this.a)},g.prototype._y=function(e){return new g(this.x,e,this.z,this.a)},g.prototype._z=function(e){return new g(this.x,this.y,e,this.a)},g.prototype._a=function(e){return new g(this.x,this.y,this.z,e)},g.EPSILON=Math.pow(6/29,3),g.KAPPA=Math.pow(29/3,3),g.WHITE=new a(255,255,255,1).toXYZA(),_.prototype.eq=function(e){return e.l===this.l&&e.u===this.u&&e.v===this.v},_.fromXYZA=function(e,s,n,o){const a=1/(g.WHITE.x+15*g.WHITE.y+3*g.WHITE.z),u=4*g.WHITE.x*a,f=9*g.WHITE.y*a,b=s/g.WHITE.y;let v=e+15*s+3*n;0===v&&(v=1);const k=1/v,x=4*e*k,C=9*s*k,E=b>g.EPSILON?116*Math.pow(b,1/3)-16:g.KAPPA*b;return new _(E,13*E*(x-u),13*E*(C-f),void 0===o?1:o)},_.prototype.toXYZA=function(){return g.fromLUVA(this.l,this.u,this.v,this.a)},_.prototype.toRGBA=function(){return this.toXYZA().toRGBA()},_.prototype.toHSLA=function(){return this.toXYZA().toHSLA()},_.prototype.toHSVA=function(){return this.toXYZA().toHSVA()},_.prototype.toLUVA=function(){return this},_.prototype._l=function(e){return new _(e,this.u,this.v,this.a)},_.prototype._u=function(e){return new _(this.l,e,this.v,this.a)},_.prototype._v=function(e){return new _(this.l,this.u,e,this.a)},_.prototype._a=function(e){return new _(this.l,this.u,this.v,e)};class ColorAdjuster{constructor(e="#232323",s=0,n=4.5){this._contrast=n,this._base=e,this._mode=s,this.rebuildContrast()}get contrast(){return this._contrast}set contrast(e){this._contrast=e,this.rebuildContrast()}get base(){return this._base}set base(e){this._base=e,this.rebuildContrast()}get dark(){return this._dark}get mode(){return this._mode}set mode(e){this._mode=e,this.rebuildContrast()}rebuildContrast(){this._cache=new Map;const e=a.fromCSS(this._base),s=e.luminance();(this._dark=s<.5)?(this._luv=new g(0,this._contrast*(e.toXYZA().y+.05)-.05,0,1).toLUVA().l,this._luma=this._contrast*(e.luminance()+.05)-.05):(this._luv=new g(0,(e.toXYZA().y+.05)/this._contrast-.05,0,1).toLUVA().l,this._luma=(e.luminance()+.05)/this._contrast-.05)}process(e,s=!1){if(-1===this._mode)return"";if(0===this._mode)return e;if(e instanceof a&&(e=e.toCSS()),!e)return null;if(this._cache.has(e))return this._cache.get(e);let n;try{n=a.fromCSS(e)}catch(e){if(s)throw e;return null}if(1===this._mode){const e=n.luminance();(this._dark?e<this._luma:e>this._luma)&&(n=n.toHSLA().targetLuminance(this._luma).toRGBA())}else if(2===this._mode){const e=n.toLUVA();(this._dark?e.l<this._luv:e.l>this._luv)&&(n=e._l(this._luv).toRGBA())}else if(3===this._mode)if(this._dark)for(;n.get_Y()<.5;){const e=n.toHSLA();n=e._l(Math.min(Math.max(0,.1+.9*e.l),1)).toRGBA()}else for(;n.get_Y()>=.5;){const e=n.toHSLA();n=e._l(Math.min(Math.max(0,.9*e.l),1)).toRGBA()}else if(4===this._mode){let e=0;if(this._dark)for(;n.luminance()<.15&&e++<127;)n=n.brighten();else for(;n.luminance()>.3&&e++<127;)n=n.brighten(-1)}const o=n.toCSS();return this._cache.set(e,o),o}}},function(e,s,n){"use strict";function getNodeName(e){return e?(e.nodeName||"").toLowerCase():null}n.d(s,"a",(function(){return getNodeName}))},function(e,s,n){"use strict";n.d(s,"a",(function(){return getDocumentElement}));var o=n(5);function getDocumentElement(e){return((Object(o.a)(e)?e.ownerDocument:e.document)||window.document).documentElement}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getComputedStyle}));var o=n(8);function getComputedStyle(e){return Object(o.a)(e).getComputedStyle(e)}},function(e,s,n){"use strict";n.d(s,"a",(function(){return detectOverflow}));var o=n(93),a=n(13),u=n(19),f=n(62),g=n(48),_=n(3),b=n(5),v=n(63),k=n(65);function detectOverflow(e,s){void 0===s&&(s={});var n=s,x=n.placement,C=void 0===x?e.placement:x,E=n.boundary,z=void 0===E?_.j:E,j=n.rootBoundary,O=void 0===j?_.w:j,A=n.elementContext,T=void 0===A?_.p:A,D=n.altBoundary,B=void 0!==D&&D,P=n.padding,L=void 0===P?0:P,I=Object(v.a)("number"!=typeof L?L:Object(k.a)(L,_.e)),N=T===_.p?_.r:_.p,R=e.rects.popper,U=e.elements[B?N:T],q=Object(o.a)(Object(b.a)(U)?U:U.contextElement||Object(a.a)(e.elements.popper),z,O),H=Object(u.a)(e.elements.reference),G=Object(f.a)({reference:H,element:R,strategy:"absolute",placement:C}),V=Object(g.a)(Object.assign({},R,G)),W=T===_.p?V:H,K={top:q.top-W.top+I.top,bottom:W.bottom-q.bottom+I.bottom,left:q.left-W.left+I.left,right:W.right-q.right+I.right},Z=e.modifiersData.offset;if(T===_.p&&Z){var J=Z[C];Object.keys(K).forEach((function(e){var s=[_.s,_.i].indexOf(e)>=0?1:-1,n=[_.u,_.i].indexOf(e)>=0?"y":"x";K[e]+=J[n]*s}))}return K}},function(e,s,n){"use strict";n.d(s,"a",(function(){return Twilight}));var o=n(87),a=n(311),u=n(312),f=n(88),g=n(119),_=n(110),b=n(111),v=n(313),k=n(314),x=n(1),C=n(0),E=n(315),z=n.n(E);class Twilight extends o.a{constructor(...e){super(...e),this.inject(a.a),this.inject(f.a),this.inject(u.a),this.inject("router",g.a),this.inject(_.default,!1),this.inject(b.default),this.inject(k.a),this.inject(v.a),this._dom_updates=[]}async populateModules(){const e=await n(379),s=await this.populate(e,this.log);this.log.info(`Loaded descriptions of ${Object.keys(s).length} modules.`)}async onLoad(){await this.populateModules(),this.web_munch.known(Twilight.KNOWN_MODULES),this.router.route(Twilight.ROUTES),this.router.routeName(Twilight.ROUTE_NAMES),this.router.route("user","/:userName",null,(e=>"Home"!==(null==e?void 0:e.channelView))),this.router.route("user-home","/:userName",null,(e=>"Home"===(null==e?void 0:e.channelView))),this.router.route(Twilight.DASH_ROUTES,"dashboard.twitch.tv"),this.router.route(Twilight.PLAYER_ROUTES,"player.twitch.tv"),this.router.route(Twilight.CLIP_ROUTES,"clips.twitch.tv")}onEnable(){var e;this.settings=this.resolve("settings");const s=this.fine.searchNode(null,(e=>{var s,n;return null==e||null===(s=e.pendingProps)||void 0===s||null===(n=s.store)||void 0===n?void 0:n.getState})),n=this.store=null==s||null===(e=s.pendingProps)||void 0===e?void 0:e.store;if(!n)return new Promise((e=>setTimeout(e,50))).then((()=>this.onEnable()));this.on(":dom-update",((...e)=>{this._dom_updates.push(e),this._dom_frame||(this._dom_frame=requestAnimationFrame((()=>{const e=this._dom_updates,s=this.resolve("core");this._dom_updates=[],this._dom_frame=null;for(const[n,o]of e){const e=this.fine.getChildNode(o);s.emit("core:dom-update",n,e,o)}})))}));const update_size=()=>this.settings.updateContext({size:{height:window.innerHeight,width:window.innerWidth}});window.addEventListener("resize",update_size),update_size(),n.subscribe((()=>this.updateContext())),this.updateContext(),this.router.on(":route",((e,s)=>{this.log.info("Navigation",e&&e.name,s&&s[0]),this.fine.route(e&&e.name),this.elemental.route(e&&e.name),this.settings.updateContext({route:e,route_data:s})}));const o=this.router.current;this.fine.route(o&&o.name),this.elemental.route(o&&o.name),this.settings.updateContext({route:o,route_data:this.router.match}),document.head.appendChild(Object(x.createElement)("link",{href:z.a,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"}));const a=new URL(window.location).searchParams;if(a&&(a.has("ffz-settings")&&this.resolve("main_menu").openExclusive(),a.has("ffz-translate"))){const e=this.resolve("translation_ui");e.dialog.exclusive=!0,e.enable()}}updateContext(){try{const e=this.store.getState(),s=this.router&&this.router.history;this.settings.updateContext({location:s&&s.location,ui:e&&e.ui,session:e&&e.session,chat:e&&e.chat})}catch(e){this.log.error("Error updating context.",e)}}getSession(){const e=this.store&&this.store.getState();return e&&e.session}getUser(){if(this._user)return this._user;const e=this.getSession();return this._user=e&&e.user}getCore(){return this._core||(this._core=this.web_munch.getModule("core")),this._core}}const j="_calculateChangedBits";Twilight.KNOWN_MODULES={simplebar:e=>e.globalObserver&&e.initDOMLoadedElements,react:e=>e.Component&&e.createElement,core:e=>{var s,n,o,a;return null!==(s=e.$6)&&void 0!==s&&s.experiments?e.$6:null!==(n=e.p)&&void 0!==n&&n.experiments?e.p:null!==(o=e.o)&&void 0!==o&&o.experiments?e.o:null!==(a=e.q)&&void 0!==a&&a.experiments?e.q:void 0},cookie:e=>e&&e.set&&e.get&&e.getJSON&&e.withConverter,"extension-service":e=>e.extensionService,"chat-types":e=>Object(C.has)(e.b,"Message")&&Object(C.has)(e.b,"RoomMods")?{automod:e.a,chat:e.b,message:e.c,mod:e.e}:Object(C.has)(e.SJ,"Message")&&Object(C.has)(e.SJ,"RoomMods")?{automod:e.mT,chat:e.SJ,message:e.Ay,mod:e.Aw}:void 0,"gql-printer":e=>{if(e!==window)return e.print&&e.print.toString().includes(".visit")?e.print:e.S&&e.S.toString().includes(".visit")?e.S:void 0},mousetrap:e=>e.bindGlobal&&e.unbind&&e.handleKey,"algolia-search":e=>{var s,n,o,a;return null!==(s=e.a)&&void 0!==s&&null!==(n=s.prototype)&&void 0!==n&&n.queryTopResults&&e.a.prototype.queryForType?e.a:null!==(o=e.w9)&&void 0!==o&&null!==(a=o.prototype)&&void 0!==a&&a.queryTopResults&&e.w9.prototype.queryForType?e.w9:void 0},highlightstack:e=>Object(C.has)(e.b,j)&&Object(C.has)(e.c,j)?{stack:e.b,dispatch:e.c}:Object(C.has)(e.fQ,j)&&Object(C.has)(e.vJ,j)?{stack:e.fQ,dispatch:e.vJ}:void 0};const VEND_CHUNK=e=>e&&e.includes("vendor");Twilight.KNOWN_MODULES.core.use_result=!0,Twilight.KNOWN_MODULES.simplebar.chunks=VEND_CHUNK,Twilight.KNOWN_MODULES.react.chunks=VEND_CHUNK,Twilight.KNOWN_MODULES.cookie.chunks=VEND_CHUNK,Twilight.KNOWN_MODULES["gql-printer"].use_result=!0,Twilight.KNOWN_MODULES["gql-printer"].chunks=VEND_CHUNK,Twilight.KNOWN_MODULES.mousetrap.chunks=VEND_CHUNK;const CHAT_CHUNK=e=>e&&e.includes("chat");Twilight.KNOWN_MODULES["chat-types"].use_result=!0,Twilight.KNOWN_MODULES["chat-types"].chunks=CHAT_CHUNK,Twilight.KNOWN_MODULES.highlightstack.use_result=!0,Twilight.KNOWN_MODULES.highlightstack.chunks=CHAT_CHUNK,Twilight.KNOWN_MODULES["algolia-search"].use_result=!0,Twilight.KNOWN_MODULES["algolia-search"].chunks="core",Twilight.POPOUT_ROUTES=["embed-chat","popout","dash-popout-chat","mod-popout-chat"],Twilight.CHAT_ROUTES=["collection","popout","dash-chat","video","user-video","user-home","user-clip","user-videos","user-clips","user-events","user-followers","user-following","user","dash","embed-chat","squad","command-center","dash-stream-manager","dash-popout-chat","mod-view","mod-popout-chat"],Twilight.ROUTE_NAMES={dir:"Browse","dir-following":"Following","dir-all":"Browse Live Channels",dash:"Dashboard",popout:"Popout Chat","dash-popout-chat":"Dashboard Popout Chat","user-video":"Channel Video","popout-player":"Popout/Embed Player"},Twilight.SUNLIGHT_ROUTES=["dash-stream-manager","dash-channel-analytics","dash-stream-summary","dash-achievements","dash-roles","dash-activity","dash-channel-points","dash-video-producer","dash-edit-video","dash-collections","dash-edit-collection","dash-clips","dash-settings-moderation","dash-settings-channel","dash-settings-revenue","dash-extensions","dash-streaming-tools"],Twilight.PLAYER_ROUTES={"popout-player":"/"},Twilight.CLIP_ROUTES={"clip-page":"/:slug"},Twilight.DASH_ROUTES={"dash-stream-manager":"/u/:userName/stream-manager","dash-channel-analytics":"/u/:userName/channel-analytics","dash-stream-summary":"/u/:userName/stream-summary","dash-achievements":"/u/:userName/achievements","dash-roles":"/u/:userName/community/roles","dash-activity":"/u/:userName/community/activity","dash-channel-points":"/u/:userName/community/channel-points","dash-video-producer":"/u/:userName/content/video-producer","dash-edit-video":"/u/:userName/content/video-producer/edit/:videoID","dash-collections":"/u/:userName/content/collections","dash-edit-collection":"/u/:userName/content/collections/:collectionID","dash-clips":"/u/:userName/content/clips","dash-settings-moderation":"/u/:userName/settings/moderation","dash-settings-channel":"/u/:userName/settings/channel","dash-settings-revenue":"/u/:userName/settings/revenue","dash-extensions":"/u/:userName/extensions","dash-streaming-tools":"/u/:userName/broadcast","dash-popout-chat":"/popout/u/:userName/stream-manager/chat"},Twilight.ROUTES={"front-page":"/",collection:"/collections/:collectionID",dir:"/directory","dir-following":"/directory/following/:category?","dir-game-index":"/directory/game/:gameName","dir-game-clips":"/directory/game/:gameName/clips","dir-game-videos":"/directory/game/:gameName/videos/:filter","dir-all":"/directory/all/:filter?",dash:"/:userName/dashboard/:live?",event:"/event/:eventName",popout:"/popout/:userName/chat",video:"/videos/:videoID","user-video":"/:userName/video/:videoID","user-videos":"/:userName/videos/:filter?","user-clips":"/:userName/clips","user-clip":"/:userName/clip/:clipID","user-collections":"/:userName/collections","user-events":"/:userName/events","user-followers":"/:userName/followers","user-following":"/:userName/following",product:"/products/:productName",prime:"/prime",turbo:"/turbo",search:"/search",squad:"/:userName/squad","command-center":"/:userName/commandcenter","embed-chat":"/embed/:userName/chat","mod-view":"/moderator/:userName","mod-popout-chat":"/popout/moderator/:userName/chat"},Twilight.DIALOG_EXCLUSIVE=".moderation-root,.sunlight-root,.twilight-main,.twilight-minimal-root>div,#root>div>.tw-full-height,.clips-root,#root>div>div",Twilight.DIALOG_MAXIMIZED='.moderation-view-page > div[data-highlight-selector="main-grid"],.sunlight-page,.twilight-main,.twilight-minimal-root,#root .dashboard-side-nav+.tw-full-height,.clips-root>.tw-full-height .scrollable-area,.teams-page-body__outer-container .scrollable-area',Twilight.DIALOG_SELECTOR=".moderation-root,.sunlight-root,#root>div,.twilight-minimal-root>.tw-full-height,.clips-root>.tw-full-height .scrollable-area"},function(e,s,n){"use strict";function createTester(e,s,n=!1,o=!1,a){if(!Array.isArray(e)||!s)return n?()=>!1:()=>!0;const u=[],f=[];let g=0;for(const n of e){if(!n||!n.type)continue;const e=s[n.type];if(!e){g++,u.push((()=>!1)),f.push(`f${g}`);continue}const o=e.createTest(n.data,s,a);o&&(g++,u.push(o),f.push(`f${g}`))}return u.length?1===u.length?n?e=>!u[0](e):u[0]:new Function(...f,"ctx",`return ${n?"!(":""}${f.map((e=>`${e}(ctx)`)).join(o?" || ":" && ")}${n?")":""};`).bind(null,...u):n?()=>!1:()=>!0}n.r(s),n.d(s,"createTester",(function(){return createTester}))},function(e,s,n){"use strict";function getVariation(e){return e.split("-")[1]}n.d(s,"a",(function(){return getVariation}))},function(e,s,n){"use strict";function getBoundingClientRect(e,s){void 0===s&&(s=!1);var n=e.getBoundingClientRect();return{width:n.width/1,height:n.height/1,top:n.top/1,right:n.right/1,bottom:n.bottom/1,left:n.left/1,x:n.left/1,y:n.top/1}}n.d(s,"a",(function(){return getBoundingClientRect}))},function(e,s,n){e.exports=function(){"use strict";var e=1e3,s=6e4,n=36e5,o="millisecond",a="second",u="minute",f="hour",g="day",_="week",b="month",v="quarter",k="year",x="date",C="Invalid Date",E=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,z=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,j={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},m=function(e,s,n){var o=String(e);return!o||o.length>=s?e:""+Array(s+1-o.length).join(n)+e},O={s:m,z:function(e){var s=-e.utcOffset(),n=Math.abs(s),o=Math.floor(n/60),a=n%60;return(s<=0?"+":"-")+m(o,2,"0")+":"+m(a,2,"0")},m:function t(e,s){if(e.date()<s.date())return-t(s,e);var n=12*(s.year()-e.year())+(s.month()-e.month()),o=e.clone().add(n,b),a=s-o<0,u=e.clone().add(n+(a?-1:1),b);return+(-(n+(s-o)/(a?o-u:u-o))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:b,y:k,w:_,d:g,D:x,h:f,m:u,s:a,ms:o,Q:v}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},A="en",T={};T[A]=j;var p=function(e){return e instanceof B},S=function(e,s,n){var o;if(!e)return A;if("string"==typeof e)T[e]&&(o=e),s&&(T[e]=s,o=e);else{var a=e.name;T[a]=e,o=a}return!n&&o&&(A=o),o||!n&&A},w=function(e,s){if(p(e))return e.clone();var n="object"==typeof s?s:{};return n.date=e,n.args=arguments,new B(n)},D=O;D.l=S,D.i=p,D.w=function(e,s){return w(e,{locale:s.$L,utc:s.$u,x:s.$x,$offset:s.$offset})};var B=function(){function M(e){this.$L=S(e.locale,null,!0),this.parse(e)}var j=M.prototype;return j.parse=function(e){this.$d=function(e){var s=e.date,n=e.utc;if(null===s)return new Date(NaN);if(D.u(s))return new Date;if(s instanceof Date)return new Date(s);if("string"==typeof s&&!/Z$/i.test(s)){var o=s.match(E);if(o){var a=o[2]-1||0,u=(o[7]||"0").substring(0,3);return n?new Date(Date.UTC(o[1],a,o[3]||1,o[4]||0,o[5]||0,o[6]||0,u)):new Date(o[1],a,o[3]||1,o[4]||0,o[5]||0,o[6]||0,u)}}return new Date(s)}(e),this.$x=e.x||{},this.init()},j.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},j.$utils=function(){return D},j.isValid=function(){return!(this.$d.toString()===C)},j.isSame=function(e,s){var n=w(e);return this.startOf(s)<=n&&n<=this.endOf(s)},j.isAfter=function(e,s){return w(e)<this.startOf(s)},j.isBefore=function(e,s){return this.endOf(s)<w(e)},j.$g=function(e,s,n){return D.u(e)?this[s]:this.set(n,e)},j.unix=function(){return Math.floor(this.valueOf()/1e3)},j.valueOf=function(){return this.$d.getTime()},j.startOf=function(e,s){var n=this,o=!!D.u(s)||s,v=D.p(e),$=function(e,s){var a=D.w(n.$u?Date.UTC(n.$y,s,e):new Date(n.$y,s,e),n);return o?a:a.endOf(g)},l=function(e,s){return D.w(n.toDate()[e].apply(n.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(s)),n)},C=this.$W,E=this.$M,z=this.$D,j="set"+(this.$u?"UTC":"");switch(v){case k:return o?$(1,0):$(31,11);case b:return o?$(1,E):$(0,E+1);case _:var O=this.$locale().weekStart||0,A=(C<O?C+7:C)-O;return $(o?z-A:z+(6-A),E);case g:case x:return l(j+"Hours",0);case f:return l(j+"Minutes",1);case u:return l(j+"Seconds",2);case a:return l(j+"Milliseconds",3);default:return this.clone()}},j.endOf=function(e){return this.startOf(e,!1)},j.$set=function(e,s){var n,_=D.p(e),v="set"+(this.$u?"UTC":""),C=(n={},n[g]=v+"Date",n[x]=v+"Date",n[b]=v+"Month",n[k]=v+"FullYear",n[f]=v+"Hours",n[u]=v+"Minutes",n[a]=v+"Seconds",n[o]=v+"Milliseconds",n)[_],E=_===g?this.$D+(s-this.$W):s;if(_===b||_===k){var z=this.clone().set(x,1);z.$d[C](E),z.init(),this.$d=z.set(x,Math.min(this.$D,z.daysInMonth())).$d}else C&&this.$d[C](E);return this.init(),this},j.set=function(e,s){return this.clone().$set(e,s)},j.get=function(e){return this[D.p(e)]()},j.add=function(o,v){var x,C=this;o=Number(o);var E=D.p(v),y=function(e){var s=w(C);return D.w(s.date(s.date()+Math.round(e*o)),C)};if(E===b)return this.set(b,this.$M+o);if(E===k)return this.set(k,this.$y+o);if(E===g)return y(1);if(E===_)return y(7);var z=(x={},x[u]=s,x[f]=n,x[a]=e,x)[E]||1,j=this.$d.getTime()+o*z;return D.w(j,this)},j.subtract=function(e,s){return this.add(-1*e,s)},j.format=function(e){var s=this,n=this.$locale();if(!this.isValid())return n.invalidDate||C;var o=e||"YYYY-MM-DDTHH:mm:ssZ",a=D.z(this),u=this.$H,f=this.$m,g=this.$M,_=n.weekdays,b=n.months,h=function(e,n,a,u){return e&&(e[n]||e(s,o))||a[n].substr(0,u)},c=function(e){return D.s(u%12||12,e,"0")},v=n.meridiem||function(e,s,n){var o=e<12?"AM":"PM";return n?o.toLowerCase():o},k={YY:String(this.$y).slice(-2),YYYY:this.$y,M:g+1,MM:D.s(g+1,2,"0"),MMM:h(n.monthsShort,g,b,3),MMMM:h(b,g),D:this.$D,DD:D.s(this.$D,2,"0"),d:String(this.$W),dd:h(n.weekdaysMin,this.$W,_,2),ddd:h(n.weekdaysShort,this.$W,_,3),dddd:_[this.$W],H:String(u),HH:D.s(u,2,"0"),h:c(1),hh:c(2),a:v(u,f,!0),A:v(u,f,!1),m:String(f),mm:D.s(f,2,"0"),s:String(this.$s),ss:D.s(this.$s,2,"0"),SSS:D.s(this.$ms,3,"0"),Z:a};return o.replace(z,(function(e,s){return s||k[e]||a.replace(":","")}))},j.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},j.diff=function(o,x,C){var E,z=D.p(x),j=w(o),O=(j.utcOffset()-this.utcOffset())*s,A=this-j,T=D.m(this,j);return T=(E={},E[k]=T/12,E[b]=T,E[v]=T/3,E[_]=(A-O)/6048e5,E[g]=(A-O)/864e5,E[f]=A/n,E[u]=A/s,E[a]=A/e,E)[z]||A,C?T:D.a(T)},j.daysInMonth=function(){return this.endOf(b).$D},j.$locale=function(){return T[this.$L]},j.locale=function(e,s){if(!e)return this.$L;var n=this.clone(),o=S(e,s,!0);return o&&(n.$L=o),n},j.clone=function(){return D.w(this.$d,this)},j.toDate=function(){return new Date(this.valueOf())},j.toJSON=function(){return this.isValid()?this.toISOString():null},j.toISOString=function(){return this.$d.toISOString()},j.toString=function(){return this.$d.toUTCString()},M}(),P=B.prototype;return w.prototype=P,[["$ms",o],["$s",a],["$m",u],["$H",f],["$W",g],["$M",b],["$y",k],["$D",x]].forEach((function(e){P[e[1]]=function(s){return this.$g(s,e[0],e[1])}})),w.extend=function(e,s){return e.$i||(e(s,B,w),e.$i=!0),w},w.locale=S,w.isDayjs=p,w.unix=function(e){return w(1e3*e)},w.en=T[A],w.Ls=T,w.p={},w}()},function(e,s,n){"use strict";n.d(s,"a",(function(){return getOffsetParent}));var o=n(8),a=n(12),u=n(14),f=n(5),g=n(91),_=n(25);function getTrueOffsetParent(e){return Object(f.b)(e)&&"fixed"!==Object(u.a)(e).position?e.offsetParent:null}function getOffsetParent(e){for(var s=Object(o.a)(e),n=getTrueOffsetParent(e);n&&Object(g.a)(n)&&"static"===Object(u.a)(n).position;)n=getTrueOffsetParent(n);return n&&("html"===Object(a.a)(n)||"body"===Object(a.a)(n)&&"static"===Object(u.a)(n).position)?s:n||function getContainingBlock(e){var s=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&Object(f.b)(e)&&"fixed"===Object(u.a)(e).position)return null;for(var n=Object(_.a)(e);Object(f.b)(n)&&["html","body"].indexOf(Object(a.a)(n))<0;){var o=Object(u.a)(n);if("none"!==o.transform||"none"!==o.perspective||"paint"===o.contain||-1!==["transform","perspective"].indexOf(o.willChange)||s&&"filter"===o.willChange||s&&o.filter&&"none"!==o.filter)return n;n=n.parentNode}return null}(e)||s}},,function(e,s,n){"use strict";n.d(s,"b",(function(){return popperGenerator})),n.d(s,"a",(function(){return x}));var o=n(100),a=n(39),u=n(40),f=n(21),g=n(98),_=n(103),b=n(99),v=n(5),k={placement:"bottom",modifiers:[],strategy:"absolute"};function areValidElements(){for(var e=arguments.length,s=new Array(e),n=0;n<e;n++)s[n]=arguments[n];return!s.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function popperGenerator(e){void 0===e&&(e={});var s=e,n=s.defaultModifiers,x=void 0===n?[]:n,C=s.defaultOptions,E=void 0===C?k:C;return function createPopper(e,s,n){void 0===n&&(n=E);var C={placement:"bottom",orderedModifiers:[],options:Object.assign({},k,E),modifiersData:{},elements:{reference:e,popper:s},attributes:{},styles:{}},z=[],j=!1,O={state:C,setOptions:function setOptions(n){var o="function"==typeof n?n(C.options):n;cleanupModifierEffects(),C.options=Object.assign({},E,C.options,o),C.scrollParents={reference:Object(v.a)(e)?Object(u.a)(e):e.contextElement?Object(u.a)(e.contextElement):[],popper:Object(u.a)(s)};var a=Object(g.a)(Object(b.a)([].concat(x,C.options.modifiers)));return C.orderedModifiers=a.filter((function(e){return e.enabled})),function runModifierEffects(){C.orderedModifiers.forEach((function(e){var s=e.name,n=e.options,o=void 0===n?{}:n,a=e.effect;if("function"==typeof a){var u=a({state:C,name:s,instance:O,options:o}),f=function noopFn(){};z.push(u||f)}}))}(),O.update()},forceUpdate:function forceUpdate(){if(!j){var e=C.elements,s=e.reference,n=e.popper;if(areValidElements(s,n)){C.rects={reference:Object(o.a)(s,Object(f.a)(n),"fixed"===C.options.strategy),popper:Object(a.a)(n)},C.reset=!1,C.placement=C.options.placement,C.orderedModifiers.forEach((function(e){return C.modifiersData[e.name]=Object.assign({},e.data)}));for(var u=0;u<C.orderedModifiers.length;u++)if(!0!==C.reset){var g=C.orderedModifiers[u],_=g.fn,b=g.options,v=void 0===b?{}:b,k=g.name;"function"==typeof _&&(C=_({state:C,options:v,name:k,instance:O})||C)}else C.reset=!1,u=-1}}},update:Object(_.a)((function(){return new Promise((function(e){O.forceUpdate(),e(C)}))})),destroy:function destroy(){cleanupModifierEffects(),j=!0}};if(!areValidElements(e,s))return O;function cleanupModifierEffects(){z.forEach((function(e){return e()})),z=[]}return O.setOptions(n).then((function(e){!j&&n.onFirstUpdate&&n.onFirstUpdate(e)})),O}}var x=popperGenerator()},function(e,s,n){"use strict";n.d(s,"a",(function(){return SettingsProfile}));var o=n(7),a=n(0),u=n(17);class SettingsProfile extends o.EventEmitter{constructor(e,s){super(),this.onShortcut=this.onShortcut.bind(this),this._hotkey_enabled=!1,this.manager=e,this.provider=e.provider,this.data=s,this.prefix=`p:${this.id}:`,this.enabled_key=`${this.prefix}:enabled`}get data(){return{id:this.id,parent:this.parent,name:this.name,i18n_key:this.i18n_key,hotkey:this.hotkey,pause_updates:this.pause_updates,description:this.description,desc_i18n_key:this.desc_i18n_key,url:this.url,show_toggle:this.show_toggle,context:this.context}}set data(e){if("object"!=typeof e)throw new TypeError("data must be an object");this.matcher=null;for(const s in e)Object(a.has)(e,s)&&(this[s]=e[s])}matches(e){return this.matcher||(this.matcher=Object(u.createTester)(this.context,this.manager.filters,!1,!1,(()=>this.manager.updateSoon()))),this.matcher(e)}save(){this.manager.saveProfile(this.id)}getBackup(){const e={version:2,type:"profile",profile:this.data,toggled:this.toggled,values:{}};for(const[s,n]of this.entries())e.values[s]=n;return e}async checkUpdate(){if(!this.url||this.pause_updates)return!1;const e=await(s=this.url,fetch(s,n).then((e=>e.ok?e.json():null)).catch((()=>null)));var s,n;if(!e||"profile"===!e.type||!e.profile||!e.values)return!1;delete e.profile.id,delete e.profile.name,delete e.profile.i18n_key,delete e.profile.hotkey,delete e.profile.description,delete e.profile.desc_i18n_key,delete e.profile.url,delete e.profile.pause_updates,this.data=e.profile;const o=new Set(this.keys());for(const[s,n]of Object.entries(e.values))o.delete(s),this.set(s,n);for(const e of o)this.delete(e);return!0}get hotkey(){return this._hotkey}set hotkey(e){e!==this._hotkey&&(this._hotkey=e,this._hotkey_enabled&&this._updateHotkey())}get hotkey_enabled(){return this._hotkey_enabled}set hotkey_enabled(e){this._hotkey_enabled=!!e,this._updateHotkey()}_updateHotkey(){const e=this.Mousetrap=this.Mousetrap||window.Mousetrap;if(!e)return;const s=this._hotkey;!this._bound_key||this._bound_key===s&&this._hotkey_enabled||(e.unbind(this._bound_key),this._bound_key=null),this._hotkey_enabled&&s&&Object(a.isValidShortcut)(s)&&(e.bind(s,this.onShortcut),this._bound_key=s)}onShortcut(e){this.toggled=!this.toggled,e&&(e.stopPropagation(),e.preventDefault())}get toggled(){return this.provider.get(this.enabled_key,!0)}set toggled(e){e!==this.toggleState&&(this.provider.set(this.enabled_key,e),this.emit("toggled",this,e))}updateContext(e){if(0===this.id)throw new Error("cannot set context of default profile");this.context=Object.assign(this.context||{},e),this.matcher=null,this.manager._saveProfiles()}setContext(e){if(0===this.id)throw new Error("cannot set context of default profile");this.context=e,this.matcher=null,this.manager._saveProfiles()}get(e,s){return this.provider.get(this.prefix+e,s)}set(e,s){this.provider.set(this.prefix+e,s),this.emit("changed",e,s)}delete(e){this.provider.delete(this.prefix+e),this.emit("changed",e,void 0,!0)}has(e){return this.provider.has(this.prefix+e)}keys(){const e=[],s=this.prefix,n=s.length;for(const o of this.provider.keys())o.startsWith(s)&&o!==this.enabled_key&&e.push(o.slice(n));return e}clear(){const e=this.prefix,s=e.length;for(const n of this.provider.keys())n.startsWith(e)&&n!==this.enabled_key&&(this.provider.delete(n),this.emit("changed",n.slice(s),void 0,!0))}*entries(){const e=this.prefix,s=e.length;for(const n of this.provider.keys())n.startsWith(e)&&n!==this.enabled_key&&(yield[n.slice(s),this.provider.get(n)])}get size(){const e=this.prefix;let s=0;for(const n of this.provider.keys())n.startsWith(e)&&n!==this.enabled_key&&s++;return s}}SettingsProfile.Default={id:0,name:"Default Profile",i18n_key:"setting.profiles.default",description:"Settings that apply everywhere on Twitch."},SettingsProfile.Moderation={id:1,name:"Moderation",i18n_key:"setting.profiles.moderation",description:"Settings that apply when you are a moderator of the current channel.",context:[{type:"Moderator",data:!0}]}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getParentNode}));var o=n(12),a=n(13),u=n(5);function getParentNode(e){return"html"===Object(o.a)(e)?e:e.assignedSlot||e.parentNode||(Object(u.c)(e)?e.host:null)||Object(a.a)(e)}},function(e,s,n){var o,a;!function(u){if(void 0===(a="function"==typeof(o=u)?o.call(s,n,s,e):o)||(e.exports=a),!0,e.exports=u(),!!0){var f=window.Cookies,g=window.Cookies=u();g.noConflict=function(){return window.Cookies=f,g}}}((function(){function extend(){for(var e=0,s={};e<arguments.length;e++){var n=arguments[e];for(var o in n)s[o]=n[o]}return s}function decode(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function init(e){function api(){}function set(s,n,o){if("undefined"!=typeof document){"number"==typeof(o=extend({path:"/"},api.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var a=JSON.stringify(n);/^[\{\[]/.test(a)&&(n=a)}catch(e){}n=e.write?e.write(n,s):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),s=encodeURIComponent(String(s)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var u="";for(var f in o)o[f]&&(u+="; "+f,!0!==o[f]&&(u+="="+o[f].split(";")[0]));return document.cookie=s+"="+n+u}}function get(s,n){if("undefined"!=typeof document){for(var o={},a=document.cookie?document.cookie.split("; "):[],u=0;u<a.length;u++){var f=a[u].split("="),g=f.slice(1).join("=");n||'"'!==g.charAt(0)||(g=g.slice(1,-1));try{var _=decode(f[0]);if(g=(e.read||e)(g,_)||decode(g),n)try{g=JSON.parse(g)}catch(e){}if(o[_]=g,s===_)break}catch(e){}}return s?o[s]:o}}return api.set=set,api.get=function(e){return get(e,!1)},api.getJSON=function(e){return get(e,!0)},api.remove=function(e,s){set(e,"",extend(s,{expires:-1}))},api.defaults={},api.withConverter=init,api}((function(){}))}))},function(e,s,n){"use strict";n.r(s),n.d(s,"DefaultOptions",(function(){return g})),n.d(s,"Tooltip",(function(){return Tooltip})),n.d(s,"normalizeModifiers",(function(){return normalizeModifiers})),n.d(s,"makeReference",(function(){return makeReference}));var o=n(1),a=n(0),u=n(70);let f=0;const g={html:!1,delayShow:0,delayHide:0,live:!0,tooltipClass:"ffz__tooltip",innerClass:"ffz__tooltip--inner",arrowClass:"ffz__tooltip--arrow"};class Tooltip{constructor(e,s,n){if("string"==typeof e&&(e=document.querySelector(e)),!(e instanceof Node))throw new TypeError("invalid parent");if(this.options=Object.assign({},g,n),this.live=this.options.live,this.check_modifiers=this.options.check_modifiers,this.parent=e,this.container=this.options.container||this.parent,this.cls=s,this.check_modifiers&&this.installModifiers(),this.live)this.cls=s,this.elements=new Set;else{if("string"==typeof s)this.elements=e.querySelectorAll(s);else if(Array.isArray(s))this.elements=s;else{if(!(s instanceof Node))throw new TypeError("invalid elements");this.elements=[s]}this.elements=new Set(this.elements)}if(this._accessor="_ffz_tooltip$"+f++,this._onMouseOut=e=>{var s,n;return e.target&&"true"!==(null===(s=e.target)||void 0===s||null===(n=s.dataset)||void 0===n?void 0:n.forceOpen)&&this._exit(e.target)},this.options.manual);else if(this.live)this._onMouseOver=e=>{this.updateShift(e.shiftKey);const s=e.target;s&&s.classList&&s.classList.contains(this.cls)&&"true"!==s.dataset.forceOpen&&this._enter(s)},e.addEventListener("mouseover",this._onMouseOver),e.addEventListener("mouseout",this._onMouseOut);else if(this._onMouseOver=e=>{this.updateShift(e.shiftKey);const s=e.target;this.elements.has(s)&&"true"!==s.dataset.forceOpen&&this._enter(e.target)},this.elements.size<=5)for(const e of this.elements)e.addEventListener("mouseenter",this._onMouseOver),e.addEventListener("mouseleave",this._onMouseOut);else e.addEventListener("mouseover",this._onMouseOver),e.addEventListener("mouseout",this._onMouseOut)}destroy(){if(this.removeModifiers(),this.options.manual);else if(this.live||this.elements.size>5)this.parent.removeEventListener("mouseover",this._onMouseOver),this.parent.removeEventListener("mouseout",this._onMouseOut);else for(const e of this.elements)e.removeEventListener("mouseenter",this._onMouseOver),e.removeEventListener("mouseleave",this._onMouseOut);for(const e of this.elements){const s=e[this._accessor];s&&s.visible&&this.hide(s),e[this._accessor]=null,e._ffz_tooltip=null}this.elements=null,this._onMouseOut=this._onMouseOver=null,this.container=null,this.parent=null}installModifiers(){this._keyUpdate||(this._keyUpdate=e=>this.updateShift(e.shiftKey),window.addEventListener("keydown",this._keyUpdate),window.addEventListener("keyup",this._keyUpdate))}removeModifiers(){this._keyUpdate&&(window.removeEventListener("keydown",this._keyUpdate),window.removeEventListener("keyup",this._keyUpdate),this._keyUpdate=null)}updateShift(e){e!==this.shift_state&&(this.shift_state=e,this._shift_af||(this._shift_af=requestAnimationFrame((()=>{if(this._shift_af=null,this.elements)for(const e of this.elements){const s=e[this._accessor];s&&s.outer&&(s.outer.dataset.shift=this.shift_state,s.update())}}))))}cleanup(){if(!this.options.manual&&this.elements)for(const e of this.elements){const s=e[this._accessor];document.body.contains(e)||s&&s.visible&&this.hide(s)}}_enter(e){let s=e[this._accessor];if(s||(s=e[this._accessor]={target:e}),s.state=!0,s._show_timer&&(clearTimeout(s._show_timer),s._show_timer=null),s.visible)return;const n=Object(a.maybe_call)(this.options.delayShow,null,e,s);0===n?this.show(s):s._show_timer=setTimeout((()=>{s._show_timer=null,s.state&&this.show(s)}),n)}_exit(e){const s=e[this._accessor];if(!s)return;if(s.state=!1,s._show_timer&&(clearTimeout(s._show_timer),s._show_timer=null),!s.visible)return;const n=Object(a.maybe_call)(this.options.delayHide,null,e,s);0===n?this.hide(s):s._show_timer=setTimeout((()=>{s._show_timer=null,s.state||this.hide(s)}),n)}show(e){var s;const n=this.options,f=e.target;this.elements.add(f),f._ffz_tooltip=e,e._promises=[],e.waitForDom=()=>e.element?Promise.resolve():new Promise((s=>{e._promises.push(s)})),e.update=()=>e._update(),e.show=()=>{let e=f[this._accessor];e||(e=f[this._accessor]={target:f}),this.show(e)},e.hide=()=>this.hide(e),e.rerender=()=>{e.visible&&(e.hide(),e.show())};let g=Object(a.maybe_call)(n.content,null,f,e);if(void 0===g&&(g=e.target.title),e.visible||!g&&!n.onShow)return;const _=Object(o.createElement)("div",n.arrowClass),b=e.element=Object(o.createElement)("div",n.innerClass),v=e.outer=Object(o.createElement)("div",{className:n.tooltipClass,"data-shift":this.shift_state},[b,_]);if(_.setAttribute("x-arrow",!0),n.arrowInner&&_.appendChild(Object(o.createElement)("div",n.arrowInner)),e.align&&b.classList.add(`${n.innerClass}--align-${e.align}`),e.add_class){for(const s of Array.isArray(e.add_class)?e.add_class:[e.add_class])b.classList.add(s);e.add_class=void 0}const k=Object(a.maybe_call)(n.interactive,null,f,e),x=Object(a.maybe_call)(n.hover_events,null,f,e);v.classList.toggle("interactive",k||!1),(!n.manual||x&&(n.onHover||n.onLeave||n.onMove))&&(x&&n.onMove&&v.addEventListener("mousemove",v._ffz_move_handler=s=>{this.updateShift(s.shiftKey),n.onMove(f,e,s)}),v.addEventListener("mouseover",v._ffz_over_handler=s=>{n.no_auto_remove||document.contains(f)||this.hide(e),x&&n.onHover&&n.onHover(f,e,s),n.manual||(Object(a.maybe_call)(n.interactive,null,f,e)?this._enter(f):"true"!==f.dataset.forceOpen&&this._exit(f))}),v.addEventListener("mouseout",v._ffz_out_handler=s=>{x&&n.onLeave&&n.onLeave(f,e,s),n.manual||"true"===f.dataset.forceOpen||this._exit(f)}));const C=Object(a.maybe_call)(n.html,null,f,e),E=C?"innerHTML":"textContent",z={flip:{behavior:["top","bottom","left","right"]},offset:{offset:[0,10]},arrow:{element:_}};let j=Object.assign({modifiers:z},n.popper);j.modifiers=Object.assign(z,j.modifiers),n.popperConfig&&(j=null!==(s=n.popperConfig(f,e,j))&&void 0!==s?s:j),j.onUpdate=e._on_update=Object(a.debounce)((()=>{n.no_auto_remove||document.contains(e.target)||this.hide(e)}),250);let O=f;n.no_update&&(O=makeReference(f)),e._update=()=>{e.popper&&e.popper.forceUpdate()};for(const s of e._promises)s();e._promises=null,g instanceof Promise||g.then&&"[object Promise]"===g.toString()?(b.innerHTML='<div class="ffz-i-zreknarf loader"></div>',g.then((s=>{if(!s)return this.hide(e);C&&(s instanceof Node||Array.isArray(s))?(b.innerHTML="",Object(o.setChildren)(b,s,n.sanitizeChildren)):b[E]=s,e._update()})).catch((s=>{this.options.logger&&this.options.logger.error("Error rendering tooltip content.",s),this.options.i18n?b.textContent=this.options.i18n.t("tooltip.render-error","There was an error rendering this tooltip.\n{err}",{err:s}):b.textContent=`There was an error rendering this tooltip.\n${s}`,e._update()}))):g&&(C&&(g instanceof Node||Array.isArray(g))?Object(o.setChildren)(b,g,n.sanitizeChildren):b[E]=g),j.modifiers=normalizeModifiers(j.modifiers),e.popper=Object(u.a)(O,v,j),this.container.appendChild(v),e.visible=!0,n.onShow&&n.onShow(f,e)}hide(e){const s=this.options;if(s.onHide&&s.onHide(e.target,e),e.popper&&(e.popper.destroy(),e.popper=null),e.outer){const s=e.outer;s._ffz_over_handler&&s.removeEventListener("mouseover",s._ffz_over_handler),s._ffz_out_handler&&s.removeEventListener("mouseout",s._ffz_out_handler),s._ffz_move_handler&&s.removeEventListener("mousemove",s._ffz_move_handler),s.remove(),e.outer=s._ffz_out_handler=s._ffz_over_handler=null}this.live&&this.elements&&this.elements.delete(e.target),e.target._ffz_tooltip===e&&(e.target._ffz_tooltip=null),e.target[this._accessor]=null,e._update=e.rerender=e.update=noop,e.element=null,e.visible=!1}}function normalizeModifiers(e){const s=[];for(const[n,o]of Object.entries(e)){const e={name:n};if(o&&"object"==typeof o&&!Array.isArray(o)){Object(a.has)(o,"enabled")&&(e.enabled=o.enabled);const s=Object.keys(o);(s.length>1||1===s.length&&"enabled"!==s[0])&&(e.options=o)}s.push(e)}return s}function makeReference(e,s,n=0,o=0){if(e instanceof Node){const a=e.getBoundingClientRect();e=a.x,s=a.y,n=a.height,o=a.width}return{getBoundingClientRect:()=>({top:s,bottom:s+n,y:s,left:e,right:e+o,x:e,height:n,width:o}),clientWidth:o,clientHeight:n}}function noop(){}s.default=Tooltip},function(e,s,n){"use strict";n.r(s),n.d(s,"Invert",(function(){return g})),n.d(s,"Or",(function(){return _})),n.d(s,"If",(function(){return b})),n.d(s,"Constant",(function(){return v})),n.d(s,"Time",(function(){return k})),n.d(s,"TheaterMode",(function(){return x})),n.d(s,"Moderator",(function(){return C})),n.d(s,"Debug",(function(){return E})),n.d(s,"AddonDebug",(function(){return z})),n.d(s,"SquadMode",(function(){return j})),n.d(s,"NativeDarkTheme",(function(){return O})),n.d(s,"Page",(function(){return A})),n.d(s,"Channel",(function(){return T})),n.d(s,"Category",(function(){return D})),n.d(s,"Title",(function(){return B}));var o=n(0),a=n(17),u=n(2);let f=null;const g={createTest:(e,s,n)=>Object(a.createTester)(e,s,!0,!1,n),maxRules:1,childRules:!0,tall:!0,title:"Invert",i18n:"settings.filter.invert",default:()=>[],editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,105))},_={createTest:(e,s,n)=>Object(a.createTester)(e,s,!1,!0,n),childRules:!0,tall:!0,title:"Or",i18n:"settings.filter.or",default:()=>[],editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,105))},b={createTest(e,s,n){const o=Object(a.createTester)(e[0],s,!1,!1,n),u=Object(a.createTester)(e[1],s,!1,!1,n),f=Object(a.createTester)(e[2],s,!1,!1,n);return e=>o(e)?u(e):f(e)},childRules:!0,tall:!0,title:"If",i18n:"settings.filter.if",default:()=>[[],[],[]],editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,132))},v={createTest:e=>e?()=>!0:()=>!1,title:"True or False",i18n:"settings.filter.true_false",default:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,22))};function parseTime(e){if("string"!=typeof e||!e.length)return null;const s=e.indexOf(":");if(-1===s)return null;let n,o;try{n=parseInt(e.slice(0,s),10),o=parseInt(e.slice(s+1),10)}catch(e){return null}return 60*n+o}const k={_captured:new Set,createTest(e){const s=parseTime(e[0]),n=parseTime(e[1]);return null==s||null==n?()=>!1:s<=n?()=>{k._captured.add(s),k._captured.add(n+1);const e=new Date,o=60*e.getHours()+e.getMinutes();return o>=s&&o<=n}:()=>{k._captured.add(s+1),k._captured.add(n);const e=new Date,o=60*e.getHours()+e.getMinutes();return o>=s||o<=n}},captured:()=>{const e=Array.from(k._captured);return k._captured=new Set,e.sort(((e,s)=>e-s)),e},title:"Time of Day",i18n:"settings.filter.time",default:()=>["08:00","18:00"],editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,133))},x={createTest:e=>s=>s.ui&&s.ui.theatreModeEnabled===e,title:"Theater Mode",i18n:"settings.filter.theater",default:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,22))},C={createTest:e=>s=>s.moderator===e,title:"Is Moderator",i18n:"settings.filter.moderator",default:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,22))},E={createTest:e=>()=>u.DEBUG===e,title:"Is Developer Mode",i18n:"settings.filter.dev",default:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,22))},z={createTest:e=>s=>s.addonDev==e,title:"Is Addon Developer Mode",i18n:"settings.filter.addon-dev",default:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,22))},j={createTest:e=>s=>s.ui&&s.ui.squadModeEnabled===e,title:"Squad Mode",i18n:"settings.filter.squad",default:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,22))},O={createTest(e){const s=e?1:0;return e=>e.ui&&e.ui.theme===s},title:"Dark Theme",i18n:"settings.filter.native-dark",default:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,22))},A={createTest(e={}){const s=e.route,n=[];if(Object.keys(e.values).length){var o;const a=null===(o=window.FrankerFaceZ)||void 0===o?void 0:o.get(),u=a&&a.resolve("site.router");if(!u)return()=>!1;{const o=u.getRoute(s);if(!o||!o.parts)return()=>!1;let a=1;for(const s of o.parts)if("object"==typeof s){const o=e.values[s.name];o&&o.length&&n.push([a,o.toLowerCase()]),a++}}}return e=>{if(!e.route||!e.route_data||e.route.name!==s)return!1;for(const[s,o]of n){let n=e.route_data[s];if("string"==typeof n&&(n=n.toLowerCase()),n!==o)return!1}return!0}},tall:!0,title:"Current Page",i18n:"settings.filter.page",default:()=>({route:"front-page",values:{}}),editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,134))},T={createTest(e={}){const s=e.login,n=e.id;return e=>e.channelID===n||null==e.channelID&&e.channelLogin===s},title:"Current Channel",i18n:"settings.filter.channel",default:()=>({login:null,id:null}),editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,135))},D={createTest(e={}){const s=e.name,n=e.id;return n&&s?e=>e.categoryID===n||null==e.categoryID&&e.category===s:()=>!1},title:"Current Category",i18n:"settings.filter.category",default:()=>({name:null,id:null}),editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,136))},B={createTest(e={},s,a){const u=e.mode;let g,_=e.title,b=!0;if(!_||!u)return()=>!1;if("text"===u)_=Object(o.escape_regex)(_),b=!1;else if("glob"===u)_=Object(o.glob_to_regex)(_);else if("raw"!==u)return()=>!1;if(b&&(f||function loadSafety(e){n.e(1).then(n.t.bind(null,131,7)).then((s=>{f=s.default,e&&e()}))}(a),!f||!f(_)))return()=>!1;try{g=new RegExp(_,"g"+(e.sensitive?"":"i"))}catch(e){return()=>!1}return e=>(g.lastIndex=0,e.title&&g.test(e.title))},title:"Current Title",i18n:"settings.filter.title",default:()=>({title:"",mode:"text",sensitive:!1}),editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,137))}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getFontsList})),n.d(s,"b",(function(){return useFont}));var o=n(1),a=n(90),u=n.n(a);const f=["Roobert","Arial","Arial Black","Verdana","Helvetica","Tahoma","Trebuchet MS","Impact","Didot","American Typewriter","Lucida Console","Monaco","Bradley Hand","Times New Roman","Georgia","Garamond","Courier New","Brush Script MT","Comic Sans MS"].filter((e=>document.fonts.check(`16px ${e}`))).sort(),g=["Roboto","Open Sans","Noto Sans JP","Lato","Montserrat","Roboto Condensed","Source Sans Pro","Oswald","Poppins","Noto Sans","Roboto Mono","Raleway","Ubuntu","Merriweather","Nunito","PT Sans","Roboto Slab","Playfair Display","Lora","Rubik","Mukta","Noto Sans KR","Work Sans","Nunito Sans","Nanum Gothic","Inter","Quicksand","PT Serif","Hind Siliguri","Titilium Web","Fira Sans","Noto Serif","Noto Sans TC","Karla"],_=new Map,b=new Map;const v=["OpenDyslexic","OpenDyslexicAlta","OpenDyslexicMono"];let k=0,x=null;function getFontsList(){const e=[{value:"",i18n_key:"setting.font.default",title:"Default"},{separator:!0,i18n_key:"setting.font.builtin",title:"Built-in Fonts"}];for(const s of f)e.push({value:s,title:s});e.push({separator:!0,i18n_key:"setting.font.dyslexic",title:"Dyslexia Fonts"});for(const s of v)e.push({value:s,title:s});e.push({separator:!0,i18n_key:"setting.font.google",title:"Google Fonts"});for(const s of g)e.push({value:`google:${s}`,title:s});return e}function useFont(e){if(!e)return[e,null];if(v.includes(e)){k++,1===k&&function loadOpenDyslexic(){x||(x=Object(o.createElement)("link",{id:"ffz-font-opendyslexic",rel:"stylesheet",type:"text/css",href:u.a}),document.head.appendChild(x))}();let s=!1;return[e,()=>{s||(s=!0,k--,k||function unloadOpenDyslexic(){x&&(x.remove(),x=null)}())}]}if(e.startsWith("google:")){var s;const n=e.slice(7),a=(null!==(s=_.get(n))&&void 0!==s?s:0)+1;_.set(n,a),1===a&&function loadGoogleFont(e){if(b.has(e))return;const s=encodeURIComponent(e),n=Object(o.createElement)("link",{id:`ffz-font-${s}`,rel:"stylesheet",href:`https://fonts.googleapis.com/css2?family=${s}`});b.set(e,n),document.head.appendChild(n)}(n);let u=!1;const unloader=()=>{if(!u){var e;u=!0;const s=(null!==(e=_.get(n))&&void 0!==e?e:0)-1;s>0?_.set(n,s):(_.delete(n),function unloadGoogleFont(e){const s=b.get(e);s&&(b.delete(e),s.remove())}(n))}};return[n,unloader]}return[e,null]}},function(e,s,n){"use strict";function isValidBlob(e){return e instanceof Blob||e instanceof File||e instanceof ArrayBuffer||e instanceof Uint8Array}async function serializeBlob(e){if(!e)return null;if(e instanceof Blob)return{type:"blob",mime:e.type,buffer:await e.arrayBuffer()};if(e instanceof File)return{type:"file",mime:e.type,name:e.name,modified:e.lastModified,buffer:await e.arrayBuffer()};if(e instanceof ArrayBuffer)return{type:"ab",buffer:e};if(e instanceof Uint8Array)return{type:"u8",buffer:e.buffer};throw new TypeError("Invalid type")}function deserializeBlob(e){if(!e||!e.type)return null;if("blob"===e.type)return new Blob([e.buffer],{type:e.mime});if("file"===e.type)return new File([e.buffer],e.name,{type:e.mime,lastModified:e.modified});if("ab"===e.type)return e.buffer;if("u8"===e.type)return new Uint8Array(e.buffer);throw new TypeError("Invalid type")}n.d(s,"b",(function(){return isValidBlob})),n.d(s,"c",(function(){return serializeBlob})),n.d(s,"a",(function(){return deserializeBlob}))},function(e,s,n){"use strict";var o=n(8),a={passive:!0};s.a={name:"eventListeners",enabled:!0,phase:"write",fn:function fn(){},effect:function effect(e){var s=e.state,n=e.instance,u=e.options,f=u.scroll,g=void 0===f||f,_=u.resize,b=void 0===_||_,v=Object(o.a)(s.elements.popper),k=[].concat(s.scrollParents.reference,s.scrollParents.popper);return g&&k.forEach((function(e){e.addEventListener("scroll",n.update,a)})),b&&v.addEventListener("resize",n.update,a),function(){g&&k.forEach((function(e){e.removeEventListener("scroll",n.update,a)})),b&&v.removeEventListener("resize",n.update,a)}},data:{}}},function(e,s,n){"use strict";var o=n(62);s.a={name:"popperOffsets",enabled:!0,phase:"read",fn:function popperOffsets(e){var s=e.state,n=e.name;s.modifiersData[n]=Object(o.a)({reference:s.rects.reference,element:s.rects.popper,strategy:"absolute",placement:s.placement})},data:{}}},function(e,s,n){"use strict";var o=n(3),a=n(21),u=n(8),f=n(13),g=n(14),_=n(9),b=n(18),v=n(6),k={top:"auto",right:"auto",bottom:"auto",left:"auto"};function mapToStyles(e){var s,n=e.popper,_=e.popperRect,b=e.placement,x=e.variation,C=e.offsets,E=e.position,z=e.gpuAcceleration,j=e.adaptive,O=e.roundOffsets,A=!0===O?function roundOffsetsByDPR(e){var s=e.x,n=e.y,o=window.devicePixelRatio||1;return{x:Object(v.c)(Object(v.c)(s*o)/o)||0,y:Object(v.c)(Object(v.c)(n*o)/o)||0}}(C):"function"==typeof O?O(C):C,T=A.x,D=void 0===T?0:T,B=A.y,P=void 0===B?0:B,L=C.hasOwnProperty("x"),I=C.hasOwnProperty("y"),N=o.l,R=o.u,U=window;if(j){var q=Object(a.a)(n),H="clientHeight",G="clientWidth";q===Object(u.a)(n)&&(q=Object(f.a)(n),"static"!==Object(g.a)(q).position&&"absolute"===E&&(H="scrollHeight",G="scrollWidth")),q=q,b!==o.u&&(b!==o.l&&b!==o.s||x!==o.k)||(R=o.i,P-=q[H]-_.height,P*=z?1:-1),b!==o.l&&(b!==o.u&&b!==o.i||x!==o.k)||(N=o.s,D-=q[G]-_.width,D*=z?1:-1)}var V,W=Object.assign({position:E},j&&k);return z?Object.assign({},W,((V={})[R]=I?"0":"",V[N]=L?"0":"",V.transform=(U.devicePixelRatio||1)<=1?"translate("+D+"px, "+P+"px)":"translate3d("+D+"px, "+P+"px, 0)",V)):Object.assign({},W,((s={})[R]=I?P+"px":"",s[N]=L?D+"px":"",s.transform="",s))}s.a={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function computeStyles(e){var s=e.state,n=e.options,o=n.gpuAcceleration,a=void 0===o||o,u=n.adaptive,f=void 0===u||u,g=n.roundOffsets,v=void 0===g||g,k={placement:Object(_.a)(s.placement),variation:Object(b.a)(s.placement),popper:s.elements.popper,popperRect:s.rects.popper,gpuAcceleration:a};null!=s.modifiersData.popperOffsets&&(s.styles.popper=Object.assign({},s.styles.popper,mapToStyles(Object.assign({},k,{offsets:s.modifiersData.popperOffsets,position:s.options.strategy,adaptive:f,roundOffsets:v})))),null!=s.modifiersData.arrow&&(s.styles.arrow=Object.assign({},s.styles.arrow,mapToStyles(Object.assign({},k,{offsets:s.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:v})))),s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-placement":s.placement})},data:{}}},function(e,s,n){"use strict";var o=n(12),a=n(5);s.a={name:"applyStyles",enabled:!0,phase:"write",fn:function applyStyles(e){var s=e.state;Object.keys(s.elements).forEach((function(e){var n=s.styles[e]||{},u=s.attributes[e]||{},f=s.elements[e];Object(a.b)(f)&&Object(o.a)(f)&&(Object.assign(f.style,n),Object.keys(u).forEach((function(e){var s=u[e];!1===s?f.removeAttribute(e):f.setAttribute(e,!0===s?"":s)})))}))},effect:function effect(e){var s=e.state,n={popper:{position:s.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(s.elements.popper.style,n.popper),s.styles=n,s.elements.arrow&&Object.assign(s.elements.arrow.style,n.arrow),function(){Object.keys(s.elements).forEach((function(e){var u=s.elements[e],f=s.attributes[e]||{},g=Object.keys(s.styles.hasOwnProperty(e)?s.styles[e]:n[e]).reduce((function(e,s){return e[s]="",e}),{});Object(a.b)(u)&&Object(o.a)(u)&&(Object.assign(u.style,g),Object.keys(f).forEach((function(e){u.removeAttribute(e)})))}))}},requires:["computeStyles"]}},function(e,s,n){"use strict";function getMainAxisFromPlacement(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}n.d(s,"a",(function(){return getMainAxisFromPlacement}))},function(e,s,n){"use strict";n.d(s,"a",(function(){return getWindowScrollBarX}));var o=n(19),a=n(13),u=n(37);function getWindowScrollBarX(e){return Object(o.a)(Object(a.a)(e)).left+Object(u.a)(e).scrollLeft}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getWindowScroll}));var o=n(8);function getWindowScroll(e){var s=Object(o.a)(e);return{scrollLeft:s.pageXOffset,scrollTop:s.pageYOffset}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return isScrollParent}));var o=n(14);function isScrollParent(e){var s=Object(o.a)(e),n=s.overflow,a=s.overflowX,u=s.overflowY;return/auto|scroll|overlay|hidden/.test(n+u+a)}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getLayoutRect}));var o=n(19);function getLayoutRect(e){var s=Object(o.a)(e),n=e.offsetWidth,a=e.offsetHeight;return Math.abs(s.width-n)<=1&&(n=s.width),Math.abs(s.height-a)<=1&&(a=s.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:a}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return listScrollParents}));var o=n(96),a=n(25),u=n(8),f=n(38);function listScrollParents(e,s){var n;void 0===s&&(s=[]);var g=Object(o.a)(e),_=g===(null==(n=e.ownerDocument)?void 0:n.body),b=Object(u.a)(g),v=_?[b].concat(b.visualViewport||[],Object(f.a)(g)?g:[]):g,k=s.concat(v);return _?k:k.concat(listScrollParents(Object(a.a)(v)))}},function(e,s,n){"use strict";n.d(s,"a",(function(){return within}));var o=n(6);function within(e,s,n){return Object(o.a)(e,Object(o.b)(s,n))}},function(e,s,n){"use strict";n.r(s),n.d(s,"to_int",(function(){return to_int})),n.d(s,"to_float",(function(){return to_float}));const o=Symbol("BAD"),do_number=(e,s,n)=>{if("number"==typeof e&&!isNaN(e)&&isFinite(e)||(e=o),e!==o){const s=n.bounds;Array.isArray(s)&&(s.length>=3?((s[1]?e<s[0]:e<=s[0])||(s[3]?e>s[2]:e>=s[2]))&&(e=o):2===s.length?"boolean"==typeof s[1]?(s[1]?e<s[0]:e<=s[0])&&(e=o):(e<s[0]||e>s[1])&&(e=o):1===s.length&&e<s[0]&&(e=o))}return e===o?s:e},to_int=(e,s,n)=>(e="string"!=typeof e||/^-?\d+$/.test(e)?parseInt(e,10):o,do_number(e,s,n)),to_float=(e,s,n)=>(e="string"!=typeof e||/^-?[\d.]+$/.test(e)?parseFloat(e):o,do_number(e,s,n))},function(e,s,n){"use strict";n.r(s),n.d(s,"process_to_int",(function(){return process_to_int})),n.d(s,"process_to_float",(function(){return process_to_float}));const do_number=(e,s)=>{if("number"!=typeof e||isNaN(e)||!isFinite(e))return!1;const n=s.bounds;if(Array.isArray(n))if(n.length>=3){if((n[1]?e<n[0]:e<=n[0])||(n[3]?e>n[2]:e>=n[2]))return!1}else if(2===n.length){if("boolean"==typeof n[1]){if(n[1]?e<n[0]:e<=n[0])return!1}else if(e<n[0]||e>n[1])return!1}else if(1===n.length&&e<n[0])return!1;return!0},process_to_int=(e,s)=>!("string"==typeof e&&!/^-?\d+$/.test(e))&&(e=parseInt(e,10),do_number(e,s)),process_to_float=(e,s)=>!("string"==typeof e&&!/^-?[\d.]+$/.test(e))&&(e=parseFloat(e),do_number(e,s))},function(e,s,n){"use strict";n.r(s),n.d(s,"SettingsProvider",(function(){return SettingsProvider})),n.d(s,"LocalStorageProvider",(function(){return LocalStorageProvider})),n.d(s,"IndexedDBProvider",(function(){return IndexedDBProvider})),n.d(s,"CrossOriginStorageBridge",(function(){return CrossOriginStorageBridge}));var o=n(30),a=n(7),u=n(0);const f="www.twitch.tv"!==window.location.host,g="www.youtube.com"!==window.location.host;class SettingsProvider extends a.EventEmitter{constructor(e){super(),this.manager=e,this.disabled=!1}static supported(){return!1}awaitReady(){return this.ready?Promise.resolve():Promise.reject(new Error("Not Implemented"))}get allowTransfer(){return this.constructor.allowTransfer}get shouldUpdate(){return this.constructor.shouldUpdate}broadcastTransfer(){throw new Error("Not Implemented")}disableEvents(){throw new Error("Not Implemented")}async flush(){throw new Error("Not Implemented")}get(e,s){throw new Error("Not Implemented")}set(e,s){throw new Error("Not Implemented")}delete(e){throw new Error("Not Implemented")}clear(){throw new Error("Not Implemented")}has(e){throw new Error("Not Implemented")}keys(){throw new Error("Not Implemented")}entries(){throw new Error("Not Implemented")}get size(){throw new Error("Not Implemented")}get supportsBlobs(){return this.constructor.supportsBlobs}isValidBlob(e){return this.supportsBlobs&&Object(o.b)(e)}async getBlob(e){throw new Error("Not Implemented")}async setBlob(e,s){throw new Error("Not Implemented")}async deleteBlob(e){throw new Error("Not Implemented")}async hasBlob(e){throw new Error("Not Implemented")}async clearBlobs(){throw new Error("Not Implemented")}async blobKeys(){throw new Error("Not Implemented")}}SettingsProvider.supportsBlobs=!1,SettingsProvider.allowTransfer=!0,SettingsProvider.shouldUpdate=!0;class LocalStorageProvider extends SettingsProvider{constructor(e,s){super(e),this.prefix=s=null==s?"FFZ:setting:":s;const n=this._cached=new Map,o=s.length;for(const e in localStorage)if(Object(u.has)(localStorage,e)&&e.startsWith(s)){const s=localStorage.getItem(e);try{n.set(e.slice(o),JSON.parse(s))}catch(n){this.manager.log.warn(`unable to parse value for ${e}`,s)}}if(this.ready=!0,window.BroadcastChannel){(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this))}else window.addEventListener("storage",this._boundHandleStorage=this.handleStorage.bind(this))}broadcastTransfer(){this.broadcast({type:"change-provider"})}disableEvents(){this._broadcaster&&(this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null),this._boundHandleStorage&&(window.removeEventListener("storage",this._boundHandleStorage),this._boundHandleStorage=null),this.broadcast=()=>{},this.emit=()=>{}}static supported(){return!0}static hasContent(e){e||(e="FFZ:setting:");for(const s in localStorage)if(s.startsWith(e)&&Object(u.has)(localStorage,s))return!0}destroy(){this.disable(),this._cached.clear()}disable(){this.disabled=!0,this._broadcaster&&(this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null),this._boundHandleStorage&&(window.removeEventListener("storage",this._boundHandleStorage),this._boundHandleStorage=null)}flush(){}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}handleMessage(e){if(this.disabled||!e.isTrusted||!e.data)return;this.manager.log.debug("storage broadcast event",e.data);const{type:s,key:n}=e.data;if("change-provider"===s)this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if("set"===s){const e=JSON.parse(localStorage.getItem(this.prefix+n));this._cached.set(n,e),this.emit("changed",n,e,!1)}else if("delete"===s)this._cached.delete(n),this.emit("changed",n,void 0,!0);else if("clear"===s){const e=Array.from(this._cached.keys());this._cached.clear();for(const s of e)this.emit("changed",s,void 0,!0)}}handleStorage(e){if(!this.disabled&&(this.manager.log.debug("storage event",e),e.storageArea===localStorage&&e.key.startsWith(this.prefix))){const s=e.key.slice(this.prefix.length);let n=e.newValue;null===n?(this._cached.delete(s),this.emit("changed",s,void 0,!0)):(n=JSON.parse(n),this._cached.set(s,n),this.emit("changed",s,n,!1))}}get(e,s){return this._cached.has(e)?this._cached.get(e):s}set(e,s){if(!this.disabled)if(void 0!==s){this._cached.set(e,s);try{localStorage.setItem(this.prefix+e,JSON.stringify(s))}catch(s){throw this.manager&&this.manager.log.error(`An error occurred while trying to save a value to localStorage for key "${this.prefix+e}"`),/quota/i.test(s.toString())&&this.emit("quota-exceeded",s),s}this.broadcast({type:"set",key:e}),this.emit("set",e,s,!1)}else this.has(e)&&this.delete(e)}delete(e){this.disabled||(this._cached.delete(e),localStorage.removeItem(this.prefix+e),this.broadcast({type:"delete",key:e}),this.emit("set",e,void 0,!0))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const e=this._cached;this._cached=new Map;for(const s of e.keys())localStorage.removeItem(this.prefix+s),this.emit("changed",s,void 0,!0);this.broadcast({type:"clear"})}entries(){return this._cached.entries()}get size(){return this._cached.size}}LocalStorageProvider.key="local",LocalStorageProvider.priority=-1e3,LocalStorageProvider.title="Local Storage",LocalStorageProvider.description="[Local Storage](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) is available on all platforms and fast to access, but has poorly defined capacity limits and may be cleared unexpectedly. Particularly, clearing cookies and cache in your browser will likely clear Local Storage as well.";class IndexedDBProvider extends SettingsProvider{constructor(e,s=!0){if(super(e),this._start_time=performance.now(),this._pending=new Set,this._flush_wait=null,this._cached=new Map,this.ready=!1,this._ready_wait=null,s){if(window.BroadcastChannel){(this._broadcaster=new BroadcastChannel("ffz-settings")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this))}else window.addEventListener("storage",this._boundHandleStorage=this.handleStorage.bind(this));this.loadSettings().then((()=>this._resolveReady(!0))).catch((e=>this._resolveReady(!1,e)))}}_resolveReady(e,s){this.manager&&this.manager.log.info(`IDB ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.ready=e;const n=this._ready_wait;if(this._ready_wait=null,n)for(const o of n)o[e?0:1](s)}static supported(){return null!=window.indexedDB}static hasContent(){return new Promise((e=>{const s=window.indexedDB.open("FFZ",1);s.onerror=()=>e(!1),s.onupgradeneeded=s=>{s.target.transaction.abort(),e(!1)},s.onsuccess=()=>{const n=s.result;let o;try{o=n.transaction(["settings"],"readonly").objectStore("settings")}catch(s){e(!1)}const a=o.getAllKeys();a.onerror=()=>{n.close(),e(!1)},a.onsuccess=()=>{const s=Array.isArray(a.result)&&a.result.length>0;return n.close(),e(s)}}}))}destroy(){this.disable(),this._cached.clear()}disable(){this.disabled=!0,this.db&&(this.db.close(),this.db=null),this._broadcaster&&(this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null)}broadcastTransfer(){this.broadcast({type:"change-provider"})}disableEvents(){this._broadcaster&&(this._broadcaster.removeEventListener("message",this._boundHandleMessage),this._broadcaster.close(),this._boundHandleMessage=this._broadcaster=null),this.broadcast=()=>{},this.emit=()=>{}}_onStart(e){this._pending||(this._pending=new Set),this._pending.add(e)}_onFinish(e){if((!this._pending||(this._pending.delete(e),!this._pending.size))&&this._flush_wait){const e=this._flush_wait;this._flush_wait=null;for(const s of e)s()}}flush(){return this._pending&&this._pending.size?new Promise((e=>{this._flush_wait||(this._flush_wait=[]),this._flush_wait.push(e)})):Promise.resolve()}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}handleMessage(e){if(this.disabled||!e.isTrusted||!e.data)return;this.manager&&this.manager.log.debug("storage broadcast event",e.data);const{type:s,key:n}=e.data;if("change-provider"===s)this.manager.log.info("Received notice of changed settings provider."),this.emit("change-provider"),this.disable(),this.disableEvents();else if("set"===s)this._get(n).then((e=>{this._cached.set(n,e),this.emit("changed",n,e,!1)})).catch((e=>this.manager&&this.manager.log.error(`Error getting setting "${n}" from database`,e)));else if("delete"===s)this._cached.delete(n),this.emit("changed",n,void 0,!0);else if("clear"===s){const e=Array.from(this._cached.keys());this._cached.clear();for(const s of e)this.emit("changed",s,void 0,!0)}else"set-blob"===s?this.emit("changed-blob",n,!1):"delete-blob"===s?this.emit("changed-blob",n,!0):"clear-blobs"===s&&this.emit("clear-blobs")}awaitReady(){return this.ready?Promise.resolve():new Promise(((e,s)=>{(this._ready_wait=this._ready_wait||[]).push([e,s])}))}get(e,s){return this._cached.has(e)?this._cached.get(e):s}set(e,s){this.disabled||(void 0!==s?(this._cached.set(e,s),this._set(e,s).then((()=>this.broadcast({type:"set",key:e}))).catch((s=>this.manager&&this.manager.log.error(`Error saving setting "${e}" to database`,s))),this.emit("set",e,s,!1)):this.has(e)&&this.delete(e))}delete(e){this.disabled||(this._cached.delete(e),this._delete(e).catch((s=>this.manager&&this.manager.log.error(`Error deleting setting "${e}" from database`,s))).then((()=>this.broadcast({type:"delete",key:e}))),this.emit("set",e,void 0,!0))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}clear(){if(this.disabled)return;const e=this._cached;this._cached=new Map;for(const s of e.keys())this.emit("changed",s,void 0,!0);this._clear().catch((e=>this.manager&&this.manager.log.error("Error clearing database",e))).then((()=>this.broadcast({type:"clear"})))}entries(){return this._cached.entries()}get size(){return this._cached.size}getDB(e=!1){return this.db?Promise.resolve(this.db):this._listeners?new Promise(((e,s)=>this._listeners.push([e,s]))):new Promise(((s,n)=>{const o=this._listeners=[[s,n]],done=(e,s)=>{if(this._listeners===o){this._listeners=null;for(const n of o)n[e?0:1](s)}},a=window.indexedDB.open("FFZ",1);this._onStart(a),a.onerror=e=>{this.manager&&this.manager.log.error("Error opening database.",e),done(!1,e),this._onFinish(a)},a.onupgradeneeded=e=>{this.manager&&this.manager.log.info(`Upgrading database from version ${e.oldVersion} to 1`);const s=a.result;s.createObjectStore("settings",{keyPath:"k"}),s.createObjectStore("blobs")},a.onsuccess=()=>{this.manager&&this.manager.log.info(`Database opened. (After: ${(performance.now()-this._start_time).toFixed(5)}ms)`),this.db=a.result;try{const e=this.db.transaction(["settings","blobs"],"readonly");e.objectStore("settings"),e.objectStore("blobs")}catch(s){this.manager&&this.manager.log.error("Database in invalid state.",s);try{this.db.close()}catch(e){}if(this._onFinish(a),this.db=null,e)done(!1,s);else{const e=window.indexedDB.deleteDatabase("FFZ");this._onStart(e),e.onerror=s=>{this.manager&&this.manager.log.error("Error deleting invalid database.",s),done(!1,s),this._onFinish(e)},e.onsuccess=()=>{this.manager&&this.manager.log.info("Deleted invalid database."),this._onFinish(e),this._listeners=null,this.getDB(!0).then((e=>{for(const s of o)s[0](e)})).catch((e=>{for(const s of o)s[1](e)}))}}return}done(!0,this.db),this._onFinish(a)}}))}async loadSettings(){const e=(await this.getDB()).transaction(["settings"],"readonly").objectStore("settings");return new Promise(((s,n)=>{const o=e.getAll();this._onStart(o),o.onsuccess=()=>{for(const e of o.result)this._cached.set(e.k,e.v);s(),this._onFinish(o)},o.onerror=e=>{this.manager&&this.manager.log.error("Error reading settings from database.",e),n(),this._onFinish(o)}}))}async _getKeys(){const e=(await this.getDB()).transaction(["settings"],"readonly").objectStore("settings");return new Promise(((s,n)=>{const o=e.getAllKeys();this._onStart(o),o.onsuccess=()=>{s(o.result),this._onFinish(o)},o.onerror=()=>{n(),this._onFinish(o)}}))}async _get(e){const s=(await this.getDB()).transaction(["settings"],"readonly").objectStore("settings");return new Promise(((n,o)=>{s.onerror=o;const a=s.get(e);this._onStart(a),a.onerror=()=>{o(),this._onFinish(a)},a.onsuccess=()=>{n(a.result.v),this._onFinish(a)}}))}async _set(e,s){if(this.disabled)return;const n=(await this.getDB()).transaction(["settings"],"readwrite").objectStore("settings");return new Promise(((o,a)=>{n.onerror=a;const u=n.put({k:e,v:s});this._onStart(u),u.onerror=()=>{a(),this._onFinish(u)},u.onsuccess=()=>{o(),this._onFinish(u)}}))}async _delete(e){if(this.disabled)return;const s=(await this.getDB()).transaction(["settings"],"readwrite").objectStore("settings");return new Promise(((n,o)=>{s.onerror=o;const a=s.delete(e);this._onStart(a),a.onerror=()=>{o(),this._onFinish(a)},a.onsuccess=()=>{n(),this._onFinish(a)}}))}async _clear(){if(this.disabled)return;const e=(await this.getDB()).transaction(["settings"],"readwrite").objectStore("settings");return new Promise(((s,n)=>{e.onerror=n;const o=e.clear();this._onStart(o),o.onerror=()=>{n(),this._onFinish(o)},o.onsuccess=()=>{s(),this._onFinish(o)}}))}async getBlob(e){const s=(await this.getDB()).transaction(["blobs"],"readonly").objectStore("blobs");return new Promise(((n,o)=>{s.onerror=o;const a=s.get(e);this._onStart(a),a.onerror=()=>{o(),this._onFinish(a)},a.onsuccess=e=>{n(e.target.result),this._onFinish(a)}}))}async setBlob(e,s){if(this.disabled)return;if(!this.isValidBlob(s))throw new Error("Invalid blob type");const n=(await this.getDB()).transaction(["blobs"],"readwrite").objectStore("blobs");return new Promise(((o,a)=>{n.onerror=a;const u=n.put(s,e);this._onStart(u),u.onerror=()=>{a(),this._onFinish(u)},u.onsuccess=()=>{o(),this.broadcast({type:"set-blob",key:e}),this.emit("set-blob",e,s,!1),this._onFinish(u)}}))}async deleteBlob(e){if(this.disabled)return;const s=(await this.getDB()).transaction(["blobs"],"readwrite").objectStore("blobs");return new Promise(((n,o)=>{s.onerror=o;const a=s.delete(e);this._onStart(a),a.onerror=()=>{o(),this._onFinish(a)},a.onsuccess=()=>{n(),this.broadcast({type:"delete-blob",key:e}),this.emit("set-blob",e,void 0,!0),this._onFinish(a)}}))}async hasBlob(e){return(await this.blobKeys()).includes(e)}async clearBlobs(){if(this.disabled)return;const e=(await this.getDB()).transaction(["blobs"],"readwrite").objectStore("blobs");return new Promise(((s,n)=>{e.onerror=n;const o=e.clear();this._onStart(o),o.onerror=()=>{n(),this._onFinish(o)},o.onsuccess=()=>{s(),this.broadcast({type:"clear-blobs"}),this._onFinish(o)}}))}async blobKeys(){const e=(await this.getDB()).transaction(["blobs"],"readonly").objectStore("blobs");return new Promise(((s,n)=>{const o=e.getAllKeys();this._onStart(o),o.onerror=()=>{n(),this._onFinish(o)},o.onsuccess=()=>{Array.isArray(o.result)?s(o.result):n(),this._onFinish(o)}}))}}IndexedDBProvider.key="idb",IndexedDBProvider.priority=10,IndexedDBProvider.title="IndexedDB",IndexedDBProvider.description="[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API) is available on most platforms, and has a slightly slower initialization time than Local Storage. IndexedDB has a higher storage capacity and is less likely to be cleared unexpectedly.",IndexedDBProvider.supportsBlobs=!0;class CrossOriginStorageBridge extends SettingsProvider{constructor(e){super(e),this._start_time=performance.now(),this._rpc=new Map,this._cached=new Map,this.resolved_ready=!1,this.ready=!1,this._ready_wait=null,this._blobs=null,this._last_id=0;const s=this.frame=document.createElement("iframe");s.src="twitch"===this.manager.root.host?"//www.twitch.tv/p/ffz_bridge/":"//www.youtube.com/__ffz_bridge/",s.id="ffz-settings-bridge",s.style.width=0,s.style.height=0,window.addEventListener("message",this.onMessage.bind(this)),document.body.appendChild(s)}static supported(e){return"twitch"===e.root.host?f:g}static hasContent(e){return CrossOriginStorageBridge.supported(e)}get supportsBlobs(){return this._blobs}_resolveReady(e,s){this.manager&&this.manager.log.info(`COSB ready in ${(performance.now()-this._start_time).toFixed(5)}ms`),this.resolved_ready=!0,this.ready=e;const n=this._ready_wait;if(this._ready_wait=null,n)for(const o of n)o[e?0:1](s)}awaitReady(){return this.resolved_ready?this.ready?Promise.resolve():Promise.reject():new Promise(((e,s)=>{(this._ready_wait=this._ready_wait||[]).push([e,s])}))}get(e,s){return this._cached.has(e)?this._cached.get(e):s}set(e,s){void 0!==s?(this._cached.set(e,s),this.rpc({ffz_type:"set",key:e,value:s}).catch((e=>this.manager.log.error("Error setting value",e))),this.emit("set",e,s,!1)):this.has(e)&&this.delete(e)}delete(e){this._cached.delete(e),this.rpc({ffz_type:"delete",key:e}).catch((e=>this.manager.log.error("Error deleting value",e))),this.emit("set",e,void 0,!0)}clear(){const e=this._cached;this._cached=new Map;for(const s of e.keys())this.emit("changed",s,void 0,!0);this.rpc("clear").catch((e=>this.manager.log.error("Error clearing storage",e)))}has(e){return this._cached.has(e)}keys(){return this._cached.keys()}entries(){return this._cached.entries()}get size(){return this._cached.size}async flush(){await this.rpc("flush")}async getBlob(e){const s=await this.rpc({ffz_type:"get-blob",key:e});return s.reply&&Object(o.a)(s.reply)}async setBlob(e,s){await this.rpc({ffz_type:"set-blob",key:e,value:await Object(o.c)(s)})}async deleteBlob(e){await this.rpc({ffz_type:"delete-blob",key:e})}async hasBlob(e){return(await this.rpc({ffz_type:"has-blob",key:e})).reply}async clearBlobs(){await this.rpc("clear-blobs")}async blobKeys(){return(await this.rpc("blob-keys")).reply}send(e,s){"string"==typeof e&&(e={ffz_type:e});try{this.frame.contentWindow.postMessage(e,"*",s?Array.isArray(s)?s:[s]:void 0)}catch(n){this.manager.log.error("Error sending message to bridge.",n,e,s)}}rpc(e,s){const n=++this._last_id;return new Promise(((o,a)=>{this._rpc.set(n,[o,a]),"string"==typeof e&&(e={ffz_type:e}),e.id=n,this.send(e,s)}))}onMessage(e){const s=e.data;s&&s.ffz_type&&("ready"===s.ffz_type?this.rpc("init-load").then((e=>{this._blobs=e.reply.blobs;for(const[s,n]of Object.entries(e.reply.values))this._cached.set(s,n);this._resolveReady(!0)})).catch((e=>{this._resolveReady(!1,e)})):"change"===s.ffz_type?this.onChange(s):"change-blob"===s.ffz_type?this.emit("changed-blob",s.key,s.deleted):"clear-blobs"===s.ffz_type?this.emit("clear-blobs"):"reply"===s.ffz_type||"reply-error"===s.ffz_type?this.onReply(s):this.manager.log.warn("Unknown Message",s.ffz_type,s))}onChange(e){const s=e.key,n=e.value;e.deleted?(this._cached.delete(s),this.emit("changed",s,void 0,!0)):(this._cached.set(s,n),this.emit("changed",s,n,!1))}onReply(e){const s=e.id,n="reply"===e.ffz_type,o=this._rpc.get(s);if(!o)return this.manager.log.warn("Received reply for unknown ID",s);this._rpc.delete(s),o[n?0:1](e)}}CrossOriginStorageBridge.key="cosb",CrossOriginStorageBridge.priority=100,CrossOriginStorageBridge.title="Cross-Origin Storage Bridge",CrossOriginStorageBridge.description="This provider uses an `<iframe>` to synchronize storage across subdomains. Due to the `<iframe>`, this provider takes longer than others to load, but should perform roughly the same once loaded. You should be using this on non-www subdomains of Twitch unless you don't want your settings to automatically synchronize for some reason.",CrossOriginStorageBridge.supportsBlobs=!0,CrossOriginStorageBridge.allowTransfer=!1,CrossOriginStorageBridge.shouldUpdate=!1},function(e,s,n){"use strict";n.r(s),n.d(s,"Experiments",(function(){return o})),n.d(s,"HiddenEmotes",(function(){return a})),n.d(s,"FavoriteEmotes",(function(){return u})),n.d(s,"Overrides",(function(){return f})),n.d(s,"Profiles",(function(){return g})),n.d(s,"Everything",(function(){return _}));const o={label:"Experiment Overrides",keys:["exp-lock","experiment-overrides"]},a={label:"Hidden Emotes",keys(e){const s=["emote-menu.hidden-sets"];for(const n of e.keys())n.startsWith("hidden-emotes.")&&s.push(n);return s}},u={label:"Favorited Emotes",keys(e){const s=[];for(const n of e.keys())n.startsWith("favorite-emotes.")&&s.push(n);return s}},f={label:"Name and Color Overrides",keys:["overrides.colors","overrides.names"]},g={label:"Profiles",clear(e,s){const n=["profiles"];for(const s of e.keys())/^p:\d+:/.test(s)&&n.push(s);for(const s of n)e.delete(s);s.loadProfiles()}},_={label:"Absolutely Everything",async clear(e,s){e.clear(),e.supportsBlobs&&await e.clearBlobs(),s.loadProfiles()}}},function(e,s,n){"use strict";n.r(s),n.d(s,"Logger",(function(){return Logger}));var o=n(0);const a={1:"debug",2:"info",4:"warn",8:"error"};class Logger{constructor(e,s,n,a){var u,f;this.root=e?e.root:this,this.parent=e,this.name=s,this.root==this&&(this.captured_init=[],this.label="FFZ"),this.init=!1,this.enabled=!0,this.level=null!==(u=null!==(f=null!=n?n:e&&e.level)&&void 0!==f?f:function readLSLevel(){const e=localStorage.ffzLogLevel;if(!e)return null;const s=e.toUpperCase();return Object(o.has)(Logger,s)?Logger[s]:/^\d+$/.test(e)?parseInt(e,10):null}())&&void 0!==u?u:Logger.DEFAULT_LEVEL,this.raven=a||e&&e.raven,this.children={}}hi(e){const s=e.constructor.version_info;this.info(`FrankerFaceZ v${s} (s:${e.host} f:${e.flavor} b:${s.build} c:${s.commit||"null"})`);try{const e=new URL(location);e.search="",this.info(`Initial URL: ${e}`)}catch(e){this.warn("Unable to read location.",e)}}get(e,s){return this.children[e]||(this.children[e]=new Logger(this,this.name?`${this.name}.${e}`:e,s)),this.children[e]}verbose(...e){return this.invoke(Logger.VERBOSE,e)}debug(...e){return this.invoke(Logger.DEBUG,e)}info(...e){return this.invoke(Logger.INFO,e)}warn(...e){return this.invoke(Logger.WARN,e)}warning(...e){return this.invoke(Logger.WARN,e)}error(...e){return this.invoke(Logger.ERROR,e)}crumb(...e){if(this.raven)return this.raven.captureBreadcrumb(...e)}capture(e,s,...n){if(this.raven&&((s=s||{}).logger||(s.logger=this.name),this.raven.captureException(e,s)),n.length)return this.error(...n)}invoke(e,s){if(!this.enabled||e<this.level)return;const n=Array.prototype.slice.call(s);e!==Logger.VERBOSE&&(this.root.init&&this.root.captured_init.push({time:Date.now(),category:this.name,message:n.join(" "),level:a[e]||e}),this.crumb({message:n.join(" "),category:this.name,level:a[e]||e})),this.name?n.unshift(`%c${this.root.label} [%c${this.name}%c]:%c`,"color:#755000; font-weight:bold","","color:#755000; font-weight:bold",""):n.unshift(`%c${this.root.label}:%c`,"color:#755000; font-weight:bold",""),e===Logger.DEBUG||e===Logger.VERBOSE?console.debug(...n):e===Logger.INFO?console.info(...n):e===Logger.WARN?console.warn(...n):e===Logger.ERROR?console.error(...n):console.log(...n)}}Logger.VERBOSE=0,Logger.DEBUG=1,Logger.INFO=2,Logger.WARN=4,Logger.WARNING=4,Logger.ERROR=8,Logger.OFF=99,Logger.DEFAULT_LEVEL=Logger.INFO,s.default=Logger},function(e,s,n){"use strict";function parse(e){return function parseAST(e){const s=e.path,n=s.length,o=[];let a,u,f=!1,g=!1;for(;e.i<n;){const n=e.i,_=s[n],b=s[n+1];if(a||(u=[],a={}),"@"===_&&"{"===b){e.i++;const s=parseJSON(e);s&&Object.assign(a,s);continue}const v="~"===_&&">"===b,k=">"===_&&">"===b;!k&&">"===_||k||v?((v||k)&&e.i++,a.title=u.join("").trim(),a.key=a.title.toSnakeCase(),a.page=g,a.tab=f,g=k,f=v,o.push(a),a=u=null,e.i++):(u.push(_),e.i++)}a&&(a.title=u.join("").trim(),a.key=a.title.toSnakeCase(),a.page=g,a.tab=f,o.push(a));return o}({path:e,i:0})}function parseJSON(e){const s=e.path,n=s.length,o=e.i;e.i++;const a=["{"];let u=!1;for(;e.i<n&&a.length;){const n=s[e.i];if(u){if("\\"===n){e.i++;continue}'"'!==n&&"'"!==n||n!==u||(a.pop(),u=!1)}else{if('"'!==n&&"'"!==n||(u=n,a.push(n)),"{"!==n&&"["!==n||a.push(n),"]"===n&&"["!==a.pop())throw new SyntaxError("Invalid JSON");if("}"===n&&"{"!==a.pop())throw new SyntaxError("Invalid JSON")}e.i++}return JSON.parse(s.slice(o,e.i))}n.d(s,"a",(function(){return parse}))},function(e,s,n){"use strict";function rectToClientRect(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}n.d(s,"a",(function(){return rectToClientRect}))},function(e,s,n){"use strict";n.d(s,"c",(function(){return b})),n.d(s,"a",(function(){return v})),n.d(s,"b",(function(){return k})),n.d(s,"e",(function(){return z})),n.d(s,"d",(function(){return O})),n.d(s,"f",(function(){return Emoji}));var o=n(4),a=n(2),u=n(0),f=n(10),g=n(120),_=n.n(g);const b=["component"],v={"smileys-emotion":"Smileys & Emotions","people-body":"People",component:"Components","animals-nature":"Animals & Nature","food-drink":"Food & Drink","travel-places":"Travel & Places",activities:"Activities",objects:"Objects",symbols:"Symbols",flags:"Flags"},k=Object.keys(v),x={1:"1f3fb",2:"1f3fc",3:"1f3fd",4:"1f3fe",5:"1f3ff"};let C,E=!0;try{C=new RegExp("(?<!\\u{E0002})\\u{E0002}","gu")}catch(e){E=!1,C=null}const z=C,j=/\u{200D}/gu,O={google:"noto",twitter:"twemoji",open:"openmoji",blob:"blob"};function codepoint_to_emoji(e){let s="number"==typeof e?e:parseInt(e,16);return s<65536?String.fromCharCode(s):(s-=65536,String.fromCharCode(55296+(s>>10),56320+(1023&s)))}class Emoji extends o.default{constructor(...e){super(...e),this.inject("..emotes"),this.inject("settings"),E?this.settings.add("chat.emoji.replace-joiner",{default:2,ui:{path:"Chat > Behavior >> Emoji",title:"Emoji Joiner Workaround",description:"This feature is intended to allow the use of combined emoji in supported clients. This is required due to a bug in TMI that strips ZWJ characters from chat messages. [Visit the original issue](https://github.com/FrankerFaceZ/FrankerFaceZ/issues/1147) for more details.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Display Only"},{value:2,title:"Display and Send"}]}}):(this.log.warn('This browser does not support regexp lookbehind. The "Emoji Joiner Workaround" feature will be disabled.'),this.settings.add("chat.emoji.replace-joiner",{process:()=>0})),this.settings.add("chat.emoji.style",{default:"twitter",process:(e,s)=>0==s||O[s]?s:"twitter",ui:{path:"Chat > Appearance >> Emoji",title:"Emoji Style",component:"setting-select-box",data:[{value:"twitter",title:"Twitter (Twemoji)"},{value:"google",title:"Google (Noto)"},{value:"blob",title:"Blob"},{value:"open",title:"OpenMoji"},{value:0,title:"Native"}]}}),this.splitter=_()(),this.categories=v,this.emoji={},this.names={},this.chars=new Map}onEnable(){this.on("chat:pre-send-message",(e=>{e.context.get("chat.emoji.replace-joiner")<2||(e.message=e.message.replace(j,"󠀂"))})),this.loadEmojiData()}async loadEmojiData(e=0){let s;try{s=await fetch(`${a.SERVER}/script/emoji/v3.2.json?_${Object(f.getBuster)(60)}`).then((e=>e.ok?e.json():null))}catch(s){return++e<10?setTimeout((()=>this.loadEmojiData(e)),500*e):(this.log.error("Error loading emoji data.",s),!1)}if(!s)return!1;const n=s.c,o={},u={},g=new Map;for(const e of s.e){const s=Object.assign(hydrate_emoji(e.slice(4)),{category:n[e[0]],sort:e[1],names:e[2],name:e[3]});Array.isArray(s.names)||(s.names=[s.names]),s.name||(s.name=s.names[0].replace(/_/g," ")),o[s.code]=s,g.set(s.raw,[s.code,null]);for(const e of s.names)u[e]=s.code;if(e[7]){const a=s.variants={};for(const f of e[7]){if(Array.isArray(f[3])||!f[3]){const s=Object.assign(hydrate_emoji(f),{category:n[e[0]],sort:e[1],names:f[5],hidden:!0});Array.isArray(s.names)||(s.names=[s.names]),s.name=s.names[0].replace(/_/g," "),o[s.code]=s,g.set(s.raw,[s.code,null]);for(const e of s.names)u[e]=s.code;continue}const _=x[f[3]];if(!_){console.warn("Unknown tone:",f[3],f,s);continue}const b=Object.assign(hydrate_emoji(f),{key:_});a[_]=b,g.set(b.raw,[s.code,b.key])}}}return this.emoji=o,this.names=u,this.chars=g,this.log.info(`Loaded data about ${Object.keys(o).length} emoji.`),this.emit(":populated"),!0}getFullImage(e,s){return s||(s=this.parent.context.get("chat.emoji.style")),Object(u.has)(O,s)||(s="twitter"),`${a.SERVER}/static/emoji/images/${O[s]}/${e}`}getFullImageSet(e,s){return s||(s=this.parent.context.get("chat.emoji.style")),Object(u.has)(O,s)||(s="twitter"),`${a.SERVER}/static/emoji/images/${O[s]}/${e} 72w`}}function hydrate_emoji(e){let s=e[0];return 0===e[4]&&(s=`${s}-fe0f`),{code:s,image:`${e[0]}.png`,raw:s.split("-").map(codepoint_to_emoji).join(""),sheet_x:e[1][0],sheet_y:e[1][1],has:{google:!!(8&e[2]),blob:!!(4&e[2])||!!(8&e[2]),twitter:!!(2&e[2]),open:!!(1&e[2])}}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getOppositePlacement}));var o={left:"right",right:"left",bottom:"top",top:"bottom"};function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,(function(e){return o[e]}))}},function(e,s,n){"use strict";n.d(s,"a",(function(){return awaitMD})),n.d(s,"b",(function(){return getMD}));var o=n(47);let a,u,f,g;function loadMD(){return a?Promise.resolve(a):new Promise(((e,s)=>{if(f)return f.push([e,s]);f=[[e,s]],Promise.all([n.e(0).then(n.t.bind(null,146,7)),n.e(0).then(n.t.bind(null,147,7))]).then((e=>{var s,n;a=null===(s=e[0])||void 0===s?void 0:s.default,u=null===(n=e[1])||void 0===n?void 0:n.default;const o=f;f=null;for(const e of o)e[0](a)})).catch((e=>{const s=f;f=null;for(const n of s)n[1](e)}))}))}function SettingsLinks(e){const s=e.renderer.rules.link_open||this.defaultRender;e.renderer.rules.link_open=function(e,n,a,u,f){const g=e[n];if(g&&"link_open"===g.type&&Array.isArray(g.attrs)){let s;for(const e of g.attrs)if("href"===e[0]){s=e[1];break}if(s.startsWith("~")){let a;if("~"===s){let s=n+1,u=[];for(;s<e.length;){const n=e[s],o=null==n?void 0:n.type;if("text"===o)u.push(n);else if("link_close"===o)break;s++}u=u.map((e=>e.content)).join("");a=Object(o.a)(u).map((e=>e.key)).join(".")}else a=s.slice(1);if(a&&a.length){for(const e of g.attrs)if("class"===e[0]){e[1]=e[1].replace(/ffz-tooltip/g,"");break}g.attrs.push(["data-settings-link",a]),g.attrs.push(["onclick",'FrankerFaceZ.get().resolve("main_menu").mdNavigate(this);return false'])}}}return s(e,n,a,u,f)}}async function awaitMD(){if(!g){const e=await loadMD();if(!e)return null;const s=g=new e({html:!1,linkify:!0});s.use(SettingsLinks),s.use(u,{attrs:{class:"ffz-tooltip",target:"_blank",rel:"noopener","data-tooltip-type":"link"}})}return g}function getMD(e){if(g)return g;e&&awaitMD().then((s=>e(s)))}SettingsLinks.defaultRender=function(e,s,n,o,a){return a.renderToken(e,s,n)}},function(e,s,n){"use strict";n.r(s),n.d(s,"basic",(function(){return a})),n.d(s,"object_merge",(function(){return u})),n.d(s,"basic_array_merge",(function(){return f})),n.d(s,"array_merge",(function(){return g}));const o=Symbol("default"),a={get(e,s){for(const n of s)if(n.has(e))return[n.get(e),[n.id]]}},u={get(e,s,n){const o=[],a=[];for(const u of s)if(u.has(e)){const s=u.get(e);if("object"!=typeof s){n.warn(`Profile #${u.id} has an invalid value for "${e}" of type ${typeof s}. Skipping.`);continue}a.push(u.id),o.unshift(s)}if(a.length)return[Object.assign({},...o),a]}},f={get(e,s,n){const o=[],a=[];for(const u of s)if(u.has(e)){const s=u.get(e);if(!Array.isArray(s)){n.warn(`Profile #${u.id} has an invalid value for "${e}"`);continue}a.push(u.id);for(const e of s)o.push(e)}if(a.length)return[o,a]}},g={default(e){const s=[];for(const n of e)"inherit"!==n.t&&n.v&&s.push(n.v);return s},get(e,s,n,a,u){const f=[],g=[];let _=[],b=!1,v=s;n.inherit_default&&(v=[...s,o]);for(const s of v){let v;if(s===o)v=n.default,"function"==typeof v&&(v=v(u));else{if(!s.has(e))continue;v=s.get(e)}if(!Array.isArray(v)){s!==o&&a.warn(`Profile #${s.id} has an invalid value for "${e}" of type ${typeof v}. Skipping.`);continue}const k=[];s!==o&&g.push(s.id);let x=!1;for(const e of v)b=!0,"inherit"===e.t?x=!0:x?k.push(e.v):f.push(e.v);if(_=k.concat(_),!x&&!n.always_inherit)break}if(b)return[f.concat(_),g]}}},function(e,s,n){"use strict";var o=n(34);n.d(s,"a",(function(){return o.a}));var a=n(58);n.d(s,"b",(function(){return a.a}));var u=n(33);n.d(s,"c",(function(){return u.a}));var f=n(31);n.d(s,"d",(function(){return f.a}));var g=n(56);n.d(s,"e",(function(){return g.a}));var _=n(59);n.d(s,"f",(function(){return _.a}));var b=n(55);n.d(s,"g",(function(){return b.a}));var v=n(32);n.d(s,"h",(function(){return v.a}));var k=n(57);n.d(s,"i",(function(){return k.a}))},function(e,s,n){"use strict";n.d(s,"a",(function(){return b}));var o=n(23),a=n(31),u=n(32),f=n(33),g=n(34),_=[a.a,u.a,f.a,g.a],b=Object(o.b)({defaultModifiers:_})},function(e,s,n){"use strict";var o=n(9),a=n(3);s.a={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function offset(e){var s=e.state,n=e.options,u=e.name,f=n.offset,g=void 0===f?[0,0]:f,_=a.o.reduce((function(e,n){return e[n]=function distanceAndSkiddingToXY(e,s,n){var u=Object(o.a)(e),f=[a.l,a.u].indexOf(u)>=0?-1:1,g="function"==typeof n?n(Object.assign({},s,{placement:e})):n,_=g[0],b=g[1];return _=_||0,b=(b||0)*f,[a.l,a.s].indexOf(u)>=0?{x:b,y:_}:{x:_,y:b}}(n,s.rects,g),e}),{}),b=_[s.placement],v=b.x,k=b.y;null!=s.modifiersData.popperOffsets&&(s.modifiersData.popperOffsets.x+=v,s.modifiersData.popperOffsets.y+=k),s.modifiersData[u]=_}}},function(e,s,n){"use strict";var o=n(50),a=n(9),u=n(73),f=n(15),g=n(92),_=n(3),b=n(18);s.a={name:"flip",enabled:!0,phase:"main",fn:function flip(e){var s=e.state,n=e.options,v=e.name;if(!s.modifiersData[v]._skip){for(var k=n.mainAxis,x=void 0===k||k,C=n.altAxis,E=void 0===C||C,z=n.fallbackPlacements,j=n.padding,O=n.boundary,A=n.rootBoundary,T=n.altBoundary,D=n.flipVariations,B=void 0===D||D,P=n.allowedAutoPlacements,L=s.options.placement,I=Object(a.a)(L),N=z||(I===L||!B?[Object(o.a)(L)]:function getExpandedFallbackPlacements(e){if(Object(a.a)(e)===_.d)return[];var s=Object(o.a)(e);return[Object(u.a)(e),s,Object(u.a)(s)]}(L)),R=[L].concat(N).reduce((function(e,n){return e.concat(Object(a.a)(n)===_.d?Object(g.a)(s,{placement:n,boundary:O,rootBoundary:A,padding:j,flipVariations:B,allowedAutoPlacements:P}):n)}),[]),U=s.rects.reference,q=s.rects.popper,H=new Map,G=!0,V=R[0],W=0;W<R.length;W++){var K=R[W],Z=Object(a.a)(K),J=Object(b.a)(K)===_.t,Y=[_.u,_.i].indexOf(Z)>=0,X=Y?"width":"height",Q=Object(f.a)(s,{placement:K,boundary:O,rootBoundary:A,altBoundary:T,padding:j}),ee=Y?J?_.s:_.l:J?_.i:_.u;U[X]>q[X]&&(ee=Object(o.a)(ee));var te=Object(o.a)(ee),ie=[];if(x&&ie.push(Q[Z]<=0),E&&ie.push(Q[ee]<=0,Q[te]<=0),ie.every((function(e){return e}))){V=K,G=!1;break}H.set(K,ie)}if(G)for(var se=function _loop(e){var s=R.find((function(s){var n=H.get(s);if(n)return n.slice(0,e).every((function(e){return e}))}));if(s)return V=s,"break"},ne=B?3:1;ne>0;ne--){if("break"===se(ne))break}s.placement!==V&&(s.modifiersData[v]._skip=!0,s.placement=V,s.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}}},function(e,s,n){"use strict";var o=n(3),a=n(9),u=n(35),f=n(97),g=n(41),_=n(39),b=n(21),v=n(15),k=n(18),x=n(64),C=n(6);s.a={name:"preventOverflow",enabled:!0,phase:"main",fn:function preventOverflow(e){var s=e.state,n=e.options,E=e.name,z=n.mainAxis,j=void 0===z||z,O=n.altAxis,A=void 0!==O&&O,T=n.boundary,D=n.rootBoundary,B=n.altBoundary,P=n.padding,L=n.tether,I=void 0===L||L,N=n.tetherOffset,R=void 0===N?0:N,U=Object(v.a)(s,{boundary:T,rootBoundary:D,padding:P,altBoundary:B}),q=Object(a.a)(s.placement),H=Object(k.a)(s.placement),G=!H,V=Object(u.a)(q),W=Object(f.a)(V),K=s.modifiersData.popperOffsets,Z=s.rects.reference,J=s.rects.popper,Y="function"==typeof R?R(Object.assign({},s.rects,{placement:s.placement})):R,X={x:0,y:0};if(K){if(j||A){var Q="y"===V?o.u:o.l,ee="y"===V?o.i:o.s,te="y"===V?"height":"width",ie=K[V],se=K[V]+U[Q],ne=K[V]-U[ee],oe=I?-J[te]/2:0,ae=H===o.t?Z[te]:J[te],re=H===o.t?-J[te]:-Z[te],le=s.elements.arrow,ce=I&&le?Object(_.a)(le):{width:0,height:0},ue=s.modifiersData["arrow#persistent"]?s.modifiersData["arrow#persistent"].padding:Object(x.a)(),de=ue[Q],he=ue[ee],fe=Object(g.a)(0,Z[te],ce[te]),pe=G?Z[te]/2-oe-fe-de-Y:ae-fe-de-Y,me=G?-Z[te]/2+oe+fe+he+Y:re+fe+he+Y,ge=s.elements.arrow&&Object(b.a)(s.elements.arrow),_e=ge?"y"===V?ge.clientTop||0:ge.clientLeft||0:0,be=s.modifiersData.offset?s.modifiersData.offset[s.placement][V]:0,ve=K[V]+pe-be-_e,ye=K[V]+me-be;if(j){var we=Object(g.a)(I?Object(C.b)(se,ve):se,ie,I?Object(C.a)(ne,ye):ne);K[V]=we,X[V]=we-ie}if(A){var ke="x"===V?o.u:o.l,Fe="x"===V?o.i:o.s,xe=K[W],Se=xe+U[ke],Ce=xe-U[Fe],Ee=Object(g.a)(I?Object(C.b)(Se,ve):Se,xe,I?Object(C.a)(Ce,ye):Ce);K[W]=Ee,X[W]=Ee-xe}}s.modifiersData[E]=X}},requiresIfExists:["offset"]}},function(e,s,n){"use strict";var o=n(9),a=n(39),u=n(66),f=n(21),g=n(35),_=n(41),b=n(63),v=n(65),k=n(3);s.a={name:"arrow",enabled:!0,phase:"main",fn:function arrow(e){var s,n=e.state,u=e.name,x=e.options,C=n.elements.arrow,E=n.modifiersData.popperOffsets,z=Object(o.a)(n.placement),j=Object(g.a)(z),O=[k.l,k.s].indexOf(z)>=0?"height":"width";if(C&&E){var A=function toPaddingObject(e,s){return e="function"==typeof e?e(Object.assign({},s.rects,{placement:s.placement})):e,Object(b.a)("number"!=typeof e?e:Object(v.a)(e,k.e))}(x.padding,n),T=Object(a.a)(C),D="y"===j?k.u:k.l,B="y"===j?k.i:k.s,P=n.rects.reference[O]+n.rects.reference[j]-E[j]-n.rects.popper[O],L=E[j]-n.rects.reference[j],I=Object(f.a)(C),N=I?"y"===j?I.clientHeight||0:I.clientWidth||0:0,R=P/2-L/2,U=A[D],q=N-T[O]-A[B],H=N/2-T[O]/2+R,G=Object(_.a)(U,H,q),V=j;n.modifiersData[u]=((s={})[V]=G,s.centerOffset=G-H,s)}},effect:function effect(e){var s=e.state,n=e.options.element,o=void 0===n?"[data-popper-arrow]":n;null!=o&&("string"!=typeof o||(o=s.elements.popper.querySelector(o)))&&Object(u.a)(s.elements.popper,o)&&(s.elements.arrow=o)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]}},function(e,s,n){"use strict";var o=n(3),a=n(15);function getSideOffsets(e,s,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-s.height-n.y,right:e.right-s.width+n.x,bottom:e.bottom-s.height+n.y,left:e.left-s.width-n.x}}function isAnySideFullyClipped(e){return[o.u,o.s,o.i,o.l].some((function(s){return e[s]>=0}))}s.a={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function hide(e){var s=e.state,n=e.name,o=s.rects.reference,u=s.rects.popper,f=s.modifiersData.preventOverflow,g=Object(a.a)(s,{elementContext:"reference"}),_=Object(a.a)(s,{altBoundary:!0}),b=getSideOffsets(g,o),v=getSideOffsets(_,u,f),k=isAnySideFullyClipped(b),x=isAnySideFullyClipped(v);s.modifiersData[n]={referenceClippingOffsets:b,popperEscapeOffsets:v,isReferenceHidden:k,hasPopperEscaped:x},s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-reference-hidden":k,"data-popper-escaped":x})}}},function(e,s,n){"use strict";const o=/\s/,a={OPEN:"{",CLOSE:"}",TAG_OPEN:"<",TAG_CLOSE:">",TAG_CLOSING:"/",SEP:",",SUB_VAR:"#",ESCAPE:"'"},u="subnumeric_types",f="submessage_types",g=Object.keys(a),_=Symbol("C"),b=(e.exports=function Parser(e){if(!(this instanceof Parser))return new Parser(e);this.opts=Object.assign({OFFSET:"offset:",[u]:["plural","selectordinal"],[f]:["plural","selectordinal","select"],allowTags:!0,requireOther:!0},a,e);for(let e=0;e<g.length;e++){const s=g[e],n=this.opts[s];if("string"!=typeof n||1!==n.length)throw new Error(`Option ${s} must be a 1-length string`);for(let o=e+1;o<g.length;o++){const e=g[o];if(this.opts[e]===n)throw new Error(`Option ${s} and ${e} cannot match`)}}}).prototype;function expected(e,s,n){return"object"==typeof s&&(n=s.i,s=s.msg[n]),new SyntaxError(`expected ${e} at position ${n} but found ${s||"eof"}`)}function unexpected(e,s){return new SyntaxError(`unexpected ${e} at position ${s}`)}function skipSpace(e){const s=e.msg,n=s.length;for(;e.i<n&&o.test(s[e.i]);)e.i++}function mergePush(e,s){const n=e.length-1;"string"==typeof s&&"string"==typeof e[n]?e[n]+=s:e.push(s)}b.parse=function(e){return this.parseAST({msg:String(e),i:0},null)},b.parseAST=function(e,s){const n=e.msg,a=this.opts,f=n.length,g=s&&a[u].includes(s.t),b=[];for(;e.i<f;){const u=e.i,f=n[u];if(f===a.CLOSE){if(s)break;mergePush(b,"}"),e.i++}else if(f===a.OPEN||g&&f===a.SUB_VAR)mergePush(b,this.parseElement(e,s));else if(a.allowTags&&f===a.TAG_OPEN&&!o.test(n[u+1])){const n=this.parseTag(e,s);if(n===_){s.closed=!0;break}mergePush(b,n)}else mergePush(b,this.parseText(e,s));if(e.i===u)throw unexpected(f,e.i)}return b},b.parseText=function(e,s,n=!0,a=!0,f=!1){const g=e.msg,_=this.opts,b=_.allowTags,v=g.length,k=s&&_[u].includes(s.t);let x="";for(;e.i<v;){const s=g[e.i];if(s===_.OPEN||s===_.CLOSE||b&&(s===_.TAG_OPEN||f&&(s===_.TAG_CLOSE||s===_.TAG_CLOSING))||!n&&s===_.SEP||!a&&o.test(s)||k&&s===_.SUB_VAR)break;if(s===_.ESCAPE){let o=g[++e.i];if(o===_.ESCAPE)x+=o,e.i++;else if(o===_.OPEN||o===_.CLOSE||b&&(o===_.TAG_OPEN||f&&(o===_.TAG_CLOSE||o===_.TAG_CLOSING))||k&&o===_.SUB_VAR||!a||!n)for(x+=o;++e.i<v;)if(o=g[e.i],o===_.ESCAPE){if(o=g[e.i+1],o!==_.ESCAPE){e.i++;break}x+=o,e.i++}else x+=o;else x+=s}else e.i++,x+=s}return x},b.parseTag=function(e,s){const n=e.msg,o=e.i,a=this.opts;e.i++;let u=n[e.i],f=!1;if(u===a.TAG_CLOSING){if(!s||!s.n)throw unexpected(u,e.i);f=!0,e.i++,skipSpace(e)}const g=this.parseText(e,null,!1,!1,!0);if(!g)return n.slice(o,e.i);if(skipSpace(e),u=n[e.i],f){if(u!==a.TAG_CLOSE)throw expected(a.TAG_CLOSE,u,e.i);if(g!==s.n)throw unexpected("tag mismatch",o);return e.i++,_}if(f=!1,u===a.TAG_CLOSING&&(f=!0,e.i++,u=n[e.i]),u!==a.TAG_CLOSE)return n.slice(o,e.i);e.i++;const b={n:g};if(f)return b;const v=this.parseAST(e,b);if(v&&v.length&&(b.c=v),!b.closed&&e.i>=n.length)throw expected("closing tag",e);return delete b.closed,b},b.parseElement=function(e,s){const n=e.msg,o=this.opts,a=s&&o[u].includes(s.t);let g=n[e.i];if(a&&g===o.SUB_VAR)return e.i++,{v:s.v,t:"number"};e.i++,skipSpace(e);const _=this.parseText(e,null,!1,!1);if(!_)throw expected("placeholder id",g,e.i);const b={v:_};if(skipSpace(e),g=n[e.i],g===o.CLOSE)return e.i++,b;if(g!==o.SEP)throw expected(`${o.SEP} or ${o.CLOSE}`,g,e.i);e.i++,skipSpace(e);const v=this.parseText(e,null,!1,!1);if(!v)throw expected("type",e);if(b.t=v,skipSpace(e),g=n[e.i],g===o.CLOSE){if(o[f].includes(b.t))throw expected("sub-messages",e);return e.i++,b}if(g!==o.SEP)throw expected(`${o.SEP} or ${o.CLOSE}`,g,e.i);if(e.i++,skipSpace(e),o[u].includes(b.t)){const s=this.parseOffset(e);s&&(b.f=s,skipSpace(e))}if(o[f].includes(b.t)){const s=this.parseSubmessages(e,b),n=o.requireOther;if((Array.isArray(n)?n.includes(b.t):n)&&!s.other)throw expected("other sub-message",e);b.o=s}else{const s=this.parseText(e,null,!0,!0);if(!s)throw expected("format",e);b.f=s.trimRight()}if(skipSpace(e),g=n[e.i],g!==o.CLOSE)throw expected(o.CLOSE,g,e.i);return e.i++,b},b.parseSubmessages=function(e,s){const n=e.msg,o=n.length,a={};for(;e.i<o;){if(n[e.i]===this.opts.CLOSE)break;const o=this.parseText(e,null,!0,!1);if(!o)throw expected("sub-message selector",e);skipSpace(e),a[o]=this.parseSubmessage(e,s),skipSpace(e)}return a},b.parseSubmessage=function(e,s){const n=e.msg,o=this.opts;if(n[e.i]!==o.OPEN)throw expected(o.OPEN,e);e.i++;const a=this.parseAST(e,s);if(n[e.i]!==o.CLOSE)throw expected(o.CLOSE,e);return e.i++,a},b.parseOffset=function(e){const s=e.msg,n=this.opts.OFFSET,o=s.length;if(s.slice(e.i,e.i+n.length)!==n)return;e.i+=n.length,skipSpace(e);const a=e.i;for(;e.i<o&&/[-\d]/.test(s[e.i]);)e.i++;if(a===e.i)throw expected("number",e);return+s.slice(a,e.i)}},function(e,s,n){"use strict";n.d(s,"a",(function(){return E})),n.d(s,"b",(function(){return SettingsManager})),n.d(s,"c",(function(){return parse_path}));var o=n(4),a=n(0),u=n(47),f=n(24),g=n(71),_=n(72),b=n(42),v=n(43),k=n(44),x=n(28),C=n(45);function postMessage(e,s){try{return e.postMessage(s,"*"),!0}catch(e){return!1}}const E=["session"];class SettingsManager extends o.default{constructor(...e){super(...e),this.providers={};for(const e in k)if(Object(a.has)(k,e)){const s=k[e];s.key&&s.supported(this)&&(this.providers[s.key]=s)}Object.seal(this.providers),this.updateSoon=Object(a.debounce)((()=>this.updateRoutes()),50,!1);try{const e=new URL(window.location).searchParams;e&&e.has("ffz-no-settings")&&(this.disable_profiles=!0)}catch(e){}this.__ls_scheduled=new Set,this.__ls_cache=new Map,this.__ls_hooked=!1,this._updateLS=this._updateLS.bind(this),this.__contexts=[],this.__profiles=[],this.__profile_ids={},this.ui_structures=new Map,this.definitions=new Map,this.validators={};for(const e in v)Object(a.has)(v,e)&&(this.validators[e]=v[e]);this.processors={};for(const e in b)Object(a.has)(b,e)&&(this.processors[e]=b[e]);this.clearables={};for(const e in C)Object(a.has)(C,e)&&(this.clearables[e]=C[e]);this.filters={};for(const e in x)Object(a.has)(x,e)&&(this.filters[e]=x[e]);this._provider_waiters=[],this._createProvider().then((e=>{this.provider=e,this.log.info(`Using Provider: ${e.constructor.name}`),e.on("changed",this._onProviderChange,this),e.on("quota-exceeded",(e=>{this.emit(":quota-exceeded",e)})),e.on("change-provider",(()=>{this.emit(":change-provider")}));for(const s of this._provider_waiters)s(e)})),this.migrations=new _.a(this),this.main_context=new g.a(this),this.main_context.on("changed",((e,s,n)=>{this.emit(`:changed:${e}`,s,n)})),this.main_context.on("uses_changed",((e,s,n)=>{this.emit(`:uses_changed:${e}`,s,n)})),this.main_context.on("context_changed",(()=>this._updateContextProxies())),this._context_proxies=new Set,window.addEventListener("message",(e=>{var s;"request-context"===(null===(s=e.data)||void 0===s?void 0:s.ffz_type)&&(this._context_proxies.add(e.source),this._updateContextProxies(e.source))})),window.addEventListener("beforeunload",(()=>{for(const e of this._context_proxies)postMessage(e,{ffz_type:"context-gone"})})),this._start_time=performance.now(),this.enable()}_updateContextProxies(e){if(!e&&!this._context_proxies.size)return;const s=JSON.parse(JSON.stringify(this.main_context._context));for(const e of E)Object(a.has)(s,e)&&delete s[e];if(e)postMessage(e,{ffz_type:"context-update",ctx:s});else for(const e of this._context_proxies)postMessage(e,{ffz_type:"context-update",ctx:s})}addFilter(e,s){if(this.filters[e])return this.log.warn("Tried to add already existing filter",e);this.filters[e]=s,this.updateRoutes()}getFilterBasicEditor(){return()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,22))}generateLog(){const e=[];for(const[s,n]of this.main_context.__cache.entries())e.push(`${s}: ${JSON.stringify(n)}`);return e.join("\n")}awaitProvider(){return this.provider?Promise.resolve(this.provider):new Promise((e=>{this._provider_waiters.push(e)}))}async onEnable(){await this.awaitProvider(),await this.provider.awaitReady(),this.on("site.router:updated-routes",this.updateRoutes,this),this.loadProfiles(!0);for(const e of this.__contexts)e.selectProfiles();const e=performance.now()-this._start_time;this.log.info(`Initialization complete after ${e.toFixed(5)}ms -- Values: ${this.provider.size} -- Profiles: ${this.__profiles.length}`),this.scheduleUpdates(),this.updateClock()}updateClock(){const e=n(28).Time.captured();if(null==e||!e.length)return;this._time_timer&&clearTimeout(this._time_timer);const s=new Date,o=60*s.getHours()+s.getMinutes();let a=null!=this._time_next?this._time_next:null;for(const s of e)s<=o||(null==a||s<a)&&(a=s);null==a&&(a=e[0]+1440);const u=60*(a-o)*1e3-59750+(6e4-Date.now()%6e4);this._time_timer=setTimeout((()=>{for(const e of this.__contexts)e.selectProfiles();this.updateClock()}),u)}_updateLSKey(e){(this.__ls_cache.has(e)||this.__ls_cache.has(`raw.${e}`))&&(this.__ls_scheduled.add(e),this.__ls_timer||(this.__ls_timer=setTimeout(this._updateLS,0)))}_hookLS(){if(this.__ls_hooked)return;this.__ls_hooked=!0;const e=localStorage.setItem,s=this;localStorage.setItem=function(n,...o){try{s._updateLSKey(n)}catch(e){}return e.call(this,n,...o)},this._handleLSEvent=this._handleLSEvent.bind(this),window.addEventListener("storage",this._handleLSEvent)}_handleLSEvent(e){e.storageArea===localStorage&&this._updateLSKey(e.key)}_updateLS(){clearTimeout(this.__ls_timer),this.__ls_timer=null;const e=this.__ls_scheduled;this.__ls_scheduled=new Set;for(const s of e){const e=this.__ls_cache.has(s),n=`raw.${s}`,o=this.__ls_cache.has(n);if(!o&&!e)continue;const a=localStorage.getItem(s);if(o&&(this.__ls_cache.set(n,a),this.emit(":ls-update",n,a)),e){let e;if(a)try{e=JSON.parse(a)}catch(e){this.log.warn(`Unable to parse localStorage value as JSON for "${s}"`,e)}this.__ls_cache.set(s,e),this.emit(":ls-update",s,e)}}}getLS(e){if(this.__ls_cache.has(e))return this.__ls_cache.get(e);this.__ls_hooked||this._hookLS();const s=e.startsWith("raw."),n=localStorage.getItem(s?e.slice(4):e);let o;if(s)o=n;else try{o=JSON.parse(n)}catch(s){this.log.warn(`Unable to parse localStorage value as JSON for "${e}"`,s)}return this.__ls_cache.set(e,o),o}async generateBackupFile(){const e=new Date,s=`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`;if(await this._needsZipBackup()){const e=await this._getZipBackup();return new File([e],`ffz-settings (${s}).zip`,{type:"application/zip"})}const n=await this.getSettingsDump();return new File([JSON.stringify(n)],`ffz-settings (${s}).json`,{type:"application/json;charset=utf-8"})}async _needsZipBackup(){if(await this.awaitProvider(),await this.provider.awaitReady(),!this.provider.supportsBlobs)return!1;const e=await this.provider.blobKeys();return!!Array.isArray(e)&&e.length>0}async _getZipBackup(){await this.awaitProvider(),await this.provider.awaitReady();const e=new(0,(await n.e(164).then(n.t.bind(null,130,7))).default),s=await this.getSettingsDump();e.file("settings.json",JSON.stringify(s));const o={};if(this.provider.supportsBlobs){const s=await this.provider.blobKeys();for(const n of s){const s=encodeURIComponent(n),a=await this.provider.getBlob(n);if(!a)continue;const u={key:n};if(a instanceof File)u.type="file",u.name=a.name,u.modified=a.lastModified,u.mime=a.type;else if(a instanceof Blob)u.type="blob";else if(a instanceof ArrayBuffer)u.type="ab";else{if(!(a instanceof Uint8Array))continue;u.type="ui8"}o[s]=u,e.file(`blobs/${s}`,a)}}return e.file("blobs.json",JSON.stringify(o)),e.generateAsync({type:"blob"})}async getSettingsDump(){await this.awaitProvider(),await this.provider.awaitReady();const e={version:2,type:"full",values:{}};for(const[s,n]of this.provider.entries())e.values[s]=n;return e}scheduleUpdates(){this._update_timer&&clearTimeout(this._update_timer),this._update_timer=setTimeout((()=>this.checkUpdates()),5e3)}async checkUpdates(){if(await this.awaitProvider(),await this.provider.awaitReady(),!this.provider.shouldUpdate)return;const e=[];for(const s of this.__profiles){if(!s||!s.url||s.pause_updates)continue;const n=s.checkUpdate();e.push(n instanceof Promise?n:Promise.resolve(n))}const s=await Promise.all(e);let n=0;for(const e of s)e&&n++;this.log.info(`Successfully refreshed ${n} of ${s.length} profiles from remote URLs.`)}getProviders(){return this.providers}getActiveProvider(){return this._active_provider}async _createProvider(){let e=localStorage.ffzProviderv2;if(null==e&&(e=localStorage.ffzProviderv2=await this.sniffProvider()),this.providers[e]){const s=new this.providers[e](this);return"idb"===e&&(this._idb=s),this._active_provider=e,s}return this._active_provider="local",new this.providers.local(this)}async sniffProvider(){const e=Object.values(this.providers);e.sort(((e,s)=>s.priority-e.priority));for(const s of e)if(s.supported(this)&&s.hasContent&&await s.hasContent(this))return s.key;return"local"}async changeProvider(e,s){if(!this.providers[e]||!this.providers[e].supported(this))throw new Error(`Invalid provider: ${e}`);if(e===this._active_provider)return;const n=this.provider;if(this.provider=null,n.broadcastTransfer(),s){const s=new this.providers[e](this);if(await s.awaitReady(),s.allowTransfer&&n.allowTransfer){n.disableEvents(),await s.clear(),s.supportsBlobs&&await s.clearBlobs();for(const[e,o]of n.entries())s.set(e,o);if(n.supportsBlobs&&s.supportsBlobs){for(const e of await n.blobKeys()){const o=await n.getBlob(e);o&&await s.setBlob(e,o)}await n.clearBlobs()}n.clear(),await n.flush(),await s.flush()}}localStorage.ffzProviderv2=e,location.reload()}_onProviderChange(e,s,n){if("profiles"===e)return this.loadProfiles();if(!e.startsWith("p:"))return;const o=(e=e.substr(2)).indexOf(":");if(-1===o)return;const a=this.__profile_ids[e.slice(0,o)],u=e.slice(o+1);a&&(":enabled"===u?a.emit("toggled",a,!!n||s):a.emit("changed",u,s,n))}updateRoutes(){for(const e of this.__profiles)e.matcher=null;for(const e of this.__contexts)e.selectProfiles();this.updateClock()}_onProfileToggled(e,s){for(const e of this.__contexts)e.selectProfiles();this.updateClock(),this.emit(":profile-toggled",e,s)}profile(e){return this.__profile_ids[e]||null}loadProfiles(e){const s=this.__profile_ids,n=this.__profiles,o=this.__profile_ids={},u=this.__profiles=[],g=new Set(n.map((e=>e.id))),_=new Set,b=new Set,v=this.provider.get("profiles",[f.a.Moderation,f.a.Default]);let k=!1,x=!1;for(const e of n)e.off("toggled",this._onProfileToggled,this),e.hotkey_enabled=!1;for(const e of v){const v=e.id,C=u.length,E=s[v],z=E?n.indexOf(E):-1;if(g.delete(v),z!==C&&(k=!0),e.context&&!Array.isArray(e.context)&&(e.context.moderator?e.context=f.a.Moderation.context:e.context=null),E&&Object(a.deep_equals)(E.data,e,!0)){z!==C&&(x=!0),u.push(o[v]=E);continue}const j=o[v]=new f.a(this,e);E?(j.__listeners=E.__listeners,E.__listeners={},b.add(v)):_.add(v),u.push(j),x=!0}for(const e of u)e.on("toggled",this._onProfileToggled,this),e.hotkey_enabled=!0;if((x||g.size)&&!e){for(const e of this.__contexts)e.selectProfiles();this.updateClock();for(const e of _)this.emit(":profile-created",o[e]);for(const e of b)this.emit(":profile-changed",o[e]);k&&this.emit(":profiles-reordered")}}createProfile(e){let s=0;for(;this.__profile_ids[s];)s++;(e=e||{}).id=s,e.name||(e.name=`Unnamed Profile ${s}`);const n=this.__profile_ids[s]=new f.a(this,e);return this.__profiles.unshift(n),n.on("toggled",this._onProfileToggled,this),n.hotkey_enabled=!0,this._saveProfiles(),this.emit(":profile-created",n),n}deleteProfile(e){"object"==typeof e&&null!=e.id&&(e=e.id);const s=this.__profile_ids[e];if(!s)return;if(1===this.__profiles.length)throw new Error("cannot delete only profile");s.off("toggled",this._onProfileToggled,this),s.clear(),this.__profile_ids[e]=null;const n=this.__profiles.indexOf(s);-1!==n&&this.__profiles.splice(n,1),this._saveProfiles(),this.emit(":profile-deleted",s)}moveProfile(e,s){"object"==typeof e&&e.id&&(e=e.id);const n=this.__profile_ids[e];if(!n)return;const o=this.__profiles,a=o.indexOf(n);a!==s&&(o.splice(s,0,...o.splice(a,1)),this._saveProfiles(),this.emit(":profiles-reordered"))}saveProfile(e){"object"==typeof e&&e.id&&(e=e.id);const s=this.__profile_ids[e];s&&(this._saveProfiles(),this.emit(":profile-changed",s))}_saveProfiles(){this.provider.set("profiles",this.__profiles.map((e=>e.data)));for(const e of this.__contexts)e.selectProfiles();this.updateClock()}context(e){return this.main_context.context(e)}get(e){return this.main_context.get(e)}getChanges(e,s,n){return this.main_context.getChanges(e,s,n)}onChange(e,s,n){return this.main_context.onChange(e,s,n)}uses(e){return this.main_context.uses(e)}update(e){return this.main_context.update(e)}updateContext(e){return this.main_context.updateContext(e)}setContext(e){return this.main_context.setContext(e)}add(e,s){if("object"==typeof e){for(const s in e)Object(a.has)(e,s)&&this.add(s,e[s]);return}const n=this.definitions.get(e),o=n?Array.isArray(n)?n:n.required_by:[];s.required_by=o,s.requires=s.requires||[];for(const n of s.requires){const s=this.definitions.get(n);s?Array.isArray(s)?s.push(e):s.required_by.push(e):this.definitions.set(n,[e])}if(s.ui){const n=s.ui;if(n.path_tokens=n.path_tokens?format_path_tokens(n.path_tokens):n.path?parse_path(n.path):void 0,!n.key&&e&&(n.key=e),!n.key&&n.title&&(n.key=n.title.toSnakeCase()),("setting-select-box"===n.component||"setting-combo-box"===n.component)&&Array.isArray(n.data)&&!n.no_i18n&&"ffzap.core.highlight_sound"!==e){const s=`${n.i18n_key||`setting.entry.${e}`}.values`;for(const e of n.data)void 0===e.i18n_key&&void 0!==e.value&&(e.i18n_key=`${s}.${e.value}`)}}s.changed&&this.on(`:changed:${e}`,s.changed),this.definitions.set(e,s),n&&!Array.isArray(n)||this.emit(":added-definition",e,s)}addUI(e,s){if("object"==typeof e){for(const s in e)Object(a.has)(e,s)&&this.add(s,e[s]);return}s.ui||(s={ui:s});const n=s.ui;n.path_tokens=n.path_tokens?format_path_tokens(n.path_tokens):n.path?parse_path(n.path):void 0,!n.key&&n.title&&(n.key=n.title.toSnakeCase());const o=this.ui_structures.get(e);this.ui_structures.set(e,s),o||this.emit(":added-definition",e,s)}addClearable(e,s){if("object"!=typeof e)this.clearables[e]=s;else for(const s in e)Object(a.has)(e,s)&&this.addClearable(s,e[s])}getClearables(){return Object(a.deep_copy)(this.clearables)}addProcessor(e,s){if("object"!=typeof e)this.processors[e]=s;else for(const s in e)Object(a.has)(e,s)&&this.addProcessor(s,e[s])}getProcessor(e){return this.processors[e]}getProcessors(){return Object(a.deep_copy)(this.processors)}addValidator(e,s){if("object"!=typeof e)this.validators[e]=s;else for(const s in e)Object(a.has)(e,s)&&this.addValidator(s,e[s])}getValidator(e){return this.validators[e]}getValidators(){return Object(a.deep_copy)(this.validators)}}function parse_path(e){return Object(u.a)(e)}function format_path_tokens(e){for(let s=0,n=e.length;s<n;s++){const n=e[s];"string"!=typeof n?n.key||(n.key=n.title.toSnakeCase()):e[s]={key:n.toSnakeCase(),title:n}}return e}},function(e,s,n){"use strict";n.d(s,"a",(function(){return computeOffsets}));var o=n(9),a=n(18),u=n(35),f=n(3);function computeOffsets(e){var s,n=e.reference,g=e.element,_=e.placement,b=_?Object(o.a)(_):null,v=_?Object(a.a)(_):null,k=n.x+n.width/2-g.width/2,x=n.y+n.height/2-g.height/2;switch(b){case f.u:s={x:k,y:n.y-g.height};break;case f.i:s={x:k,y:n.y+n.height};break;case f.s:s={x:n.x+n.width,y:x};break;case f.l:s={x:n.x-g.width,y:x};break;default:s={x:n.x,y:n.y}}var C=b?Object(u.a)(b):null;if(null!=C){var E="y"===C?"height":"width";switch(v){case f.t:s[C]=s[C]-(n[E]/2-g[E]/2);break;case f.k:s[C]=s[C]+(n[E]/2-g[E]/2)}}return s}},function(e,s,n){"use strict";n.d(s,"a",(function(){return mergePaddingObject}));var o=n(64);function mergePaddingObject(e){return Object.assign({},Object(o.a)(),e)}},function(e,s,n){"use strict";function getFreshSideObject(){return{top:0,right:0,bottom:0,left:0}}n.d(s,"a",(function(){return getFreshSideObject}))},function(e,s,n){"use strict";function expandToHashMap(e,s){return s.reduce((function(s,n){return s[n]=e,s}),{})}n.d(s,"a",(function(){return expandToHashMap}))},function(e,s,n){"use strict";n.d(s,"a",(function(){return contains}));var o=n(5);function contains(e,s){var n=s.getRootNode&&s.getRootNode();if(e.contains(s))return!0;if(n&&Object(o.c)(n)){var a=s;do{if(a&&e.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}},function(e,s,n){"use strict";n.d(s,"a",(function(){return TranslationManager})),n.d(s,"b",(function(){return transformPhrase}));var o=n(60),a=n.n(o),u=n(2),f=n(0),g=n(10),_=n(4),b=n(69);const v=/\s*at\s+(.+?)\s+\((.+)\)$/,k=/^(.+):\/\/(.+?)(?:\?[a-zA-Z0-9]+)?:(\d+:\d+)$/,x={filter:e=>e.includes(".frankerfacez.com")||e.includes("localhost"),cacheGlobally:!0},C=["/src/i18n.js","/src/utilities/vue.js"],E=["(・`ω´・)",";;w;;","owo","ono","oAo","oxo","ovo;","UwU",">w<","^w^","> w >","v.v"],transformText=(e,s)=>e.map((e=>{if("string"==typeof e)return s(e);if("object"==typeof e&&e.o){const n=Object.assign(e,{o:{}});for(const o of Object.keys(e.o))n.o[o]=transformText(e.o[o],s)}return e})),owo=e=>e.replace(/(?:r|l)/g,"w").replace(/(?:R|L)/g,"W").replace(/n([aeiou])/g,"ny$1").replace(/N([aeiou])/g,"Ny$1").replace(/N([AEIOU])/g,"NY$1").replace(/ove/g,"uv").replace(/!+/g,` ${Object(f.pick_random)(E)} `),z={double:(e,s)=>[...s," ",...s],upper:(e,s)=>transformText(s,(e=>e.toUpperCase())),lower:(e,s)=>transformText(s,(e=>e.toLowerCase())),append_key:(e,s)=>[...s,` (${e})`],set_key:e=>[e],owo:(e,s)=>transformText(s,owo)};class TranslationManager extends _.default{constructor(...e){super(...e),this.inject("settings"),this.parser=new a.a,this._seen=new Set,this.availableLocales=["en"],this.chunks=["client"],this.localeData={en:{name:"English"}},this.loadLocales(),this.strings_loaded=!1,this.new_strings=0,this.changed_strings=0,this.capturing=!1,this.captured=new Map,this.settings.addUI("i18n.debug.open",{path:"Debugging > Localization >> Editing",component:"i18n-open",force_seen:!0}),this.settings.add("i18n.debug.capture",{default:null,process:(e,s)=>null===s?u.DEBUG:s,ui:{path:"Debugging > Localization >> General",title:"Enable message capture.",description:"Capture all localized strings, including variables and call locations, for the purpose of reporting them to the backend. This is used to add new strings to the translation project. By default, message capture is enabled when running in development mode.",component:"setting-check-box",force_seen:!0},changed:e=>{this.capturing=e}}),this.settings.add("i18n.debug.transform",{default:null,ui:{path:"Debugging > Localization >> General",title:"Transformation",description:"Transform all localized strings to test string coverage as well as length.",component:"setting-select-box",data:[{value:null,title:"Disabled"},{value:"upper",title:"Upper Case"},{value:"lower",title:"Lower Case"},{value:"append_key",title:"Append Key"},{value:"set_key",title:"Set to Key"},{value:"double",title:"Double"},{value:"owo",title:"owo what's this"}]},changed:e=>{this._.transformation=z[e],this.emit(":transform"),this.emit(":update")}}),this.settings.add("i18n.locale",{default:-1,process:(e,s)=>{if(-1!==s&&"string"==typeof s||(s=e.get("context.session.languageCode")||"en"),this.availableLocales.includes(s))return s;if("no"===s&&this.availableLocales.includes("nb"))return"nb";const n=s.indexOf("-");return-1===n?"en":(s=s.slice(0,n),this.availableLocales.includes(s)?s:"en")},ui:{path:'Appearance > Localization >> General @{"sort":-100}',title:"Language",description:"FrankerFaceZ is lovingly translated by volunteers from our community. Thank you. If you're interested in helping to translate FrankerFaceZ, please [join our Discord](https://discord.gg/UrAkGhT) and ask about localization.",component:"setting-select-box",data:(e,s)=>this.getLocaleOptions(s)},changed:e=>this.locale=e}),this.settings.add("i18n.format.date",{default:"default",ui:{path:"Appearance > Localization >> Formatting",title:"Date Format",description:"The default date format. Custom date formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"date",component:"format-preview"},data:()=>{const e=[],s=new Date;for(const[n,o]of Object.entries(this._.formats.date))e.push({value:n,title:`${this.formatDate(s,n)} (${n})`});return e}},changed:e=>{this._.defaultDateFormat=e,this.emit(":update")}}),this.settings.add("i18n.format.time",{default:"short",ui:{path:"Appearance > Localization >> Formatting",title:"Time Format",description:"The default time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"time",component:"format-preview"},data:()=>{const e=[],s=new Date;for(const[n,o]of Object.entries(this._.formats.time))e.push({value:n,title:`${this.formatTime(s,n)} (${n})`});return e}},changed:e=>{this._.defaultTimeFormat=e,this.emit(":update")}}),this.settings.add("i18n.format.datetime",{default:"medium",ui:{path:"Appearance > Localization >> Formatting",title:"Date-Time Format",description:"The default combined date-time format. Custom time formats are formated using the [Day.js](https://day.js.org/docs/en/display/format) library.",component:"setting-combo-box",extra:{before:!0,mode:"datetime",component:"format-preview"},data:()=>{const e=[],s=new Date;for(const[n,o]of Object.entries(this._.formats.datetime))e.push({value:n,title:`${this.formatDateTime(s,n)} (${n})`});return e}},changed:e=>{this._.defaultDateTimeFormat=e,this.emit(":update")}})}getLocaleOptions(e){void 0===e&&(e=this.settings.get("i18n.locale"));const s=[],n=[];for(const o of this.availableLocales){const a=this.localeData[o];let u=(null==a?void 0:a.native_name)||(null==a?void 0:a.name)||o;null!=(null==a?void 0:a.coverage)&&(null==a?void 0:a.coverage)<100&&(u=this.t("i18n.locale-coverage","{name} ({coverage,number,percent} Complete)",{name:u,coverage:a.coverage/100}));const f={selected:e===o,value:o,title:u};null!=a&&a.joke?n.push(f):s.push(f)}s.sort(((e,s)=>e.title.localeCompare(s.title))),n.sort(((e,s)=>e.title.localeCompare(s.title)));let o=[{selected:-1===e,value:-1,i18n_key:"setting.appearance.localization.general.language.twitch",title:"Use Twitch's Language"}];return s.length&&(o.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.languages",title:"Supported Languages"}),o=o.concat(s)),n.length&&(o.push({separator:!0,i18n_key:"setting.appearance.localization.general.language.joke",title:"Joke Languages"}),o=o.concat(n)),o}onEnable(){if(this.capturing=this.settings.get("i18n.debug.capture"),this.capturing&&this.loadStrings(),this._=new b.default({warn:(...e)=>this.log.warn(...e),defaultDateFormat:this.settings.get("i18n.format.date"),defaultTimeFormat:this.settings.get("i18n.format.time"),defaultDateTimeFormat:this.settings.get("i18n.format.datetime")}),window.BroadcastChannel){(this._broadcaster=new BroadcastChannel("ffz-i18n")).addEventListener("message",this._boundHandleMessage=this.handleMessage.bind(this))}this._.transformation=z[this.settings.get("i18n.debug.transform")],this.locale=this.settings.get("i18n.locale")}async loadChunk(e){if(this.chunks.includes(e))return[];this.chunks.push(e);const s=this._.locale,n=await this.loadLocale(s,e),o=this._.extend(n);return o.length&&(this.log.info(`Loaded Chunk: ${e} -- Phrases: ${o.length}`),this.emit(":loaded",o),this.emit(":update")),o}broadcast(e){this._broadcaster&&this._broadcaster.postMessage(e)}getKeys(){const e=[];for(const s of this.captured.values()){const n=Object(f.deep_copy)(s);n.translation=this._.phrases.get(n.key)||n.phrase,e.push(n)}return e}requestKeys(){this.broadcast({type:"request-keys"})}updatePhrase(e,s){this.broadcast({type:"update-key",key:e,phrase:s}),this._.extend({[e]:s}),this.emit(":loaded",[e]),this.emit(":update")}handleMessage(e){const s=e.data;if(s)if("update-key"===s.type)this._.extend({[s.key]:s.phrase}),this.emit(":loaded",[s.key]),this.emit(":update");else if("request-keys"===s.type)this.broadcast({type:"keys",data:Array.from(this.captured.values())});else if("keys"===s.type&&Array.isArray(s.data)){for(const e of s.data)this.captured.set(e.key,e);this.emit(":got-keys")}}openUI(e=!0){this.capturing||(this.capturing=!0,this.emit(":update"));const s=this.resolve("translation_ui");e?s.openPopout():s.enable()}get locale(){return this._&&this._.locale}set locale(e){this.setLocale(e)}async loadStrings(e=!1){if(this.strings_loaded&&!e)return;if(this.strings_loading)return;this.strings_loading=!0;const s=await fetch(`${u.SERVER}/script/locale/strings.json?_=${Object(g.getBuster)(30)}`);let n;s.ok?n=await s.json():(this.log.warn(`Error Loading Strings -- Status: ${s.status}`),n=[]);for(const e of n){var o;const s=e.id;let n=this.captured.get(s);var a;if(!n)this.captured.set(s,n={key:s,phrase:e.default,hits:0,calls:[]}),null!==(a=e.source)&&void 0!==a&&a.length&&n.calls.push(e.source);if(!n.options&&null!==(o=e.context)&&void 0!==o&&o.length)try{n.options=JSON.parse(e.context)}catch(e){}n.known=e.default,n.different=e.default!==n.phrase}this.new_strings=0,this.changed_strings=0;for(const e of this.captured.values())e.known||this.new_strings++,e.different&&this.changed_strings++;this.strings_loaded=!0,this.strings_loading=!1,this.log.info(`Loaded ${n.length} strings from the server.`),this.emit(":strings-loaded"),this.emit(":new-strings",this.new_strings),this.emit(":changed-strings",this.changed_strings)}see(e,s,o){if(!this.capturing)return;let a;try{a=(new Error).stack}catch(e){try{a=e.stack}catch(e){}}let u=this.captured.get(e);u||(this.captured.set(e,u={key:e,phrase:s,hits:0,calls:[]}),this.strings_loaded&&(this.new_strings++,this.emit(":new-strings",this.new_strings))),s!==u.phrase&&(u.phrase=s,u.known&&s!==u.known&&!u.different&&(u.different=!0,this.changed_strings++,this.emit(":changed-strings",this.changed_strings))),u.options=this.pluckVariables(e,o),u.hits++,a&&(this.mapStackTrace?this.mapStackTrace(a,(e=>this.recordCall(u,e)),x):n.e(161).then(n.t.bind(null,150,7)).then((e=>{this.mapStackTrace=e.mapStackTrace,this.mapStackTrace(a,(e=>this.recordCall(u,e)),x)})))}pluckVariables(e,s){const n=this._.cache.get(e);if(!n)return null;const o={};return this._doPluck(n,s,o),Object.keys(o).length?o:null}_doPluck(e,s,n){if(Array.isArray(e))for(const o of e)this._doPluck(o,s,n);else if("object"==typeof e&&e.v){const o=Object(f.get)(e.v,s);if(o&&o.$$typeof)return;n[e.v]=Object(f.shallow_copy)(o)}}recordCall(e,s){if(Array.isArray(s))for(const n of s){const s=v.exec(n);if(!s)continue;const o=k.exec(s[2]);if(!o||"webpack"!==o[1])continue;const a=o[2];if(a.includes("/node_modules/")||C.includes(a))continue;let u;if("MainMenu.getSettingsTree"===s[1])u="FFZ Control Center";else{let e=s[1];("Proxy.render"===e||e.startsWith("Proxy.push"))&&o[2].includes(".vue")&&(e="Vue Component"),u=`${e} (${o[2]}:${o[3]})`}return void(e.calls.includes(u)||e.calls.push(u))}}async loadLocales(){const e=await fetch(`${u.SERVER}/script/locale/locales.json?_=${Object(g.getBuster)(30)}`);let s;e.ok?s=await e.json():this.log.warn(`Error Populating Locales -- Status: ${e.status}`),Array.isArray(s)&&s.length||(s=[{id:"en",name:"English",coverage:100,rtl:!1,hashes:{}}]),this.localeData={},this.availableLocales=[];for(const e of s){const s=e.id.toLowerCase();this.localeData[s]=e,this.availableLocales.push(s)}this.emit(":locales-loaded")}async loadLocale(e,s=null){var n;if("en"===e)return{};const o=null===(n=this.localeData[e])||void 0===n?void 0:n.hashes;if(!o)return this.log.info(`Cannot Load Locale: ${e}`),{};s?Array.isArray(s)||(s=[s]):s=this.chunks;const a=this.localeData[e].id,u=[];for(const e of s){const s=o[e];s&&u.push(fetch(`https://cdn.frankerfacez.com/static/locale/${a}/${e}.${s}.json`,void 0).then((e=>e.ok?e.json():null)).catch((()=>null)))}const f=await Promise.all(u),g={};let _=0;for(const e of f)if(e)for(const[s,n]of Object.entries(e))"string"==typeof n&&n.length>0?g[s]=n:_++;return _>0&&this.log.debug(`Ignored ${_} invalid values while loading ${e} chunks.`),g}async setLocale(e){const s=this._.locale;if(e===s)return[];if(await this.loadDayjsLocale(e),this._.locale=e,this._.clear(),this.log.info(`Changed Locale: ${e} -- Old: ${s}`),this.emit(":changed",e,s),this.emit(":update"),"en"===e)return this.emit(":loaded",[]),[];const n=this.localeData[e],o=await this.loadLocale((null==n?void 0:n.id)||e);if(this._.locale!==e)throw new Error("locale has changed since we started loading");const a=this._.extend(o);return a.length&&(this.log.info(`Loaded Locale: ${e} -- Phrases: ${a.length}`),this.emit(":loaded",a),this.emit(":update")),a}async loadDayjsLocale(e){if("en"!==e&&"en-arrr"!==e)try{await n(114)(`./${e}.js`)}catch(s){this.log.warn(`Unable to load day.js locale data for locale "${e}"`,s)}}has(e){return this._.has(e)}formatNode(...e){return this._.formatNode(...e)}toLocaleString(...e){return this._.toLocaleString(...e)}toRelativeTime(...e){return this._.formatRelativeTime(...e)}formatNumber(...e){return this._.formatNumber(...e)}formatDuration(...e){return this._.formatDuration(...e)}formatDate(...e){return this._.formatDate(...e)}formatTime(...e){return this._.formatTime(...e)}formatDateTime(...e){return this._.formatDateTime(...e)}t(e,...s){return this.see(e,...s),this._.t(e,...s)}tList(e,...s){return this.see(e,...s),this._.tList(e,...s)}}const j=/\$/g,O=String.prototype.replace;function transformPhrase(e,s,n,o,a){const u=Array.isArray(e);if(null==s)return u?e[0]:e;let g=e;const _="number"==typeof s?{count:s}:s;return u&&(g=g[0]),"string"==typeof g&&(g=O.call(g,o,((e,s,o)=>{let u=Object(f.get)(s,_);if(null==u)return"";const g=a[o];return"function"==typeof g?u=g(u,n,_):"string"==typeof u&&(u=O.call(u,j,"$$")),u}))),g}},,function(e,s,n){"use strict";n.r(s),n.d(s,"DEFAULT_TYPES",(function(){return x})),n.d(s,"DEFAULT_FORMATS",(function(){return C})),n.d(s,"default",(function(){return TranslationCore})),n.d(s,"getCardinalName",(function(){return getCardinalName})),n.d(s,"getOrdinalName",(function(){return getOrdinalName}));var o=n(20),a=n.n(o),u=n(86),f=n.n(u),g=n(60),_=n.n(g),b=n(0),v=n(10);a.a.extend(f.a);const k={allowTags:!1,requireOther:!1},x={tostring:e=>`${e}`,select(e,s,n,o,a,u){const f=s.o&&(s.o[e]||s.o.other);if(f)return this._processAST(f,u,n)},plural(e,s,n,o,a,u){const f=s.o&&(s.o[`=${e}`]||s.o[getCardinalName(n,e)]||s.o.other);if(f)return this._processAST(f,u,n)},selectordinal(e,s,n,o,a,u){const f=s.o&&(s.o[`=${e}`]||s.o[getOrdinalName(n,e)]||s.o.other);if(f)return this._processAST(f,u,n)},number(e,s){if("number"!=typeof e){let s=parseFloat(e);if(!isNaN(s)&&isFinite(s)||(s=parseInt(e,10)),isNaN(s)||!isFinite(s))return e;e=s}return this.formatNumber(e,s.f)},date(e,s){return this.formatDate(e,s.f)},time(e,s){return this.formatTime(e,s.f)},datetime(e,s){return this.formatDateTime(e,s.f)},duration(e){return this.formatDuration(e)},localestring(e){return this.toLocaleString(e)},relativetime(e,s){return this.formatRelativeTime(e,s.f)},humantime(e,s){return this.formatRelativeTime(e,s.f)},en_plural:e=>1!==e?"s":""},C={number:{currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},default:{},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}},datetime:{short:{month:"numeric",day:"numeric",year:"2-digit",hour:"numeric",minute:"numeric"},medium:{},long:{month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}};class TranslationCore{constructor(e){if(e=e||{},this.warn=e.warn,this._locale=e.locale||"en",this.defaultLocale=e.defaultLocale||this._locale,this.transformation=null,this.defaultDateFormat=e.defaultDateFormat,this.defaultTimeFormat=e.defaultTimeFormat,this.defaultDateTimeFormat=e.defaultDateTimeFormat,this.phrases=new Map,this.cache=new Map,this.numberFormats=new Map,this.formats=Object.assign({},C),e.formats)for(const s of Object.keys(e.formats))this.formats[s]=Object.assign({},this.formats[s],e.formats[s]);this.types=Object.assign({},x,e.types||{}),this.parser=new _.a(Object.assign({},k,e.parserOptions)),e.phrases&&this.extend(e.phrases)}get locale(){return this._locale}set locale(e){e!==this._locale&&(this._locale=e,this.numberFormats.clear())}toLocaleString(e){return e&&e.toLocaleString?e.toLocaleString(this._locale):e}formatRelativeTime(e,s){const n=a()(e),o="plain"===s;try{return n.locale(this._locale).fromNow(o)}catch(e){return n.fromNow(o)}}formatNumber(e,s){let n=this.numberFormats.get(s);return n||(n=this.formats.number[s]?new Intl.NumberFormat(this.locale,this.formats.number[s]):"number"==typeof s?new Intl.NumberFormat(this.locale,{minimumFractionDigits:s,maximumFractionDigits:s}):new Intl.NumberFormat(this.locale),this.numberFormats.set(s,n)),n.format(e)}formatDuration(e){return Object(v.duration_to_string)(e)}formatDate(e,s){if(s||(s=this.defaultDateFormat),s&&!this.formats.date[s]){const n=a()(e);try{return n.locale(this._locale).format(s)}catch(e){return n.format(s)}}return e instanceof Date||(e=new Date(e)),e.toLocaleDateString(this._locale,this.formats.date[s]||{})}formatTime(e,s){if(s||(s=this.defaultTimeFormat),s&&!this.formats.time[s]){const n=a()(e);try{return n.locale(this._locale).format(s)}catch(e){return n.format(s)}}return e instanceof Date||(e=new Date(e)),e.toLocaleTimeString(this._locale,this.formats.time[s]||{})}formatDateTime(e,s){if(s||(s=this.defaultDateTimeFormat),s&&!this.formats.datetime[s]){const n=a()(e);try{return n.locale(this._locale).format(s)}catch(e){return n.format(s)}}return e instanceof Date||(e=new Date(e)),e.toLocaleString(this._locale,this.formats.datetime[s]||{})}extend(e,s){const n=[];if(!e||"object"!=typeof e)return n;for(const o of Object.keys(e)){const a=s?"_"===o?s:`${s}.${o}`:o,u=e[o];if("object"==typeof u)n.push(...this.extend(u,a));else{let e;try{e=this.parser.parse(u)}catch(e){this.warn&&this.warn(`Error parsing i18n phrase for key "${a}": ${u}`,e);continue}this.phrases.set(a,u),this.cache.set(a,e),n.push(a)}}return n}unset(e,s){"string"==typeof e&&(e=[e]);const n=Array.isArray(e)?e:Object.keys(e);for(const o of n){const n=s?"_"===o?s:`${s}.${o}`:o;"object"==typeof e[o]?this.unset(e,n):(this.phrases.delete(n),this.cache.delete(n))}}has(e){return this.phrases.has(e)}set(e,s){const n=this.parser.parse(s);this.phrases.set(e,s),this.cache.set(e,n)}clear(){this.phrases.clear(),this.cache.clear()}replace(e){this.clear(),this.extend(e)}_preTransform(e,s,n,o={}){let a,u,f=null==n?{}:n;if("number"==typeof f&&(f={count:f}),!o.noCache&&this.phrases.has(e))a=this.cache.get(e),u=this.locale;else if(!o.noCache&&this.cache.has(e))a=this.cache.get(e),u=this.defaultLocale;else{let n=null;try{n=this.parser.parse(s)}catch(n){if(o.throwParse)throw n;!o.noWarn&&this.warn&&this.warn(`Error parsing i18n phrase for key "${e}": ${s}`,n),a=["parsing error"],u=this.defaultLocale}n&&(a=n,u=this.locale,o.noCache||(this.locale===this.defaultLocale&&this.phrases.set(e,s),this.cache.set(e,n)))}return this.transformation&&(a=this.transformation(e,a)),[a,f,u]}t(e,s,n,o){return listToString(this.tList(e,s,n,o))}tList(e,s,n,o){return this._processAST(...this._preTransform(e,s,n,o))}formatNode(e,s,n=null,o=null,a=null){if(!e||"object"!=typeof e)return e;null==n&&(n=this.locale);const u=Object(b.get)(e.v,s);if(null==u)return null;if(e.t){if(this.types[e.t])return this.types[e.t].call(this,u,e,n,o,a,s);this.warn&&this.warn(`Encountered unknown type "${e.t}" when formatting node.`)}return u}_processAST(e,s,n){const o=[];for(const a of e){const u=this.formatNode(a,s,n,o,e);null!=u&&o.push(u)}return o}}function listToString(e){return Array.isArray(e)?e.map(listToString).join(""):String(e)}const E={arabic:["ar"],czech:["cs"],danish:["da"],german:["de","el","en","es","fi","hu","it","nl","no","nb","tr","sv"],hebrew:["he"],persian:["fa"],polish:["pl"],serbian:["sr"],french:["fr","pt"],russian:["ru","uk"],slov:["sl"]},z={other:()=>5,arabic(e){if(0===e)return 0;if(1===e)return 1;if(2===e)return 2;const s=e%1e3;return s>=3&&s<=10?3:s>=11?4:5},czech:(e,s,n)=>0!==n?4:1===s?1:s>=2&&s<=4?3:5,danish:(e,s,n,o)=>1===e||0!==o&&(0===s||1===s)?1:5,french:(e,s)=>0===s||1===s?1:5,german:e=>1===e?1:5,hebrew:e=>1===e?1:2===e?2:e>10&&e%10==0?4:5,persian:(e,s)=>0===s||1===e?1:5,slov(e,s,n){if(0!==n)return 3;const o=e%100;return 1===o?1:2===o?2:3===o||4===o?3:5},serbian(e,s,n,o){if(0!==n)return 5;const a=s%10,u=s%100,f=o%10,g=o%100;return 1===a&&11!==u||1===f&&11!==g?1:a>=2&&a<=4&&!(u>=12&&u<=14)||f>=2&&f<=4&&!(g>=12&&g<=14)?3:5},polish(e,s,n){if(0!==n)return 5;if(1===e)return 1;const o=e%10,a=e%100;return o>=2&&o<=4&&!(a>=12&&a<=14)?3:1===s||0!==o&&1!==o?o>=5&&o<=9||a>=12&&a<=14?4:5:4},russian(e,s,n){const o=e%10,a=e%100;return 1===o&&11!==a?1:0===n&&o>=2&&o<=4&&(a<12||a>14)?3:0===n&&(0===o||o>=5&&o<=9||a>=11||a<=14)?4:5}},j={english:["en"],hungarian:["hu"],italian:["it"],one:["fr","lo","ms"],swedish:["sv"],ukranian:["uk"]},O={other:()=>5,one:e=>1===e?1:5,english(e){const s=e%10,n=e%100;return 1===s&&11!==n?1:2===s&&12!==n?2:3===s&&13!==n?3:5},ukranian:e=>3===e%10&&13!==e%100?3:5,hungarian:e=>1===e||5===e?1:5,italian:e=>11===e||8===e||80===e||800===e?4:5,swedish(e){const s=e%10,n=e%100;return 1!==s&&2!==s||11===n||12===n?5:1}},A=["zero","one","two","few","many","other"],T={},D={};for(const e of Object.keys(E))for(const s of E[e])T[s]=e;for(const e of Object.keys(j))for(const s of j[e])D[s]=e;function executePlural(e,s){s=Math.abs(Number(s));const n=Math.floor(s);let o,a;return n===s?(o=0,a=0):(a=`${s}`.split(".")[1],o=a?a.length:0,a=a?Number(a):0),A[e(s,n,o,a)]}function getCardinalName(e,s){let n=T[e];if(!n){const s=e.indexOf("-");n=-1!==s&&T[e.slice(0,s)]||"other",T[e]=n}return executePlural(z[n],s)}function getOrdinalName(e,s){let n=D[e];if(!n){const s=e.indexOf("-");n=-1!==s&&D[e.slice(0,s)]||"other",D[e]=n}return executePlural(O[n],s)}},function(e,s,n){"use strict";n.d(s,"a",(function(){return E}));var o=n(23),a=n(31),u=n(32),f=n(33),g=n(34),_=n(55),b=n(56),v=n(57),k=n(58),x=n(59),C=[a.a,u.a,f.a,g.a,_.a,b.a,v.a,k.a,x.a],E=Object(o.b)({defaultModifiers:C})},function(e,s,n){"use strict";n.d(s,"a",(function(){return SettingsContext}));var o=n(7),a=n(0),u=n(52);function compare_requirements(e,s,n){if(!e||!Array.isArray(e.requires))return!1;for(const o of e.requires){const e=n.get(o),u=s.get(o);if(typeof e!=typeof u)return!0;if(Array.isArray(e)&&Array.isArray(u)){if(!Object(a.array_equals)(u,e))return!0}else if(u instanceof Set&&e instanceof Set){if(!Object(a.set_equals)(u,e))return!0}else if(u instanceof Map&&e instanceof Map){if(!Object(a.map_equals)(u,e))return!0}else if(u!==e)return!0}return!1}class SettingsContext extends o.EventEmitter{constructor(e,s){super(),e instanceof SettingsContext?(this.parent=e,this.manager=e.manager,this.parent.on("context_changed",this._rebuildContext,this)):(this.parent=null,this.manager=e),this.manager.__contexts.push(this),this._context=s||{},this.__ls_listening=!1,this.__ls_wanted=new Map,this.__cache=new Map,this.__meta=new Map,this.__profiles=[],this.order=[],this._rebuildContext()}destroy(){this.parent&&this.parent.off("context_changed",this._rebuildContext,this);for(const e of this.__profiles)e.off("changed",this._onChanged,this);const e=this.manager.__contexts,s=e.indexOf(this);-1!==s&&e.splice(s,1)}_watchLS(){this.__ls_watched||(this.__ls_watched=!0,this.manager.on(":ls-update",this._onLSUpdate,this))}_unwatchLS(){this.__ls_watched&&(this.__ls_watched=!1,this.manager.off(":ls-update",this._onLSUpdate,this))}_onLSUpdate(e){const s=this.__ls_wanted.get(`ls.${e}`);if(s)for(const e of s)this._update(e,e,[])}_rebuildContext(){this.__context=this.parent?Object.assign({},this.parent.__context||this.parent._context,this._context):this._context,this.selectProfiles()||this.rebuildCache(),this.emit("context_changed")}selectProfiles(){const e=[],s=this.order=[];if(!this.manager.disable_profiles)for(const n of this.manager.__profiles)n.toggled&&n.matches(this.__context)&&(e.push(n),s.push(n.id));if(Object(a.array_equals)(this.__profiles,e))return!1;const n=new Set;for(const s of this.__profiles)e.includes(s)||(s.off("changed",this._onChanged,this),n.add(s.id));for(const s of e)this.__profiles.includes(s)||(s.on("changed",this._onChanged,this),n.add(s.id));return this.__profiles=e,this.emit("profiles_changed"),this.rebuildCache(n),!0}rebuildCache(){const e=this.__cache,s=this.__meta,n=this.__meta=new Map;this.__cache=new Map;for(const[o,u]of e){const f=this.get(o),g=n.get(o),_=s.get(o),b=g?g.uses:null,v=_?_.uses:null,k=this.manager.definitions.get(o);let x=!1;k&&k.equals?"requirements"===k.equals?x=compare_requirements(k,this.__cache,e):"function"==typeof k.equals&&(x=!k.equals(f,u,this.__cache,e)):Array.isArray(f)&&Array.isArray(u)?x=!Object(a.array_equals)(f,u):f instanceof Set&&u instanceof Set?x=!Object(a.set_equals)(f,u):f instanceof Map&&u instanceof Map?x=!Object(a.map_equals)(f,u):f!==u&&(x=!0),x&&(this.emit("changed",o,f,u),this.emit(`changed:${o}`,f,u)),Object(a.array_equals)(b,v)||(this.emit("uses_changed",o,b,v),this.emit(`uses_changed:${o}`,b,v))}}context(e){return new SettingsContext(this,e)}updateContext(e){let s=!1;for(const n in e)if(Object(a.has)(e,n)){const o=e[n];try{if(Object(a.deep_equals)(o,this._context[n]))continue}catch(e){}this._context[n]=o,s=!0}s&&this._rebuildContext()}setContext(e){this._context_objects=new Set,this._context={},this.updateContext(e)}_onChanged(e){this._update(e,e,[])}_update(e,s,n){if(!this.__cache.has(e))return;if(n.includes(e))throw new Error(`cyclic dependent chain when updating setting "${s}"`);n.push(e);const o=this.__cache.get(e),u=this.__meta.get(e),f=this._get(e,e,[]),g=this.__meta.get(e),_=u?u.uses:null,b=g?g.uses:null;if(Object(a.array_equals)(b,_)||(this.emit("uses_changed",e,b,_),this.emit(`uses_changed:${e}`,b,_)),o===f)return;this.emit("changed",e,f,o),this.emit(`changed:${e}`,f,o);const v=this.manager.definitions.get(e);if(v&&v.required_by)for(const e of v.required_by)e.startsWith("context.")||e.startsWith("ls.")||this._update(e,s,Array.from(n))}_get(e,s,n){if(n.includes(e))throw new Error(`cyclic dependency when resolving setting "${s}"`);n.push(e);const o=this.manager.definitions.get(e),a=o&&o.type,f=a?u[a]:u.basic;if(!f)throw new Error(`non-existent setting type "${a}"`);const g=this._getRaw(e,f),_={uses:g?g[1]:null};let b=g?g[0]:void 0;if(o){if(Array.isArray(o))throw new Error(`non-existent setting "${e}" required when resolving setting "${s}"`);if(null===_.uses){const e=o.default;b="function"==typeof e?e(this):e,f.default&&(b=f.default(b,o,this.manager.log))}if(o.requires)for(const a of o.requires)if(a.startsWith("ls.")){this._watchLS();let s=this.__ls_wanted.get(a);s||this.__ls_wanted.set(a,s=new Set),s.add(e)}else a.startsWith("context.")||this.__cache.has(a)||this._get(a,s,Array.from(n));o.process&&(b=o.process(this,b,_))}return this.__cache.set(e,b),this.__meta.set(e,_),b}*profiles(){for(const e of this.__profiles)yield e}hasProfile(e){if("number"==typeof e)for(const s of this.__profiles)if(s.id===e)return!0;return this.__profiles.includes(e)}_getRaw(e,s){if(!s)throw new Error(`non-existent type for ${e}`);return s.get(e,this.profiles(),this.manager.definitions.get(e),this.manager.log,this)}update(e){this._update(e,e,[])}get(e){return e.startsWith("ls.")?this.manager.getLS(e.slice(3)):e.startsWith("context.")?Object(a.get)(e.slice(8),this.__context):this.__cache.has(e)?this.__cache.get(e):this._get(e,e,[])}getChanges(e,s,n){this.onChange(e,s,n),s.call(n,this.get(e))}onChange(e,s,n){this.on(`changed:${e}`,s,n)}uses(e){return e.startsWith("ls.")||e.startsWith("context.")?null:(this.__meta.has(e)||this._get(e,e,[]),this.__meta.get(e).uses)}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return MigrationManager}));class MigrationManager{constructor(e){this.manager=e,this.provider=e.provider}process(){throw new Error("Not Implemented")}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getOppositeVariationPlacement}));var o={start:"end",end:"start"};function getOppositeVariationPlacement(e){return e.replace(/start|end/g,(function(e){return o[e]}))}},function(e,s,n){"use strict";n.d(s,"a",(function(){return Badges})),n.d(s,"c",(function(){return getBadgeCategory})),n.d(s,"b",(function(){return fixBadgeData}));var o=n(2),a=n(1),u=n(0),f=n(4),g=n(11);const _={1:{staff:{1:{color:"#200f33",svg:!0,trans:{color:"#6441a5"}}},admin:{1:{color:"#faaf19",svg:!0}},global_mod:{1:{color:"#0c6f20",svg:!0}},broadcaster:{1:{color:"#e71818",svg:!0}},moderator:{1:{color:"#34ae0a",svg:!0}},twitchbot:{1:{color:"#34ae0a"}},partner:{1:{color:"transparent",trans:{image:!0,color:"#6441a5"}}},"clip-champ":{1:{color:"#6441a5"}},vip:{1:{color:"#b33ff0",trans:{color:"transparent",invert:!1}}},turbo:{1:{color:"#6441a5",svg:!0}},premium:{1:{color:"#009cdc"}},subscriber:{0:{color:"#6441a5"},1:{color:"#6441a5"}}},2:{staff:{1:{color:"#000"}},admin:{1:{color:"#DB7600"}},broadcaster:{1:{color:"#E91916"}},moderator:{1:{color:"#00AD03"}},global_mod:{1:{color:"#006441"}},twitchbot:{1:{color:"#00AD03"}},partner:{1:{color:"#9146FF"}},subscriber:{0:{color:"#8205B4"},1:{color:"#8205B4"}},vip:{1:{color:"#E005B9"}},turbo:{1:{color:"#59399A"}},premium:{1:{color:"#00A0D6"}},"anonymous-cheerer":{1:{color:"#4B367C"}},"clip-champ":{1:{color:"#9146FF"}}}},b={staff:-2,admin:-1,global_mod:-1,broadcaster:0,mod:1,moderator:1,twitchbot:1,vip:2,subscriber:25},v="background-repeat:no-repeat;background-position:center;",k=`${o.SERVER}/static/badges/twitch/`,x=o.IS_WEBKIT?"webkitMaskImage":"maskImage",C={0:e=>`${e.fore?`color:${e.fore};`:""}background:${e.image||""} ${e.color};background-size:${1.8*e.scale}rem;${e.svg?"":`background-image:${e.image_set};`}${v}`,1:e=>`${C[0](e)}border-radius:${.2*e.scale}rem;`,2:e=>`${C[0](e)}border-radius:${.9*e.scale}rem;background-size:${1.6*e.scale}rem;`,3:e=>`${e.fore?`color:${e.fore};`:""}background:${e.color};border-radius:${.9*e.scale}rem;`,4:e=>`${C[3](e)}height:${e.scale}rem;min-width:${e.scale}rem;`,5:e=>`background:${e.image};background-size:${1.8*e.scale}rem;${e.svg?"":`background-image:${e.image_set};`}${v}`,6:e=>`background:linear-gradient(${e.color},${e.color});${o.WEBKIT_CSS}mask-image:${e.image};${o.WEBKIT_CSS}mask-size:${1.8*e.scale}rem ${1.8*e.scale}rem;${e.svg?"":`${o.WEBKIT_CSS}mask-image:${e.image_set};`}`};function generateOverrideCSS(e,s){const n=e.urls||{1:e.image},a=`url("${n[1]}")`,u=`${o.WEBKIT_CSS}image-set(${a} 1x${n[2]?`, url("${n[2]}") 2x`:""}${n[4]?`, url("${n[4]}") 4x`:""})`;return 3===s||4===s?"":6===s?`${o.WEBKIT_CSS}mask-image:${a} !important;${o.WEBKIT_CSS}mask-image:${u} !important;`:`background-image:${a} !important;background-image:${u} !important;`}function generateBadgeCSS(e,s,n,a,f,g=2,_,b,v=1,x=!1){let E,z,j,O=n.color||"transparent",A=n.fore||f?"#fff":"#000",T=n.image||(n.addon?null:`${k}${g}/${e}${n.svg?".svg":`/${s}/`}`),D=!1,B=!1;if(T&&a>4){const e=n.trans||{};O=e.color||O,e.image&&(D=!0,!0!==e.image&&(T=e.image)),B=Object(u.has)(e,"invert")?e.invert&&!f:5===a&&!f}return 3!==a&&4!==a||"transparent"===O&&n.trans&&(O=n.trans.color||O),"transparent"===O&&(a=0),T&&3!==a&&4!==a&&(E=T.endsWith(".svg"),z=n.urls?`url("${n.urls[v]}")`:`url("${E?T:`${T}${v}${D?"_trans":""}.png`}")`,n.urls&&1===v?j=`${o.WEBKIT_CSS}image-set(${z} 1x${n.urls[2]?`, url("${n.urls[2]}") 2x`:""}${n.urls[4]?`, url("${n.urls[4]}") 4x`:""})`:n.urls&&2===v?j=`${o.WEBKIT_CSS}image-set(${z} 1x${n.urls[4]?`, url("${n.urls[4]}") 2x`:""})`:!E&&v<4?1===v?j=`${o.WEBKIT_CSS}image-set(${z} 1x, url("${T}2${D?"_trans":""}.png") 2x, url("${T}4${D?"_trans":""}.png") 4x)`:2===v&&(j=`${o.WEBKIT_CSS}image-set(${z} 1x, url("${T}4${D?"_trans":""}.png") 2x)`):j=z),_&&O&&"transparent"!==O&&(O=_.process(O)||O),b&&A&&"transparent"!==A&&"transparent"!==O&&(b.base=O,A=b.process(A)||A),T||(a>4?a=1:a>3&&(a=2)),`${x&&(n.click_handler||n.click_url||n.click_action)?"cursor:pointer;":""}${B?"filter:invert(100%);":""}${C[a]({scale:1,color:O,fore:A,image:z,image_set:j,svg:E})}${n.css||""}`}class Badges extends f.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("tooltips"),this.inject("experiments"),this.style=new a.ManagedStyle("badges"),this.bulk=new Map,this.badges={},this.twitch_badges={},o.IS_FIREFOX&&this.settings.add("chat.badges.media-queries",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use @media queries to support High-DPI Badge images in Mozilla Firefox.",description:"This is required to see high-DPI badges on Firefox because Firefox still has yet to support `image-set()` after more than five years. It may be less reliable.",component:"setting-check-box"}}),this.settings.add("chat.badges.version",{default:2,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Version",component:"setting-select-box",data:[{value:1,title:"1 (Pre December 2019)"},{value:2,title:"2 (Current)"}]}}),this.settings.add("chat.badges.clickable",{default:!0,ui:{path:"Chat > Badges >> Behavior",title:"Allow clicking badges.",description:"Certain badges, such as Prime Gaming, act as links when this is enabled.",component:"setting-check-box"}}),this.settings.add("chat.badges.fix-colors",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Adjust badge colors for visibility.",description:"Ensures that badges are visible against the current background.\n\n**Note:** Only affects badges with custom rendering. Subscriber badges, bit badges, etc. are not affected.",component:"setting-check-box"}}),this.settings.add("chat.badges.hidden",{default:{},type:"object_merge",ui:{path:"Chat > Badges >> tabs ~> Visibility",title:"Visibility",component:"badge-visibility",getBadges:e=>this.getSettingsBadges(!0,e)}}),this.settings.add("chat.badges.custom-mod",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom moderator badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.custom-vip",{default:!0,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Use custom VIP badges where available.",component:"setting-check-box"}}),this.settings.add("chat.badges.style",{default:1,ui:{path:"Chat > Badges >> tabs ~> Appearance",title:"Style",component:"setting-select-box",data:[{value:0,title:"Square"},{value:1,title:"Rounded"},{value:2,title:"Circular"},{value:3,title:"Circular (Color Only)"},{value:4,title:"Circular (Color Only, Small)"},{value:5,title:"Transparent"},{value:6,title:"Transparent (Colored)"}]}}),this.handleClick=this.handleClick.bind(this)}getSettingsBadges(e,s){const n=[],o=[],a=[],f=[],g=[],_=[],b=[];if(!Object.keys(this.twitch_badges).length&&s){const e=this.resolve("site.twitch_data");e&&e.getBadges().then((e=>{this.updateTwitchBadges(e),s()}))}for(const e in this.twitch_badges)if(Object(u.has)(this.twitch_badges,e)){const s=this.twitch_badges[e],_=[];let b=s&&(s[1]||s[0]);for(const e in s)if("__cat"!==e&&Object(u.has)(s,e)){const n=s[e];b||(b=n),n&&n.image1x&&_.push({version:e,name:n.title,image:n.image1x,styleImage:`url("${n.image1x}")`})}if(b){let u;u="m-other"===s.__cat?o:"m-owl"===s.__cat?a:"m-tcon"===s.__cat?f:"m-game"===s.__cat?g:n,u.push({id:e,provider:"twitch",name:b.title,color:"transparent",image:b.image2x,versions:_,styleImage:`url("${b.image2x}")`})}}if(e)for(const e in this.badges)if(Object(u.has)(this.badges,e)){const s=this.badges[e];if(s.no_visibility)continue;let n=s.urls?s.urls[2]||s.urls[1]:s.image,o=s.color||"transparent";s.addon||(n=`//cdn.frankerfacez.com/badge/${s.id}/2/rounded`,o="transparent"),(s.addon?b:_).push({id:e,provider:"ffz",name:s.title,color:o,image:n,styleImage:`url("${n}")`})}return[{title:"Twitch",id:"m-twitch",badges:n},{title:"Twitch: TwitchCon",id:"m-tcon",badges:f},{title:"Twitch: Other",id:"m-other",badges:o},{title:"Twitch: Overwatch League",id:"m-owl",badges:a},{title:"Twitch: Game",id:"m-game",key:"game",badges:g},{title:"FrankerFaceZ",id:"m-ffz",badges:_},{title:"Add-on",id:"m-addon",badges:b}]}onEnable(){this.parent.context.on("changed:chat.badges.custom-mod",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.custom-vip",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.style",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.is-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:theme.tooltips-dark",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.version",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.media-queries",this.rebuildAllCSS,this),this.parent.context.on("changed:chat.badges.fix-colors",this.rebuildColoredBadges,this),this.parent.context.on("changed:chat.badges.clickable",this.rebuildAllCSS,this),this.rebuildAllCSS(),this.loadGlobalBadges(),this.tooltips.types.badge=(e,s)=>{s.add_class="ffz__tooltip--badges";const n=this.parent.context.get("tooltip.badge-images"),o=this.getBadgeData(e),u=[];if(null==o.data)return u;for(const e of o.data){const s=e.provider;if("twitch"===s){const s=this.getTwitchBadge(e.badge,e.version,o.room_id,o.room_login),f=this.getTwitchBadge(e.badge,e.version,null,null,!0)||{};if(!s)continue;let g=s.title||f.title;const _=s.tier||f.tier;e.data&&("subscriber"===e.badge?g=_>0?this.i18n.t("badges.subscriber.tier-months","{title}\n(Tier {tier}, {months, plural, one {# Month} other {# Months}})",{title:g,tier:_,months:e.data}):this.i18n.t("badges.subscriber.months","{title}\n({count, plural, one {# Month} other {# Months}})",{title:g,count:e.data}):"founder"===e.badge&&(g=this.i18n.t("badges.founder.months","{title}\n(Subscribed for {count, plural, one {# Month} other {# Months}})",{title:g,count:e.data}))),u.push(Object(a.createElement)("div",{class:"ffz-badge-tip"},n&&Object(a.createElement)("img",{class:"preview-image ffz-badge",src:s.image4x}),g))}else"ffz"===s&&u.push(Object(a.createElement)("div",{class:"ffz-badge-tip"},n&&e.image&&Object(a.createElement)("div",{class:"preview-image ffz-badge",style:{backgroundColor:e.color,backgroundImage:`url("${e.image}")`}}),e.title))}return u}}getBadgeData(e){var s,n,o,a,u,f,g,_,b,v,k;let x=null===(s=e.parentElement)||void 0===s?void 0:s.parentElement;null!==(n=x)&&void 0!==n&&null!==(o=n.dataset)&&void 0!==o&&o.roomId||(x=e.closest("[data-room-id]"));const C=null===(a=x)||void 0===a||null===(u=a.dataset)||void 0===u?void 0:u.roomId,E=null===(f=x)||void 0===f||null===(g=f.dataset)||void 0===g?void 0:g.room,z=null===(_=x)||void 0===_||null===(b=_.dataset)||void 0===b?void 0:b.userId,j=null===(v=x)||void 0===v||null===(k=v.dataset)||void 0===k?void 0:k.user;let O;if(e.dataset.badgeData)O=JSON.parse(e.dataset.badgeData);else{var A,T,D,B;const s=e.dataset.badgeIdx;let n;if(x.message)n=x.message;else{const e=this.resolve("site.fine");if(e){var P,L,I,N,R,U,q,H,G,V,W,K,Z,J;if(n=null===(P=x[e.accessor])||void 0===P||null===(L=P.return)||void 0===L||null===(I=L.stateNode)||void 0===I||null===(N=I.props)||void 0===N?void 0:N.message,n||(n=null===(R=e.searchParent(x,(e=>{var s;return null===(s=e.props)||void 0===s?void 0:s.message})))||void 0===R||null===(U=R.props)||void 0===U?void 0:U.message),!n&&"clips"===this.root.flavor){var Y,X;const s=this.resolve("site.chat.line"),o=null===(Y=e.searchParent(x,(e=>{var s;return null===(s=e.props)||void 0===s?void 0:s.node})))||void 0===Y||null===(X=Y.props)||void 0===X?void 0:X.node;s&&o&&(n=s.messages.get(o))}n||(n=null===(q=e.searchParent(x,(e=>{var s;return null===(s=e.props)||void 0===s?void 0:s.node})))||void 0===q||null===(H=q.props)||void 0===H||null===(G=H.node)||void 0===G?void 0:G._ffz_message),n||(n=null===(V=e.searchParent(x,(e=>{var s;return null===(s=e.props)||void 0===s?void 0:s.messageContext})))||void 0===V||null===(W=V.props)||void 0===W||null===(K=W.messageContext)||void 0===K||null===(Z=K.comment)||void 0===Z?void 0:Z._ffz_message),n||(n=null===(J=e.searchParent(x,(e=>e._ffzIdentityMsg),50))||void 0===J?void 0:J._ffzIdentityMsg)}}null!==(A=n)&&void 0!==A&&A._ffz_message&&(n=n._ffz_message),n&&(O=null===(T=n.ffz_badge_cache)||void 0===T||null===(D=T[s])||void 0===D||null===(B=D[1])||void 0===B?void 0:B.badges)}return{room_id:C,room_login:E,user_id:z,user_login:j,data:O}}handleClick(e){if(!this.parent.context.get("chat.badges.clickable"))return;const s=e.target,n=this.getBadgeData(s);if(null==n.data)return;let o=null;for(const a of n.data){const u=a.provider;if("twitch"===u){const e=this.getTwitchBadge(a.badge,a.version,n.room_id,n.room_login),s=this.getTwitchBadge(a.badge,a.version,null,null,!0)||{};if(!e)continue;if(e.click_url)o=e.click_url;else if(s.click_url)o=s.click_url;else{if("sub"!==e.click_action&&"sub"!==s.click_action||!n.room_login)continue;o=`https://www.twitch.tv/subs/${n.room_login}`}break}if("ffz"===u){const a=this.badges[s.dataset.badge];if(null!=a&&a.click_handler){o=a.click_handler(n.user_id,n.user_login,n.room_id,n.room_login,n.data,e);break}if(null!=a&&a.click_url){o=a.click_url;break}}}if(o){Object(a.createElement)("a",{target:"_blank",rel:"noopener noreferrer",href:o}).click()}e.preventDefault()}cacheBadges(e,s=!1){if(e.ffz_badge_cache)return e.ffz_badge_cache;const n=s?{}:this.parent.context.get("chat.badges.hidden")||{},a=this.parent.context.get("chat.badges.style"),f=this.parent.context.get("chat.badges.custom-mod"),g=this.parent.context.get("chat.badges.custom-vip"),_=a>5,v=5!==a,k=3!==a&&4!==a,C=n["m-ffz"],E=n["m-addon"],z=this.twitch_badges,j=new Map,O=e.badges||{},A=e.badgeDynamicData||{},T=e.roomID,D=e.roomLogin,B=this.parent.getRoom(T,D,!0),P=e.ffz_badges;let L,I=50;for(const e in O)if(Object(u.has)(O,e)){const s=O[e],o=n[e],a=z&&z[e],_=a&&a.__cat||"m-twitch";if(o||null==o&&n[_])continue;L=Object(u.has)(b,e)?b[e]:I++;const v=A[e]||"founder"===e&&A.subscriber,k="moderator"===e&&f&&B&&B.data&&B.data.mod_urls,x="vip"===e&&g&&B&&B.data&&B.data.vip_badge,C=[];if(k){const n=this.getTwitchBadge(e,s,T,D);C.push({provider:"ffz",image:k[4]||k[2]||k[1],color:"#34ae0a",title:n?n.title:"Moderator",data:v})}else if(x){const n=this.getTwitchBadge(e,s,T,D);C.push({provider:"ffz",image:x[4]||x[2]||x[1],color:"transparent",title:n?n.title:"VIP",data:v})}else C.push({provider:"twitch",badge:e,version:s,data:v});j.set(L,{id:e,props:{"data-provider":"twitch","data-badge":e,"data-version":s,style:{}},badges:C})}if(Array.isArray(P)){const e=new Set;for(const s of P)if(s&&null!=s.id){if(e.has(s.id))continue;e.add(s.id);const a=this.badges[s.id]||{},f=n[s.id];if(f||null==f&&(a.addon?E:C))continue;const g=Object(u.has)(s,"slot")?s.slot:a.slot,b=j.get(g),z=s.urls||(s.image?{1:s.image}:null),O=s.color||a.color||"transparent",A=s.no_invert,T="transparent"!==O&&_,D=z||a.urls||{1:a.image},B={provider:"ffz",image:D[4]||D[2]||D[1],color:s.color||a.color,title:s.title||a.title};let P;if(a.addon||(B.image=`//cdn.frankerfacez.com/badge/${s.id}/4/rounded`,B.color=null),b){b.badges.push(B);const e=Object(u.has)(s,"replaces")?s.replaces:a.replaces,n=s.replaces_type||a.replaces_type;if(!e||n&&n!==b.id)continue;b.replaced=s.id,b.content=s.content||a.content||b.content,P=b.props.style}else{if(null==g)continue;{P={};const e={className:"ffz-tooltip ffz-badge","data-tooltip-type":"badge","data-provider":"ffz","data-badge":s.id,style:P};j.set(g,{id:s.id,props:e,badges:[B],content:s.content||a.content})}}if(A){const e=j.get(g);e.full_size=!0,e.no_invert=!0,P.background="unset",P.backgroundSize="unset",P[x]="unset"}if((k||"transparent"===O)&&z){const e=`url("${z[1]}")`;let s;(z[2]||z[4])&&(s=`${o.WEBKIT_CSS}image-set(${e} 1x${z[2]?`, url("${z[2]}") 2x`:""}${z[4]?`, url("${z[4]}") 4x`:""})`),P[T&&!A?x:"backgroundImage"]=e,s&&(P[T&&!A?x:"backgroundImage"]=s)}v&&s.color&&(T&&!A?P.backgroundImage=`linear-gradient(${s.color},${s.color})`:P.backgroundColor=s.color)}}return e.ffz_badge_cache=Array.from(j).sort(((e,s)=>e[0]-s[0]))}render(e,s,n=!1,o=!1){if(!e.badges&&!e.ffz_badges)return null;if(e.ffz_badge_cache||this.cacheBadges(e,n),!e.ffz_badge_cache.length)return null;const a=[];for(let n=0,f=e.ffz_badge_cache.length;n<f;n++){const f=e.ffz_badge_cache[n][1],g=f.props;let _=Object(u.maybe_call)(f.content,this,f,e,s);_&&!Array.isArray(_)&&(_=[_]),g.className=`ffz-tooltip ffz-badge${_?" tw-pd-x-05":""}${f.full_size?" ffz-full-size":""}${f.no_invert?" ffz-no-invert":""}`,g.key=`${g["data-provider"]}-${g["data-badge"]}`,g["data-tooltip-type"]="badge",g["data-badge-idx"]=n,o||(g.onClick=this.handleClick),f.replaced&&(g["data-replaced"]=f.replaced),a.push(s("span",g,_||void 0))}return a}rebuildColor(){this.parent.context.get("chat.badges.fix-colors")?(this.fg_fixer=new g.ColorAdjuster("#fff",1,4.5),this.color_fixer=new g.ColorAdjuster(this.parent.context.get("theme.is-dark")?"#181818":"#FFFFFF",1,2.5)):(this.fg_fixer=null,this.color_fixer=null)}rebuildColoredBadges(){this.rebuildColor(),this.buildBadgeCSS(),this.buildTwitchCSSBadgeCSS()}rebuildAllCSS(){this.rebuildColor();for(const e of this.parent.iterateRooms())e.buildBadgeCSS(),e.buildModBadgeCSS();this.buildBadgeCSS(),this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}getBadges(e,s,n,o){const a=this.parent.getRoom(n,o,!0),u=this.parent.getUser(e,s,!0);var f,g;u&&(e=null!==(f=e)&&void 0!==f?f:u.id,s=null!==(g=s)&&void 0!==g?g:u.login);const _=a&&a.getUser(e,s,!0),b=(null!=u&&u.badges?u.badges._cache:[]).concat(null!=_&&_.badges?_.badges._cache:[]);if(this.bulk.size){const s=String(e);for(const[e,n]of this.bulk)null!=n&&n._cache.has(s)&&b.push({id:e})}return b}setBulk(e,s,n){let o=this.bulk.get(s);o||this.bulk.set(s,o=new u.SourcedSet(!0)),o.set(e,n)}deleteBulk(e,s){const n=this.bulk.get(s);n&&n.delete(e)}extendBulk(e,s,n){let o=this.bulk.get(s);o||this.bulk.set(s,o=new u.SourcedSet(!0)),Array.isArray(n)||(n=[n]),o.extend(e,...n)}async loadGlobalBadges(e=0){let s,n;if(this.experiments.getAssignment("api_load")&&e<1)try{fetch(`${o.NEW_API}/v1/badges/ids`).catch((()=>{}))}catch(e){}try{s=await fetch(`${o.API_SERVER}/v1/badges/ids`)}catch(s){return++e<10?setTimeout((()=>this.loadGlobalBadges(e)),500*e):(this.log.error("Error loading global badge data.",s),!1)}if(!s.ok)return!1;try{n=await s.json()}catch(e){return this.log.error("Error parsing global badge data.",e),!1}let a=0,f=0;if(n.badges)for(const e of n.badges)e&&e.id&&(this.loadBadgeData(e.id,e,!1),a++);if(n.users)for(const e in n.users)if(Object(u.has)(n.users,e)){const s=this.badges[e],o=null==s?void 0:s.name;let a=0;if("supporter"===o||"bot"===o)this.setBulk("ffz-global",e,n.users[e].map((e=>String(e)))),a=n.users[e].length;else for(const s of n.users[e]){this.parent.getUser(s,void 0).addBadge("ffz-global",e)&&(a++,f++)}a>0&&this.log.info(`Added "${s?s.name:`#${e}`}" to ${a} users.`)}this.log.info(`Loaded ${a} badges and assigned them to ${f} users.`),this.buildBadgeCSS()}loadBadgeData(e,s,n=!0){this.badges[e]=s,s&&(void 0===s.addon&&(s.addon=/^addon/.test(e)),s.replaces&&!s.replaces_type&&(s.replaces_type=s.replaces,s.replaces=!0),s.addon||"developer"!==s.name&&"supporter"!==s.name||(s.click_url="https://www.frankerfacez.com/donate")),n&&this.buildBadgeCSS()}buildBadgeCSS(){const e=this.parent.context.get("chat.badges.style"),s=this.parent.context.get("theme.is-dark"),n=this.parent.context.get("chat.badges.clickable"),a=o.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),f=[];for(const o in this.badges)if(Object(u.has)(this.badges,o)){const u=this.badges[o],g=`.ffz-badge[data-badge="${o}"]`;f.push(`.ffz-badge[data-replaced="${o}"]{${generateOverrideCSS(u,e)}}`),a?(f.push(`@media (max-resolution: 99dpi) {${g}{${generateBadgeCSS(o,0,u,e,s,0,this.color_fixer,this.fg_fixer,1,n)}}}`),f.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${g}{${generateBadgeCSS(o,0,u,e,s,0,this.color_fixer,this.fg_fixer,2,n)}}}`),f.push(`@media (min-resolution: 200dpi) {${g}{${generateBadgeCSS(o,0,u,e,s,0,this.color_fixer,this.fg_fixer,4,n)}}}`)):f.push(`${g}{${generateBadgeCSS(o,0,u,e,s,0,this.color_fixer,this.fg_fixer,void 0,n)}}`)}this.style.set("ext-badges",f.join("\n"))}getTwitchBadge(e,s,n,o,a=!1){const u=this.parent.getRoom(n,o,!0);let f;if(u){const n=u.badges&&u.badges[e];f=n&&n[s]}if(!f){const n=this.twitch_badges&&this.twitch_badges[e];f=n&&n[s]}if(!f&&!a){const e=this.resolve("site.chat");e&&e.tryUpdateBadges&&e.tryUpdateBadges()}return f}getTwitchBadgeCount(){return this.twitch_badge_count||0}updateTwitchBadges(e){if(this.twitch_badge_count=0,Array.isArray(e)){let s=null;if(e.length){s={};for(const n of e){const e=n.setID,o=s[e]=s[e]||{__cat:getBadgeCategory(e)};this.twitch_badge_count++,o[n.version]=fixBadgeData(n)}}this.twitch_badges=s}else this.twitch_badges=e;this.buildTwitchBadgeCSS(),this.buildTwitchCSSBadgeCSS()}buildTwitchCSSBadgeCSS(){const e=this.parent.context.get("chat.badges.style"),s=this.parent.context.get("theme.is-dark"),n=this.parent.context.get("chat.badges.clickable"),a=o.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),f=this.parent.context.get("chat.badges.version"),g=_[f]||{},b=this.twitch_badges||{},v=[];for(const o in g)if(Object(u.has)(g,o)){const _=g[o],k=b[o];for(const g in _)if(Object(u.has)(_,g)){const u=_[g],b=null==k?void 0:k[g],x=`.ffz-badge[data-badge="${o}"][data-version="${g}"]`;b&&b.click_url&&(u.click_url=b.click_url),b&&b.click_action&&(u.click_action=b.click_action),a?(v.push(`@media (max-resolution: 99dpi) {${x}{${generateBadgeCSS(o,g,u,e,s,f,this.color_fixer,this.fg_fixer,1,n)}}}`),v.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) {${x}{${generateBadgeCSS(o,g,u,e,s,f,this.color_fixer,this.fg_fixer,2,n)}}}`),v.push(`@media (min-resolution: 200dpi) {${x}{${generateBadgeCSS(o,g,u,e,s,f,this.color_fixer,this.fg_fixer,4,n)}}}`)):v.push(`${x}{${generateBadgeCSS(o,g,u,e,s,f,this.color_fixer,this.fg_fixer,void 0,n)}}`)}}this.style.set("css-badges",v.join("\n"))}buildTwitchBadgeCSS(){this.twitch_badges||this.style.delete("twitch-badges");const e=this.parent.context.get("chat.badges.version"),s=o.IS_FIREFOX&&this.parent.context.get("chat.badges.media-queries"),n=this.parent.context.get("chat.badges.clickable"),a=_[e]||{},f=[];for(const e in this.twitch_badges)if(Object(u.has)(this.twitch_badges,e)){if(Object(u.has)(a,e))continue;const g=this.twitch_badges[e];for(const a in g)if(Object(u.has)(g,a)){const u=g[a],_=`.ffz-badge[data-badge="${e}"][data-version="${a}"]`;f.push(`${_} {\n\t\t\t${n&&(u.click_action||u.click_url)?"cursor:pointer;":""}\n\t\t\tbackground-color: transparent;\n\t\t\tfilter: none;\n\t\t\t${o.WEBKIT_CSS}mask-image: none;\n\t\t\tbackground-size: 1.8rem;\n\t\t\tbackground-image: url("${u.image1x}");\n\t\t\tbackground-image: ${o.WEBKIT_CSS}image-set(\n\t\t\t\turl("${u.image1x}") 1x,\n\t\t\t\turl("${u.image2x}") 2x,\n\t\t\t\turl("${u.image4x}") 4x\n\t\t\t);\n\t\t}`),s&&(f.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${_} {\n\t\t\t\t\t\t\t\tbackground-image: url("${u.image2x}");\n\t\t\t\t\t\t\t}}`),f.push(`@media (min-resolution: 200dpi) { ${_} {\n\t\t\t\t\t\t\t\tbackground-image: url("${u.image4x}");\n\t\t\t\t\t\t\t}}`))}}f.length?this.style.set("twitch-badges",f.join("\n")):this.style.delete("twitch-badges")}}const E=["vga-champ-2017","warcraft","samusoffer_beta","power-rangers","bits-charity","glhf-pledge"];function getBadgeCategory(e){return E.includes(e)?"m-other":e.startsWith("overwatch-league")?"m-owl":e.startsWith("twitchcon")||e.startsWith("glitchcon")?"m-tcon":/_\d+$/.test(e)?"m-game":"m-twitch"}function fixBadgeData(e){if(!e)return e;if(!(e=Object.assign({},e)).clickAction&&e.onClickAction&&(e.clickAction=e.onClickAction),"VISIT_URL"===e.clickAction&&e.clickURL&&(e.click_url=e.clickURL),"TURBO"===e.clickAction&&(e.click_url="https://www.twitch.tv/products/turbo?ref=chat_badge"),"SUBSCRIBE"===e.clickAction&&e.channelName?e.click_url=`https://www.twitch.tv/subs/${e.channelName}`:e.clickAction&&(e.click_action="sub"),"subscriber"===e.setID){const s=parseInt(e.version,10);!isNaN(s)&&isFinite(s)?(e.tier=(s-s%1e3)/1e3,e.tier<0&&(e.tier=0)):e.tier=0}return e}},function(e,s){e.exports=pathToRegexp,e.exports.match=function match(e,s){var n=[];return regexpToFunction(pathToRegexp(e,n,s),n)},e.exports.regexpToFunction=regexpToFunction,e.exports.parse=parse,e.exports.compile=function compile(e,s){return tokensToFunction(parse(e,s),s)},e.exports.tokensToFunction=tokensToFunction,e.exports.tokensToRegExp=tokensToRegExp;var n=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function parse(e,s){for(var o,a=[],u=0,f=0,g="",_=s&&s.delimiter||"/",b=s&&s.whitelist||void 0,v=!1;null!==(o=n.exec(e));){var k=o[0],x=o[1],C=o.index;if(g+=e.slice(f,C),f=C+k.length,x)g+=x[1],v=!0;else{var E="",z=o[2],j=o[3],O=o[4],A=o[5];if(!v&&g.length){var T=g.length-1,D=g[T];(!b||b.indexOf(D)>-1)&&(E=D,g=g.slice(0,T))}g&&(a.push(g),g="",v=!1);var B="+"===A||"*"===A,P="?"===A||"*"===A,L=j||O,I=E||_;a.push({name:z||u++,prefix:E,delimiter:I,optional:P,repeat:B,pattern:L?escapeGroup(L):"[^"+escapeString(I===_?I:I+_)+"]+?"})}}return(g||f<e.length)&&a.push(g+e.substr(f)),a}function regexpToFunction(e,s){return function(n,o){var a=e.exec(n);if(!a)return!1;for(var u=a[0],f=a.index,g={},_=o&&o.decode||decodeURIComponent,b=1;b<a.length;b++)if(void 0!==a[b]){var v=s[b-1];v.repeat?g[v.name]=a[b].split(v.delimiter).map((function(e){return _(e,v)})):g[v.name]=_(a[b],v)}return{path:u,index:f,params:g}}}function tokensToFunction(e,s){for(var n=new Array(e.length),o=0;o<e.length;o++)"object"==typeof e[o]&&(n[o]=new RegExp("^(?:"+e[o].pattern+")$",flags(s)));return function(s,o){for(var a="",u=o&&o.encode||encodeURIComponent,f=!o||!1!==o.validate,g=0;g<e.length;g++){var _=e[g];if("string"!=typeof _){var b,v=s?s[_.name]:void 0;if(Array.isArray(v)){if(!_.repeat)throw new TypeError('Expected "'+_.name+'" to not repeat, but got array');if(0===v.length){if(_.optional)continue;throw new TypeError('Expected "'+_.name+'" to not be empty')}for(var k=0;k<v.length;k++){if(b=u(v[k],_),f&&!n[g].test(b))throw new TypeError('Expected all "'+_.name+'" to match "'+_.pattern+'"');a+=(0===k?_.prefix:_.delimiter)+b}}else if("string"!=typeof v&&"number"!=typeof v&&"boolean"!=typeof v){if(!_.optional)throw new TypeError('Expected "'+_.name+'" to be '+(_.repeat?"an array":"a string"))}else{if(b=u(String(v),_),f&&!n[g].test(b))throw new TypeError('Expected "'+_.name+'" to match "'+_.pattern+'", but got "'+b+'"');a+=_.prefix+b}}else a+=_}return a}}function escapeString(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function escapeGroup(e){return e.replace(/([=!:$/()])/g,"\\$1")}function flags(e){return e&&e.sensitive?"":"i"}function tokensToRegExp(e,s,n){for(var o=(n=n||{}).strict,a=!1!==n.start,u=!1!==n.end,f=n.delimiter||"/",g=[].concat(n.endsWith||[]).map(escapeString).concat("$").join("|"),_=a?"^":"",b=0;b<e.length;b++){var v=e[b];if("string"==typeof v)_+=escapeString(v);else{var k=v.repeat?"(?:"+v.pattern+")(?:"+escapeString(v.delimiter)+"(?:"+v.pattern+"))*":v.pattern;s&&s.push(v),v.optional?v.prefix?_+="(?:"+escapeString(v.prefix)+"("+k+"))?":_+="("+k+")?":_+=escapeString(v.prefix)+"("+k+")"}}if(u)o||(_+="(?:"+escapeString(f)+")?"),_+="$"===g?"$":"(?="+g+")";else{var x=e[e.length-1],C="string"==typeof x?x[x.length-1]===f:void 0===x;o||(_+="(?:"+escapeString(f)+"(?="+g+"))?"),C||(_+="(?="+escapeString(f)+"|"+g+")")}return new RegExp(_,flags(n))}function pathToRegexp(e,s,n){return e instanceof RegExp?function regexpToRegexp(e,s){if(!s)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var o=0;o<n.length;o++)s.push({name:o,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e}(e,s):Array.isArray(e)?function arrayToRegexp(e,s,n){for(var o=[],a=0;a<e.length;a++)o.push(pathToRegexp(e[a],s,n).source);return new RegExp("(?:"+o.join("|")+")",flags(n))}(e,s,n):function stringToRegexp(e,s,n){return tokensToRegExp(parse(e,n),s,n)}(e,s,n)}},function(e,s,n){"use strict";n.d(s,"a",(function(){return User}));var o=n(0);class User{constructor(e,s,n,o){this.manager=e,this.room=s,this.emote_sets=null,this.badges=null,this._id=n,this.login=o,n&&((s||e).user_ids[n]=this)}destroy(){if(this.destroyed=!0,this.emote_sets){for(const e of this.emote_sets._cache)this.manager.emotes.unrefSet(e);this.emote_sets=null}this.badges&&(this.badges=null);const e=this.room||this.manager;e&&(this._login&&e.users&&e.users[this._login]===this&&(e.users[this._login]=null),e.user_ids&&e.user_ids[this._id]===this&&(e.user_ids[this._id]=null))}merge(e){if(!this.login&&e.login&&(this.login=e.login),e.emote_sets&&e.emote_sets._sources)for(const[s,n]of e.emote_sets._sources.entries())for(const e of n)this.addSet(s,e);if(e.badges&&e.badges._sources)for(const[s,n]of e.badges._sources.entries())for(const e of n)this.addBadge(s,e.id,e)}get id(){return this._id}get login(){return this._login}set login(e){if(this._login===e)return;const s=this.room||this.manager;if(this._login){s.users[this._login]===this&&(s.users[this._login]=null)}if(this._login=e,!e)return;const n=s.users[e];n&&n!==this&&(n.login=null),this._login=e,s.users[e]=this}addBadge(e,s,n){if(!this.destroyed){if("number"==typeof s&&(s=`${s}`),n?n.id=s:n={id:s},this.badges||(this.badges=new o.SourcedSet),this.badges.has(e))for(const o of this.badges.get(e))if(o.id==s)return Object.assign(o,n),!1;return this.badges.push(e,n),!0}}getBadge(e){if(!this.badges)return null;for(const s of this.badges._cache)if(s.id==e)return s}removeBadge(e,s){if(!this.badges||!this.badges.has(e))return!1;for(const n of this.badges.get(e))if(n.id==s)return this.badges.remove(e,n),!0}addSet(e,s,n){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new o.SourcedSet),"number"==typeof s&&(s=`${s}`);let a=!1,u=!1;return this.emote_sets.sourceIncludes(e,s)||(a=!this.emote_sets.includes(s),this.emote_sets.push(e,s),u=!0),n&&this.manager.emotes.loadSetData(s,n),a&&(this.manager.emotes.refSet(s),this.manager.emotes.emit(":update-user-sets",this,e,s,!0)),u}removeAllSets(e){if(this.destroyed||!this.emote_sets)return!1;const s=this.emote_sets.get(e);if(!Array.isArray(s)||!s.length)return!1;for(const n of s)this.removeSet(e,n);return!0}removeSet(e,s){if(!this.destroyed&&this.emote_sets)return"number"==typeof s&&(s=`${s}`),!!this.emote_sets.sourceIncludes(e,s)&&(this.emote_sets.remove(e,s),this.emote_sets.includes(s)||(this.manager.emotes.unrefSet(s),this.manager.emotes.emit(":update-user-sets",this,e,s,!1)),!0)}}},function(e,s,n){"use strict";n.r(s),n.d(s,"reply",(function(){return a})),n.d(s,"edit_overrides",(function(){return u})),n.d(s,"open_url",(function(){return f})),n.d(s,"chat",(function(){return g})),n.d(s,"msg_delete",(function(){return _})),n.d(s,"ban",(function(){return b})),n.d(s,"timeout",(function(){return v})),n.d(s,"unban",(function(){return k})),n.d(s,"untimeout",(function(){return x})),n.d(s,"whisper",(function(){return C}));var o=n(1);const a={presets:[{appearance:{type:"icon",icon:"ffz-i-reply"}}],required_context:["message"],title:"Reply to Message",description:'Allows you to directly reply to another user\'s message. Only functions when the Chat Replies Style is "FrankerFaceZ".',can_self:!0,tooltip(){return this.i18n.t("chat.actions.reply","Reply to Message")},hidden(e,s,n,o){var a;const u=null==s?void 0:s.id;return"string"!=typeof u||!/^[0-9a-f]+-[0-9a-f]+/.test(u)||(!(!(!s.message||s.deleted||o&&o.login===(null===(a=s.user)||void 0===a?void 0:a.login)||null==o)&&o.can_reply)||(!(null==s||!s.reply)||void 0))},click(e,s){let n=s.line;if(!n){const s=this.resolve("site.fine");n=s?s.searchParent(e.target,(e=>e.setMessageTray&&e.props&&e.props.message)):null}n&&n.ffzOpenReply()}},u={presets:[{appearance:{type:"icon",icon:"ffz-i-pencil"}}],required_context:["user"],title:"Change Name & Color",description:"Allows you to set local overrides for a user's name and color in chat.",can_self:!0,tooltip(){return this.i18n.t("chat.actions.edit_overrides","Change Name & Color")},click(e,s){this.resolve("chat.overrides").renderUserEditor(s.user,e.target)}},f={presets:[{appearance:{type:"icon",icon:"ffz-i-link-ext"}}],defaults:{url:"https://link.example/{{user.login}}"},editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,359)),title:"Open URL",description:"{options.url}",can_self:!0,tooltip(e){const s=this.replaceVariables(e.options.url,e);return[Object(o.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.open_url","Open URL")),Object(o.createElement)("div",{class:"tw-align-left"},s)]},click(e,s){const n=this.replaceVariables(s.options.url,s),o=window.open();o&&(o.opener=null,o.location=n)}},g={presets:[{appearance:{type:"text",text:"C"}}],required_context:["room"],defaults:{command:"@{{user.login}} HeyGuys",paste:!1},title:"Chat Command",description:"{options.command}",can_self:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,360)),tooltip(e){const s=this.replaceVariables(e.options.command,e);return[Object(o.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.actions.chat","Chat Command")),Object(o.createElement)("div",{class:"tw-align-left"},s)]},click(e,s){const n=this.replaceVariables(s.options.command,s);s.options.paste?this.pasteMessage(s.room.login,n):this.sendMessage(s.room.login,n)}},_={presets:[{appearance:{type:"icon",icon:"ffz-i-trash"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user","message"],title:"Delete Message",tooltip(e){return this.i18n.t("chat.actions.delete.tooltip","Delete {user.login}'s message",{user:e.user})},click(e,s){this.sendMessage(s.room.login,`/delete ${s.message_id}`)}},b={presets:[{appearance:{type:"icon",icon:"ffz-i-block"},display:{mod:!0,mod_icons:!0}}],defaults:{},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,361)),title:"Ban User",reason_text(e){return this.i18n.t("chat.actions.ban-reason","Ban {user.login} for:",{user:e.user})},tooltip(e){return this.i18n.t("chat.actions.ban.tooltip","Ban {user.login}",{user:e.user})},click(e,s){let n=s.reason||s.options.reason||"";n.length&&(n=this.replaceVariables(n,s)),this.sendMessage(s.room.login,`/ban ${s.user.login} ${n}`)}},v={presets:[{appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}],defaults:{duration:600},required_context:["room","user"],uses_reason:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,362)),title:"Timeout User",description:"{options.duration, plural, one {# second} other {# seconds}}",reason_text(e){return this.i18n.t("chat.actions.timeout-reason","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}} for:",{user:e.user,duration:e.options.duration})},tooltip(e){return this.i18n.t("chat.actions.timeout.tooltip","Timeout {user.login} for {duration, plural, one {# second} other {# seconds}}",{user:e.user,duration:e.options.duration})},click(e,s){let n=s.reason||s.options.reason||"";n.length&&(n=this.replaceVariables(n,s)),this.sendMessage(s.room.login,`/timeout ${s.user.login} ${s.options.duration} ${n}`)}},k={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Unban User",tooltip(e){return this.i18n.t("chat.actions.unban.tooltip","Unban {user.login}",{user:e.user})},click(e,s){this.sendMessage(s.room.login,`/unban ${s.user.login}`)}},x={presets:[{appearance:{type:"icon",icon:"ffz-i-ok"},display:{mod:!0,mod_icons:!0}}],required_context:["room","user"],title:"Untimeout User",tooltip(e){return this.i18n.t("chat.actions.untimeout.tooltip","Untimeout {user.login}",{user:e.user})},click(e,s){this.sendMessage(s.room.login,`/untimeout ${s.user.login}`)}},C={presets:[{appearance:{type:"text",text:"W"}}],required_context:["user"],title:"Whisper User",tooltip(e){return this.i18n.t("chat.actions.whisper.tooltip","Whisper {user.login}",e)},click(e,s){const n=this.resolve("site"),o=n&&n.getUser(),a=n&&n.store;if(!(o&&a&&s.user&&s.user.id&&o.id!=s.user.id))return;const u=parseInt(o.id,10),f=parseInt(s.user.id,10),g=u<f?`${u}_${f}`:`${f}_${u}`;a.dispatch({type:"whispers.THREAD_OPENED",data:{threadID:g,collapsed:!1}})}}},function(e,s,n){"use strict";n.r(s),n.d(s,"text",(function(){return a})),n.d(s,"icon",(function(){return u})),n.d(s,"combo",(function(){return f})),n.d(s,"image",(function(){return g}));var o=n(104);const a={title:"Text",title_i18n:"setting.actions.appearance.text",colored:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,363)),component:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,364)),render:(e,s,n)=>s("span",{style:{color:n}},e.text)},u={title:"Icon",title_i18n:"setting.actions.appearance.icon",colored:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,365)),load:e=>(e.icon&&e.icon.startsWith("ffz-fa")&&Object(o.load)(),!0),component:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,366)),render:(e,s,n)=>s("figure",{style:{color:n},class:`${e.icon||"ffz-i-zreknarf"}`})},f={title:"Text and Icon",title_i18n:"setting.actions.appearance.combo",colored:!0,editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,367)),load:e=>(e.icon&&e.icon.startsWith("ffz-fa")&&Object(o.load)(),!0),component:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,368)),render:(e,s,n)=>s("span",{style:{color:n},class:e.icon},e.text)},g={title:"Image",title_i18n:"setting.actions.appearance.image",editor:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,369)),component:()=>Promise.all([n.e(1),n.e(149)]).then(n.bind(null,370)),render:(e,s)=>s("figure",{class:"mod-icon__image"},s("img",{src:e.image}))}},function(e,s,n){"use strict";n.r(s),n.d(s,"FilterTester",(function(){return v})),n.d(s,"Links",(function(){return k})),n.d(s,"Replies",(function(){return x})),n.d(s,"Mentions",(function(){return C})),n.d(s,"UserHighlights",(function(){return E})),n.d(s,"BlockedUsers",(function(){return z})),n.d(s,"BadgeStuff",(function(){return j})),n.d(s,"CustomHighlights",(function(){return O})),n.d(s,"BlockedTerms",(function(){return A})),n.d(s,"AutomoddedTerms",(function(){return D})),n.d(s,"CheerEmotes",(function(){return B})),n.d(s,"AddonEmotes",(function(){return P})),n.d(s,"Emoji",(function(){return L})),n.d(s,"TwitchEmotes",(function(){return I}));var o=n(1),a=n(0),u=n(2),f=n(49);const g="chat-image chat-line__message--emote",_=/(?:(https?:\/\/)?((?:[\w#%\-+=:~]+\.)+[a-z]{2,10}(?:\/[\w./#%&@()\-+=:?~]*)?))/g,b=/^(['"*([{<\\/]*)(@)((?:[^\u0000-\u007F]|[\w-])+)(?:\b|$)/,v={type:"filter_test",priority:1e3,render(e,s){var n;return null!==(n=e.msg.filters)&&void 0!==n&&n.length?s("div",{class:"ffz-pill tw-mg-l-1"},e.msg.filters.join(", ")):null},process(e,s){if(e&&e.length&&this.context.get("chat.filtering.debug"))return s.filters=[],e.push({type:"filter_test",msg:s}),e}};function datasetBool(e){return null==e?null:"true"===e}const k={type:"link",priority:50,component:()=>n.e(163).then(n.bind(null,334)),render:(e,s)=>s("a",{class:"ffz-tooltip link-fragment","data-tooltip-type":"link","data-url":e.url,"data-is-mail":e.is_mail,rel:"noopener noreferrer",target:"_blank",href:e.url},e.text),tooltip(e,s){var a,u;if(!this.context.get("tooltip.rich-links")&&!e.dataset.forceTooltip)return"";if("true"===e.dataset.isMail)return[this.i18n.t("tooltip.email-link","E-Mail {address}",{address:e.textContent})];const f=e.dataset.url||e.href,g=null!==(a=datasetBool(e.dataset.forceMedia))&&void 0!==a?a:this.context.get("tooltip.link-images"),_=null!==(u=datasetBool(e.dataset.forceUnsafe))&&void 0!==u?u:this.context.get("tooltip.link-nsfw-images");return Promise.all([Promise.all([n.e(0),n.e(158)]).then(n.bind(null,148)),this.get_link_info(f)]).then((([e,n])=>{if(!n||(n.v||1)>e.VERSION)return"";const a={tList:(...e)=>this.i18n.tList(...e),i18n:this.i18n,fragments:n.fragments,allow_media:g,allow_unsafe:_,onload:()=>requestAnimationFrame((()=>s.update()))};let u;if(s.element&&(s.element.classList.add("ffz-rich-tip"),s.element.classList.add("tw-align-left")),u=n.full?e.renderTokens(n.full,o.createElement,a):n.mid?e.renderTokens(n.mid,o.createElement,a):n.short?e.renderTokens(n.short,o.createElement,a):this.i18n.t("card.empty","No data was returned."),!n.urls)return u;const f=[];for(let e=0;e<n.urls.length;e++){const s=n.urls[e];f.push(Object(o.createElement)("tr",null,Object(o.createElement)("td",null,this.i18n.formatNumber(e+1),"."),Object(o.createElement)("td",{class:"tw-c-text-alt-2 tw-pd-x-05 tw-word-break-all"},s.url),Object(o.createElement)("td",null,s.flags?s.flags.map((e=>Object(o.createElement)("span",{class:"tw-pill"},e.toLowerCase()))):null)))}let b;if(n.unsafe){const e=Array.from(new Set(n.urls.map((e=>e.flags)).flat())).join(", ");b=Object(o.createElement)("div",{class:"ffz-i-attention"},this.i18n.tList("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:e.toLowerCase()}))}else n.urls.length>1&&(b=this.i18n.t("tooltip.link-destination","Destination: {url}",{url:n.urls[n.urls.length-1].url}));return u=Object(o.createElement)("div",null,Object(o.createElement)("div",{class:"ffz--shift-hide"},u,b?Object(o.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-align-center"},b,Object(o.createElement)("div",{class:" tw-font-size-8"},this.i18n.t("tooltip.shift-detail","(Shift for Details)"))):null),Object(o.createElement)("div",{class:"ffz--shift-show tw-align-left"},Object(o.createElement)("div",{class:"tw-semibold tw-mg-b-05 tw-align-center"},this.i18n.t("tooltip.link.urls","Visited URLs")),Object(o.createElement)("table",null,f))),u})).catch((e=>(console.error(e),Object(o.sanitize)(this.i18n.t("tooltip.error","An error occurred. ({error})",{error:e})))))},process(e){if(!e||!e.length)return;const s=[];for(const n of e){if("text"!==n.type){s.push(n);continue}_.lastIndex=0;const e=n.text;let o,a=0;for(;o=_.exec(e);){const n=o.index;a!==n&&s.push({type:"text",text:e.slice(a,n)});let u=o[0];if(u.endsWith(")")){let e=1,s=u.length-1;for(;s--;){const n=u[s];if(")"===n?e++:"("===n&&e--,!e)break}e&&(u=u.slice(0,u.length-1))}s.push({type:"link",url:`${o[1]?"":"https://"}${u}`,is_mail:!1,text:u}),a=n+u.length}a<e.length&&s.push({type:"text",text:e.slice(a)})}return s}};k.tooltip.interactive=function(e){if(!this.context.get("tooltip.rich-links")||!this.context.get("tooltip.link-interaction")||"true"===e.dataset.isMail)return!1;const s=this.get_link_info(e.dataset.url,!0);return s&&s.interactive},k.tooltip.delayHide=function(e){return this.context.get("tooltip.rich-links")&&"true"!==e.dataset.isMail?64:0};const x={type:"reply",priority:0,component:()=>null,render(e,s){let n=e.color;if(n){const e=this.resolve("site.chat");n=e?e.colors.process(n):n}return s("strong",{class:"chat-line__message-mention ffz--pointer-events ffz-tooltip ffz--reply-mention ffz-i-threads"+(e.me?" ffz--mention-me":""),style:{color:n},"data-tooltip-type":"reply","data-login":e.recipient,onClick:this.handleReplyClick},e.text)},tooltip(e){var s;const n=this.resolve("site.fine");if(!e||!n)return null;const a=n.searchParent(e,(e=>e.props&&e.props.reply&&e.setOPCardTray)),u=null==a||null===(s=a.props)||void 0===s?void 0:s.reply;return u?[Object(o.createElement)("strong",{},this.i18n.t("chat.reply-to","Replying To:")),"\n\n",Object(o.createElement)("div",{className:"tw-align-left"},[Object(o.createElement)("strong",{},u.parentDisplayName),": ",u.parentMessageBody])]:null}},C={type:"mention",priority:0,component:()=>n.e(163).then(n.bind(null,335)),render(e,s){let n=e.color;if(n){const e=this.resolve("site.chat");n=e?e.colors.process(n):n}return s("strong",{class:`chat-line__message-mention${e.me?" ffz--mention-me":""} ffz--pointer-events`,style:{color:n},"data-login":e.recipient,onClick:this.handleMentionClick},e.text)},process(e,s,n){if(!e||!e.length)return;const o=n&&n.login&&n.login==s.user.login&&!this.context.get("chat.filtering.process-own"),a=this.context.get("chat.filtering.mention-priority");let u,f,g,_=!1;n&&n.login&&!o?(f=n.login.toLowerCase(),g=n.displayName&&n.displayName.toLowerCase(),g===f&&(g=null),_=!0,u=new RegExp(`^(['"*([{<\\/]*)(?:(@?)(${n.login.toLowerCase()}${g?`|${g}`:""})|@((?:[^\0-]|[\\w-])+))(?:\\b|$)`,"i")):u=b;const v=[];for(const n of e){if("text"!==n.type){v.push(n);continue}let e=[];for(const o of n.text.split(/ +/)){const n=u.exec(o);if(n){(e.length||n[1])&&(v.push({type:"text",text:`${e.join(" ")} ${n[1]||""}`}),e=[]);let u,f=!1,g=n[2];n[4]?(u=n[4],g="@"):(u=n[3],f=_);const b=u?u.toLowerCase():"",k=this.color_cache?this.color_cache.get(b):null;v.push({type:"mention",text:`${g}${u}`,me:f,color:k,recipient:b}),f&&this.applyHighlight(s,a,null,"mention",!0),e.push(o.substr(n[0].length))}else e.push(o)}(e.length>1||1===e.length&&""!==e[0])&&v.push({type:"text",text:e.join(" ")})}return v}},E={type:"user_highlight",priority:90,process(e,s,n){if(n&&n.login&&n.login==s.user.login&&!this.context.get("chat.filtering.process-own"))return;const o=this.context.get("__filter:highlight-users");if(!o||!o.length)return;const a=s.user;for(const[e,n,u]of o)(u.test(a.login)||u.test(a.displayName))&&this.applyHighlight(s,e,n,"user")}},z={type:"user_block",priority:100,process(e,s,n,o){if(n&&n.login&&n.login==s.user.login&&!this.context.get("chat.filtering.process-own"))return;const a=s.user,u=this.context.get("__filter:block-users");u&&(u[1]&&(u[1].test(a.login)||u[1].test(a.displayName))?(s.deleted=!0,s.ffz_removed=!0,o&&(s.ffz_halt_tokens=!0)):!s.deleted&&u[0]&&(u[0].test(a.login)||u[0].test(a.displayName))&&(s.deleted=!0))}};const j={type:"badge_stuff",priority:97,process(e,s,n,o){if(n&&n.login&&n.login==s.user.login&&!this.context.get("chat.filtering.process-own"))return;const a=this.context.get("__filter:highlight-badges"),u=this.context.get("__filter:block-badges");if(!a&&!u)return;const f=function getBadgeIDs(e){let s=e.badges?Object.keys(e.badges):null;if(!e.ffz_badges)return s;s||(s=[]);for(const n of e.ffz_badges)null!=n&&n.id&&s.push(n.id);return s}(s);if(f&&f.length)for(const e of f){if(u&&u[1].includes(e))return s.deleted=!0,s.ffz_removed=!0,void(o&&(s.ffz_halt_tokens=!0));if(u&&!s.deleted&&u[0].includes(e)&&(s.deleted=!0),a&&a.has(e)){const n=a.get(e);Array.isArray(n)&&n.length>1&&this.applyHighlight(s,n[0],n[1],"badge")}}}},O={type:"highlight",priority:35,component:()=>n.e(163).then(n.bind(null,336)),render:(e,s)=>s("strong",{class:"ffz--highlight"},e.text),process(e,s,n){if(!e||!e.length)return;if(n&&n.login&&n.login==s.user.login&&!this.context.get("chat.filtering.process-own"))return;const o=this.context.get("__filter:highlight-terms");if(!o)return;let a=!1;if(o.non)for(const[e,n,u]of o.non){if(a&&null!=s.mention_priority&&s.mention_priority>e)break;let o=!1;u[0]&&(u[0].lastIndex=0,o=u[0].test(s.message)),!o&&u[1]&&(u[1].lastIndex=0,o=u[1].test(s.message)),o&&(a=!0,this.applyHighlight(s,e,n,"term"))}if(!o.hl)return e;for(const[n,a,u]of o.hl){const o=[];for(const f of e){if("text"!==f.type){o.push(f);continue}const e=f.text;let g,_=0;for(;_<e.length;){u[0]&&(u[0].lastIndex=_),u[1]&&(u[1].lastIndex=_),g=u[0]?u[0].exec(e):null;const f=u[1]?u[1].exec(e):null;if(f&&(!g||g.index>f.index)&&(g=f),!g)break;const b=g.index,v=g[1]?g[1].length:0,k=b+v;_!==k&&o.push({type:"text",text:e.slice(_,k)}),this.applyHighlight(s,n,a,"term"),o.push({type:"highlight",text:g[0].slice(v)}),_=b+g[0].length}_<e.length&&o.push({type:"text",text:e.slice(_)})}e=o}return e}};function blocked_process(e,s,n,o,a){const u=[];for(const f of e){if("text"!==f.type){u.push(f);continue}const g=f.text;let _,b=0;for(;b<g.length;){n[0]&&(n[0].lastIndex=b),n[1]&&(n[1].lastIndex=b),_=n[0]?n[0].exec(g):null;const f=n[1]?n[1].exec(g):null;if(f&&(!_||_.index>f.index)&&(_=f),!_)break;const v=_.index,k=_[1]?_[1].length:0,x=v+k;if(b!==x&&u.push({type:"text",text:g.slice(b,x)}),o&&(s.ffz_removed=!0,a))return e;u.push({type:"blocked",text:_[0].slice(k)}),b=v+_[0].length}b<g.length&&u.push({type:"text",text:g.slice(b)})}return u}const A={type:"blocked",priority:99,component:()=>n.e(163).then(n.bind(null,337)),render(e,s){return s("strong",{"data-text":e.text,"data-tooltip-type":"blocked",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"×××")},tooltip(e){const s=e.dataset;return[Object(o.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.blocked-term","Blocked Term")),s.text]},process(e,s,n,o){if(!e||!e.length)return;if(n&&n.login&&n.login==s.user.login&&!this.context.get("chat.filtering.process-own"))return;const a=this.context.get("__filter:block-terms");return a?a.remove&&(e=blocked_process(e,s,a.remove,!0,o),o&&s.ffz_removed)?(s.ffz_halt_tokens=!0,e):(a.non&&(e=blocked_process(e,s,a.non,!1,o)),e):void 0}},T={A:"Hostility",I:"Discrimination",P:"Profanity",S:"Sexually Explicit Language"},D={type:"amterm",priority:95,component:()=>n.e(163).then(n.bind(null,338)),render(e,s){return s("strong",{"data-text":e.text,"data-categories":JSON.stringify(e.categories),"data-tooltip-type":"amterm",class:"ffz-tooltip ffz--blocked ffz--pointer-events",onClick:this.clickToReveal},"×××")},tooltip(e){const s=e.dataset,n=[];let a;try{a=JSON.parse(s.categories);for(const e in a)a[e]&&T[e]&&n.push(this.i18n.t(`chat.filtering.automod.${e}`,T[e]))}catch(e){n.push("Parse Error")}return[Object(o.createElement)("div",{class:"tw-border-b tw-mg-b-05"},this.i18n.t("chat.filtering.automod-term","AutoMod Blocked Term")),this.i18n.t("chat.filtering.automod-why","This was flagged as: "),n.join(", ")]},process(e,s,n,o){if(!(e&&e.length&&s.flags&&Array.isArray(s.flags.list)))return;const u=s.flags.preferences,f=s.flags.list.filter((e=>{if(!e||null==e.startIndex||null==e.endIndex)return!1;const s=e.categories;if(!s)return!1;for(const e in s)if(s[e]&&u[e])return!0})),g=f.length;if(!g)return;const _=[];let b=0,v=0;const k=this.context.get("chat.automod.remove-messages");if(this.context.get("chat.automod.delete-messages")&&(s.deleted=!0),k)return s.ffz_removed=!0,void(o&&(s.ffz_halt_tokens=!0));for(const s of e){const e=b,n=b+(s.length||s.text&&Object(a.split_chars)(s.text).length||0);if("text"!==s.type){_.push(s),b=n;continue}const o=Object(a.split_chars)(s.text);for(;v<g;){const a=f[v],u=a.startIndex,g=a.endIndex+1;if(g<e){v++;continue}if(u>n){_.push(s),b=n;break}u>b&&_.push({type:"text",text:o.slice(b-e,u-e).join("")});let k=u-e;if(k<0&&(k=0),_.push({type:"amterm",categories:a.categories,text:o.slice(k,g-e).join("")}),g>n){b=n;break}b=g,v++}b<n&&(e===b?_.push(s):_.push({type:"text",text:o.slice(b-e).join("")}),b=n)}return _}},B={type:"cheer",priority:40,component:()=>n.e(163).then(n.bind(null,339)),render(e,s){return s("span",{class:"ffz-cheer ffz-tooltip ffz--pointer-events","data-tooltip-type":"cheer","data-prefix":e.prefix,"data-amount":this.i18n.formatNumber(e.amount),"data-tier":e.tier,"data-individuals":JSON.stringify(e.individuals||null),alt:e.text})},tooltip(e){const s=e.dataset,n=parseInt(s.amount.replace(/,/g,""),10),a=s.prefix,u=s.tier,f=s.individuals&&JSON.parse(s.individuals),g=f&&f.length,_=[this.context.get("tooltip.emote-images")&&Object(o.createElement)("div",{class:"preview-image ffz-cheer-preview","data-prefix":a,"data-tier":u}),this.i18n.t("tooltip.bits","{count,number} Bits",n)];if(g>1){_.push(Object(o.createElement)("br",null)),f.sort((e=>-e[0]));for(let e=0;e<g&&e<12;e++){const[s,n,a]=f[e];_.push(this.tokenizers.cheer.render.call(this,{amount:s,prefix:a,tier:n},o.createElement))}g>12&&(_.push(Object(o.createElement)("br",null)),_.push(this.i18n.t("tooltip.bits.more","(and {count, number} more)",g-12)))}return _},process(e,s){if(!e||!e.length||!s.bits)return;const n=this.getRoom(s.roomID,s.roomLogin,!0),o=n&&n.bitsConfig;if(!o)return;const u=new RegExp(`^(${Object.keys(o).join("|")})(\\d+)$`,"i"),f=[],g={},_=this.context.get("chat.bits.stack");for(const s of e){if(!s||"text"!==s.type){f.push(s);continue}let e=[];for(const n of s.text.split(/ +/)){const s=u.exec(n);if(s){const a=s[1].toLowerCase(),u=o[a];if(!u){e.push(n);continue}const b=parseInt(s[2],10),v=u.tiers;let k,x;for(let e=0,s=v.length;e<s;e++)if(b>=v[e].amount){k=e;break}if(e.length&&(f.push({type:"text",text:`${e.join(" ")} `}),e=[]),f.push(x={type:"cheer",prefix:a,tier:k,amount:b,text:s[0]}),_){let e=2===_?"cheer":a;o[e]||(e=a);const s=g[e]=g[e]||{total:0,individuals:[]};s.total+=b,s.individuals.push([b,k,a]),x.hidden=!0}e.push("")}else e.push(n)}(e.length>1||1===e.length&&""!==e[0])&&f.push({type:"text",text:e.join(" ")})}if(_)for(const e in g)if(Object(a.has)(g,e)){const s=g[e],n=o[e].tiers;let a=0;for(let e=n.length;a<e&&!(s.total>=n[a].amount);a++);f.unshift({type:"cheer",prefix:e,tier:a,amount:s.total,individuals:s.individuals,length:0})}return f}},render_emote=(e,s,n)=>{const o=2===e.anim,a=e.big&&e.can_big;let u,f,_,b,v,k;1===e.anim&&e.animSrc?(u=a?e.animSrc2:e.animSrc,f=a?e.animSrcSet2:e.animSrcSet):(u=a?e.src2:e.src,f=a?e.srcSet2:e.srcSet),o&&e.animSrc&&(v=u,k=f,_=a?e.animSrc2:e.animSrc,b=a?e.animSrcSet2:e.animSrcSet);const x=e.modifiers||[],C=x.length,E=s("img",{class:`${g} ffz-tooltip${_?" ffz-hover-emote":""}${"twitch"===e.provider?" twitch-emote":"ffz"===e.provider?" ffz-emote":"emoji"===e.provider?" ffz-emoji":""}`,attrs:{src:u,srcSet:f,alt:e.text,height:e.big&&!e.can_big&&e.height?2*e.height+"px":void 0,"data-tooltip-type":"emote","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-code":e.code,"data-variant":e.variant,"data-normal-src":v,"data-normal-src-set":k,"data-hover-src":_,"data-hover-src-set":b,"data-modifiers":C?x.map((e=>e.id)).join(" "):null,"data-modifier-info":C?JSON.stringify(x.map((e=>[e.set,e.id]))):null}});return C?s("div",{class:"ffz--inline modified-emote",attrs:{"data-test-selector":"emote-button","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-modifiers":C?x.map((e=>e.id)).join(" "):null}},[E,x.map((e=>s("span",{key:e.text},render_emote(e,s,!0))))]):n?E:s("div",{className:"ffz--inline",attrs:{"data-test-selector":"emote-button"}},[E])},P={type:"emote",priority:10,component:{functional:!0,render:(e,{props:s})=>render_emote(s.token,e)},render(e,s,n){const o=2===e.anim,a=e.big&&e.can_big;let u,f,_,b,v,k;1===e.anim&&e.animSrc?(u=a?e.animSrc2:e.animSrc,f=a?e.animSrcSet2:e.animSrcSet):(u=a?e.src2:e.src,f=a?e.srcSet2:e.srcSet),o&&e.animSrc&&(v=u,k=f,_=a?e.animSrc2:e.animSrc,b=a?e.animSrcSet2:e.animSrcSet);const x=e.modifiers||[],C=x.length,E=s("img",{class:`${g} ffz--pointer-events ffz-tooltip${_?" ffz-hover-emote":""}${"twitch"===e.provider?" twitch-emote":"ffz"===e.provider?" ffz-emote":"emoji"===e.provider?" ffz-emoji":""}`,src:u,srcSet:f,height:e.big&&!e.can_big&&e.height?2*e.height+"px":void 0,alt:e.text,"data-tooltip-type":"emote","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-code":e.code,"data-variant":e.variant,"data-normal-src":v,"data-normal-src-set":k,"data-hover-src":_,"data-hover-src-set":b,"data-modifiers":C?x.map((e=>e.id)).join(" "):null,"data-modifier-info":C?JSON.stringify(x.map((e=>[e.set,e.id]))):null,onClick:this.emotes.handleClick});return C?s("div",{class:"ffz--inline ffz--pointer-events modified-emote","data-test-selector":"emote-button","data-provider":e.provider,"data-id":e.id,"data-set":e.set,"data-modifiers":C?x.map((e=>e.id)).join(" "):null,onClick:this.emotes.handleClick},E,x.map((e=>s("span",{key:e.text},this.tokenizers.emote.render.call(this,e,s,!0))))):n?E:s("div",{class:"ffz--inline","data-test-selector":"emote-button"},E)},async tooltip(e,s){const n=e.dataset,g=n.provider,_=n.modifierInfo;let b,v,k,x,C,E,z,j=!1;const O="true"===n.noSource;if(_&&"null"!==_&&(C=JSON.parse(_).map((([e,s])=>{const n=this.emotes.emote_sets[e],a=n&&n.emotes[s];if(a)return Object(o.createElement)("span",{class:"tw-mg-05"},this.tokenizers.emote.render.call(this,a.token,o.createElement),` - ${a.hidden?"???":a.name}`)}))),"twitch"===g){z=n.id;const e=O?null:await this.emotes.getTwitchEmoteSet(z),s=null!=e&&await this.emotes.getTwitchSetChannel(e);if(v=`${Object(a.getTwitchEmoteURL)(n.id,4,!0,!0)}?_=preview`,E="twitch",s){var A,T;const e=s.type;var D;if(e===u.EmoteTypes.Global)k=null!==(D=s.owner)&&void 0!==D&&D.login?this.i18n.t("tooltip.channel","Channel: {source}",{source:s.owner.displayName||s.owner.login}):this.i18n.t("emote.global","Twitch Global");else if(e===u.EmoteTypes.BitsTier){var B;k=this.i18n.t("emote.bits","Twitch Bits Reward"),null!==(B=s.owner)&&void 0!==B&&B.login&&(k=this.i18n.t("emote.bits-owner","{source}\nChannel: {channel}",{source:k,channel:s.owner.displayName||s.owner.login}))}else e===u.EmoteTypes.Prime||e===u.EmoteTypes.Turbo?k=this.i18n.t("emote.prime","Prime Gaming"):e===u.EmoteTypes.TwoFactor?k=this.i18n.t("emote.2fa","Twitch 2FA Emote"):e===u.EmoteTypes.LimitedTime?k=this.i18n.t("emote.limited","Limited-Time Only Emote"):e===u.EmoteTypes.ChannelPoints?k=this.i18n.t("emote.points","Channel Points Emote"):e===u.EmoteTypes.Follower&&null!==(A=s.owner)&&void 0!==A&&A.login?k=this.i18n.t("emote.follower","Follower Emote ({source})",{source:s.owner.displayName||s.owner.login}):e===u.EmoteTypes.Subscription&&null!==(T=s.owner)&&void 0!==T&&T.login&&(k=this.i18n.t("tooltip.channel","Channel: {source}",{source:s.owner.displayName||s.owner.login}))}}else if("ffz"===g){const e=this.emotes.emote_sets[n.set],s=e&&e.emotes[n.id];if(e&&(k=e.source_line||`${e.source||"FFZ"} ${e.title||"Global"}`,E=e.source||"ffz"),s){var P;z=s.id,s.owner&&(x=this.i18n.t("emote.owner","By: {owner}",{owner:s.owner.display_name}));this.context.get("tooltip.emote-images.animated")&&null!==(P=s.animated)&&void 0!==P&&P[1]?s.animated[4]?v=s.animated[4]:s.animated[2]&&(v=s.animated[2]):s.urls[4]?v=s.urls[4]:s.urls[2]&&(v=s.urls[2])}}else{if("emoji"!==g)return;{const e=this.emoji.emoji[n.code],a=this.context.get("chat.emoji.style"),u=n.variant?e.variants[n.variant]:e,g=n.variant?this.emoji.emoji[n.variant]:null;E="emoji",z=n.code,v=Object(o.createElement)("img",{class:"preview-image ffz-emoji",src:this.emoji.getFullImage(u.image,a),srcSet:this.emoji.getFullImageSet(u.image,a),onLoad:s.update}),j=!0,b=`:${e.names[0]}:${g?`:${g.names[0]}:`:""}`;const _=e.category?this.i18n.t(`emoji.category.${e.category.toSnakeCase()}`,f.a[e.category]||e.category):null;k=this.i18n.t("tooltip.emoji","Emoji - {category}",{category:_})}}b||(b=n.name||e.alt);const L=E&&this.emotes.isFavorite(E,z);return[v&&this.context.get("tooltip.emote-images")&&("string"==typeof v?Object(o.createElement)("img",{class:"preview-image",src:v,onLoad:s.update}):v),j||O&&!x?b:this.i18n.t("tooltip.emote","Emote: {name}",{name:b}),!O&&k&&this.context.get("tooltip.emote-sources")&&Object(o.createElement)("div",{class:"tw-pd-t-05"},k),x&&this.context.get("tooltip.emote-sources")&&Object(o.createElement)("div",{class:"tw-pd-t-05"},x),n.sellout&&Object(o.createElement)("div",{class:"tw-mg-t-05 tw-border-t tw-pd-t-05"},n.sellout),C&&Object(o.createElement)("div",{class:"tw-pd-t-1"},C),L&&Object(o.createElement)("figure",{class:"ffz--favorite ffz-i-star"})]},process(e,s){if(!e||!e.length)return;if(2!==this.context.get("chat.emotes.enabled"))return;const n=this.emotes.getEmotes(s.user.id,s.user.login,s.roomID,s.roomLogin);if(!n)return;const o=this.context.get("chat.emotes.2x")>0,u=this.context.get("chat.emotes.animated"),f=[];let g,_;for(const s of e){if(!s)continue;if("text"!==s.type){"emote"===s.type&&(s.modifiers||(s.modifiers=[])),f.push(s),g=s;continue}let e=[];for(const b of s.text.split(/ +/))if(Object(a.has)(n,b)){if(_=n[b],_.modifier&&g&&g.modifiers&&(!e.length||1===e.length&&""===e[0])){-1===g.modifiers.indexOf(_.token)&&g.modifiers.push(Object.assign({big:o,anim:u},_.token));continue}if(e.length){const s={type:"text",text:`${e.join(" ")} `};f.push(s),s.text.trim().length&&(g=s),e=[]}const s=Object.assign({modifiers:[],big:o,anim:u},_.token);f.push(s),g=s,e.push("")}else e.push(b);if(e.length>1||1===e.length&&""!==e[0]){const s={type:"text",text:e.join(" ")};f.push(s)}}return f}},L={type:"emoji",priority:15,process(e){if(!e||!e.length)return;const s=this.emoji.splitter,n=this.context.get("chat.emoji.replace-joiner")>0,o=this.context.get("chat.emoji.style");if(0===o)return;const u=[];for(const g of e){if(!g)continue;if("text"!==g.type){u.push(g);continue}const e=n?g.text.replace(f.e,"‍"):g.text;s.lastIndex=0;let _,b=0;for(;_=s.exec(e);){const s=_.index,n=this.emoji.chars.get(_[0]);if(!n)continue;const f=this.emoji.emoji[n[0]],g=n[1]?f.variants[n[1]]:f,v=Object(a.split_chars)(_[0]).length;b!==s&&u.push({type:"text",text:e.slice(b,s)}),u.push({type:"emote",provider:"emoji",code:n[0],variant:n[1],src:this.emoji.getFullImage(g.image,o),srcSet:this.emoji.getFullImageSet(g.image,o),text:_[0],length:v,modifiers:[]}),b=s+_[0].length}b<e.length&&u.push({type:"text",text:e.slice(b)})}return u}},I={type:"twitch-emote",priority:20,process(e,s){if(!s.ffz_emotes)return;if(this.context.get("chat.emotes.enabled")<1)return;const n=s.ffz_emotes,o=this.context.get("chat.emotes.animated"),f=this.context.get("chat.emotes.2x")>0,g=this.context.get("chat.fix-bad-emotes"),_=[];for(const e in n)if(Object(a.has)(n,e))for(const s of n[e])_.push([e,s.startIndex,s.endIndex+1]);const b=_.length;if(!b)return;const v=[];_.sort(((e,s)=>e[1]!==s[1]?e[1]-s[1]:s[0]-e[0]));let k=0,x=0;for(const s of e){const e=k,n=k+(s.length||s.text&&Object(a.split_chars)(s.text).length||0);if("text"!==s.type){v.push(s),k=n;continue}const C=Object(a.split_chars)(s.text);for(;x<b;){const[b,E,z]=_[x];if(E>n||z>n){e===k?v.push(s):v.push({type:"text",text:C.slice(k-e).join("")}),E<n&&z>n&&x++,k=n;break}if(E<k){x++;continue}let j,O,A,T,D,B,P,L;E>k&&v.push({type:"text",text:C.slice(k-e,E-e).join("")});let I=!0;const N=u.REPLACEMENTS[b];N&&g?(j=`${u.REPLACEMENT_BASE}${N}`,O="",I=!1):(j=Object(a.getTwitchEmoteURL)(b,1,!1),O=Object(a.getTwitchEmoteSrcSet)(b,!1),o>0&&(A=Object(a.getTwitchEmoteURL)(b,1,!0),T=Object(a.getTwitchEmoteSrcSet)(b,!0)),f&&(D=Object(a.getTwitchEmoteURL)(b,2,!1),B=Object(a.getTwitchEmoteSrcSet)(b,!1,!0,!0),o>0&&(P=Object(a.getTwitchEmoteURL)(b,2,!0),L=Object(a.getTwitchEmoteSrcSet)(b,!0,!0,!0)))),v.push({type:"emote",id:b,provider:"twitch",src:j,srcSet:O,src2:D,srcSet2:B,animSrc:A,animSrc2:P,animSrcSet:T,animSrcSet2:L,anim:o,big:f,can_big:I,height:28,text:C.slice(E-e,z-e).join(""),modifiers:[]}),k=z,x++}k<n&&(e===k?v.push(s):v.push({type:"text",text:C.slice(k-e).join("")}),k=n)}return v}}},function(e,s,n){"use strict";n.r(s),n.d(s,"Links",(function(){return C})),n.d(s,"Users",(function(){return E})),n.d(s,"Clips",(function(){return z})),n.d(s,"Videos",(function(){return j}));var o=n(126),a=n.n(o),u=n(127),f=n.n(u),g=n(0);const _=/^(?:https?:\/\/)?clips\.twitch\.tv\/([a-z0-9-_=]+)(?:\/)?(\w+)?(?:\/edit)?/i,b=/^(?:https?:\/\/)?(?:(?:www|m)\.)?twitch\.tv\/\w+\/clip\/([a-z0-9-_=]+)/i,v=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/(?:\w+\/v|videos)\/(\w+)/,k=/^(?:https?:\/\/)?(?:www\.)?twitch\.tv\/([^/]+)$/,x=["directory","_deck","p","downloads","jobs","turbo","settings","friends","subscriptions","inventory","wallet"],C={type:"link",can_hide_token:!0,priority:-10,test(e){return!(!this.context.get("chat.rich.all-links")&&!e.force_rich)&&"link"===e.type},process(e,s){return{card_tooltip:!0,url:e.url,timeout:0,want_mid:s,getData:async(s=!1)=>{let n;try{n=await this.get_link_info(e.url,!1,s)}catch(s){return{url:e.url,error:String(s)}}return n?Object.assign({},n,{allow_media:this.context.get("tooltip.link-images"),allow_unsafe:this.context.get("tooltip.link-nsfw-images")}):{url:e.url}}}}},E={type:"user",can_hide_token:!0,test(e){return!("link"!==e.type||!this.context.get("chat.rich.all-links")&&!e.force_rich)&&k.test(e.url)},process(e){const s=k.exec(e.url),n=this.resolve("site.twitch_data");if(n&&s&&!x.includes(s[1]))return{url:e.url,getData:async()=>{var o,a,u,f;const _=await n.getUser(null,s[1]);if(!_||!_.id)return null;const b=null===(o=_.broadcastSettings)||void 0===o||null===(a=o.game)||void 0===a?void 0:a.displayName;let v;(null===(u=_.stream)||void 0===u?void 0:u.id)&&b&&(v={type:"i18n",key:"cards.user.streaming",phrase:"streaming {game}",content:{game:{type:"style",weight:"semibold",content:b}}});const k=Object(g.truncate)(_.description),x=[_.displayName];return _.displayName.trim().toLowerCase()!==_.login&&x.push({type:"style",color:"alt-2",content:[" (",_.login,")"]}),null!==(f=_.roles)&&void 0!==f&&f.isPartner&&x.push({type:"style",color:"link",content:{type:"icon",name:"verified"}}),{url:e.url,accent:_.primaryColorHex?`#${_.primaryColorHex}`:null,short:{type:"header",image:{type:"image",url:_.profileImageURL,rounding:-1,aspect:1},title:x,subtitle:v,extra:k}}}}}},z={type:"clip",can_hide_token:!0,test:e=>"link"===e.type&&(_.test(e.url)||b.test(e.url)),process(e){let s=_.exec(e.url);s||(s=b.exec(e.url));const n=this.resolve("site.apollo");if(n&&s&&"create"!==s[1])return{url:e.url,getData:async()=>{const o=await n.client.query({query:a.a,variables:{slug:s[1]}});if(!(o&&o.data&&o.data.clip&&o.data.clip.broadcaster))return null;const u=o.data.clip,f=u.game,g=f&&f.displayName,_={type:"link",url:`https://www.twitch.tv/${u.broadcaster.login}`,content:{type:"style",weight:"semibold",color:"alt-2",content:u.broadcaster.displayName}},b=g?{type:"i18n",key:"clip.desc.1.playing",phrase:"{user} playing {game}",content:{user:_,game:{type:"style",weight:"semibold",content:g}}}:{type:"i18n",key:"clip.desc.1",phrase:"Clip of {user}",content:{user:_}},v={type:"i18n",key:"clip.desc.2",phrase:"Clipped by {curator} — {views, plural, one {# View} other {# Views}}",content:{curator:u.curator?{type:"link",url:`https://www.twitch.tv/${u.curator.login}`,content:{type:"style",color:"alt-2",content:u.curator.displayName}}:{type:"i18n",key:"clip.unknown",phrase:"Unknown"},views:u.viewCount}};return{url:e.url,accent:"#6441a4",short:{type:"header",image:{type:"image",url:u.thumbnailURL,sfw:!0,aspect:16/9},title:u.title,subtitle:b,extra:v}}}}}},j={type:"video",can_hide_token:!0,test:e=>"link"===e.type&&v.test(e.url),process(e){const s=v.exec(e.url),n=this.resolve("site.apollo");if(n&&s)return{getData:async()=>{const o=await n.client.query({query:f.a,variables:{id:s[1]}});if(!(o&&o.data&&o.data.video&&o.data.video.owner))return null;const a=o.data.video,u=a.game,g=u&&u.displayName,_={type:"link",url:`https://www.twitch.tv/${a.owner.login}`,content:{type:"style",weight:"semibold",color:"alt-2",content:a.owner.displayName}},b=g?{type:"i18n",key:"clip.desc.1.playing",phrase:"{user} playing {game}",content:{user:_,game:{type:"style",weight:"semibold",content:g}}}:{type:"i18n",key:"video.desc.1",phrase:"Video of {user}",content:{user:_}},v={type:"i18n",key:"video.desc.2",phrase:"{length,duration} — {views,number} Views — {date,datetime}",content:{length:a.lengthSeconds,views:a.viewCount,date:a.publishedAt}};return{url:e.url,short:{type:"header",image:{type:"image",url:a.previewThumbnailURL,sfw:!0,aspect:16/9},title:a.title,subtitle:b,extra:v}}}}}}},function(e,s,n){"use strict";n.r(s);var o=n(3);n.d(s,"top",(function(){return o.u})),n.d(s,"bottom",(function(){return o.i})),n.d(s,"right",(function(){return o.s})),n.d(s,"left",(function(){return o.l})),n.d(s,"auto",(function(){return o.d})),n.d(s,"basePlacements",(function(){return o.e})),n.d(s,"start",(function(){return o.t})),n.d(s,"end",(function(){return o.k})),n.d(s,"clippingParents",(function(){return o.j})),n.d(s,"viewport",(function(){return o.w})),n.d(s,"popper",(function(){return o.p})),n.d(s,"reference",(function(){return o.r})),n.d(s,"variationPlacements",(function(){return o.v})),n.d(s,"placements",(function(){return o.o})),n.d(s,"beforeRead",(function(){return o.g})),n.d(s,"read",(function(){return o.q})),n.d(s,"afterRead",(function(){return o.b})),n.d(s,"beforeMain",(function(){return o.f})),n.d(s,"main",(function(){return o.m})),n.d(s,"afterMain",(function(){return o.a})),n.d(s,"beforeWrite",(function(){return o.h})),n.d(s,"write",(function(){return o.x})),n.d(s,"afterWrite",(function(){return o.c})),n.d(s,"modifierPhases",(function(){return o.n}));var a=n(53);n.d(s,"applyStyles",(function(){return a.a})),n.d(s,"arrow",(function(){return a.b})),n.d(s,"computeStyles",(function(){return a.c})),n.d(s,"eventListeners",(function(){return a.d})),n.d(s,"flip",(function(){return a.e})),n.d(s,"hide",(function(){return a.f})),n.d(s,"offset",(function(){return a.g})),n.d(s,"popperOffsets",(function(){return a.h})),n.d(s,"preventOverflow",(function(){return a.i}));var u=n(23);n.d(s,"popperGenerator",(function(){return u.b}));var f=n(15);n.d(s,"detectOverflow",(function(){return f.a})),n.d(s,"createPopperBase",(function(){return u.a}));var g=n(70);n.d(s,"createPopper",(function(){return g.a}));var _=n(54);n.d(s,"createPopperLite",(function(){return _.a}))},function(e,s,n){"use strict";n.d(s,"a",(function(){return AddonManager}));var o=n(4),a=n(2),u=n(1),f=n(0),g=n(10);const fetchJSON=(e,s)=>fetch(e,s).then((e=>e.ok?e.json():null)).catch((()=>null));class AddonManager extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.load_requires=["settings"],this.target=this.parent.flavor||"unknown",this.has_dev=!1,this.reload_required=!1,this.addons={},this.enabled_addons=[]}onLoad(){this._loader=this.loadAddonData()}onEnable(){this.settings.addUI("add-ons",{path:'Add-Ons @{"description": "Add-Ons are additional modules, often written by other people, that can be loaded automatically by FrankerFaceZ to add new capabilities and behaviors to the extension and Twitch.", "profile_warning": false}',component:"addon-list",title:"Add-Ons",no_filter:!0,getExtraTerms:()=>Object.values(this.addons).map((e=>e.search_terms)),isReady:()=>this.enabled,getAddons:()=>Object.values(this.addons),hasAddon:e=>this.hasAddon(e),getVersion:e=>this.getVersion(e),doesAddonTarget:e=>this.doesAddonTarget(e),isAddonEnabled:e=>this.isAddonEnabled(e),isAddonExternal:e=>this.isAddonExternal(e),enableAddon:e=>this.enableAddon(e),disableAddon:e=>this.disableAddon(e),isReloadRequired:()=>this.reload_required,refresh:()=>window.location.reload(),on:(...e)=>this.on(...e),off:(...e)=>this.off(...e)}),this.settings.add("addons.dev.server",{default:!1,ui:{path:"Add-Ons >> Development",title:"Use Local Development Server",description:"Attempt to load add-ons from local development server on port 8001.",component:"setting-check-box"}}),this.on("i18n:update",this.rebuildAddonSearch,this),this.settings.provider.on("changed",this.onProviderChange,this),this._loader.then((()=>{this.enabled_addons=this.settings.provider.get("addons.enabled",[]);for(const e of this.enabled_addons)this.hasAddon(e)&&this.doesAddonTarget(e)&&this._enableAddon(e).catch((s=>{this.log.error(`An error occured while enabling the add-on "${e}":`,s),this.log.capture(s)}));this.emit(":ready")}))}doesAddonTarget(e){var s;const n=this.addons[e];if(!n)return!1;const o=null!==(s=n.targets)&&void 0!==s?s:["main"];return!!Array.isArray(o)&&o.includes(this.target)}generateLog(){const e=["Known"];for(const[s,n]of Object.entries(this.addons))e.push(`${s} | ${this.isAddonEnabled(s)?"enabled":"disabled"} | ${n.dev?"dev | ":""}${this.isAddonExternal(s)?"external | ":""}${n.short_name} v${n.version}`);e.push(""),e.push("Modules");for(const[s,n]of Object.entries(this.__modules))n&&e.push(`${n.loaded?"loaded  ":n.loading?"loading ":"unloaded"} | ${n.enabled?"enabled ":n.enabling?"enabling":"disabled"} | ${s}`);return e.join("\n")}onProviderChange(e,s){if("addons.enabled"!=e)return;s||(s=[]);const n=[...this.enabled_addons];for(const e of n)s.includes(e)||this.disableAddon(e,!1);for(const e of s)n.includes(e)||this.enableAddon(e,!1)}async loadAddonData(){const[e,s]=await Promise.all([fetchJSON(`${a.SERVER}/script/addons.json?_=${Object(g.getBuster)(30)}`),this.settings.get("addons.dev.server")?fetchJSON(`https://localhost:8001/script/addons.json?_=${Object(g.getBuster)()}`):null]);if(Array.isArray(e))for(const s of e)this.addAddon(s,!1);if(Array.isArray(s)){this.has_dev=!0;for(const e of s)this.addAddon(e,!0)}this.settings.updateContext({addonDev:this.has_dev}),this.rebuildAddonSearch(),this.emit(":data-loaded")}addAddon(e,s=!1){const n=this.addons[e.id];this.addons[e.id]=e,e.dev=s,e.requires=e.requires||[],e.required_by=Array.isArray(n)?n:n&&n.required_by||[],e.updated&&(e.updated=new Date(e.updated)),e.created&&(e.created=new Date(e.created)),e._search=e.search_terms;for(const s of e.requires){const n=this.addons[s];Array.isArray(n)?n.push(e.id):n?n.required_by.push(e.id):this.addons[s]=[e.id]}this.emit(":added")}rebuildAddonSearch(){for(const e of Object.values(this.addons)){const s=new Set([e._search,e.name,e.short_name,e.author,e.description]);"en"!==this.i18n.locale&&(e.name_i18n&&s.add(this.i18n.t(e.name_i18n,e.name)),e.short_name_i18n&&s.add(this.i18n.t(e.short_name_i18n,e.short_name)),e.author_i18n&&s.add(this.i18n.t(e.author_i18n,e.author)),e.description_i18n&&s.add(this.i18n.t(e.description_i18n,e.description))),e.search_terms=[...s].map((e=>e?e.toLocaleLowerCase():"")).join("\n")}}isAddonEnabled(e){return!!this.isAddonExternal(e)||this.enabled_addons.includes(e)}getAddon(e){const s=this.addons[e];return Array.isArray(s)?null:s}hasAddon(e){return null!=this.getAddon(e)}getVersion(e){const s=this.getAddon(e);if(!s)throw new Error(`Unknown add-on id: ${e}`);const n=this.resolve(`addon.${e}`);if(n){if(Object(f.has)(n,"version"))return n.version;if(n.constructor&&Object(f.has)(n.constructor,"version"))return n.constructor.version}return s.version}isAddonExternal(e){if(!this.hasAddon(e))throw new Error(`Unknown add-on id: ${e}`);const s=this.resolve(`addon.${e}`);if(!s)return!1;return!document.head.querySelector(`script#ffz-loaded-addon-${e}`)||(s.external||s.constructor&&s.constructor.external)}async _enableAddon(e){if(!this.getAddon(e))throw new Error(`Unknown add-on id: ${e}`);await this.loadAddon(e);const s=this.resolve(`addon.${e}`);s&&!s.enabled&&await s.enable()}async loadAddon(e){const s=this.getAddon(e);if(!s)throw new Error(`Unknown add-on id: ${e}`);await this.i18n.loadChunk(`addon.${e}`);let n=this.resolve(`addon.${e}`);if(n)return n.loaded||await n.load(),void this.emit(":addon-loaded",e);document.head.appendChild(Object(u.createElement)("script",{id:`ffz-loaded-addon-${s.id}`,type:"text/javascript",src:s.src||`${s.dev?"https://localhost:8001":a.SERVER}/script/addons/${s.id}/script.js?_=${Object(g.getBuster)(30)}`,crossorigin:"anonymous"})),await Object(f.timeout)(this.waitFor(`addon.${e}:registered`),6e4),n=this.resolve(`addon.${e}`),n&&!n.loaded&&await n.load(),this.emit(":addon-loaded",e)}unloadAddon(e){const s=this.resolve(`addon.${e}`);if(s)return s.unload()}enableAddon(e,s=!0){const n=this.getAddon(e);if(!n)throw new Error(`Unknown add-on id: ${e}`);if(!this.isAddonEnabled(e)){if(Array.isArray(n.requires))for(const e of n.requires){if(!this.hasAddon(e))throw new Error(`Unknown add-on id: ${e}`);this.enableAddon(e)}this.emit(":addon-enabled",e),this.enabled_addons.push(e),s&&this.settings.provider.set("addons.enabled",this.enabled_addons),this.doesAddonTarget(e)&&this._enableAddon(e).catch((s=>{this.log.error(`An error occured while enabling the add-on "${e}":`,s),this.log.capture(s)}))}}async disableAddon(e,s=!0){const n=this.getAddon(e);if(!n)throw new Error(`Unknown add-on id: ${e}`);if(this.isAddonExternal(e))throw new Error(`Cannot disable external add-on with id: ${e}`);if(this.isAddonEnabled(e)){if(Array.isArray(n.required_by)){const e=[];for(const s of n.required_by)e.push(this.disableAddon(s));await Promise.all(e)}this.emit(":addon-disabled",e),this.enabled_addons.splice(this.enabled_addons.indexOf(e),1),s&&this.settings.provider.set("addons.enabled",this.enabled_addons);try{const s=this.resolve(`addon.${e}`);s&&await s.disable()}catch(e){this.reload_required=!0,this.emit(":reload-required")}}}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return ExperimentManager}));var o=n(2),a=n(4),u=n(0),f=n(10),g=n(26),_=n.n(g),b=n(84),v=n.n(b),k=n(85),x=n.n(k);const C="experiment_overrides",E={expires:7,domain:".twitch.tv"};function sortExperimentLog(e,s){return e.rarity<s.rarity?-1:e.rarity>s.rarity?1:e.name<s.name?-1:e.name>s.name?1:0}class ExperimentManager extends a.default{constructor(...e){super(...e),this.inject("settings"),this.settings.addUI("experiments",{path:"Debugging > Experiments",component:"experiments",no_filter:!0,getExtraTerms:()=>{const e=[];for(const s of[this.experiments,this.getTwitchExperiments()])if(s)for(const[n,o]of Object.entries(s))e.push(n),o.name&&e.push(o.name),o.description&&e.push(o.description);return e},is_locked:()=>this.getControlsLocked(),unlock:()=>this.unlockControls(),unique_id:()=>this.unique_id,ffz_data:()=>Object(u.deep_copy)(this.experiments),twitch_data:()=>Object(u.deep_copy)(this.getTwitchExperiments()),usingTwitchExperiment:e=>this.usingTwitchExperiment(e),getTwitchAssignment:e=>this.getTwitchAssignment(e),getTwitchType:e=>this.getTwitchType(e),hasTwitchOverride:e=>this.hasTwitchOverride(e),setTwitchOverride:(e,s)=>this.setTwitchOverride(e,s),deleteTwitchOverride:e=>this.deleteTwitchOverride(e),getAssignment:e=>this.getAssignment(e),hasOverride:e=>this.hasOverride(e),setOverride:(e,s)=>this.setOverride(e,s),deleteOverride:e=>this.deleteOverride(e),on:(...e)=>this.on(...e),off:(...e)=>this.off(...e)}),this.unique_id=_.a.get("unique_id"),this.Cookie=_.a,this.experiments={},this.cache=new Map}getControlsLocked(){if(o.DEBUG)return!1;const e=this.settings.provider.get("exp-lock",0);return!(!isNaN(e)&&isFinite(e))||Date.now()-e>=864e5}unlockControls(){this.settings.provider.set("exp-lock",Date.now())}async onLoad(){await this.loadExperiments()}async loadExperiments(){let e;try{e=await fetch(o.DEBUG?x.a:`${o.SERVER}/script/experiments.json?_=${Object(f.getBuster)()}`).then((e=>e.ok?e.json():null))}catch(e){this.log.warn("Unable to load experiment data.",e)}if(!e)return;this.experiments=e;const s=this.cache;this.cache=new Map;let n=0;for(const[e,o]of s.entries()){const s=this.getAssignment(e);o!==s&&(n++,this.emit(":changed",e,s),this.emit(`:changed:${e}`,s))}this.log.info(`Loaded information on ${Object.keys(e).length} experiments.${n>0?` ${n} values updated.`:""}`)}onEnable(){this.on("socket:command:reload_experiments",this.loadExperiments,this),this.on("socket:command:update_experiment",this.updateExperiment,this)}updateExperiment(e,s){this.log.info(`Received updated data for experiment "${e}" via WebSocket.`,s),s.groups?this.experiments[e]=s:this.experiments[e].groups=s,this._rebuildKey(e)}generateLog(){const e=[`Unique ID: ${this.unique_id}`,""],s=[];for(const[e,n]of Object.entries(this.experiments)){const o=this.getAssignment(e),a=this.hasOverride(e);let u=0,f=0;for(const e of n.groups)e.value===o&&(u=e.weight),f+=e.weight;(a||u!==f)&&s.push({key:e,name:n.name,value:o,override:a,rarity:u/f})}s.sort(sortExperimentLog);for(const n of s)e.push(`FFZ | ${n.name}: ${n.value}${n.override?" (Override)":""} (r:${n.rarity})`);const n=[],o=this.settings.get("context.channel");for(const[e,s]of Object.entries(this.getTwitchExperiments())){if(!this.usingTwitchExperiment(e))continue;const o=this.getTwitchAssignment(e),a=this.hasTwitchOverride(e);let u=0,f=0;for(const e of s.groups)e.value===o&&(u=e.weight),f+=e.weight;(a||u!==f)&&n.push({key:e,name:s.name,value:o,override:a,type:this.getTwitchTypeByKey(e),rarity:u/f})}n.sort(sortExperimentLog);for(const s of n)e.push(`Twitch | ${s.name}: ${s.value}${s.override?" (Override)":""} (r:${s.rarity}, t:${s.type}${"channel_id"===s.type?`, c:${o}`:""})`);return e.join("\n")}getTwitchType(e){var s,n,o;const a=null===(s=this.resolve("site"))||void 0===s||null===(n=s.getCore)||void 0===n?void 0:n.call(s);return null!=a&&null!==(o=a.experiments)&&void 0!==o&&o.getExperimentType?a.experiments.getExperimentType(e):1===e?"device_id":2===e?"user_id":3===e?"channel_id":e}getTwitchTypeByKey(e){var s,n,o;const a=null===(s=this.resolve("site"))||void 0===s||null===(n=s.getCore)||void 0===n?void 0:n.call(s),u=a&&a.experiments,f=null==u||null===(o=u.experiments)||void 0===o?void 0:o[e];return null!=f&&f.t?this.getTwitchType(f.t):null}getTwitchExperiments(){var e,s;if(window.__twilightSettings)return window.__twilightSettings.experiments;const n=null===(e=this.resolve("site"))||void 0===e||null===(s=e.getCore)||void 0===s?void 0:s.call(e);return n&&n.experiments.experiments}usingTwitchExperiment(e){var s,n;const o=null===(s=this.resolve("site"))||void 0===s||null===(n=s.getCore)||void 0===n?void 0:n.call(s);return o&&Object(u.has)(o.experiments.assignments,e)}setTwitchOverride(e,s=null){var n,o;const a=_.a.getJSON(C)||{},u=a.experiments=a.experiments||{},f=a.disabled=a.disabled||[];u[e]=s;const g=f.indexOf(e);-1!=g&&f.remove(g),_.a.set(C,a,E);const b=null===(n=this.resolve("site"))||void 0===n||null===(o=n.getCore)||void 0===o?void 0:o.call(n);b&&(b.experiments.overrides[e]=s),this._rebuildTwitchKey(e,!0,s)}deleteTwitchOverride(e){var s,n;const o=_.a.getJSON(C),a=null==o?void 0:o.experiments;if(!a||!Object(u.has)(a,e))return;const f=a[e];delete a[e],_.a.set(C,o,E);const g=null===(s=this.resolve("site"))||void 0===s||null===(n=s.getCore)||void 0===n?void 0:n.call(s);g&&delete g.experiments.overrides[e],this._rebuildTwitchKey(e,!1,f)}hasTwitchOverride(e){const s=_.a.getJSON(C),n=null==s?void 0:s.experiments;return n&&Object(u.has)(n,e)}getTwitchAssignment(e,s=null){var n,o,a;const u=null===(n=this.resolve("site"))||void 0===n||null===(o=n.getCore)||void 0===o?void 0:o.call(n),f=u&&u.experiments;if(!f)return null;if(!f.hasInitialized&&f.initialize)try{f.initialize()}catch(e){this.log.warn("Error attempting to initialize Twitch experiments tracker.",e)}return s||"channel_id"===this.getTwitchType(null===(a=f.experiments[e])||void 0===a?void 0:a.t)?f.getAssignmentById(e,{channel:null!=s?s:this.settings.get("context.channel")}):f.overrides&&f.overrides[e]?f.overrides[e]:f.assignments&&f.assignments[e]?f.assignments[e]:null}getTwitchKeyFromName(e){const s=this.getTwitchExperiments();if(s){e=e.toLowerCase();for(const n in s)if(Object(u.has)(s,n)){const o=s[n];if(o&&o.name&&o.name.toLowerCase()===e)return n}}}getTwitchAssignmentByName(e,s=null){return this.getTwitchAssignment(this.getTwitchKeyFromName(e),s)}_rebuildTwitchKey(e,s,n){var o,a;const f=(null===(o=this.resolve("site"))||void 0===o||null===(a=o.getCore)||void 0===a?void 0:a.call(o)).experiments,g=Object(u.has)(f.assignments,e)?f.assignments[e]:void 0;if(g!==n){const o=s?n:g;this.emit(":twitch-changed",e,o),this.emit(`:twitch-changed:${e}`,o)}}setOverride(e,s=null){const n=this.settings.provider.get("experiment-overrides")||{};n[e]=s,this.settings.provider.set("experiment-overrides",n),this._rebuildKey(e)}deleteOverride(e){const s=this.settings.provider.get("experiment-overrides");s&&Object(u.has)(s,e)&&(delete s[e],this.settings.provider.set("experiment-overrides",s),this._rebuildKey(e))}hasOverride(e){const s=this.settings.provider.get("experiment-overrides");return s&&Object(u.has)(s,e)}getAssignment(e){if(this.cache.has(e))return this.cache.get(e);const s=this.experiments[e];if(!s)return this.log.warn(`Tried to get assignment for experiment "${e}" which is not known.`),null;const n=this.settings.provider.get("experiment-overrides"),o=n&&Object(u.has)(n,e)?n[e]:ExperimentManager.selectGroup(e,s,this.unique_id);return this.cache.set(e,o),o}_rebuildKey(e){if(!this.cache.has(e))return;const s=this.cache.get(e);this.cache.delete(e);const n=this.getAssignment(e);n!==s&&(this.emit(":changed",e,n),this.emit(`:changed:${e}`,n))}static selectGroup(e,s,n){const o=e+n+(s.seed||""),a=s.groups.reduce(((e,s)=>e+s.weight),0);let u=(v()(o).words[0]>>>0)/Math.pow(2,32);for(const e of s.groups)if(u-=e.weight/a,u<=0)return e.value;return null}}},function(e,s,n){var o,a,u,f,g,_,b,v;e.exports=(v=n(113),a=(o=v).lib,u=a.WordArray,f=a.Hasher,g=o.algo,_=[],b=g.SHA1=f.extend({_doReset:function(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,s){for(var n=this._hash.words,o=n[0],a=n[1],u=n[2],f=n[3],g=n[4],b=0;b<80;b++){if(b<16)_[b]=0|e[s+b];else{var v=_[b-3]^_[b-8]^_[b-14]^_[b-16];_[b]=v<<1|v>>>31}var k=(o<<5|o>>>27)+g+_[b];k+=b<20?1518500249+(a&u|~a&f):b<40?1859775393+(a^u^f):b<60?(a&u|a&f|u&f)-1894007588:(a^u^f)-899497514,g=f,f=u,u=a<<30|a>>>2,a=o,o=k}n[0]=n[0]+o|0,n[1]=n[1]+a|0,n[2]=n[2]+u|0,n[3]=n[3]+f|0,n[4]=n[4]+g|0},_doFinalize:function(){var e=this._data,s=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return s[o>>>5]|=128<<24-o%32,s[14+(o+64>>>9<<4)]=Math.floor(n/4294967296),s[15+(o+64>>>9<<4)]=n,e.sigBytes=4*s.length,this._process(),this._hash},clone:function(){var e=f.clone.call(this);return e._hash=this._hash.clone(),e}}),o.SHA1=f._createHelper(b),o.HmacSHA1=f._createHmacHelper(b),v.SHA1)},function(e,s,n){e.exports=n.p+"experiments.e36cd9fa7c4df0dd60ffd5c37dd27290.json"},function(e,s,n){e.exports=function(){"use strict";return function(e,s,n){e=e||{};var o=s.prototype,a={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function i(e,s,n,a){return o.fromToBase(e,s,n,a)}n.en.relativeTime=a,o.fromToBase=function(s,o,u,f,g){for(var _,b,v,k=u.$locale().relativeTime||a,x=e.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],C=x.length,E=0;E<C;E+=1){var z=x[E];z.d&&(_=f?n(s).diff(u,z.d,!0):u.diff(s,z.d,!0));var j=(e.rounding||Math.round)(Math.abs(_));if(v=_>0,j<=z.r||!z.r){j<=1&&E>0&&(z=x[E-1]);var O=k[z.l];g&&(j=g(""+j)),b="string"==typeof O?O.replace("%d",j):O(j,o,z.l,v);break}}if(o)return b;var A=v?k.future:k.past;return"function"==typeof A?A(b):A.replace("%s",b)},o.to=function(e,s){return i(e,s,this,!0)},o.from=function(e,s){return i(e,s,this)};var d=function(e){return e.$u?n.utc():n()};o.toNow=function(e){return this.to(d(this),e)},o.fromNow=function(e){return this.from(d(this),e)}}}()},function(e,s,n){"use strict";n.d(s,"a",(function(){return BaseSite}));var o=n(4);let a=0,u=0;class BaseSite extends o.default{constructor(...e){super(...e),this._id="_ffz$"+a++,this.log.info(`Using: ${this.constructor.name}`)}awaitElement(e,s,n=6e4){s||(s=document.documentElement);const o=s.querySelector(e);return o?Promise.resolve(o):new Promise(((o,a)=>{const f=`${this._id}$observer`,g=s[f],_=u++,b=n&&setTimeout((()=>{const e=s[f];if(!e)return;const[n,o]=e;for(let e=0;e<o.length;e++){const s=o[e];if(s[0]===_){o.splice(e,1),s[3]("Timed out");break}}o.length||(n.disconnect(),s[f]=null)}),n);if(g)return void g[1].push([_,e,o,a,b]);const v=new MutationObserver((()=>{const e=s[f];if(!e)return void v.disconnect();const n=e[1];for(let e=0;e<n.length;e++){const o=n[e],a=s.querySelector(o[1]);a&&(n.splice(e,1),e--,o[4]&&clearTimeout(o[4]),o[2](a))}n.length||(v.disconnect(),s[f]=null)}));s[f]=[v,[[_,e,o,a,b]]],v.observe(s,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}))}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return Fine}));var o=n(7),a=n(4);class Fine extends a.default{constructor(...e){super(...e),this._wrappers=new Map,this._known_classes=new Map,this._observer=null,this._waiting=[],this._live_waiting=null}async onEnable(e=0){if(this.root_element||(this.root_element=await this.parent.awaitElement(this.selector||"body #root")),!this.root_element||!this.root_element._reactRootContainer){if(e>500)throw new Error("Unable to find React after 25 seconds");return this.root_element=null,new Promise((e=>setTimeout(e,50))).then((()=>this.onEnable(e+1)))}this.react_root=this.root_element._reactRootContainer,this.react_root._internalRoot&&this.react_root._internalRoot.current&&(this.react_root=this.react_root._internalRoot),this.react=this.react_root.current.child}onDisable(){this.react_root=this.root_element=this.react=this.accessor=null}static findAccessor(e){for(const s in e)if(s.startsWith("__reactInternalInstance$"))return s}getReactInstance(e){if(this.accessor||(this.accessor=Fine.findAccessor(e)),this.accessor)return e[this.accessor]||e._reactRootContainer&&e._reactRootContainer._internalRoot&&e._reactRootContainer._internalRoot.current||e._reactRootContainer&&e._reactRootContainer.current}getOwner(e){return e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)),e?e.return:null}getParentNode(e,s=100,n=!1){return this.searchParent(e,(e=>e instanceof Node),s,0,n)}getChildNode(e,s=100,n=!1){return this.searchTree(e,(e=>e instanceof Node),s,0,n)}getHostNode(e,s=100){return this.getChildNode(e,s)}getParent(e){return this.getOwner(e)}getFirstChild(e){return e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)),e?e.child:null}getChildren(e){if(e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)),!e)return null;const s=[];let n=e.child;for(;n;)s.push(n),n=n.sibling;return s}searchParent(e,s,n=15,o=0,a=!0){if(e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)),!e||e._ffz_no_scan||o>n)return null;if("string"==typeof s){const e=this._wrappers.get(s);if(!e)throw new Error("invalid critera");if(!e._class)return null;s=s=>s&&s.constructor===e._class}const u=e.stateNode;if(u&&s(u))return u;if(e.return){const u=this.searchParent(e.return,s,n,o+1,a);if(u)return u}if(a&&u&&u.containerInfo){const e=u.containerInfo.parentElement,f=e&&this.getReactInstance(e);if(f){const e=this.searchParent(f,s,n,o+1,a);if(e)return e}}return null}searchNode(e,s,n=15,o=0,a=!0){if(e?e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)):e=this.react,!e||e._ffz_no_scan||o>n)return null;if("string"==typeof s){const e=this._wrappers.get(s);if(!e)throw new Error("invalid critera");if(!e._class)return null;s=s=>s&&s.constructor===e._class}if(e&&s(e))return e;if(e.child){let u=e.child;for(;u;){const e=this.searchNode(u,s,n,o+1,a);if(e)return e;u=u.sibling}}const u=e.stateNode;if(a&&u&&u.props&&u.props.root){const e=u.props.root._reactRootContainer;if(e){let u=e._internalRoot&&e._internalRoot.current||e.current;for(;u;){const e=this.searchNode(u,s,n,o+1,a);if(e)return e;u=u.sibling}}}}searchTree(e,s,n=15,o=0,a=!0,u=!1){if(e?e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)):e=this.react,u&&(u instanceof Set||(u=new Set)),!u||u instanceof Set||(u=new Set),!e||e._ffz_no_scan||o>n)return u||null;if("string"==typeof s){const e=this._wrappers.get(s);if(!e)throw new Error("invalid critera");if(!e._class)return u||null;s=s=>s&&s.constructor===e._class}const f=e.stateNode;if(f&&s(f,e)){if(!u)return f;u.add(f)}if(e.child){let f=e.child;for(;f;){const e=this.searchTree(f,s,n,o+1,a,u);if(e&&!u)return e;f=f.sibling}}if(a&&f&&f.props&&f.props.root){const e=f.props.root._reactRootContainer;if(e){let f=e._internalRoot&&e._internalRoot.current||e.current;for(;f;){const e=this.searchTree(f,s,n,o+1,a,u);if(e&&!u)return e;f=f.sibling}}}return u||void 0}findAllMatching(e,s,n=15,o=!0,a=!1,u=0,f=!0){const g=new Set;let crit=e=>!g.has(e)&&s(e);for(;;){const _=a?this.searchParent(e,crit,n,u,f):this.searchTree(e,crit,n,u,f);if(!_)break;if(o&&!g.size){const e=_.constructor;crit=n=>!g.has(n)&&n instanceof e&&s(n)}g.add(_)}return g}searchAll(e,s,n=15,o=0,a,u=!0){if(e?e._reactInternalFiber?e=e._reactInternalFiber:e instanceof Node&&(e=this.getReactInstance(e)):e=this.react,a||(a={seen:new Set,classes:s.map((()=>null)),out:s.map((()=>({cls:null,instances:new Set,depth:null}))),max_depth:o}),!e||e._ffz_no_scan||o>n)return a.out;o>a.max_depth&&(a.max_depth=o);const f=e.stateNode;if(f){const e=f.constructor,n=a.classes.indexOf(e);if(-1!==n)a.out[n].instances.add(f);else if(!a.seen.has(e)){let n=s.length;for(;n-- >0;)if(s[n](f)){a.classes[n]=a.out[n].cls=e,a.out[n].instances.add(f),a.out[n].depth=o;break}a.seen.add(e)}}let g=e.child;for(;g;)this.searchAll(g,s,n,o+1,a,u),g=g.sibling;if(u&&f&&f.props&&f.props.root){const e=f.props.root._reactRootContainer;if(e){let f=e._internalRoot&&e._internalRoot.current||e.current;for(;f;)this.searchAll(f,s,n,o+1,a,u),f=f.sibling}}return a.out}route(e){this._route=e,this._updateLiveWaiting()}_updateLiveWaiting(){const e=this._live_waiting=[],s=this._waiting_crit=[],n=this._route;if(this._waiting)for(const o of this._waiting)n&&o.routes.length&&!o.routes.includes(n)||(e.push(o),s.push(o.criteria));this._live_waiting.length?this._waiting_timer||this._startWaiting():this._stopWaiting()}define(e,s,n){if(this._wrappers.has(e))return this._wrappers.get(e);if(!s)throw new Error("cannot find definition and no criteria provided");const o=new FineWrapper(e,s,n,this);this._wrappers.set(e,o);const a=this.searchAll(this.react,[s],1e3)[0];return a.cls?(o._set(a.cls,a.instances),this._known_classes.set(a.cls,o)):!1!==n&&(this._waiting.push(o),this._updateLiveWaiting()),o}wrap(e,s){let n;if(this._wrappers.has(e)?n=this._wrappers.get(e):(n=new FineWrapper(e,null,void 0,this),this._wrappers.set(e,n)),s){if(n._class||n.criteria)throw new Error("tried setting a class on an already initialized FineWrapper");n._set(s,new Set),this._known_classes.set(s,n)}return n}_checkWaiters(e){if(this._live_waiting){Array.isArray(e)||(e=[e]);for(let s of e){if(s?s._reactInternalFiber?s=s._reactInternalFiber:s instanceof Node&&(s=this.getReactInstance(s)):s=this.react,!s||s._ffz_no_scan||!this._live_waiting.length)continue;const e=this.searchAll(s,this._waiting_crit,1e3);let n=e.length;for(;n-- >0;)if(e[n].cls){const s=e[n],o=this._live_waiting.splice(n,1)[0];this._waiting_crit.splice(n,1);const a=this._waiting.indexOf(o);-1!==a&&this._waiting.splice(a,1),this.log.debug(`Found class for "${o.name}" at depth ${s.depth}`),o._set(s.cls,s.instances)}}this._live_waiting.length||this._stopWaiting()}}_startWaiting(){this.log.info("Installing MutationObserver."),this._waiting_timer=setInterval((()=>this._checkWaiters()),500),this._observer||(this._observer=new MutationObserver((e=>this._checkWaiters(e.map((e=>e.target)))))),this._observer.observe(document.body,{childList:!0,subtree:!0})}_stopWaiting(){this.log.info("Stopping MutationObserver."),this._observer&&this._observer.disconnect(),this._waiting_timer&&clearInterval(this._waiting_timer),this._live_waiting=null,this._waiting_crit=null,this._waiting_timer=null}}const u={"will-mount":"UNSAFE_componentWillMount",mount:"componentDidMount",render:"render","receive-props":"UNSAFE_componentWillReceiveProps","should-update":"shouldComponentUpdate","will-update":"UNSAFE_componentWillUpdate",update:"componentDidUpdate",unmount:"componentWillUnmount"};class FineWrapper extends o.EventEmitter{constructor(e,s,n,o){super(),this.name=e,this.criteria=s,this.fine=o,this.instances=new Set,this.routes=n||[],this._wrapped=new Set,this._class=null}get first(){return this.toArray()[0]}toArray(){return Array.from(this.instances)}check(e=null,s=1e3){if(this._class)return;const n=this.fine.findAllMatching(e,this.criteria,s);if(n.size){const e=Array.from(n);this._set(e[0].constructor,e)}}ready(e){this._class?e(this._class,this.instances):this.once("set",e)}each(e){for(const s of this.instances)e(s)}_set(e,s){if(this._class)throw new Error("already have a class");this._class=e,this._wrapped.add("UNSAFE_componentWillMount"),this._wrapped.add("componentWillUnmount");const n=this,o=this.instances,a=e.prototype,u=a.UNSAFE_componentWillMount,f=a.componentWillUnmount,g=a.UNSAFE_componentWillMount=u?function(...e){return this._ffz_mounted=!0,o.add(this),n.emit("will-mount",this,...e),u.apply(this,e)}:function(...e){this._ffz_mounted=!0,o.add(this),n.emit("will-mount",this,...e)},_=a.componentWillUnmount=f?function(...e){return n.emit("unmount",this,...e),o.delete(this),this._ffz_mounted=!1,f.apply(this,e)}:function(...e){n.emit("unmount",this,...e),o.delete(this),this._ffz_mounted=!1};this.__UNSAFE_componentWillMount=[g,u],this.__componentWillUnmount=[_,f];for(const e of this.events())this._maybeWrap(e);if(s)for(const e of s)e._ffz_mounted=!0,o.add(e);this.emit("set",e,o)}_add(e){for(const s of e)this.instances.add(s)}_maybeWrap(e){const s=u[e];this._class&&s&&!this._wrapped.has(s)&&this._wrap(e,s)}_wrap(e,s){if(this._wrapped.has(s))return;const n=this,o=this._class.prototype,a=o[s],u=o[s]=a?function(...s){return this._ffz_mounted||(this._ffz_mounted=!0,n.instances.add(this),n.emit("late-mount",this)),n.emit(e,this,...s),a.apply(this,s)}:"shouldComponentUpdate"===s?function(...s){return this._ffz_mounted||(this._ffz_mounted=!0,n.instances.add(this),n.emit("late-mount",this)),n.emit(e,this,...s),!0}:function(...s){this._ffz_mounted||(this._ffz_mounted=!0,n.instances.add(this),n.emit("late-mount",this)),n.emit(e,this,...s)};this[`__${s}`]=[u,a]}_unwrap(e){if(!this._wrapped.has(e))return;const s=`__${e}`,n=this._class.prototype,[o,a]=this[s];if(n[e]!==o)throw new Error("unable to unwrap -- prototype modified");n[e]=a,this[s]=void 0,this._wrapped.delete(e)}forceUpdate(){for(const e of this.instances)try{e.forceUpdate(),this.fine.emit("site:dom-update",this.name,e)}catch(e){this.fine.log.capture(e,{tags:{fine_wrapper:this.name}}),this.fine.log.error(`An error occurred when calling forceUpdate on an instance of ${this.name}`,e)}}on(e,s,n){return this._maybeWrap(e),super.on(e,s,n)}prependOn(e,s,n){return this._maybeWrap(e),super.prependOn(e,s,n)}once(e,s,n){return this._maybeWrap(e),super.once(e,s,n)}prependOnce(e,s,n){return this._maybeWrap(e),super.prependOnce(e,s,n)}many(e,s,n,o){return this._maybeWrap(e),super.many(e,s,n,o)}prependMany(e,s,n,o){return this._maybeWrap(e),super.prependMany(e,s,n,o)}waitFor(e){return this._maybeWrap(e),super.waitFor(e)}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return PlayerBase}));var o=n(4),a=n(1),u=n(0),f=n(2),g=n(29);const _=Object(a.createElement)("span"),b=window.AudioContext&&null!=window.DynamicsCompressorNode,v=b&&null!=window.GainNode,k="setting.entry.player.volume-scroll.values",x=[{value:!1,title:"Disabled",i18n_key:`${k}.false`},{value:!0,title:"Enabled",i18n_key:`${k}.true`},{value:2,title:"Enabled with Right-Click",i18n_key:`${k}.2`},{value:3,title:"Enabled with Alt",i18n_key:`${k}.3`},{value:4,title:"Enabled with Alt + Right-Click",i18n_key:`${k}.4`},{value:5,title:"Enabled with Shift",i18n_key:`${k}.5`},{value:6,title:"Enabled with Shift + Right-Click",i18n_key:`${k}.6`},{value:7,title:"Enabled with Ctrl",i18n_key:`${k}.7`},{value:8,title:"Enabled with Ctrl + Right-Click",i18n_key:`${k}.8`}];function wantsRMB(e){return 2===e||4===e||6===e||8===e}function matchesEvent(e,s,n){return!(wantsRMB(e)&&2!==s.button&&!n)&&(!!(s.altKey||3!==e&&4!==e)&&(!!(s.shiftKey||5!==e&&6!==e)&&!!(s.ctrlKey||7!==e&&8!==e)))}function rotateButton(e){const s=e.currentTarget,n=s&&s.querySelector("figure");n&&!n.classList.contains("ffz-i-t-reset-clicked")&&(n.classList.toggle("ffz-i-t-reset",!1),n.classList.toggle("ffz-i-t-reset-clicked",!0),setTimeout((()=>{n.classList.toggle("ffz-i-t-reset",!0),n.classList.toggle("ffz-i-t-reset-clicked",!1)}),500))}class PlayerBase extends o.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.onShortcut=this.onShortcut.bind(this),this.registerSettings()}registerSettings(){this.settings.add("player.embed-metadata",{default:!0,ui:{path:"Player > General >> Embed and Popout",title:"Show metadata when mousing over the player.",component:"setting-check-box"}}),b&&(this.settings.add("player.compressor.enable",{default:!0,ui:{path:'Player > Compressor @{"description": "These settings control optional dynamic range compression for the player, a form of audio processing that reduces the volume of loud sounds and amplifies quiet sounds, thus normalizing or compressing the volume. This uses a [DynamicsCompressorNode](https://developer.mozilla.org/en-US/docs/Web/API/DynamicsCompressorNode) from the Web Audio API behind the scenes if you want to learn more."} >> General',title:"Enable the audio compressor and add an `Audio Compressor` button to the player controls.",sort:-1e3,component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addCompressorButton(e)}}),this.settings.add("player.compressor.default",{default:!1,ui:{path:"Player > Compressor >> General",title:"Enable the compressor by default.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.compressPlayer(e)}}),this.settings.add("player.compressor.shortcut",{default:null,requires:["player.compressor.enable"],process:(e,s)=>e.get("player.compressor.enable")?s:null,ui:{path:"Player > Compressor >> General",title:"Shortcut Key",description:"This key sequence can be used to toggle the compressor.",component:"setting-hotkey"},changed:()=>{this.updateShortcut();for(const e of this.Player.instances)this.addCompressorButton(e)}}),v&&(this.settings.add("player.gain.enable",{default:!1,ui:{sort:-1,path:'Player > Compressor >> Gain Control @{"sort": 50, "description": "Gain Control gives you extra control over the output volume when using the Compressor by letting you adjust the volume after the compressor runs, while the built-in volume slider takes affect before the compressor. This uses a simple [GainNode](https://developer.mozilla.org/en-US/docs/Web/API/GainNode) from the Web Audio API, connected in sequence after the DynamicsCompressorNode the Compressor uses."}',title:"Enable gain control when the audio compressor is enabled.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.compressPlayer(e)}}),this.settings.add("player.gain.no-volume",{default:!1,requires:["player.gain.enable"],process:(e,s)=>!!e.get("player.gain.enable")&&s,ui:{path:"Player > Compressor >> Gain Control",title:"Force built-in volume to 100% when the audio compressor is enabled.",description:"With this enabled, the built-in volume will be hidden and the Gain Control will be the only way to change volume.",component:"setting-check-box"},changed:e=>{this.css_tweaks.toggleHide("player-gain-volume",e);for(const e of this.Player.instances)this.updateGainVolume(e)}}),this.settings.add("player.gain.scroll",{default:!1,ui:{path:"Player > Compressor >> Gain Control",title:"Scroll Adjust",description:"Adjust the gain by scrolling with the mouse wheel. This setting takes precedence over adjusting the volume by scrolling. *This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:x}}),this.settings.add("player.gain.default",{default:100,requires:["player.gain.min","player.gain.max"],process(e,s){const n=e.get("player.gain.min"),o=e.get("player.gain.max");return(s/=100)<n&&(s=n),s>o&&(s=o),s},ui:{path:"Player > Compressor >> Gain Control",title:"Default Value",component:"setting-text-box",description:"The default value for gain control, when gain control is enabled. 100% means no change in volume.",process:"to_int",bounds:[0,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.min",{default:0,process:(e,s)=>s/100,ui:{path:"Player > Compressor >> Gain Control",title:"Minimum",component:"setting-text-box",description:"**Range:** 0 ~ 100\n\nThe minimum allowed value for gain control. 0% is effectively muted.",process:"to_int",bounds:[0,!0,100,!0]},changed:()=>this.updateGains()}),this.settings.add("player.gain.max",{default:200,process:(e,s)=>s/100,ui:{path:"Player > Compressor >> Gain Control",title:"Maximum",component:"setting-text-box",description:"**Range:** 100 ~ 1000\n\nThe maximum allowed value for gain control. 100% is no change. 200% is double the volume.",process:"to_int",bounds:[100,!0,1e3,!0]},changed:()=>this.updateGains()})),this.settings.add("player.compressor.threshold",{default:-50,ui:{path:'Player > Compressor >> Advanced @{"sort": 1000}',title:"Threshold",sort:0,description:"**Range:** -100 ~ 0\n\nThe decibel value above which the compression will start taking effect.",component:"setting-text-box",process:"to_int",bounds:[-100,!0,0,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.knee",{default:40,ui:{path:"Player > Compressor >> Advanced",title:"Knee",sort:5,description:"**Range:** 0 ~ 40\n\nA decibel value representing the range above the threshold where the curve smoothly transitions to the compressed portion.",component:"setting-text-box",process:"to_int",bounds:[0,!0,40,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.ratio",{default:12,ui:{path:"Player > Compressor >> Advanced",title:"Ratio",sort:10,description:"**Range:** 0 ~ 20\n\nThe amount of change, in dB, needed in the input for a 1 dB change in the output.",component:"setting-text-box",process:"to_int",bounds:[0,!0,20,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.attack",{default:0,ui:{path:"Player > Compressor >> Advanced",title:"Attack",sort:15,description:"**Range:** 0 ~ 1\n\nThe amount of time, in seconds, required to reduce the gain by 10 dB.",component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()}),this.settings.add("player.compressor.release",{default:.25,ui:{path:"Player > Compressor >> Advanced",title:"Release",sort:20,description:"**Range:** 0 ~ 1\nThe amount of time, in seconds, required to increase the gain by 10 dB.",component:"setting-text-box",process:"to_float",bounds:[0,!0,1,!0]},changed:()=>this.updateCompressors()})),this.settings.add("player.allow-catchup",{default:!0,ui:{path:'Player > General @{"sort": -1000} >> General',title:"Allow the player to speed up to reduce delay.",description:"Twitch, by default, will apply a minor speed up to live video when you have a large delay to the broadcaster in order to catch back up with the live broadcast. This may result in audio distortion. Disable this to prevent the automatic speed changes.",component:"setting-check-box"},changed:()=>this.updatePlaybackRates()}),this.settings.add("player.mute-click",{default:!1,ui:{path:"Player > General >> Volume",title:"Mute or unmute the player by middle-clicking.",component:"setting-check-box"}}),this.settings.add("player.volume-scroll",{default:!1,ui:{path:"Player > General >> Volume",title:"Adjust volume by scrolling with the mouse wheel.",description:"*This setting will not work properly on streams with visible extensions when mouse interaction with extensions is allowed.*",component:"setting-select-box",data:x}}),this.settings.add("player.button.reset",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Reset Player` button to the player controls.",description:"Double-clicking the Reset Player button attempts to reset the Twitch player's internal state, fixing playback issues without a full page refresh.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addResetButton(e)}}),document.pictureInPictureEnabled&&this.settings.add("player.button.pip",{default:!0,ui:{path:"Player > General >> General",title:"Add a `Picture-in-Picture` button to the player controls.",description:"Clicking the PiP button attempts to toggle Picture-in-Picture mode for the player's video.",component:"setting-check-box"},changed:()=>{for(const e of this.Player.instances)this.addPiPButton(e)}}),this.settings.add("player.volume-scroll-steps",{default:.1,ui:{path:"Player > General >> Volume",title:"Volume scroll amount",description:"How much the volume level is changed per individual scroll input.",component:"setting-select-box",data:[{value:.1,title:"10%"},{value:.05,title:"5%"},{value:.02,title:"2%"},{value:.01,title:"1%"}]}}),this.settings.add("player.captions.font-size",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Size",description:"How large should captions be. This can be a percentage, such as `10%`, or a pixel value, such as `50px`.",component:"setting-text-box"},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.captions.font-family",{default:"",ui:{path:"Player > Closed Captioning >> Font",title:"Font Family",description:"Override the font used for displaying Closed Captions.",component:"setting-combo-box",data:()=>Object(g.a)()},changed:()=>this.updateCaptionsCSS()}),this.settings.add("player.ext-hide",{default:0,ui:{path:"Player > General >> Extensions",title:"Show Overlay Extensions",description:"Note: This feature does not prevent extensions from loading. Hidden extensions are merely invisible. Hiding extensions with this feature will not improve your security.",component:"setting-select-box",data:[{value:2,title:"Never"},{value:1,title:"With Controls"},{value:0,title:"Always"}]},changed:e=>this.updateHideExtensions(e)}),this.settings.add("player.ext-interaction",{default:!0,ui:{path:"Player > General >> Extensions",title:"Allow mouse interaction with overlay extensions.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-ext-mouse",!e)}),this.settings.add("player.no-autoplay",{default:!1,ui:{path:"Player > General >> Playback",title:"Do not automatically start playing videos or streams.",description:"Note: This feature does not apply when navigating directly from channel to channel.",component:"setting-check-box"}}),this.settings.add("player.vod.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play the next recommended video after a video finishes.",component:"setting-check-box"}}),this.settings.add("player.volume-always-shown",{default:!1,ui:{path:"Player > General >> Volume",title:"Keep the volume slider expanded at all times.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-volume",e)}),this.settings.add("player.hide-mouse",{default:!0,ui:{path:"Player > General >> General",title:"Hide mouse when controls aren't visible.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("player-hide-mouse",e)})}async onEnable(){await this.settings.awaitProvider(),await this.settings.provider.awaitReady(),this.css_tweaks.toggleHide("player-gain-volume",this.settings.get("player.gain.no-volume")),this.css_tweaks.toggle("player-volume",this.settings.get("player.volume-always-shown")),this.css_tweaks.toggle("player-ext-mouse",!this.settings.get("player.ext-interaction")),this.css_tweaks.toggle("player-hide-mouse",this.settings.get("player.hide-mouse")),this.installVisibilityHook(),this.updateHideExtensions(),this.updateCaptionsCSS(),this.updateShortcut(),this.on(":reset",this.resetAllPlayers,this),this.Player.ready(((e,s)=>{this.modifyPlayerClass(e);for(const e of s){var n;const s=null===(n=e.props)||void 0===n?void 0:n.playerEvents;s&&(Object(a.off)(s,"Playing",e.setPlayerActive),Object(a.off)(s,"PlayerSeekCompleted",e.setPlayerActive)),e.ffzMaybeRemoveNativeListeners(),e.maybeAttachDomEventListeners(),e.ffzScheduleState(),s&&(Object(a.on)(s,"Playing",e.setPlayerActive),Object(a.on)(s,"PlayerSeekCompleted",e.setPlayerActive)),this.updateGUI(e),this.compressPlayer(e),this.updatePlaybackRate(e)}})),this.Player.on("mount",(e=>{this.updateGUI(e),this.compressPlayer(e),this.updatePlaybackRate(e)})),this.Player.on("update",(e=>{this.updateGUI(e),this.compressPlayer(e),this.updatePlaybackRate(e)})),this.Player.on("unmount",(e=>{e.ffzUninstall()})),this.on("i18n:update",(()=>{for(const e of this.Player.instances)this.updateGUI(e)}))}updateShortcut(){var e,s;const n=this.Mousetrap=this.Mousetrap||(null===(e=this.resolve("site.web_munch"))||void 0===e||null===(s=e.getModule)||void 0===s?void 0:s.call(e,"mousetrap"))||window.Mousetrap;if(!n||!n.bind)return;this._shortcut_bound&&(n.unbind(this._shortcut_bound),this._shortcut_bound=null);const o=this.settings.get("player.compressor.shortcut");b&&o&&Object(u.isValidShortcut)(o)&&(n.bind(o,this.onShortcut),this._shortcut_bound=o)}onShortcut(e){this.log.info("Compressor Hotkey",e);for(const s of this.Player.instances)this.compressPlayer(s,e)}modifyPlayerClass(e){const s=this,n=e.prototype.maybeAttachDomEventListeners;e.prototype.ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0,this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffzErrorReset||(this._ffzErrorReset=s.addErrorResetButton.bind(s,this)),this._ffzReady||(this._ffzReady=this.ffzReady.bind(this));const e=this,n=this.setPlayerActive,o=this.setPlayerInactive;this.setPlayerActive=function(){return e.ffzScheduleState(),n.call(e)},this.setPlayerInactive=function(){return e.ffzScheduleState(),o.call(e)},this.ffzOnEnded=()=>{s.settings.get("player.vod.autoplay")||s.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||s.fine.getChildNode(this),1e3).then((e=>e.click()))};const u=this.props.playerEvents;u&&(Object(a.on)(u,"Playing",this._ffzUpdateState),Object(a.on)(u,"PlayerError",this._ffzUpdateState),Object(a.on)(u,"PlayerError",this._ffzErrorReset),Object(a.on)(u,"Ended",this._ffzUpdateState),Object(a.on)(u,"Ended",this.ffzOnEnded),Object(a.on)(u,"Ready",this._ffzReady),Object(a.on)(u,"Idle",this._ffzUpdateState)),this.ffzStopAutoplay()},e.prototype.ffzUninstall=function(){this._ffz_state_raf&&cancelAnimationFrame(this._ffz_state_raf);const e=this.props.playerEvents;e&&this._ffzUpdateState&&(Object(a.off)(e,"Playing",this._ffzUpdateState),Object(a.off)(e,"PlayerError",this._ffzUpdateState),Object(a.off)(e,"PlayerError",this._ffzErrorReset),Object(a.off)(e,"Ended",this._ffzUpdateState),Object(a.off)(e,"Ended",this.ffzOnEnded),Object(a.off)(e,"Ready",this._ffzReady),Object(a.off)(e,"Idle",this._ffzUpdateState)),this.ffzRemoveListeners(),this._ffz_state_raf=null,this._ffzUpdateState=null,this._ffzErrorReset=null,this._ffzReady=null,this.ffzOnEnded=null},e.prototype.ffzReady=function(){const e=this.props.containerRef;e&&requestAnimationFrame((()=>{const s=e.querySelectorAll(".ffz--player-reset figure");for(const e of s)e._ffz_unspin&&clearTimeout(e._ffz_unspin),e.classList.toggle("loading",!1)}))},e.prototype.ffzStopAutoplay=function(){s.shouldStopAutoplay(this)&&s.stopPlayer(this.props.mediaPlayerInstance,this.props.playerEvents,this)},e.prototype.ffzScheduleState=function(){this._ffzUpdateState||(this._ffzUpdateState=this.ffzUpdateState.bind(this)),this._ffz_state_raf||(this._ffz_state_raf=requestAnimationFrame(this._ffzUpdateState))},e.prototype.ffzUpdateState=function(){var e,n,o;this._ffz_state_raf=null;const a=this.props.containerRef;if(!a)return;const u=a.dataset;u.controls=(null===(e=this.state)||void 0===e?void 0:e.active)||!1;let f=this.props.mediaPlayerInstance;if(!f)return;f.core&&(f=f.core);const g=null===(n=f.state)||void 0===n?void 0:n.state,_=null===(o=f.mediaSinkManager)||void 0===o?void 0:o.video;"Playing"===g&&null!=_&&_._ffz_maybe_compress&&(_._ffz_maybe_compress=!1,s.compressPlayer(this)),_&&null!=_._ffz_compressed&&(u.compressed=_._ffz_compressed),u.ended="Ended"===g,u.paused="Idle"===g},e.prototype.ffzAttachListeners=function(){const e=this.props.containerRef;e&&!this._ffz_listeners&&(this._ffz_listeners=!0,this._ffz_scroll_handler||(this._ffz_scroll_handler=this.ffzScrollHandler.bind(this)),this._ffz_click_handler||(this._ffz_click_handler=this.ffzClickHandler.bind(this)),this._ffz_menu_handler||(this._ffz_menu_handler=this.ffzMenuHandler.bind(this)),Object(a.on)(e,"wheel",this._ffz_scroll_handler),Object(a.on)(e,"mousedown",this._ffz_click_handler),Object(a.on)(e,"contextmenu",this._ffz_menu_handler))},e.prototype.ffzRemoveListeners=function(){const e=this.props.containerRef;e&&this._ffz_listeners&&(this._ffz_scroll_handler&&(Object(a.off)(e,"wheel",this._ffz_scroll_handler),this._ffz_scroll_handler=null),this._ffz_click_handler&&(Object(a.off)(e,"mousedown",this._ffz_click_handler),this._ffz_click_handler=null),this._ffz_menu_handler&&(Object(a.off)(e,"contextmenu",this._ffz_menu_handler),this._ffz_menu_handler=null),this._ffz_listeners=!1)},e.prototype.ffzClickHandler=function(e){var n;if(!e)return;const o=s.settings.get("player.volume-scroll"),a=s.settings.get("player.gain.scroll");if((wantsRMB(o)||wantsRMB(a))&&2===e.button&&(this.ffz_rmb=!0,this.ffz_scrolled=!1),!s.settings.get("player.mute-click")||1!==e.button)return;const u=null===(n=this.props)||void 0===n?void 0:n.mediaPlayerInstance;if(null==u||!u.isMuted)return;const f=!u.isMuted();return u.setMuted(f),localStorage.setItem("video-muted",JSON.stringify({default:f})),e.preventDefault(),!1},e.prototype.ffzMenuHandler=function(e){this.ffz_rmb=!1,this.ffz_scrolled&&(e.preventDefault(),e.stopPropagation())},e.prototype.ffzScrollHandler=function(e){var n,o,a,u;const f=s.settings.get("player.volume-scroll"),g=s.settings.get("player.gain.scroll"),_=s.settings.get("player.gain.no-volume"),b=g&&matchesEvent(g,e,this.ffz_rmb),v=f&&matchesEvent(f,e,this.ffz_rmb);if(!b&&!v)return;const k=e.wheelDelta||-(e.deltaY||e.detail||0),x=null===(n=this.props)||void 0===n?void 0:n.mediaPlayerInstance,C=(null==x||null===(o=x.mediaSinkManager)||void 0===o?void 0:o.video)||(null==x||null===(a=x.core)||void 0===a||null===(u=a.mediaSinkManager)||void 0===u?void 0:u.video),E=(null==C?void 0:C._ffz_compressed)&&null!=(null==C?void 0:C._ffz_gain)&&b;if(null==x||!x.getVolume)return;wantsRMB(E?g:f)&&(this.ffz_scrolled=!0);const z=s.settings.get("player.volume-scroll-steps");if(E){let e=C._ffz_gain_value;null==e&&(e=s.settings.get("player.gain.default"));const n=s.settings.get("player.gain.min"),o=s.settings.get("player.gain.max");k>0?e+=z:e-=z,e<n&&(e=n),e>o&&(e=o),C._ffz_gain_value=e,_&&0!==e&&(x.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),s.updateGain(this)}else if(v&&(!C._ffz_compressed||!_)){var j;const e=null!==(j=null==C?void 0:C.volume)&&void 0!==j?j:x.getVolume(),s=Math.max(0,Math.min(1,e+(k>0?z:-z)));x.setVolume(s),localStorage.volume=s,0!==s&&(x.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1})))}return e.preventDefault(),!1},e.prototype.ffzMaybeRemoveNativeListeners=function(){const e=this.props.containerRef;e&&this.listenersAttached&&(Object(a.off)(e,"mouseleave",this.setPlayerInactive),Object(a.off)(e,"mouseenter",this.setPlayerActive),Object(a.off)(e,"mousemove",this.onMouseMove),this.listenersAttached=!1)},e.prototype.maybeAttachDomEventListeners=function(){try{this.ffzInstall(),this.ffzAttachListeners()}catch(e){s.log.error("Error attaching event listener.",e)}return n.call(this)}}shouldStopAutoplay(){return!1}installVisibilityHook(){if(!document.pictureInPictureEnabled)return void this.log.info("Skipping visibility hooks. Picture-in-Picture is not available.");const e=this;document.addEventListener("fullscreenchange",(()=>{const e=document.fullscreenElement,s=document.pictureInPictureElement;e&&s&&(e===s||e.contains(s))&&document.exitPictureInPicture();for(const e of this.Player.instances)this.addPiPButton(e)}));try{Object.defineProperty(document,"hidden",{configurable:!0,get:()=>null==document.pictureInPictureElement&&(!e.settings.get("player.force-visible")&&"hidden"===document.visibilityState)})}catch(e){this.log.warn("Unable to install document visibility hook.",e)}}stopPlayer(e,s,n){var o,u,f;if(e&&e.pause&&"Playing"===((null===(o=e.getState)||void 0===o?void 0:o.call(e))||(null===(u=e.core)||void 0===u||null===(f=u.getState)||void 0===f?void 0:f.call(u))))e.pause();else if(s&&!s._ffz_stopping){s._ffz_stopping=!0;const immediatePause=()=>{var e;null!==(e=n.props.mediaPlayerInstance)&&void 0!==e&&e.pause&&(n.props.mediaPlayerInstance.pause(),Object(a.off)(s,"Playing",immediatePause),s._ffz_stopping=!1)};this.log.info("Unable to immediately pause. Listening for playing event."),Object(a.on)(s,"Playing",immediatePause)}}updateCaptionsCSS(){const e=[],s=this.settings.get("player.captions.font-size");let n=this.settings.get("player.captions.font-family");if(n&&n.length){const[s,o]=Object(g.b)(n);n=s,this._font_unloader&&this._font_unloader(),this._font_unloader=o,-1!==n.indexOf(" ")&&-1===n.indexOf(",")&&-1===n.indexOf('"')&&-1===n.indexOf("'")&&(n=`"${n}"`),_.style.fontFamily="",_.style.fontFamily=n,_.style.fontFamily&&e.push(`font-family: ${_.style.fontFamily} !important;`)}_.style.fontSize="",_.style.fontSize=s,_.style.fontSize&&e.push(`font-size: ${_.style.fontSize} !important;`),e.length?this.css_tweaks.set("captions-font",`.player-captions-container__caption-line {\n\t${e.join("\n\t")}\n}`):this.css_tweaks.delete("captions-font")}updateHideExtensions(e){void 0===e&&(e=this.settings.get("player.ext-hide")),this.css_tweaks.toggleHide("player-ext-hover",1===e),this.css_tweaks.toggleHide("player-ext",2===e)}updateGUI(e){this.addPiPButton(e),this.addResetButton(e),this.addCompressorButton(e,!1),this.addGainSlider(e,!1),this.addMetadata(e),this.emit(":update-gui",e)}areControlsDisabled(e){return e._ffz_control_state||this.findControlState(e),!!e._ffz_control_state&&e._ffz_control_state.props.disableControls}findControlState(e){e._ffz_control_state||(e._ffz_control_state=this.fine.searchTree(e,(e=>e.props&&Object(u.has)(e.props,"disableControls")),200))}addGainSlider(e,s,n=0){var o,u,f,g,_;const b=e.props.containerRef||this.fine.getChildNode(e),v=(null===(o=e.props.mediaPlayerInstance)||void 0===o||null===(u=o.mediaSinkManager)||void 0===u?void 0:u.video)||(null===(f=e.props.mediaPlayerInstance)||void 0===f||null===(g=f.core)||void 0===g||null===(_=g.mediaSinkManager)||void 0===_?void 0:_.video),k=b&&b.querySelector(".player-controls__left-control-group");let x=null!=v&&v._ffz_compressed&&v._ffz_gain;if(this.areControlsDisabled(e)&&(x=null),!k){if(v&&!x)return;return n<5?setTimeout(this.addGainSlider.bind(this,e,s,(n||0)+1),250):void 0}const C=this.settings.get("player.gain.min"),E=this.settings.get("player.gain.max");(C>=E||E<=C)&&(x=null);let z,j,O,A,T,D=k.querySelector(".ffz--player-gain");if(!x)return void(D&&D.remove());if(D){if(s)return;O=D.querySelector("input"),T=D.querySelector(".ffz--gain-value"),j=D.querySelector(".ffz-il-tooltip"),z=D.querySelector(".ffz-il-tooltip .ffz--p-tip"),A=D.querySelector(".ffz-il-tooltip .ffz--p-value")}else{const on_change=()=>{var s;let n=O.value/100;const o=this.settings.get("player.gain.min"),a=this.settings.get("player.gain.max");if(n<o&&(n=o),n>a&&(n=a),n==v._ffz_gain_value)return;const u=e.props.mediaPlayerInstance,f=u.core||u;!this.areControlsDisabled(e)&&n>0&&this.settings.get("player.gain.no-volume")&&null!=f&&null!==(s=f.isMuted)&&void 0!==s&&s.call(f)&&(f.setMuted(!1),localStorage.setItem("video-muted",JSON.stringify({default:!1}))),v._ffz_gain_value=n,x.gain.value=n;const g=(n-o)/(a-o);T.style.width=100*g+"%",A.textContent=`${Math.round(100*n)}%`};D=Object(a.createElement)("div",{class:"ffz--player-gain volume-slider__slider-container tw-relative ffz-il-tooltip__container"},Object(a.createElement)("div",{class:"tw-align-items-center tw-flex tw-full-height"},Object(a.createElement)("label",{class:"tw-hide-accessible"},this.i18n.t("player.gain.label","Gain Control")),Object(a.createElement)("div",{class:"tw-flex tw-full-width tw-relative tw-z-above"},O=Object(a.createElement)("input",{class:"ffz-range ffz-range--overlay",type:"range",min:"0",max:"100",step:"1","data-a-target":"player-gain-slider",value:"100"}),Object(a.createElement)("div",{class:"tw-absolute tw-border-radius-large tw-bottom-0 tw-flex tw-flex-column tw-full-width tw-justify-content-center ffz-range__fill ffz-range__fill--overlay tw-top-0 tw-z-below"},Object(a.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-container"},T=Object(a.createElement)("div",{class:"tw-border-radius-large ffz-range__fill-value ffz--gain-value","data-test-selector":"ffz-range__fill-value-selector"}))))),j=Object(a.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},Object(a.createElement)("div",null,z=Object(a.createElement)("div",{class:"ffz--p-tip"}),A=Object(a.createElement)("div",{class:"tw-regular ffz--p-value"})))),O.addEventListener("input",on_change),k.appendChild(D)}let B=v._ffz_gain_value;null==B&&(B=this.settings.get("player.gain.default")),O.min=100*C,O.max=100*E,O.value=100*B;const P=(B-C)/(E-C);T.style.width=100*P+"%",z.textContent=this.i18n.t("player.gain.label","Gain Control"),A.textContent=`${Math.round(100*B)}%`}addCompressorButton(e,s,n=0){var o,u,g,_,v;const k=e.props.containerRef||this.fine.getChildNode(e),x=(null===(o=e.props.mediaPlayerInstance)||void 0===o||null===(u=o.mediaSinkManager)||void 0===u?void 0:u.video)||(null===(g=e.props.mediaPlayerInstance)||void 0===g||null===(_=g.core)||void 0===_||null===(v=_.mediaSinkManager)||void 0===v?void 0:v.video),C=k&&k.querySelector(".player-controls__left-control-group"),E=b&&null!=x&&this.settings.get("player.compressor.enable");if(!C){if(!E)return;return n<5?setTimeout(this.addCompressorButton.bind(this,e,s,(n||0)+1),250):void 0}let z,j,O,A,T,D=C.querySelector(".ffz--player-comp");if(!E||this.areControlsDisabled(e))return void(D&&D.remove());if(D){if(s)return;z=D.querySelector("figure"),T=D.querySelector("button"),j=D.querySelector(".ffz-il-tooltip .ffz--p-tip"),O=D.querySelector(".ffz-il-tooltip .ffz--p-extra")}else D=Object(a.createElement)("div",{class:"ffz--player-comp tw-inline-flex tw-relative ffz-il-tooltip__container"},T=Object(a.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-comp-button",onClick:this.compressPlayer.bind(this,e)},Object(a.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(a.createElement)("div",{class:"tw-button-icon__icon"},z=Object(a.createElement)("figure",{class:"ffz-player-icon"})))),Object(a.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},Object(a.createElement)("div",null,j=Object(a.createElement)("div",{class:"ffz--p-tip"}),O=Object(a.createElement)("div",{class:"ffz--p-extra tw-pd-t-05 ffz--tooltip-explain"}),A=f.IS_FIREFOX?Object(a.createElement)("div",{class:"ffz--p-ff tw-pd-t-05 ffz--tooltip-explain"}):null))),C.appendChild(D);const B=x._ffz_compressed,P=this.canCompress(e);let L=P?B?this.i18n.t("player.comp_button.off","Disable Audio Compressor"):this.i18n.t("player.comp_button.on","Audio Compressor"):this.i18n.t("player.comp_button.disabled","Audio Compressor cannot be enabled when viewing Clips.");O.textContent=this.i18n.t("player.comp_button.help","See the FFZ Control Center for details. If audio breaks, please reset the player."),P&&this._shortcut_bound&&(L=`${L} (${this._shortcut_bound})`),A&&(A.textContent+=`\n${this.i18n.t("player.comp_button.firefox","Playback Speed controls will not function for Firefox users when the Compressor has been enabled.")}`),z.classList.toggle("ffz-i-comp-on",B),z.classList.toggle("ffz-i-comp-off",!B),T.disabled=!P,T.setAttribute("aria-label",L),j.textContent=L}compressPlayer(e,s){var n;const o=e.props.mediaPlayerInstance,a=o.core||o,u=null==a||null===(n=a.mediaSinkManager)||void 0===n?void 0:n.video;if(!u||!b)return;a._ffz_setVolume||(a._ffz_setVolume=a.setVolume,a._ffz_fakeVolume=()=>{}),u._ffz_maybe_compress=!1;const f=u._ffz_compressed||!1;let g=u._ffz_toggled?u._ffz_state:this.settings.get("player.compressor.default");if(null!=s&&(s.preventDefault(),u._ffz_toggled=!0,g=!u._ffz_compressed,u._ffz_state=g),u._ffz_compressor){if(!u._ffz_comp_reset&&!this.canCompress(e))return u._ffz_comp_reset=!0,void this.resetPlayer(e)}else{if(!g)return;this.createCompressor(e,u)}let _=u._ffz_gain;const k=v&&this.settings.get("player.gain.enable"),x=null!=_;if((g==f||null==s&&u._ffz_toggled)&&x==k)return;const C=u._ffz_context,E=u._ffz_compressor,z=u._ffz_source;if(C&&E&&z){if(k&&!_){_=u._ffz_gain=C.createGain();let e=u._ffz_gain_value;null==e&&(e=this.settings.get("player.gain.default")),_.gain.value=e,E.connect(_),f&&(E.disconnect(C.destination),_.connect(C.destination))}else!k&&_&&(E.disconnect(_),f&&(_.disconnect(C.destination),E.connect(C.destination)),_=u._ffz_gain=null);g!=f&&(g?(z.disconnect(C.destination),z.connect(E),_?(_.connect(C.destination),this.settings.get("player.gain.no-volume")&&(u._ffz_pregain_volume=a.getVolume(),a._ffz_setVolume(1),a.setVolume=a._ffz_fakeVolume)):E.connect(C.destination)):(z.disconnect(E),_?(_.disconnect(C.destination),null!=u._ffz_pregain_volume&&(a._ffz_setVolume(u._ffz_pregain_volume),a.setVolume=a._ffz_setVolume,u._ffz_pregain_volume=null)):E.disconnect(C.destination),z.connect(C.destination))),e.props.containerRef&&(e.props.containerRef.dataset.compressed=g),u._ffz_compressed=g,this.addCompressorButton(e),this.addGainSlider(e)}}updateGainVolume(e){var s;const n=e.props.mediaPlayerInstance,o=n.core||n,a=null==o||null===(s=o.mediaSinkManager)||void 0===s?void 0:s.video;if(!a||!a._ffz_compressed)return;const u=this.settings.get("player.gain.no-volume");u&&null==a._ffz_pregain_volume?(a._ffz_pregain_volume=o.getVolume(),o._ffz_setVolume(1),o.setVolume=o._ffz_fakeVolume):u||null==a._ffz_pregain_volume||(o._ffz_setVolume(a._ffz_pregain_volume),o.setVolume=o._ffz_setVolume,a._ffz_pregain_volume=null)}canCompress(e){var s,n,o,a;if(!b)return!1;const u=null===(s=e.props)||void 0===s?void 0:s.mediaPlayerInstance;if(null==u)return!1;const f=(null===(n=u.mediaSinkManager)||void 0===n?void 0:n.video)||(null===(o=u.core)||void 0===o||null===(a=o.mediaSinkManager)||void 0===a?void 0:a.video);if(!f)return!1;if(!f.src)return!1;if("blob:"!==new URL(f.src).protocol)return!1;return!0}createCompressor(e,s){if(!this.canCompress(e))return;let n=s._ffz_compressor;if(!n){const e=new AudioContext;if(!f.IS_FIREFOX&&"suspended"===e.state)return void this.log.info("Aborting due to browser auto-play policy.");s._ffz_context=e;if((s._ffz_source=e.createMediaElementSource(s)).connect(e.destination),n=s._ffz_compressor=e.createDynamicsCompressor(),this.settings.get("player.gain.enable")){const o=s._ffz_gain=e.createGain();let a=s._ffz_gain_value;null==a&&(a=this.settings.get("player.gain.default")),o.gain.value=a,n.connect(o)}s._ffz_compressed=!1}this.updateCompressor(null,n)}updateGains(){for(const e of this.Player.instances)this.updateGain(e)}updateGain(e,s,n,o=!0){var a,u,f,g,_,b;if(n||(n=(null===(a=e.props.mediaPlayerInstance)||void 0===a||null===(u=a.mediaSinkManager)||void 0===u?void 0:u.video)||(null===(f=e.props.mediaPlayerInstance)||void 0===f||null===(g=f.core)||void 0===g||null===(_=g.mediaSinkManager)||void 0===_?void 0:_.video)),null==s&&(s=null===(b=n)||void 0===b?void 0:b._ffz_gain),!n||!s)return;let v=n._ffz_gain_value;null==v&&(v=this.settings.get("player.gain.default")),s.gain.value=v,o&&this.addGainSlider(e)}updateCompressors(){for(const e of this.Player.instances)this.updateCompressor(e)}updateCompressor(e,s){if(null==s){var n,o,a,u,f;const g=(null===(n=e.props.mediaPlayerInstance)||void 0===n||null===(o=n.mediaSinkManager)||void 0===o?void 0:o.video)||(null===(a=e.props.mediaPlayerInstance)||void 0===a||null===(u=a.core)||void 0===u||null===(f=u.mediaSinkManager)||void 0===f?void 0:f.video);s=null==g?void 0:g._ffz_compressor}s&&(s.threshold.value=this.settings.get("player.compressor.threshold"),s.knee.value=this.settings.get("player.compressor.knee"),s.ratio.value=this.settings.get("player.compressor.ratio"),s.attack.value=this.settings.get("player.compressor.attack"),s.release.value=this.settings.get("player.compressor.release"))}updatePlaybackRates(){for(const e of this.Player.instances)this.updatePlaybackRate(e)}updatePlaybackRate(e){var s,n,o,a,u;const f=(null===(s=e.props.mediaPlayerInstance)||void 0===s||null===(n=s.mediaSinkManager)||void 0===n?void 0:n.video)||(null===(o=e.props.mediaPlayerInstance)||void 0===o||null===(a=o.core)||void 0===a||null===(u=a.mediaSinkManager)||void 0===u?void 0:u.video);f.setFFZPlaybackRate||this.installPlaybackRate(f),f.setFFZPlaybackRate(f.playbackRate)}installPlaybackRate(e){if(e.setFFZPlaybackRate)return;let s=e.playbackRate;const n=this;e.setFFZPlaybackRate=o=>{delete e.playbackRate,s=o,e.playbackRate=o,n.settings.get("player.allow-catchup")||Object.defineProperty(e,"playbackRate",{configurable:!0,get:()=>s,set(s){(1===s||s<1||s>=1.1)&&e.setFFZPlaybackRate(s)}})}}addPiPButton(e,s=0){var n,o,u,f,g;const _=e.props.containerRef||this.fine.getChildNode(e),b=(null===(n=e.props.mediaPlayerInstance)||void 0===n||null===(o=n.mediaSinkManager)||void 0===o?void 0:o.video)||(null===(u=e.props.mediaPlayerInstance)||void 0===u||null===(f=u.core)||void 0===f||null===(g=f.mediaSinkManager)||void 0===g?void 0:g.video),v=b&&document.fullscreenElement&&document.fullscreenElement.contains(b),k=_&&_.querySelector(".player-controls__right-control-group"),x=document.pictureInPictureEnabled&&this.settings.get("player.button.pip");if(!k){if(!x)return;return s<5?setTimeout(this.addPiPButton.bind(this,e,(s||0)+1),250):void 0}let C,E,z,j=k.querySelector(".ffz--player-pip");if(!x)return void(j&&j.remove());if(j)C=j.querySelector("figure"),z=j.querySelector("button"),E=j.querySelector(".ffz-il-tooltip");else{j=Object(a.createElement)("div",{class:"ffz--player-pip tw-inline-flex tw-relative ffz-il-tooltip__container"},z=Object(a.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-pip-button",onClick:this.pipPlayer.bind(this,e)},Object(a.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(a.createElement)("div",{class:"tw-button-icon__icon"},C=Object(a.createElement)("figure",{class:"ffz-player-icon"})))),E=Object(a.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));let s=k.querySelector('button[data-a-target="player-theatre-mode-button"]');s||(s=k.querySelector('button[data-a-target="player-fullscreen-button"]')),s?k.insertBefore(j,s.parentElement):k.appendChild(j)}const O=!!document.pictureInPictureElement,A=!1,T=v?this.i18n.t("player.pip_button.fs","Cannot use Picture-in-Picture when Fullscreen"):O?this.i18n.t("player.pip_button.off","Exit Picture-in-Picture"):this.i18n.t("player.pip_button","Picture-in-Picture");C.classList.toggle("ffz-i-t-pip-inactive",!O||A),C.classList.toggle("ffz-i-t-pip-active",O&&!0),z.setAttribute("aria-label",T),E.textContent=T}pipPlayer(e,s){var n,o,a,u,f;const g=(null===(n=e.props.mediaPlayerInstance)||void 0===n||null===(o=n.mediaSinkManager)||void 0===o?void 0:o.video)||(null===(a=e.props.mediaPlayerInstance)||void 0===a||null===(u=a.core)||void 0===u||null===(f=u.mediaSinkManager)||void 0===f?void 0:f.video);g&&document.pictureInPictureEnabled&&(s&&s.preventDefault(),document.fullscreenElement&&document.fullscreenElement.contains(g)||(g._ffz_pip_enter||(g.addEventListener("enterpictureinpicture",g._ffz_pip_enter=()=>{this.addPiPButton(e)}),g.addEventListener("leavepictureinpicture",g._ffz_pip_exit=()=>{this.addPiPButton(e)})),document.pictureInPictureElement?document.exitPictureInPicture():g.requestPictureInPicture()))}addResetButton(e,s=0){const n=e.props.containerRef||this.fine.getChildNode(e),o=n&&n.querySelector(".player-controls__right-control-group"),u=this.settings.get("player.button.reset");if(!o){if(!u)return;return s<5?setTimeout(this.addResetButton.bind(this,e,(s||0)+1),250):void 0}let f,g,_=o.querySelector(".ffz--player-reset");if(u){if(_)g=_.querySelector("button"),f=_.querySelector(".ffz-il-tooltip");else{_=Object(a.createElement)("div",{class:"ffz--player-reset tw-inline-flex tw-relative ffz-il-tooltip__container"},g=Object(a.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:rotateButton,onDblClick:this.resetPlayer.bind(this,e)},Object(a.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(a.createElement)("div",{class:"tw-button-icon__icon"},Object(a.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),f=Object(a.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"}));const s=o.querySelector(".ffz--player-pip button")||o.querySelector('button[data-a-target="player-theatre-mode-button"]')||o.querySelector('button[data-a-target="player-fullscreen-button"]');s?o.insertBefore(_,s.parentElement):o.appendChild(_)}g.setAttribute("aria-label",f.textContent=this.i18n.t("player.reset_button","Reset Player (Double-Click)"))}else _&&_.remove()}addErrorResetButton(e,s=0){const n=e.props.containerRef||this.fine.getChildNode(e),o=n&&n.querySelector(".content-overlay-gate"),u=this.settings.get("player.button.reset");if(!o){if(!u)return;return void(s<2&&this.parent.awaitElement(".autoplay-vod__content-container button",this.props.containerRef||t.fine.getChildNode(this),1e3).then((()=>{this.addErrorResetButton(e,(s||0)+1)})).catch((()=>{this.log.warn("Unable to find container element for Error Reset button.")})))}let f,g,_=o.querySelector(".ffz--player-reset");u?(_?(g=_.querySelector("button"),f=_.querySelector(".ffz-il-tooltip")):(_=Object(a.createElement)("div",{class:"ffz--player-reset tw-absolute tw-bottom-0 tw-right-0 ffz-il-tooltip__container tw-mg-1"},g=Object(a.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon tw-button-icon--overlay ffz-core-button ffz-core-button--border ffz-core-button--overlay tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",type:"button","data-a-target":"ffz-player-reset-button",onClick:rotateButton,onDblClick:this.resetPlayer.bind(this,e)},Object(a.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(a.createElement)("div",{class:"tw-button-icon__icon"},Object(a.createElement)("figure",{class:"ffz-player-icon ffz-i-t-reset"})))),f=Object(a.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up",role:"tooltip"})),o.appendChild(_)),g.setAttribute("aria-label",f.textContent=this.i18n.t("player.reset_button","Double-Click to Reset Player"))):_&&_.remove()}resetAllPlayers(){for(const e of this.Player.instances)this.resetPlayer(e)}resetPlayer(e,s){var n,o,u,f,g,_,b;const v=e?e.mediaSinkManager||null!==(n=e.core)&&void 0!==n&&n.mediaSinkManager?e:null==e||null===(o=e.props)||void 0===o?void 0:o.mediaPlayerInstance:null;if(s){s.preventDefault();const e=s.currentTarget,n=e&&e.querySelector("figure");if(n){if(n.classList.contains("loading"))return;n.classList.toggle("ffz-i-t-reset",!0),n.classList.toggle("ffz-i-t-reset-clicked",!1),n.classList.toggle("loading",!0),n._ffz_unspin=setTimeout((()=>{n._ffz_unspin=null,n.classList.toggle("loading",!1)}),1e4)}}const k=null!==(u=null===(f=v.getDuration)||void 0===f?void 0:f.call(v))&&void 0!==u?u:1/0;let x=-1;const C=v.core||v;C._ffz_setVolume&&(C.setVolume=C._ffz_setVolume),isFinite(k)&&!isNaN(k)&&k>0&&(x=v.getPosition());const E=(null===(g=v.mediaSinkManager)||void 0===g?void 0:g.video)||(null===(_=v.core)||void 0===_||null===(b=_.mediaSinkManager)||void 0===b?void 0:b.video);if(null!=E&&E._ffz_compressor&&v.attachHTMLVideoElement){var z,j;const e=Object(a.createElement)("video"),s=null!==(z=null!==(j=null==E?void 0:E._ffz_pregain_volume)&&void 0!==j?j:null==E?void 0:E.volume)&&void 0!==z?z:v.getVolume(),n=v.isMuted();e._ffz_gain_value=E._ffz_gain_value,e._ffz_state=E._ffz_state,e._ffz_toggled=E._ffz_toggled,e._ffz_maybe_compress=!0,e.volume=n?0:s,e.playsInline=!0,this.installPlaybackRate(e),E.replaceWith(e),v.attachHTMLVideoElement(e),setTimeout((()=>{v.setVolume(s),v.setMuted(n)}),0)}this.PlayerSource.check();for(const e of this.PlayerSource.instances){var O;v&&v!==(null===(O=e.props)||void 0===O?void 0:O.mediaPlayerInstance)||e.setSrc({isNewMediaPlayerInstance:!1})}x>0&&setTimeout((()=>v.seekTo(x)),250)}addMetadata(e){this.metadata&&(e._ffz_md_update||(e._ffz_md_update=Object(u.debounce)((()=>requestAnimationFrame((()=>this._updateMetadata(e)))),1e3,2)),e._ffz_md_update())}wantsMetadata(){return!1}_updateMetadata(e){e._ffz_cont&&!document.contains(e._ffz_cont)&&(e._ffz_cont=null);const s=this.wantsMetadata(e);if(!e._ffz_cont){if(!s)return;const n=e.props.containerRef||this.fine.getChildNode(e),o=n&&n.querySelector(".player-controls__right-control-group");if(!o)return;e._ffz_cont=Object(a.createElement)("div",{class:"ffz--player-meta-tray"}),o.insertBefore(e._ffz_cont,o.firstElementChild)}if(!s)return e._ffz_cont.remove(),void(e._ffz_cont=null);this.updateMetadata(e)}updateMetadata(e,s){var n,o,a,u,f;const g=e._ffz_cont;if(!g||!document.contains(g))return;s?Array.isArray(s)||(s=[s]):s=this.metadata.keys;const _=this.parent.data,b=null==_||null===(n=_.props)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.user,v=e._ffz_meta_timers=e._ffz_meta_timers||{},refresh_fn=s=>this.updateMetadata(e,s),k={channel:{id:null==b?void 0:b.id,login:null==_||null===(a=_.props)||void 0===a?void 0:a.channelLogin,display_name:null==b?void 0:b.displayName,live:null!=(null==b||null===(u=b.stream)||void 0===u?void 0:u.id),live_since:null==b||null===(f=b.stream)||void 0===f?void 0:f.createdAt},inst:e,source:_,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>null!=b&&b.id?this.getBroadcastID(e,b.id):null};for(const e of s)this.metadata.renderPlayer(e,k,g,v,refresh_fn)}getBroadcastID(e,s){if(!this.twitch_data)return Promise.resolve(null);const n=e._ffz_bcast_cache=e._ffz_bcast_cache||{};return s===n.channel_id&&Date.now()-n.saved<6e4?Promise.resolve(n.broadcast_id):new Promise((async(e,o)=>{if(n.updating)return void n.updating.push([e,o]);let a,u;n.channel_id=s,n.updating=[[e,o]];try{a=await this.twitch_data.getBroadcastID(s)}catch(e){a=null,u=e}const f=n.updating;if(n.updating=null,n.channel_id===s){n.broadcast_id=a,n.saved=Date.now();for(const e of f)u?e[1](u):e[0](a)}else{u=new Error("Outdated"),n.channel_id=null,n.broadcast_id=null,n.saved=0;for(const e of f)e[1](u)}}))}get playerUI(){var e;const s=this.fine.searchTree(this.Player.first,(e=>e.props&&e.props.uiContext),150);return null==s||null===(e=s.props)||void 0===e?void 0:e.uiContext}get current(){for(const s of this.Player.instances){var e;if(null!=s&&null!==(e=s.props)&&void 0!==e&&e.mediaPlayerInstance)return s.props.mediaPlayerInstance}return null}}},function(e,s,n){e.exports=n.p+"opendyslexic.47a42e50aafbcfaa24927507c6f2da5d.css"},function(e,s,n){"use strict";n.d(s,"a",(function(){return isTableElement}));var o=n(12);function isTableElement(e){return["table","td","th"].indexOf(Object(o.a)(e))>=0}},function(e,s,n){"use strict";n.d(s,"a",(function(){return computeAutoPlacement}));var o=n(18),a=n(3),u=n(15),f=n(9);function computeAutoPlacement(e,s){void 0===s&&(s={});var n=s,g=n.placement,_=n.boundary,b=n.rootBoundary,v=n.padding,k=n.flipVariations,x=n.allowedAutoPlacements,C=void 0===x?a.o:x,E=Object(o.a)(g),z=E?k?a.v:a.v.filter((function(e){return Object(o.a)(e)===E})):a.e,j=z.filter((function(e){return C.indexOf(e)>=0}));0===j.length&&(j=z);var O=j.reduce((function(s,n){return s[n]=Object(u.a)(e,{placement:n,boundary:_,rootBoundary:b,padding:v})[Object(f.a)(n)],s}),{});return Object.keys(O).sort((function(e,s){return O[e]-O[s]}))}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getClippingRect}));var o=n(3),a=n(94),u=n(95),f=n(40),g=n(21),_=n(13),b=n(14),v=n(5),k=n(19),x=n(25),C=n(66),E=n(12),z=n(48),j=n(6);function getClientRectFromMixedType(e,s){return s===o.w?Object(z.a)(Object(a.a)(e)):Object(v.b)(s)?function getInnerBoundingClientRect(e){var s=Object(k.a)(e);return s.top=s.top+e.clientTop,s.left=s.left+e.clientLeft,s.bottom=s.top+e.clientHeight,s.right=s.left+e.clientWidth,s.width=e.clientWidth,s.height=e.clientHeight,s.x=s.left,s.y=s.top,s}(s):Object(z.a)(Object(u.a)(Object(_.a)(e)))}function getClippingRect(e,s,n){var o="clippingParents"===s?function getClippingParents(e){var s=Object(f.a)(Object(x.a)(e)),n=["absolute","fixed"].indexOf(Object(b.a)(e).position)>=0&&Object(v.b)(e)?Object(g.a)(e):e;return Object(v.a)(n)?s.filter((function(e){return Object(v.a)(e)&&Object(C.a)(e,n)&&"body"!==Object(E.a)(e)})):[]}(e):[].concat(s),a=[].concat(o,[n]),u=a[0],_=a.reduce((function(s,n){var o=getClientRectFromMixedType(e,n);return s.top=Object(j.a)(o.top,s.top),s.right=Object(j.b)(o.right,s.right),s.bottom=Object(j.b)(o.bottom,s.bottom),s.left=Object(j.a)(o.left,s.left),s}),getClientRectFromMixedType(e,u));return _.width=_.right-_.left,_.height=_.bottom-_.top,_.x=_.left,_.y=_.top,_}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getViewportRect}));var o=n(8),a=n(13),u=n(36);function getViewportRect(e){var s=Object(o.a)(e),n=Object(a.a)(e),f=s.visualViewport,g=n.clientWidth,_=n.clientHeight,b=0,v=0;return f&&(g=f.width,_=f.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(b=f.offsetLeft,v=f.offsetTop)),{width:g,height:_,x:b+Object(u.a)(e),y:v}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getDocumentRect}));var o=n(13),a=n(14),u=n(36),f=n(37),g=n(6);function getDocumentRect(e){var s,n=Object(o.a)(e),_=Object(f.a)(e),b=null==(s=e.ownerDocument)?void 0:s.body,v=Object(g.a)(n.scrollWidth,n.clientWidth,b?b.scrollWidth:0,b?b.clientWidth:0),k=Object(g.a)(n.scrollHeight,n.clientHeight,b?b.scrollHeight:0,b?b.clientHeight:0),x=-_.scrollLeft+Object(u.a)(e),C=-_.scrollTop;return"rtl"===Object(a.a)(b||n).direction&&(x+=Object(g.a)(n.clientWidth,b?b.clientWidth:0)-v),{width:v,height:k,x:x,y:C}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getScrollParent}));var o=n(25),a=n(38),u=n(12),f=n(5);function getScrollParent(e){return["html","body","#document"].indexOf(Object(u.a)(e))>=0?e.ownerDocument.body:Object(f.b)(e)&&Object(a.a)(e)?e:getScrollParent(Object(o.a)(e))}},function(e,s,n){"use strict";function getAltAxis(e){return"x"===e?"y":"x"}n.d(s,"a",(function(){return getAltAxis}))},function(e,s,n){"use strict";n.d(s,"a",(function(){return orderModifiers}));var o=n(3);function order(e){var s=new Map,n=new Set,o=[];function sort(e){n.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!n.has(e)){var o=s.get(e);o&&sort(o)}})),o.push(e)}return e.forEach((function(e){s.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||sort(e)})),o}function orderModifiers(e){var s=order(e);return o.n.reduce((function(e,n){return e.concat(s.filter((function(e){return e.phase===n})))}),[])}},function(e,s,n){"use strict";function mergeByName(e){var s=e.reduce((function(e,s){var n=e[s.name];return e[s.name]=n?Object.assign({},n,s,{options:Object.assign({},n.options,s.options),data:Object.assign({},n.data,s.data)}):s,e}),{});return Object.keys(s).map((function(e){return s[e]}))}n.d(s,"a",(function(){return mergeByName}))},function(e,s,n){"use strict";n.d(s,"a",(function(){return getCompositeRect}));var o=n(19),a=n(101),u=n(12),f=n(5),g=n(36),_=n(13),b=n(38);function getCompositeRect(e,s,n){void 0===n&&(n=!1);var v=Object(f.b)(s),k=Object(f.b)(s)&&function isElementScaled(e){var s=e.getBoundingClientRect(),n=s.width/e.offsetWidth||1,o=s.height/e.offsetHeight||1;return 1!==n||1!==o}(s),x=Object(_.a)(s),C=Object(o.a)(e,k),E={scrollLeft:0,scrollTop:0},z={x:0,y:0};return(v||!v&&!n)&&(("body"!==Object(u.a)(s)||Object(b.a)(x))&&(E=Object(a.a)(s)),Object(f.b)(s)?((z=Object(o.a)(s,!0)).x+=s.clientLeft,z.y+=s.clientTop):x&&(z.x=Object(g.a)(x))),{x:C.left+E.scrollLeft-z.x,y:C.top+E.scrollTop-z.y,width:C.width,height:C.height}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return getNodeScroll}));var o=n(37),a=n(8),u=n(5),f=n(102);function getNodeScroll(e){return e!==Object(a.a)(e)&&Object(u.b)(e)?Object(f.a)(e):Object(o.a)(e)}},function(e,s,n){"use strict";function getHTMLElementScroll(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}n.d(s,"a",(function(){return getHTMLElementScroll}))},function(e,s,n){"use strict";function debounce(e){var s;return function(){return s||(s=new Promise((function(n){Promise.resolve().then((function(){s=void 0,n(e())}))}))),s}}n.d(s,"a",(function(){return debounce}))},function(e,s,n){"use strict";n.r(s),n.d(s,"ALIASES",(function(){return f})),n.d(s,"ICONS",(function(){return g})),n.d(s,"load",(function(){return load})),n.d(s,"maybeLoad",(function(){return maybeLoad}));var o=n(1),a=n(121),u=n.n(a);const f={ban:["ban","block"],ok:["ok","unban","untimeout"],"clock-o":["clock-o","clock","timeout"],times:["remove","close","times"],cog:["gear","cog"],repeat:["rotate-right","repeat"],outdent:["dedent","outdent"],"picture-o":["photo","image","picture-o"],"pencil-square-o":["edit","pencil-square-o"],share:["mail-forward","share"],"exclamation-triangle":["warning","exclamation-triangle"],"bar-chart":["bar-chart-o","bar-chart"],cogs:["gears","cogs"],facebook:["facebook-f","facebook"],rss:["feed","rss"],users:["group","users"],link:["chain","link"],scissors:["cut","scissors"],"files-o":["copy","files-o"],"floppy-o":["save","floppy-o"],bars:["navicon","reorder","bars"],sort:["unsorted","sort"],"sort-desc":["sort-down","sort-desc"],"sort-asc":["sort-up","sort-asc"],undo:["rotate-left","undo"],gavel:["legal","gavel"],tachometer:["dashboard","tachometer"],bolt:["flash","bolt"],clipboard:["paste","clipboard"],mobile:["mobile-phone","mobile"],reply:["mail-reply","reply"],"reply-all":["mail-reply-all","reply-all"],"star-half-o":["star-half-empty","star-half-full","star-half-o"],"chain-broken":["unlink","chain-broken"],"caret-square-o-down":["toggle-down","caret-square-o-down"],"caret-square-o-up":["toggle-up","caret-square-o-up"],"caret-square-o-right":["toggle-right","caret-square-o-right"],eur:["euro","eur"],usd:["dollar","usd"],inr:["rupee","inr"],jpy:["cny","rmb","yen","jpy"],rub:["ruble","rouble","rub"],krw:["won","krw"],btc:["bitcoin","btc"],gratipay:["gittip","gratipay"],"caret-square-o-left":["toggle-left","caret-square-o-left"],try:["turkish-lira","try"],university:["institution","bank","university"],"graduation-cap":["mortar-board","graduation-cap"],car:["automobile","car"],taxi:["cab","taxi"],"file-image-o":["file-photo-o","file-picture-o","file-image-o"],"file-archive-o":["file-zip-o","file-archive-o"],"file-audio-o":["file-sound-o","file-audio-o"],"file-video-o":["file-movie-o","file-video-o"],"life-ring":["life-bouy","life-buoy","life-saver","support","life-ring"],rebel:["ra","resistance","rebel"],empire:["ge","empire"],"hacker-news":["y-combinator-square","yc-square","hacker-news"],weixin:["wechat","weixin"],"paper-plane":["send","paper-plane"],"paper-plane-o":["send-o","paper-plane-o"],"futbol-o":["soccer-ball-o","futbol-o"],ils:["shekel","sheqel","ils"],transgender:["intersex","transgender"],bed:["hotel","bed"],"y-combinator":["yc","y-combinator"],"battery-full":["battery-4","battery","battery-full"],"battery-three-quarters":["battery-3","battery-three-quarters"],"battery-half":["battery-2","battery-half"],"battery-quarter":["battery-1","battery-quarter"],"battery-empty":["battery-0","battery-empty"],"hourglass-start":["hourglass-1","hourglass-start"],"hourglass-half":["hourglass-2","hourglass-half"],"hourglass-end":["hourglass-3","hourglass-end"],"hand-rock-o":["hand-grab-o","hand-rock-o"],"hand-paper-o":["hand-stop-o","hand-paper-o"],television:["tv","television"],"american-sign-language-interpreting":["asl-interpreting","american-sign-language-interpreting"],deaf:["deafness","hard-of-hearing","deaf"],"sign-language":["signing","sign-language"],"google-plus-official":["google-plus-circle","google-plus-official"],"font-awesome":["fa","font-awesome"],"address-card":["vcard","address-card"],"address-card-o":["vcard-o","address-card-o"],"id-card":["drivers-license","id-card"],"id-card-o":["drivers-license-o","id-card-o"],"thermometer-full":["thermometer-4","thermometer","thermometer-full"],"thermometer-three-quarters":["thermometer-3","thermometer-three-quarters"],"thermometer-half":["thermometer-2","thermometer-half"],"thermometer-quarter":["thermometer-1","thermometer-quarter"],"thermometer-empty":["thermometer-0","thermometer-empty"],bath:["bathtub","s15","bath"],"window-close":["times-rectangle","window-close"],"window-close-o":["times-rectangle-o","window-close-o"]},g=["glass","music","search","envelope-o","heart","star","star-o","user","film","th-large","th","th-list","check","times","search-plus","search-minus","power-off","signal","cog","trash-o","home","file-o","clock-o","road","download","arrow-circle-o-down","arrow-circle-o-up","inbox","play-circle-o","repeat","refresh","list-alt","lock","flag","headphones","volume-off","volume-down","volume-up","qrcode","barcode","tag","tags","book","bookmark","print","camera","font","bold","italic","text-height","text-width","align-left","align-center","align-right","align-justify","list","outdent","indent","video-camera","picture-o","pencil","map-marker","adjust","tint","pencil-square-o","share-square-o","check-square-o","arrows","step-backward","fast-backward","backward","play","pause","stop","forward","fast-forward","step-forward","eject","chevron-left","chevron-right","plus-circle","minus-circle","times-circle","check-circle","question-circle","info-circle","crosshairs","times-circle-o","check-circle-o","ban","arrow-left","arrow-right","arrow-up","arrow-down","share","expand","compress","plus","minus","asterisk","exclamation-circle","gift","leaf","fire","eye","eye-slash","exclamation-triangle","plane","calendar","random","comment","magnet","chevron-up","chevron-down","retweet","shopping-cart","folder","folder-open","arrows-v","arrows-h","bar-chart","twitter-square","facebook-square","camera-retro","key","cogs","comments","thumbs-o-up","thumbs-o-down","star-half","heart-o","sign-out","linkedin-square","thumb-tack","external-link","sign-in","trophy","github-square","upload","lemon-o","phone","square-o","bookmark-o","phone-square","twitter","facebook","github","unlock","credit-card","rss","hdd-o","bullhorn","bell","certificate","hand-o-right","hand-o-left","hand-o-up","hand-o-down","arrow-circle-left","arrow-circle-right","arrow-circle-up","arrow-circle-down","globe","wrench","tasks","filter","briefcase","arrows-alt","users","link","cloud","flask","scissors","files-o","paperclip","floppy-o","square","bars","list-ul","list-ol","strikethrough","underline","table","magic","truck","pinterest","pinterest-square","google-plus-square","google-plus","money","caret-down","caret-up","caret-left","caret-right","columns","sort","sort-desc","sort-asc","envelope","linkedin","undo","gavel","tachometer","comment-o","comments-o","bolt","sitemap","umbrella","clipboard","lightbulb-o","exchange","cloud-download","cloud-upload","user-md","stethoscope","suitcase","bell-o","coffee","cutlery","file-text-o","building-o","hospital-o","ambulance","medkit","fighter-jet","beer","h-square","plus-square","angle-double-left","angle-double-right","angle-double-up","angle-double-down","angle-left","angle-right","angle-up","angle-down","desktop","laptop","tablet","mobile","circle-o","quote-left","quote-right","spinner","circle","reply","github-alt","folder-o","folder-open-o","smile-o","frown-o","meh-o","gamepad","keyboard-o","flag-o","flag-checkered","terminal","code","reply-all","star-half-o","location-arrow","crop","code-fork","chain-broken","question","info","exclamation","superscript","subscript","eraser","puzzle-piece","microphone","microphone-slash","shield","calendar-o","fire-extinguisher","rocket","maxcdn","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-circle-down","html5","css3","anchor","unlock-alt","bullseye","ellipsis-h","ellipsis-v","rss-square","play-circle","ticket","minus-square","minus-square-o","level-up","level-down","check-square","pencil-square","external-link-square","share-square","compass","caret-square-o-down","caret-square-o-up","caret-square-o-right","eur","gbp","usd","inr","jpy","rub","krw","btc","file","file-text","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-numeric-asc","sort-numeric-desc","thumbs-up","thumbs-down","youtube-square","youtube","xing","xing-square","youtube-play","dropbox","stack-overflow","instagram","flickr","adn","bitbucket","bitbucket-square","tumblr","tumblr-square","long-arrow-down","long-arrow-up","long-arrow-left","long-arrow-right","apple","windows","android","linux","dribbble","skype","foursquare","trello","female","male","gratipay","sun-o","moon-o","archive","bug","vk","weibo","renren","pagelines","stack-exchange","arrow-circle-o-right","arrow-circle-o-left","caret-square-o-left","dot-circle-o","wheelchair","vimeo-square","try","plus-square-o","space-shuttle","slack","envelope-square","wordpress","openid","university","graduation-cap","yahoo","google","reddit","reddit-square","stumbleupon-circle","stumbleupon","delicious","digg","pied-piper-pp","pied-piper-alt","drupal","joomla","language","fax","building","child","paw","spoon","cube","cubes","behance","behance-square","steam","steam-square","recycle","car","taxi","tree","spotify","deviantart","soundcloud","database","file-pdf-o","file-word-o","file-excel-o","file-powerpoint-o","file-image-o","file-archive-o","file-audio-o","file-video-o","file-code-o","vine","codepen","jsfiddle","life-ring","circle-o-notch","rebel","empire","git-square","git","hacker-news","tencent-weibo","qq","weixin","paper-plane","paper-plane-o","history","circle-thin","header","paragraph","sliders","share-alt","share-alt-square","bomb","futbol-o","tty","binoculars","plug","slideshare","twitch","yelp","newspaper-o","wifi","calculator","paypal","google-wallet","cc-visa","cc-mastercard","cc-discover","cc-amex","cc-paypal","cc-stripe","bell-slash","bell-slash-o","trash","copyright","at","eyedropper","paint-brush","birthday-cake","area-chart","pie-chart","line-chart","lastfm","lastfm-square","toggle-off","toggle-on","bicycle","bus","ioxhost","angellist","cc","ils","meanpath","buysellads","connectdevelop","dashcube","forumbee","leanpub","sellsy","shirtsinbulk","simplybuilt","skyatlas","cart-plus","cart-arrow-down","diamond","ship","user-secret","motorcycle","street-view","heartbeat","venus","mars","mercury","transgender","transgender-alt","venus-double","mars-double","venus-mars","mars-stroke","mars-stroke-v","mars-stroke-h","neuter","genderless","facebook-official","pinterest-p","whatsapp","server","user-plus","user-times","bed","viacoin","train","subway","medium","y-combinator","optin-monster","opencart","expeditedssl","battery-full","battery-three-quarters","battery-half","battery-quarter","battery-empty","mouse-pointer","i-cursor","object-group","object-ungroup","sticky-note","sticky-note-o","cc-jcb","cc-diners-club","clone","balance-scale","hourglass-o","hourglass-start","hourglass-half","hourglass-end","hourglass","hand-rock-o","hand-paper-o","hand-scissors-o","hand-lizard-o","hand-spock-o","hand-pointer-o","hand-peace-o","trademark","registered","creative-commons","gg","gg-circle","tripadvisor","odnoklassniki","odnoklassniki-square","get-pocket","wikipedia-w","safari","chrome","firefox","opera","internet-explorer","television","contao","500px","amazon","calendar-plus-o","calendar-minus-o","calendar-times-o","calendar-check-o","industry","map-pin","map-signs","map-o","map","commenting","commenting-o","houzz","vimeo","black-tie","fonticons","reddit-alien","edge","credit-card-alt","codiepie","modx","fort-awesome","usb","product-hunt","mixcloud","scribd","pause-circle","pause-circle-o","stop-circle","stop-circle-o","shopping-bag","shopping-basket","hashtag","bluetooth","bluetooth-b","percent","gitlab","wpbeginner","wpforms","envira","universal-access","wheelchair-alt","question-circle-o","blind","audio-description","volume-control-phone","braille","assistive-listening-systems","american-sign-language-interpreting","deaf","glide","glide-g","sign-language","low-vision","viadeo","viadeo-square","snapchat","snapchat-ghost","snapchat-square","pied-piper","first-order","yoast","themeisle","google-plus-official","font-awesome","handshake-o","envelope-open","envelope-open-o","linode","address-book","address-book-o","address-card","address-card-o","user-circle","user-circle-o","user-o","id-badge","id-card","id-card-o","quora","free-code-camp","telegram","thermometer-full","thermometer-three-quarters","thermometer-half","thermometer-quarter","thermometer-empty","shower","bath","podcast","window-maximize","window-minimize","window-restore","window-close","window-close-o","bandcamp","grav","etsy","imdb","ravelry","eercast","microchip","snowflake-o","superpowers","wpexplorer","meetup"];let _=!1;const load=()=>{_||(_=!0,document.head.appendChild(Object(o.createElement)("link",{href:u.a,rel:"stylesheet",type:"text/css",crossOrigin:"anonymous"})))},maybeLoad=e=>{_||!String(e).startsWith("fa-")&&!String(e).startsWith("ffz-fa")||load()}},,function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return TooltipProvider}));var o=n(1),a=n(0),u=n(27),f=n(4),g=n(51);class TooltipProvider extends f.default{constructor(...e){super(...e),this.types={},this.inject("i18n"),this.should_enable=!0,this.types.json=e=>{const s=e.dataset.title;return[s&&Object(o.createElement)("strong",null,s),Object(o.createElement)("code",{className:"block"+(s?" pd-t-05 border-t mg-t-05":""),style:{fontFamily:"monospace",textAlign:"left"}},e.dataset.data)]},this.types.child=e=>{const s=e.querySelector(":scope > .ffz-tooltip-child");return s?(e._ffz_child=s,s.remove(),s.classList.remove("ffz-tooltip-child"),s):null},this.types.child.onHide=e=>{const s=e._ffz_child;s&&(e._ffz_child=null,s.remove(),e.querySelector(":scope > .ffz-tooltip-child")||(s.classList.add("ffz-tooltip-child"),e.appendChild(s)))},this.types.markdown=(e,s)=>{s.add_class="ffz-tooltip--markdown";const n=Object(g.b)();return n?n.render(e.dataset.title):Object(g.a)().then((s=>s.render(e.dataset.title)))},this.types.text=e=>Object(o.sanitize)(e.dataset.title),this.types.html=e=>e.dataset.title,this.onFSChange=this.onFSChange.bind(this)}onEnable(){const e=this.getRoot();window.addEventListener("fullscreenchange",this.onFSChange),this.container=e,this.tip_element=e,this.tips=this._createInstance(e),this.on(":cleanup",this.cleanup)}getRoot(){return document.querySelector(".sunlight-root")||document.querySelector("#root>div")||document.querySelector("#root")||document.querySelector(".clips-root")||document.body}_createInstance(e,s="ffz-tooltip",n="text",o){return new u.default(e,s,{html:!0,i18n:this.i18n,live:!0,check_modifiers:!0,container:o||e,delayHide:this.checkDelayHide.bind(this,n),delayShow:this.checkDelayShow.bind(this,n),content:this.process.bind(this,n),interactive:this.checkInteractive.bind(this,n),hover_events:this.checkHoverEvents.bind(this,n),onShow:this.delegateOnShow.bind(this,n),onHide:this.delegateOnHide.bind(this,n),popperConfig:this.delegatePopperConfig.bind(this,n),popper:{placement:"top",modifiers:{flip:{}}},onHover:(e,s,n)=>{this.emit(":hover",e,s,n)},onLeave:(e,s,n)=>{this.emit(":leave",e,s,n)}})}onFSChange(){const e=document.fullscreenElement||this.container;e!==this.tip_element&&(this.tips.destroy(),this.tip_element=e,this.tips=this._createInstance(e))}cleanup(){this.tips.cleanup()}delegatePopperConfig(e,s,n,o){const a=s.dataset.tooltipType||e,u=this.types[a];return s.dataset.tooltipSide&&(o.placement=s.dataset.tooltipSide),u&&u.popperConfig?u.popperConfig(s,n,o):o}delegateOnShow(e,s,n){const o=s.dataset.tooltipType||e,a=this.types[o];a&&a.onShow&&a.onShow(s,n)}delegateOnHide(e,s,n){const o=s.dataset.tooltipType||e,a=this.types[o];a&&a.onHide&&a.onHide(s,n)}checkDelayShow(e,s,n){const o=s.dataset.tooltipType||e,u=this.types[o];return Object(a.has)(u,"delayShow")?Object(a.maybe_call)(u.delayShow,null,s,n):0}checkDelayHide(e,s,n){const o=s.dataset.tooltipType||e,u=this.types[o];return Object(a.has)(u,"delayHide")?Object(a.maybe_call)(u.delayHide,null,s,n):0}checkInteractive(e,s,n){const o=s.dataset.tooltipType||e,u=this.types[o];return!!Object(a.has)(u,"interactive")&&Object(a.maybe_call)(u.interactive,null,s,n)}checkHoverEvents(e,s,n){const o=s.dataset.tooltipType||e,u=this.types[o];return!!Object(a.has)(u,"hover_events")&&Object(a.maybe_call)(u.hover_events,null,s,n)}process(e,s,n){const a=s.dataset.tooltipType||e||"text",u=s.dataset.tooltipAlign,f=this.types[a];return u&&(n.align=u),f?f(s,n):[Object(o.createElement)("strong",null,"Unhandled Tooltip Type"),Object(o.createElement)("code",{className:"tw-block pd-t-05 border-t mg-t-05",style:{fontFamily:"monospace",textAlign:"left"}},JSON.stringify(s.dataset,null,4))]}}},function(e,s){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"setID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProduct"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:213}};n.loc.source={body:"query FFZ_GetEmoteInfo($id: ID!) {\n\temote(id: $id) {\n\t\tid\n\t\towner {\n\t\t\tid\n\t\t\tlogin\n\t\t\tdisplayName\n\t\t}\n\t\tsetID\n\t\ttext\n\t\tsubscriptionProduct {\n\t\t\tid\n\t\t\tstate\n\t\t\towner {\n\t\t\t\tid\n\t\t\t\tlogin\n\t\t\t\tdisplayName\n\t\t\t}\n\t\t}\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function collectFragmentReferences(e,s){if("FragmentSpread"===e.kind)s.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&s.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,s)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,s)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,s)}))}var o={};function findOperation(e,s){for(var n=0;n<e.definitions.length;n++){var o=e.definitions[n];if(o.name&&o.name.value==s)return o}}!function extractReferences(){n.definitions.forEach((function(e){if(e.name){var s=new Set;collectFragmentReferences(e,s),o[e.name.value]=s}}))}(),e.exports=n,e.exports.FFZ_GetEmoteInfo=function oneQuery(e,s){var n={kind:e.kind,definitions:[findOperation(e,s)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var a=o[s]||new Set,u=new Set,f=new Set;for(a.forEach((function(e){f.add(e)}));f.size>0;){var g=f;f=new Set,g.forEach((function(e){u.has(e)||(u.add(e),(o[e]||new Set).forEach((function(e){f.add(e)})))}))}return u.forEach((function(s){var o=findOperation(e,s);o&&n.definitions.push(o)})),n}(n,"FFZ_GetEmoteInfo")},function(e,s,n){"use strict";n.r(s),n.d(s,"Dialog",(function(){return Dialog}));var o=n(7),a=n(16);class Dialog extends o.EventEmitter{constructor(e,s={}){super(),this.selectors={exclusive:Dialog.EXCLUSIVE,maximized:Dialog.MAXIMIZED,normal:Dialog.SELECTOR},s.selectors&&(this.selectors=Object.assign(this.selectors,s.selectors)),this._maximized=s.maximized||!1,this._exclusive=s.exclusive||!1,this.prepend=s.prepend||!1,this._element=null,this._visible=!1,"function"==typeof e?this.factory=e:this.element=e}get maximized(){return this._exclusive||this._maximized}set maximized(e){(e=Boolean(e))!==this._maximized&&(this._visible?this.toggleSize():this._maximized=e)}get visible(){return this._visible}set visible(e){(e=Boolean(e))!==this._visible&&this.toggleVisible()}get exclusive(){return this._exclusive}set exclusive(e){if(this._visible)throw new Error("cannot set exclusive flag when dialog already visible");this._exclusive=e}get element(){return this._element}set element(e){if(this._visible)throw new Error("cannot change element when dialog already visible");if(!(e instanceof Node))throw new Error("element must be an instance of Node");this._element=e}show(){this.visible=!0}hide(){this.visible=!1}maximize(){this.maximized=!0}restore(){this.maximized=!1}getContainer(){return document.querySelector(this._exclusive?this.selectors.exclusive:this._maximized?this.selectors.maximized:this.selectors.normal)}toggleVisible(e){if(e&&0!==e.button)return;const s=this.maximized,n=this._visible=!this._visible,o=this.getContainer();if(s&&o&&o.classList.toggle("ffz-has-dialog",n),!n)return this._element&&this._element.remove(),this.emit("hide"),void(this.factory&&(this._element=null));if(o){if(this.factory){const e=this.factory();if(e instanceof Promise)return void e.then((e=>{this._element=e,this.prepend?o.insertBefore(e,o.firstChild):o.appendChild(e),this.emit("show")})).catch((e=>{this.emit("error",e)}));this._element=e}this.prepend?o.insertBefore(this._element,o.firstChild):o.appendChild(this._element),this.emit("show")}}toggleSize(e){if(!this._visible||e&&0!==e.button||!this._element)return;this._maximized=!this._maximized;const s=this.maximized,n=this.getContainer(),o=this._element.parentElement;n!==o&&(s?n&&n.classList.add("ffz-has-dialog"):o&&o.classList.remove("ffz-has-dialog"),this._element.remove(),n&&(this.prepend?n.insertBefore(this._element,n.firstChild):n.appendChild(this._element)),this.emit("resize"))}}Dialog.lastZ=99999999,Dialog.EXCLUSIVE=a.a.DIALOG_EXCLUSIVE,Dialog.MAXIMIZED=a.a.DIALOG_MAXIMIZED,Dialog.SELECTOR=a.a.DIALOG_SELECTOR,s.default=Dialog},function(e,s,n){"use strict";n.r(s),n.d(s,"MERGE_METHODS",(function(){return o})),n.d(s,"mergeList",(function(){return mergeList})),n.d(s,"default",(function(){return merge}));const o={Document:(e,s)=>(e.definitions&&s.definitions?e.definitions=mergeList(e.definitions,s.definitions):s.definitions&&(e.definitions=s.definitions),e),Field:(e,s)=>!e.name||s.name&&s.name.value===e.name.value?(e.selectionSet&&s.selectionSet?e.selectionSet=merge(e.selectionSet,s.selectionSet):s.selectionSet&&(e.selectionSet=s.selectionSet),e):e,OperationDefinition:(e,s)=>(e.operation!==s.operation||(e.selectionSet&&s.selectionSet?e.selectionSet=merge(e.selectionSet,s.selectionSet):s.selectionSet&&(e.selectionSet=s.selectionSet)),e),FragmentDefinition:(e,s)=>{if(e.typeCondition&&s.typeCondition){if(e.typeCondition.kind!==s.typeCondition.kind)return e;if(e.typeCondition.name.value!=s.typeCondition.name.value)return e}return e.selectionSet&&s.selectionSet?e.selectionSet=merge(e.selectionSet,s.selectionSet):s.selectionSet&&(e.selectionSet=s.selectionSet),e},SelectionSet:(e,s)=>(e.selections&&s.selections?e.selections=mergeList(e.selections,s.selections):s.selections&&(e.selections=s.selections),e)};function mergeList(e,s){let n=!1;const o={};for(const s of e)s&&s.name&&"Name"===s.name.kind&&(s.operation&&(n=!0),o[s.name.value]=s);for(const a of s){if(!a||!a.name||"Name"!==a.name.kind)continue;const s=a.name.value,u=o[s]?e.indexOf(o[s]):-1;if(-1!==u){if(e[u].operation&&a.operation&&e[u].operation!==a.operation)continue;e[u]=merge(e[u],a),e[u].operation&&(n=!0)}else{if(n&&a.operation)continue;e.push(a)}}return e}function merge(e,s){return e.kind!==s.kind?e:o[e.kind]?o[e.kind](e,s):e}},function(e,s,n){"use strict";n.r(s),n.d(s,"ApolloEvent",(function(){return ApolloEvent})),n.d(s,"GQLError",(function(){return GQLError})),n.d(s,"default",(function(){return Apollo}));var o=n(4),a=n(0),u=n(109),f=n(7);class ApolloEvent extends f.FFZEvent{constructor(e){super(e),this._changed=!1}markChanged(){return this._changed=!0,this}}class GQLError extends Error{constructor(e){super(`${e.message}; Location: ${e.locations}`)}}class Apollo extends o.default{constructor(...e){super(...e),this.modifiers={},this.post_modifiers={},this.inject("..fine")}get gqlPrint(){var e;if(this._gql_print)return this._gql_print;const s=this.resolve("site.web_munch");return this._gql_print=null==s||null===(e=s.getModule)||void 0===e?void 0:e.call(s,"gql-printer")}onEnable(){let e=this.client;if(!e){var s;const a=this.fine.react,g=a&&a.stateNode;if(e=null==g||null===(s=g.props)||void 0===s?void 0:s.client,a&&!e){let s=0,g=a;for(;(null===(n=e)||void 0===n||!n.queryManager)&&g&&s++<20;){var n,o,u,f;e=null===(o=g)||void 0===o||null===(u=o.memoizedProps)||void 0===u?void 0:u.client,g=null===(f=g)||void 0===f?void 0:f.child}if(!e){const s=this.fine.searchTree(null,(e=>{var s,n;return null===(s=e.props)||void 0===s||null===(n=s.client)||void 0===n?void 0:n.queryManager}),500);s&&(e=s.props.client)}}this.client=e}if(!e)return new Promise((()=>this.onEnable()),50);if(!this.client.link||!this.client.queryManager||!this.client.queryManager.link)return void this.log.error("Apollo does not have a Link. We are unable to manipulate queries.");this.hooked_query_init=!1;const g=this,_=this.client.queryManager.constructor.prototype,b=_.getCurrentQueryResult;if(_.getCurrentQueryResult=function(e,s=!0){const n=b.call(this,e,s);if(n&&n.partial)try{try{const n=e.getLastResult(),o=e.options;this.dataStore.getCache().read({query:o.query,variables:o.variables,previousResult:n?n.data:void 0,optimistic:s})}catch(s){if(s.toString().includes("Can't find field")&&e.lastResult&&!e.lastResult.loading&&!e.lastError&&Date.now()-(e._ffz_last_retry||0)>=12e4){const s=Object(a.get)("options.query.definitions.0.name",e),n=s&&"Name"===s.kind?s.value:`#${e.queryId}`;g.log.info("Forcing query to refetch due to missing field:",n),e._ffz_last_retry=Date.now(),e.refetch()}}}catch(e){g.log.capture(e)}return n},this.client.queryManager.queryStore){const e=this.client.queryManager.queryStore.initQuery;this.hooked_query_init=!0,this.client.queryManager.queryStore.initQuery=function(s){const n=this.store[s.queryId];return n&&n.queryString!==s.queryString&&(n.queryString=s.queryString),e.call(this,s)}}const v=this.ApolloLink=this.client.link.constructor;this.link=new v(((e,s)=>{if(!this.enabled)return s(e);let n=e.variables;Object.keys(n).length||(n=void 0);try{this.hooked_query_init&&this.apolloPreFlight(e)}catch(o){return this.log.capture(o,{tags:{operation:e.operationName},extra:{variables:n}}),this.log.error("Error running Pre-Flight",o,e),s(e)}return s(e).map((s=>{s.extensions&&s.extensions.operationName===e.operationName&&this.log.crumb({level:"info",category:"gql",message:`${e.operationName} [${s.extensions&&s.extensions.durationMilliseconds||"??"}ms]`,data:{variables:n}});try{this.apolloPostFlight(s)}catch(o){this.log.capture(o,{tags:{operation:e.operationName},extra:{variables:n}}),this.log.error("Error running Post-Flight",o,s)}return s}))})),this.old_link=this.client.link,this.old_qm_link=this.client.queryManager.link,this.client.link=v.from([this.link,this.old_link]),this.client.queryManager.link=v.from([this.link,this.old_qm_link])}onDisable(){this.client=this.printer=this._gql_print=this.old_link=this.old_qm_dedup=this.old_qm_link=null}apolloPreFlight(e){const s=e.operationName,n=this.modifiers[s],o=`:request.${s}`,a=this.hasListeners(o);if(!n&&!a)return;const u=this.client.queryManager,f=u&&u.queryIdsByName,g=u&&u.queries,_=f&&f[s],b=Array.isArray(_)?_[0]:_,v=g&&g.get(b);if(n)for(const s of n)"function"==typeof s?s(e):s[1]&&this.applyModifier(e,s[1]);let k=!!n;if(a){const n=new ApolloEvent({operation:s,request:e});this.emit(o,n),n._changed&&(k=!0)}if(k){const n=this.client.queryManager.queryStore.store[b],o=this.gqlPrint&&this.gqlPrint(e.query);n&&(o?(n.queryString=o,e.query.loc.source.body=o,e.query.loc.end=o.length,v&&(v.document=e.query,v.observableQuery&&v.observableQuery.options&&(v.observableQuery.options.query=e.query))):(this.log.info("Unable to find GQL Print. Clearing store for query:",s),this.client.queryManager.queryStore.store[b]=null))}}apolloPostFlight(e){if(!e.extensions)return;const s=e.extensions.operationName,n=this.post_modifiers[s];if(n)for(const s of n)s(e);this.emit(`:response.${s}`,e.data)}applyModifier(e,s){e.query=Object(u.default)(e.query,s)}registerModifier(e,s,n=!0){if("function"!=typeof s){if(!n)throw new Error("post modifiers must be functions");s=[s,s]}(n?this.modifiers[e]=this.modifiers[e]||[]:this.post_modifiers[e]=this.post_modifiers[e]||[]).push(s)}unregisterModifier(e,s,n=!0){const o=n?this.modifiers[e]:this.post_modifiers[e];if(o){if("function"!=typeof s)throw new Error("graphql modifiers cannot be removed");for(let e=0;e<o.length;e++){const n=o[e];if("function"==typeof n?n===s:n[0]===s)return void o.splice(e,1)}}}getQuery(e){const s=this.client.queryManager,n=s&&s.queryIdsByName,o=s&&s.queries,a=n&&n[e],u=o&&a&&o.get(Array.isArray(a)?a[0]:a);return o||this.warn_qm||(this.log.error("Unable to find the Apollo query map. We cannot access data properly."),this.warn_qm=!0),u&&u.observableQuery}maybeRefetch(e){const s=this.getQuery(e);s&&s.lastResult&&!s.lastResult.stale&&s.refetch()}ensureQuery(e,s,n=500,o=12e4){const u=this.getQuery(e);if(u){const e=u.lastResult;let f;f=!!e&&(!!e.loading||("function"==typeof s?s(e):void 0!==Object(a.get)(s,e))),!f&&Date.now()-(u._ffz_last_retry||0)>=o&&(u._ffz_last_retry=Date.now(),u.options.query=Object.assign({},u.options.query),0===n?u.refetch():n>0&&setTimeout((()=>{u.refetch()}),n))}return u}getFromQuery(e,s,n=500,o=12e4){const u=this.getQuery(e),f=u&&u.lastResult;if(!u)return;let g;return f&&(g="function"==typeof s?s(f):Object(a.get)(s,f),f.loading)?void 0:(void 0===g&&Date.now()-(u._ffz_last_retry||0)>=o&&(u._ffz_last_retry=Date.now(),u.options.query=Object.assign({},u.options.query),0===n?u.refetch():n>0&&setTimeout((()=>u.refetch()),n)),g)}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return TwitchData}));var o=n(4),a=n(0);const u=/^auto___lang_(\w+)$/;class TwitchData extends o.default{constructor(...e){super(...e),this.site=this.parent,this.inject("site.apollo"),this._waiting_user_ids=new Map,this._waiting_user_logins=new Map,this._waiting_stream_ids=new Map,this._waiting_stream_logins=new Map,this.tag_cache=new Map,this._waiting_tags=new Map,this._loadTags=Object(a.debounce)(this._loadTags,50),this._loadStreams=Object(a.debounce)(this._loadStreams,50)}queryApollo(e,s,n){let o;return s||n||!e.query?(o={query:e,variables:s},n&&(o=Object.assign(o,n))):o=e,this.apollo.client.query(o)}mutate(e,s,n){let o;return s||n||!e.mutation?(o={mutation:e,variables:s},n&&(o=Object.assign(o,n))):o=e,this.apollo.client.mutate(o)}get languageCode(){const e=this.site.getSession();return e&&e.languageCode||"en"}get locale(){const e=this.site.getSession();return e&&e.locale||"en-US"}async getBadges(){const e=await this.queryApollo(await n.e(157).then(n.t.bind(null,340,7)));return Object(a.get)("data.badges",e)}async getMatchingCategories(e,s=15,o=null){var u;const f=await this.queryApollo(await n.e(157).then(n.t.bind(null,341,7)),{query:e,first:s,cursor:o}),g=null!==(u=Object(a.get)("data.searchCategories.edges.@each.node",f))&&void 0!==u?u:[],_=e.toLowerCase();return Array.isArray(g)&&g.sort(((e,s)=>{var n,o,a,u,f,g,b,v;const k=e&&((null===(n=e.name)||void 0===n||null===(o=n.toLowerCase)||void 0===o?void 0:o.call(n))===_||(null==e||null===(a=e.displayName)||void 0===a||null===(u=a.toLowerCase)||void 0===u?void 0:u.call(a))===_),x=e&&((null===(f=s.name)||void 0===f||null===(g=f.toLowerCase)||void 0===g?void 0:g.call(f))===_||(null==s||null===(b=s.displayName)||void 0===b||null===(v=b.toLowerCase)||void 0===v?void 0:v.call(b))===_);return k&&!x?-1:!k&&x?1:0})),{cursor:Object(a.get)("data.searchCategories.edges.@last.cursor",f),items:g,finished:!Object(a.get)("data.searchCategories.pageInfo.hasNextPage",f),count:Object(a.get)("data.searchCategories.totalCount",f)||0}}async getCategory(e,s){const o=await this.queryApollo(await n.e(157).then(n.t.bind(null,342,7)),{id:e,name:s});return Object(a.get)("data.game",o)}async getMatchingUsers(e,s=15,o=null){var u;const f=await this.queryApollo(await n.e(157).then(n.t.bind(null,343,7)),{query:e,first:s,cursor:o}),g=null!==(u=Object(a.get)("data.searchUsers.edges.@each.node",f))&&void 0!==u?u:[],_=e.toLowerCase();return Array.isArray(g)&&g.sort(((e,s)=>{var n,o,a,u,f,g,b,v;const k=e&&((null===(n=e.login)||void 0===n||null===(o=n.toLowerCase)||void 0===o?void 0:o.call(n))===_||(null==e||null===(a=e.displayName)||void 0===a||null===(u=a.toLowerCase)||void 0===u?void 0:u.call(a))===_),x=e&&((null===(f=s.login)||void 0===f||null===(g=f.toLowerCase)||void 0===g?void 0:g.call(f))===_||(null==s||null===(b=s.displayName)||void 0===b||null===(v=b.toLowerCase)||void 0===v?void 0:v.call(b))===_);return k&&!x?-1:!k&&x?1:0})),{cursor:Object(a.get)("data.searchUsers.edges.@last.cursor",f),items:g,finished:!Object(a.get)("data.searchUsers.pageInfo.hasNextPage",f),count:Object(a.get)("data.searchUsers.totalCount",f)||0}}async getUser(e,s){const o=await this.queryApollo(await n.e(157).then(n.t.bind(null,344,7)),{id:e,login:s});return Object(a.get)("data.user",o)}async getUserGame(e,s){const o=await this.queryApollo(await n.e(157).then(n.t.bind(null,345,7)),{id:e,login:s});return Object(a.get)("data.user.broadcastSettings.game",o)}async getUserSelf(e,s){const o=await this.queryApollo(await n.e(157).then(n.t.bind(null,346,7)),{id:e,login:s});return Object(a.get)("data.user.self",o)}async getLastBroadcast(e,s){const o=await this.queryApollo(await n.e(157).then(n.t.bind(null,347,7)),{id:e,login:s});return Object(a.get)("data.user.lastBroadcast",o)}getUserBasic(e,s){return new Promise(((n,o)=>{e?this._waiting_user_ids.has(e)?this._waiting_user_ids.get(e).push([n,o]):this._waiting_user_ids.set(e,[[n,o]]):s?this._waiting_user_logins.has(s)?this._waiting_user_logins.get(s).push([n,o]):this._waiting_user_logins.set(s,[[n,o]]):o("id and login cannot both be null"),this._loading_users||this._loadUsers()}))}async _loadUsers(){if(this._loading_users)return;this._loading_users=!0;const e=[...this._waiting_user_ids.keys()].slice(0,50),s=50-e.length,o=s>0?[...this._waiting_user_logins.keys()].slice(0,s):[];let u;try{const s=await this.queryApollo({query:await n.e(157).then(n.t.bind(null,348,7)),variables:{ids:e.length?e:null,logins:o.length?o:null}});u=Object(a.get)("data.users",s)}catch(s){for(const n of e){const e=this._waiting_user_ids.get(n);this._waiting_user_ids.delete(n);for(const n of e)n[1](s)}for(const e of o){const n=this._waiting_user_logins.get(e);this._waiting_user_logins.delete(e);for(const e of n)e[1](s)}return}const f=new Set(e),g=new Set(o);if(Array.isArray(u))for(const e of u){if(!e||!e.id)continue;f.delete(e.id),g.delete(e.login);let s=this._waiting_user_ids.get(e.id);if(s){this._waiting_user_ids.delete(e.id);for(const n of s)n[0](e)}if(s=this._waiting_user_logins.get(e.login),s){this._waiting_user_logins.delete(e.login);for(const n of s)n[0](e)}}for(const e of f){const s=this._waiting_user_ids.get(e);if(s){this._waiting_user_ids.delete(e);for(const e of s)e[0](null)}}for(const e of g){const s=this._waiting_user_logins.get(e);if(s){this._waiting_user_logins.delete(e);for(const e of s)e[0](null)}}this._loading_users=!1,(this._waiting_user_ids.size||this._waiting_user_logins.size)&&this._loadUsers()}async getBroadcastID(e,s){const o=await this.queryApollo({query:await n.e(157).then(n.t.bind(null,349,7)),variables:{id:e,login:s}});return Object(a.get)("data.user.stream.archiveVideo.id",o)}async getChannelColor(e,s){const o=await this.queryApollo({query:await n.e(157).then(n.t.bind(null,350,7)),variables:{id:e,login:s}});return Object(a.get)("data.user.primaryColorHex",o)}async getPoll(e){const s=await this.queryApollo({query:await n.e(157).then(n.t.bind(null,351,7)),variables:{id:e}});return Object(a.get)("data.poll",s)}async createPoll(e,s,o,u={}){if("string"!=typeof s)throw new TypeError("title must be string");if(!Array.isArray(o)||o.some((e=>"string"!=typeof e)))throw new TypeError("choices must be array of strings");let f=u.bits||0,g=u.duration||60;("number"!=typeof f||f<0)&&(f=0),("number"!=typeof g||g<0)&&(g=60);const _=await this.mutate({mutation:await n.e(157).then(n.t.bind(null,352,7)),variables:{input:{bitsCost:f,bitsVoting:f>0,choices:o.map((e=>({title:e}))),durationSeconds:g,ownedBy:`${e}`,subscriberMultiplier:u.subscriberMultiplier||!1,subscriberOnly:u.subscriberOnly||!1,title:s}}});return Object(a.get)("data.createPoll.poll",_)}async archivePoll(e){const s=await this.mutate({mutation:await n.e(157).then(n.t.bind(null,353,7)),variables:{id:e}});return Object(a.get)("data.archivePoll.poll",s)}async terminatePoll(e){const s=await this.mutate({mutation:await n.e(157).then(n.t.bind(null,354,7)),variables:{id:e}});return Object(a.get)("data.terminatePoll.poll",s)}getStreamMeta(e,s){return new Promise(((n,o)=>{e?this._waiting_stream_ids.has(e)?this._waiting_stream_ids.get(e).push([n,o]):this._waiting_stream_ids.set(e,[[n,o]]):s?this._waiting_stream_logins.has(s)?this._waiting_stream_logins.get(s).push([n,o]):this._waiting_stream_logins.set(s,[[n,o]]):o("id and login cannot both be null"),this._loading_streams||this._loadStreams()}))}async _loadStreams(){if(this._loading_streams)return;this._loading_streams=!0;const e=[...this._waiting_stream_ids.keys()].slice(0,50),s=50-e.length,o=s>0?[...this._waiting_stream_logins.keys()].slice(0,s):[];let u;try{const s=await this.queryApollo({query:await n.e(157).then(n.t.bind(null,355,7)),variables:{ids:e.length?e:null,logins:o.length?o:null}});u=Object(a.get)("data.users",s)}catch(s){for(const n of e){const e=this._waiting_stream_ids.get(n);this._waiting_stream_ids.delete(n);for(const n of e)n[1](s)}for(const e of o){const n=this._waiting_stream_logins.get(e);this._waiting_stream_logins.delete(e);for(const e of n)e[1](s)}return}const f=new Set(e),g=new Set(o);if(Array.isArray(u))for(const e of u){if(!e||!e.id)continue;f.delete(e.id),g.delete(e.login);let s=this._waiting_stream_ids.get(e.id);if(s){this._waiting_stream_ids.delete(e.id);for(const n of s)n[0](e.stream)}if(s=this._waiting_stream_logins.get(e.login),s){this._waiting_stream_logins.delete(e.login);for(const n of s)n[0](e.stream)}}for(const e of f){const s=this._waiting_stream_ids.get(e);if(s){this._waiting_stream_ids.delete(e);for(const e of s)e[0](null)}}for(const e of g){const s=this._waiting_stream_logins.get(e);if(s){this._waiting_stream_logins.delete(e);for(const e of s)e[0](null)}}this._loading_streams=!1,(this._waiting_stream_ids.size||this._waiting_stream_logins.size)&&this._loadStreams()}memorizeTag(e,s=!0){if(!(e&&e.id&&e.tagName&&e.localizedName))return;let n=this.tag_cache.get(e.id);if(!n){const s=e.isLanguageTag&&u.exec(e.tagName),o=s&&s[1]||null;n={id:e.id,value:e.id,is_auto:e.isAutomated,is_language:e.isLanguageTag,language:o,name:e.tagName,scope:e.scope},this.tag_cache.set(e.id,n)}if(e.localizedName&&(n.label=e.localizedName),e.localizedDescription&&(n.description=e.localizedDescription),s&&n.description&&this._waiting_tags.has(n.id)){const e=this._waiting_tags.get(n.id);this._waiting_tags.delete(n.id);for(const s of e)s[0](n)}return n}async _loadTags(){if(this._loading_tags)return;this._loading_tags=!0;const e=[...this._waiting_tags.keys()].slice(0,50);let s;try{const o=await this.queryApollo(await n.e(157).then(n.t.bind(null,356,7)),{ids:e});s=Object(a.get)("data.contentTags",o)}catch(s){for(const n of e){const e=this._waiting_tags.get(n);this._waiting_tags.delete(n);for(const n of e)n[1](s)}return}const o=new Set(e);if(Array.isArray(s))for(const e of s){const s=this.memorizeTag(e,!1),n=this._waiting_tags.get(s.id);if(this._waiting_tags.delete(s.id),o.delete(s.id),n)for(const e of n)e[0](s)}for(const e of o){const s=this._waiting_tags.get(e);this._waiting_tags.delete(e);for(const e of s)e[0](null)}this._loading_tags=!1,this._waiting_tags.size&&this._loadTags()}getTag(e,s=!1){if(e&&e.id&&(e=e.id),this.tag_cache.has(e)){const n=this.tag_cache.get(e);if(n&&(n.description||!s))return Promise.resolve(n)}return new Promise(((s,n)=>{this._waiting_tags.has(e)?this._waiting_tags.get(e).push([s,n]):(this._waiting_tags.set(e,[[s,n]]),this._loading_tags||this._loadTags())}))}getTagImmediate(e,s,n=!1){e&&e.id&&(e=e.id);let o=null;if(this.tag_cache.has(e)&&(o=this.tag_cache.get(e)),n&&(!o||!o.description)||!o&&s){const o=this.getTag(e,n);s&&o.then((n=>s(e,n))).catch((n=>s(e,null,n)))}return o}async getTopTags(e=50){const s=await this.queryApollo(await n.e(157).then(n.t.bind(null,357,7)),{limit:e}),o=Object(a.get)("data.topTags",s);if(!Array.isArray(o))return[];const u=[],f=new Set;for(const e of o)e&&!f.has(e.id)&&(f.add(e.id),u.push(this.memorizeTag(e)));return u}getLanguagesFromTags(e,s){const n=[],o=s?Object(a.debounce)((()=>{this.getLanguagesFromTags(e,s)}),16):null;if(Array.isArray(e))for(const s of e){const e=this.getTagImmediate(s,o);if(e&&e.is_language){const s=u.exec(e.name);s&&n.push(s[1])}}return n}async getMatchingTags(e,s,o=null){var a;const u=await this.queryApollo({query:await n.e(157).then(n.t.bind(null,358,7)),variables:{query:e,categoryID:o||null,limit:100}}),f=null==u||null===(a=u.data)||void 0===a?void 0:a.searchLiveTags;if(!Array.isArray(f)||!f.length)return[];const g=[];for(const e of f){const s=this.memorizeTag(e);s&&g.push(s)}return g}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return Actions}));var o=n(4),a=n(0),u=n(1),f=n(27),g=n(77),_=n(78),b=n(67);const v=/\{\{(.*?)(?:\|(.*?))?\}\}/g;class Actions extends o.default{constructor(...e){super(...e),this.inject("settings"),this.inject("tooltips"),this.inject("i18n"),this.actions={},this.renderers={},this.settings.add("chat.actions.size",{default:16,ui:{path:'Chat > Actions @{"always_list_pages": true} >> Appearance',title:"Action Size",description:"How tall actions should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.actions.reasons",{default:[{v:{text:"One-Man Spam",i18n:"chat.reasons.spam"}},{v:{text:"Posting Bad Links",i18n:"chat.reasons.links"}},{v:{text:"Ban Evasion",i18n:"chat.reasons.evasion"}},{v:{text:"Threats / Personal Info",i18n:"chat.reasons.personal"}},{v:{text:"Hate / Harassment",i18n:"chat.reasons.hate"}},{v:{text:"Ignoring Broadcaster / Moderators",i18n:"chat.reason.ignore"}}],type:"array_merge",always_inherit:!0,process(e,s){if(Array.isArray(s))for(const e of s)e.i18n&&"string"!=typeof e.i18n&&delete e.i18n;return s},ui:{path:"Chat > Actions > Reasons >> Custom Reasons",component:"chat-reasons"}}),this.settings.add("chat.actions.inline",{process:(e,s)=>s.filter((e=>e.appearance&&this.renderers[e.appearance.type]&&(!this.renderers[e.appearance.type].load||this.renderers[e.appearance.type].load(e.appearance))&&(!e.action||this.actions[e.action]))),default:[{v:{action:"ban",appearance:{type:"icon",icon:"ffz-i-block"},options:{},display:{mod:!0,mod_icons:!0,deleted:!1}}},{v:{action:"unban",appearance:{type:"icon",icon:"ffz-i-ok"},options:{},display:{mod:!0,mod_icons:!0,deleted:!0}}},{v:{action:"timeout",appearance:{type:"icon",icon:"ffz-i-clock"},display:{mod:!0,mod_icons:!0}}},{v:{action:"msg_delete",appearance:{type:"icon",icon:"ffz-i-trash"},options:{},display:{mod:!0,mod_icons:!0}}},{v:{action:"reply",appearance:{type:"icon",icon:"ffz-i-reply"},options:{},display:{}}}],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > In-Line @{"description": "Here, you can define custom actions that will appear along messages in chat. If you aren\'t seeing an action you\'ve defined here in chat, please make sure that you have enabled Mod Icons in the chat settings menu."}',component:"chat-actions",context:["user","room","message"],inline:!0,modifiers:!0,data:()=>{const e=this.resolve("site.chat");return{color:s=>e&&e.colors?e.colors.process(s):s,actions:Object(a.deep_copy)(this.actions),renderers:Object(a.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.user-context",{process:(e,s)=>s.filter((e=>e.type||e.appearance&&this.renderers[e.appearance.type]&&(!this.renderers[e.appearance.type].load||this.renderers[e.appearance.type].load(e.appearance))&&(!e.action||this.actions[e.action]))),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > User Context @{"description": "Here, you can define custom actions that will appear in a context menu when you right-click a username in chat."}',component:"chat-actions",context:["user","room","message"],mod_icons:!0,data:()=>{const e=this.resolve("site.chat");return{color:s=>e&&e.colors?e.colors.process(s):s,actions:Object(a.deep_copy)(this.actions),renderers:Object(a.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room",{process:(e,s)=>s.filter((e=>e.type||e.appearance&&this.renderers[e.appearance.type]&&(!this.renderers[e.appearance.type].load||this.renderers[e.appearance.type].load(e.appearance))&&(!e.action||this.actions[e.action]))),default:[],type:"array_merge",inherit_default:!0,ui:{path:'Chat > Actions > Room @{"description": "Here, you can define custom actions that will appear above the chat input box."}',component:"chat-actions",context:["room","room-mode"],inline:!1,data:()=>{const e=this.resolve("site.chat");return{color:s=>e&&e.colors?e.colors.process(s):s,actions:Object(a.deep_copy)(this.actions),renderers:Object(a.deep_copy)(this.renderers)}}}}),this.settings.add("chat.actions.room-above",{default:!1,ui:{path:"Chat > Actions > Room >> General",component:"setting-check-box",title:"Display Room Actions above the chat input box."}}),this.settings.add("chat.actions.rules-as-reasons",{default:!0,ui:{path:"Chat > Actions > Reasons >> Rules",component:"setting-check-box",title:"Include the current room's rules in the list of reasons."}}),this.handleClick=this.handleClick.bind(this),this.handleContext=this.handleContext.bind(this),this.handleUserContext=this.handleUserContext.bind(this)}onEnable(){this.tooltips.types.action=(e,s)=>{const n=this.getData(e);return n?n.definition.tooltip?n.tip&&n.tip.length?this.replaceVariables(n.tip,n):Object(a.maybe_call)(n.definition.tooltip,this,n,e,s):`Error: The "${n.action}" action provider does not have tooltip support.`:this.i18n.t("chat.actions.unknown","Unknown Action Type")};for(const e in g)Object(a.has)(g,e)&&this.addAction(e,g[e]);for(const e in _)Object(a.has)(_,e)&&this.addRenderer(e,_[e])}addAction(e,s){if(Object(a.has)(this.actions,e))return this.log.warn(`Attempted to add action "${e}" which is already defined.`);this.actions[e]=s;for(const e of this.settings.__contexts)e.update("chat.actions.inline")}addRenderer(e,s){if(Object(a.has)(this.renderers,e))return this.log.warn(`Attempted to add renderer "${e}" which is already defined.`);this.renderers[e]=s;for(const e of this.settings.__contexts)e.update("chat.actions.inline")}replaceVariables(e,s){return Object(b.b)(e,s,this.i18n.locale,v,{})}renderInlineReasons(e,s,n){const o=this.parent.context.get("chat.actions.reasons"),a=[],f=this.parent.context.get("chat.actions.rules-as-reasons")&&this.parent.getRoom(e.room.id,e.room.login,!0),g=f&&f.rules;if(!o&&!g)return n.hide(),null;const click_fn=s=>o=>(n.hide(),e.definition.click.call(this,o,Object.assign({reason:s},e)),o.preventDefault(),!1);if(o&&o.length)for(const s of o){const n=this.replaceVariables("string"==typeof s.i18n?this.i18n.t(s.i18n,s.text):s.text,e);a.push(Object(u.createElement)("li",{class:"tw-full-width tw-relative"},Object(u.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:click_fn(n)},n)))}if(g&&g.length){o&&o.length&&a.push(Object(u.createElement)("div",{class:"tw-mg-y-05 tw-border-b"}));for(const e of g)a.push(Object(u.createElement)("li",{class:"tw-full-width tw-relative"},Object(u.createElement)("a",{href:"#",class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-05",onClick:click_fn(e)},e)))}let _;return _=e.definition.reason_text?e.definition.reason_text.call(this,e,s,n):this.i18n.t("chat.actions.select-reason","Please select a reason from the list below:"),Object(u.createElement)("div",{class:"ffz--inline-reasons"},_?Object(u.createElement)("div",{class:"tw-pd-05 tw-border-b"},_):null,Object(u.createElement)("div",{class:"scrollable-area","data-simplebar":!0},Object(u.createElement)("div",{class:"simplebar-scroll-content"},Object(u.createElement)("div",{class:"simplebar-content"},Object(u.createElement)("ul",null,a)))))}renderInlineContext(e,s){const n=s.definition;let o;if(n.context)o=(e,o)=>n.context.call(this,s,e,o);else{if(!n.uses_reason)return;o=(e,n)=>this.renderInlineReasons(s,e,n)}return this.renderPopup(e,o)}renderPopup(e,s){if(e._ffz_destroy)return e._ffz_destroy();const n=e._ffz_destroy=()=>{if(e._ffz_outside&&e._ffz_outside.destroy(),e._ffz_popup){const s=e._ffz_popup;e._ffz_popup=null,s.destroy()}e._ffz_on_destroy&&e._ffz_on_destroy(),e._ffz_destroy=e._ffz_outside=e._ffz_on_destroy=null},o=document.fullscreenElement||document.body.querySelector("#root>div")||document.body;(e._ffz_popup=new f.default(o,e,{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"ffz-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base  tw-absolute",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:o},flip:{behavior:["bottom","top","left","right"]}}},content:s,onShow:async(s,o)=>{await o.waitForDom(),e._ffz_outside=new u.ClickOutside(o.outer,n)},onMove:(e,s,n)=>{this.emit("tooltips:mousemove",e,s,n)},onLeave:(e,s,n)=>{this.emit("tooltips:leave",e,s,n)},onHide:n}))._enter(e)}getUserLevel(e,s){return e&&s?e.id===s.id||e.login===s.login?5:s.moderator||"mod"===s.type||s.badges&&s.badges.moderator?3:0:0}renderRoom(e,s,n,o,u){const f=[],g=this.resolve("site.chat");let _=null;for(const o of this.parent.context.get("chat.actions.room")){if(!o)continue;const b=o.type;if(b){"new-line"===b?_=null:"space"===b?(_||f.push(_=[]),_.push(u("div",{class:"tw-flex-grow-1"}))):"space-small"===b?(_||f.push(_=[]),_.push(u("div",{class:"tw-mg-x-1"}))):this.log.warn("Unknown action type",b);continue}if(!o.action||!o.appearance)continue;let v=o.appearance||{};const k=o.display||{},x=this.actions[o.action];if(!x||k.disabled||null!=k.mod_icons&&k.mod_icons!==!!e||null!=k.mod&&k.mod!==(!!s&&!!s.mod)||null!=k.staff&&k.staff!==(!!s&&!!s.staff)||null!=k.emoteOnly&&k.emoteOnly!==n.emoteOnly||null!=k.slowMode&&k.slowMode!==n.slowMode||null!=k.subsMode&&k.subsMode!==n.subsMode||null!=k.r9kMode&&k.r9kMode!==n.r9kMode||null!=k.followersOnly&&k.followersOnly!==n.followersOnly)continue;if(Object(a.maybe_call)(x.hidden,this,o,null,n,s,e))continue;if(x.override_appearance){const a=x.override_appearance.call(this,Object.assign({},v),o,null,n,s,e);a&&(v=a)}const C=this.renderers[v.type];if(!C)continue;const E=C.colored&&v.color,z=Object(a.maybe_call)(x.disabled,this,o,null,n,s,e)||!1,j=E&&(g&&g.colors?g.colors.process(v.color):v.color),O=C.render.call(this,v,u,j);_||f.push(_=[]),_.push(u("button",{class:`ffz-tooltip tw-pd-x-05 mod-icon ffz-mod-icon tw-c-text-alt-2${z?" disabled":""}${E?" colored":""}`,"data-tooltip-type":"action","data-action":o.action,"data-options":o.options?JSON.stringify(o.options):null,"data-tip":v.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},O))}if(!f.length)return null;const b=n&&JSON.stringify(n),v=f.length>1,k=v?f.map(((e,s)=>u("div",{key:s,class:"tw-flex tw-full-width tw-flex-row tw-flex-wrap"},e))):f[0];return u("div",{class:`ffz--room-actions${v?" tw-flex-column":""} ffz-action-data tw-flex tw-flex-grow-1 tw-flex-wrap tw-align-items-center ${o?"tw-pd-y-05 tw-border-t":"tw-mg-x-05"}`,"data-room":b},k)}renderUserContext(e,s){var n,o;const f=this.resolve("site.fine"),g=this.resolve("site"),_=this.resolve("site.chat"),b=f&&f.searchParent(e,(e=>e.props&&e.props.message)),v=null==b||null===(n=b.props)||void 0===n?void 0:n.message;if(!v||!g||!_)return;let k=v.roomLogin?v.roomLogin:v.channel?v.channel.slice(1):void 0;if(!k&&b.props.channelID){const e=this.parent.getRoom(b.props.channelID,null,!0);e&&e.login&&(k=v.roomLogin=e.login)}const x=g.getUser(),C={id:b.props.channelID,login:k},E=!!b.chatRepliesTreatment&&"control"!==b.chatRepliesTreatment&&!v.deleted&&!b.props.disableReplyClick&&x.login!==(null===(o=v.user)||void 0===o?void 0:o.login)&&!v.reply;v.roomId=C.id,x&&(x.moderator=b.props.isCurrentUserModerator,x.staff=b.props.isCurrentUserStaff,x.can_reply=2===this.parent.context.get("chat.replies.style")&&E);const z=this.getUserLevel(C,x),j=this.getUserLevel(C,v.user);let O=b.props.showModerationIcons;z<3&&(O=!1);const A=b;return this.renderPopup(e,((e,n)=>{const o=[];let f=null;const handle_click=e=>{this.handleClick(e,f),n.hide()};for(const e of s){if(!e)continue;if("new-line"===e.type){f=null;continue}if("space-small"===e.type){f||o.push(f=[]),f.push(Object(u.createElement)("div",{class:"tw-pd-x-1"}));continue}if("space"===e.type){f||o.push(f=[]),f.push(Object(u.createElement)("div",{class:"tw-flex-grow-1"}));continue}if(!e.action||!e.appearance)continue;let s=e.appearance||{};const n=e.display||{},g=this.actions[e.action];if(!g||n.disabled||null!=n.mod_icons&&n.mod_icons!==!!O||null!=n.mod&&n.mod!==z>j||null!=n.staff&&n.staff!==(!!x&&!!x.staff)||null!=n.deleted&&n.deleted!==!!v.deleted)continue;if(Object(a.maybe_call)(g.hidden,this,e,v,C,x,O))continue;if(g.override_appearance){const n=g.override_appearance.call(this,Object.assign({},s),e,v,C,x,O);n&&(s=n)}const b=this.renderers[s.type];if(!b)continue;const k=b.colored&&s.color,E=Object(a.maybe_call)(g.disabled,this,e,v,C,x,O)||!1,A=k&&(_&&_.colors?_.colors.process(s.color):s.color),T=b.render.call(this,s,u.createElement,A);f||o.push(f=[]);const D=Object(u.createElement)("button",{class:"ffz-tooltip ffz-tooltip--no-mouse tw-button tw-button--text"+(E?" tw-button--disabled disabled":""),disabled:E,"data-tooltip-type":"action","data-action":e.action,"data-options":e.options?JSON.stringify(e.options):null,onClick:handle_click,onContextMenu:this.handleContext},Object(u.createElement)("span",{class:"tw-button__text"},T));s.tooltip&&(D.dataset.tip=s.tooltip),f.push(D)}const g=Object(u.createElement)("div",{class:"ffz-action-data tw-pd-05","data-source":"msg"},Object(u.createElement)("div",{class:"tw-pd-b-05 tw-border-b"},Object(u.createElement)("strong",null,v.user.displayName||v.user.login),"..."),o.map((e=>e&&e.length?Object(u.createElement)("div",{class:"tw-flex tw-flex-no-wrap"},e):null)));return g.ffz_message=v,g.ffz_line=A,g}))}renderInline(e,s,n,o,u){const f=[],g=this.getUserLevel(o,n),_=this.getUserLevel(o,e.user),b=e.user&&n&&n.login===e.user.login;g<3&&(s=!1);const v=this.resolve("site.chat"),k=[];let x=!1;for(const C of this.parent.context.get("chat.actions.inline")){if(!C.action||!C.appearance)continue;let E=C.appearance||{};const z=C.display||{},j=z.keys,O=z.hover,A=this.actions[C.action];if(!A||z.disabled||null!=z.mod_icons&&z.mod_icons!==!!s||null!=z.mod&&z.mod!==g>_||null!=z.staff&&z.staff!==(!!n&&!!n.staff)||null!=z.deleted&&z.deleted!==!!e.deleted)continue;if(b&&!A.can_self)continue;if(Object(a.maybe_call)(A.hidden,this,C,e,o,n,s))continue;if(A.override_appearance){const a=A.override_appearance.call(this,Object.assign({},E),C,e,o,n,s);a&&(E=a)}const T=this.renderers[E.type];if(!T)continue;const D=T.colored&&E.color,B=Object(a.maybe_call)(A.disabled,this,C,e,o,n,s)||!1,P=D&&(v&&v.colors?v.colors.process(E.color):E.color),L=T.render.call(this,E,u,P);let I=f;(j||O)&&(I=k),x=!0,I.push(u("button",{class:`ffz-tooltip mod-icon ffz-mod-icon tw-c-text-alt-2${B?" disabled":""}${D?" colored":""}${j?` ffz-modifier-${j}`:""}${O?" ffz-hover":""}`,disabled:B,"data-tooltip-type":"action","data-action":C.action,"data-options":C.options?JSON.stringify(C.options):null,"data-tip":E.tooltip,onClick:this.handleClick,onContextMenu:this.handleContext},L))}if(!x)return null;let C=null;if(f.length&&(C=u("div",{class:"ffz--inline-actions ffz-action-data tw-inline-block tw-mg-r-05","data-source":"line"},f)),k.length){const e=u("div",{class:"ffz--inline-actions ffz--modifier-actions ffz-action-data","data-source":"line"},k);return C?[C,e]:e}return C}getData(e){const s=e.dataset,n=e.closest(".ffz-action-data"),o=n&&n.dataset,u=s&&s.action,f=this.actions[u];if(!f)return null;let g,_,b,v,k=!1;if(o){if("msg"===o.source&&n.ffz_message){const e=n.ffz_message;v=n.ffz_line,k=!0,g=e.user?{color:e.user.color,id:e.user.id,login:e.user.login,displayName:e.user.displayName,type:e.user.type}:null,_={login:e.roomLogin,id:e.roomId},b={id:e.id,text:e.message}}else if("line"===o.source){const e=this.resolve("site.fine");if(v=e&&e.searchParent(n,(e=>e.props&&e.props.message)),v&&v.props&&v.props.message){k=!0;const e=v.props.message;g=e.user?{color:e.user.color,id:e.user.id,login:e.user.login,displayName:e.user.displayName,type:e.user.type}:null,_={login:v.props.channelLogin,id:v.props.channelID},b={id:e.id,text:e.message}}}k||(g=o.user?JSON.parse(o.user):null,_=o.room?JSON.parse(o.room):null,b=o.message?JSON.parse(o.message):o.msgId?{id:o.msgId}:null)}const x={action:u,definition:f,tip:s.tip,options:s.options?JSON.parse(s.options):null,user:g,room:_,message:b,message_id:b?b.id:null,line:v};return f.defaults&&(x.options=Object.assign({},Object(a.maybe_call)(f.defaults,this,x,e),x.options)),x}handleClick(e){const s=e.target,n=this.getData(s);if(n&&!s.classList.contains("disabled"))return n.definition.click?(s._ffz_tooltip&&s._ffz_tooltip.hide(),n.definition.click.call(this,e,n)):n.definition.context?this.handleContext(e):this.log.warn(`No click handler for action provider "${n.action}"`)}handleContext(e){if(e.shiftKey)return;e.preventDefault();const s=e.target,n=this.getData(e.target);n&&(s.classList.contains("disabled")||(s._ffz_tooltip&&s._ffz_tooltip.hide(),(n.definition.context||n.definition.uses_reason)&&this.renderInlineContext(s,n)))}handleUserContext(e){if(e.shiftKey)return;const s=this.parent.context.get("chat.actions.user-context");if(!Array.isArray(s)||!s.length)return;e.preventDefault();const n=e.target;n._ffz_tooltip&&n._ffz_tooltip.hide(),this.renderUserContext(n,s)}pasteMessage(e,s){return this.resolve("site.chat.input").pasteMessage(e,s)}sendMessage(e,s){return this.resolve("site.chat").sendMessage(e,s)}}},function(e,s,n){var o;e.exports=(o=o||function(e,s){var n=Object.create||function(){function F(){}return function(e){var s;return F.prototype=e,s=new F,F.prototype=null,s}}(),o={},a=o.lib={},u=a.Base={extend:function(e){var s=n(this);return e&&s.mixIn(e),s.hasOwnProperty("init")&&this.init!==s.init||(s.init=function(){s.$super.init.apply(this,arguments)}),s.init.prototype=s,s.$super=this,s},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var s in e)e.hasOwnProperty(s)&&(this[s]=e[s]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},f=a.WordArray=u.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=s?n:4*e.length},toString:function(e){return(e||_).stringify(this)},concat:function(e){var s=this.words,n=e.words,o=this.sigBytes,a=e.sigBytes;if(this.clamp(),o%4)for(var u=0;u<a;u++){var f=n[u>>>2]>>>24-u%4*8&255;s[o+u>>>2]|=f<<24-(o+u)%4*8}else for(u=0;u<a;u+=4)s[o+u>>>2]=n[u>>>2];return this.sigBytes+=a,this},clamp:function(){var s=this.words,n=this.sigBytes;s[n>>>2]&=4294967295<<32-n%4*8,s.length=e.ceil(n/4)},clone:function(){var e=u.clone.call(this);return e.words=this.words.slice(0),e},random:function(s){for(var n,o=[],r=function(s){s=s;var n=987654321,o=4294967295;return function(){var a=((n=36969*(65535&n)+(n>>16)&o)<<16)+(s=18e3*(65535&s)+(s>>16)&o)&o;return a/=4294967296,(a+=.5)*(e.random()>.5?1:-1)}},a=0;a<s;a+=4){var u=r(4294967296*(n||e.random()));n=987654071*u(),o.push(4294967296*u()|0)}return new f.init(o,s)}}),g=o.enc={},_=g.Hex={stringify:function(e){for(var s=e.words,n=e.sigBytes,o=[],a=0;a<n;a++){var u=s[a>>>2]>>>24-a%4*8&255;o.push((u>>>4).toString(16)),o.push((15&u).toString(16))}return o.join("")},parse:function(e){for(var s=e.length,n=[],o=0;o<s;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new f.init(n,s/2)}},b=g.Latin1={stringify:function(e){for(var s=e.words,n=e.sigBytes,o=[],a=0;a<n;a++){var u=s[a>>>2]>>>24-a%4*8&255;o.push(String.fromCharCode(u))}return o.join("")},parse:function(e){for(var s=e.length,n=[],o=0;o<s;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new f.init(n,s)}},v=g.Utf8={stringify:function(e){try{return decodeURIComponent(escape(b.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return b.parse(unescape(encodeURIComponent(e)))}},k=a.BufferedBlockAlgorithm=u.extend({reset:function(){this._data=new f.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=v.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(s){var n=this._data,o=n.words,a=n.sigBytes,u=this.blockSize,g=a/(4*u),_=(g=s?e.ceil(g):e.max((0|g)-this._minBufferSize,0))*u,b=e.min(4*_,a);if(_){for(var v=0;v<_;v+=u)this._doProcessBlock(o,v);var k=o.splice(0,_);n.sigBytes-=b}return new f.init(k,b)},clone:function(){var e=u.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),x=(a.Hasher=k.extend({cfg:u.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){k.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(s,n){return new e.init(n).finalize(s)}},_createHmacHelper:function(e){return function(s,n){return new x.HMAC.init(e,n).finalize(s)}}}),o.algo={});return o}(Math),o)},function(e,s,n){var o={"./af.js":[151,8],"./am.js":[152,9],"./ar-dz.js":[153,61],"./ar-iq.js":[154,72],"./ar-kw.js":[155,83],"./ar-ly.js":[156,94],"./ar-ma.js":[157,105],"./ar-sa.js":[158,116],"./ar-tn.js":[159,127],"./ar.js":[160,138],"./az.js":[161,10],"./be.js":[162,21],"./bg.js":[163,32],"./bi.js":[164,43],"./bm.js":[165,54],"./bn.js":[166,56],"./bo.js":[167,57],"./br.js":[168,58],"./bs.js":[169,59],"./ca.js":[170,60],"./cs.js":[171,62],"./cv.js":[172,63],"./cy.js":[173,64],"./da.js":[174,65],"./de-at.js":[175,66],"./de-ch.js":[176,67],"./de.js":[177,68],"./dv.js":[178,69],"./el.js":[179,70],"./en-au.js":[180,71],"./en-ca.js":[181,73],"./en-gb.js":[182,74],"./en-ie.js":[183,75],"./en-il.js":[184,76],"./en-in.js":[185,77],"./en-nz.js":[186,78],"./en-sg.js":[187,79],"./en-tt.js":[188,80],"./en.js":[189,81],"./eo.js":[190,82],"./es-do.js":[191,84],"./es-mx.js":[192,85],"./es-pr.js":[193,86],"./es-us.js":[194,87],"./es.js":[195,88],"./et.js":[196,89],"./eu.js":[197,90],"./fa.js":[198,91],"./fi.js":[199,92],"./fo.js":[200,93],"./fr-ca.js":[201,95],"./fr-ch.js":[202,96],"./fr.js":[203,97],"./fy.js":[204,98],"./ga.js":[205,99],"./gd.js":[206,100],"./gl.js":[207,101],"./gom-latn.js":[208,102],"./gu.js":[209,103],"./he.js":[210,104],"./hi.js":[211,106],"./hr.js":[212,107],"./ht.js":[213,108],"./hu.js":[214,109],"./hy-am.js":[215,110],"./id.js":[216,111],"./is.js":[217,112],"./it-ch.js":[218,113],"./it.js":[219,114],"./ja.js":[220,115],"./jv.js":[221,117],"./ka.js":[222,118],"./kk.js":[223,119],"./km.js":[224,120],"./kn.js":[225,121],"./ko.js":[226,122],"./ku.js":[227,123],"./ky.js":[228,124],"./lb.js":[229,125],"./lo.js":[230,126],"./lt.js":[231,128],"./lv.js":[232,129],"./me.js":[233,130],"./mi.js":[234,131],"./mk.js":[235,132],"./ml.js":[236,133],"./mn.js":[237,134],"./mr.js":[238,135],"./ms-my.js":[239,136],"./ms.js":[240,137],"./mt.js":[241,139],"./my.js":[242,140],"./nb.js":[243,141],"./ne.js":[244,142],"./nl-be.js":[245,143],"./nl.js":[246,144],"./nn.js":[247,145],"./oc-lnc.js":[248,146],"./pa-in.js":[249,147],"./pl.js":[250,148],"./pt-br.js":[251,11],"./pt.js":[252,12],"./ro.js":[253,13],"./ru.js":[254,14],"./rw.js":[255,15],"./sd.js":[256,16],"./se.js":[257,17],"./si.js":[258,18],"./sk.js":[259,19],"./sl.js":[260,20],"./sq.js":[261,22],"./sr-cyrl.js":[262,23],"./sr.js":[263,24],"./ss.js":[264,25],"./sv-fi.js":[265,26],"./sv.js":[266,27],"./sw.js":[267,28],"./ta.js":[268,29],"./te.js":[269,30],"./tet.js":[270,31],"./tg.js":[271,33],"./th.js":[272,34],"./tk.js":[273,35],"./tl-ph.js":[274,36],"./tlh.js":[275,37],"./tr.js":[276,38],"./tzl.js":[277,39],"./tzm-latn.js":[278,40],"./tzm.js":[279,41],"./ug-cn.js":[280,42],"./uk.js":[281,44],"./ur.js":[282,45],"./uz-latn.js":[283,46],"./uz.js":[284,47],"./vi.js":[285,48],"./x-pseudo.js":[286,49],"./yo.js":[287,50],"./zh-cn.js":[288,51],"./zh-hk.js":[289,52],"./zh-tw.js":[290,53],"./zh.js":[291,55]};function webpackAsyncContext(e){if(!n.o(o,e))return Promise.resolve().then((function(){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}));var s=o[e],a=s[0];return n.e(s[1]).then((function(){return n.t(a,7)}))}webpackAsyncContext.keys=function webpackAsyncContextKeys(){return Object.keys(o)},webpackAsyncContext.id=114,e.exports=webpackAsyncContext},function(e,s,n){"use strict";n.r(s),n.d(s,"Addon",(function(){return Addon}));var o=n(4);class Addon extends o.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings")}static register(e,s){if("object"==typeof e&&(e=(s=e).id||void 0),!e){if(!this.name)throw new Error("Unable to register module without ID.");e=this.name.toSnakeCase()}!s&&this.info&&(s=this.info);const n=FrankerFaceZ.get();s&&(s.id=e,n.addons.addAddon(s));try{n.register(`addon.${e}`,this)}catch(s){if(s.message&&s.message.includes("Name Collision for Module")){const s=n.resolve(`addon.${e}`);s&&(s.external=!0)}throw s}}}},function(e,s,n){var o=n(140),a=o.ARRAY_BUFFER_SUPPORT,u=o.SYMBOL_SUPPORT;e.exports=function forEach(e,s){var n,o,f,g,_;if(!e)throw new Error("obliterator/forEach: invalid iterable.");if("function"!=typeof s)throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(e)||a&&ArrayBuffer.isView(e)||"string"==typeof e||"[object Arguments]"===e.toString())for(f=0,g=e.length;f<g;f++)s(e[f],f);else if("function"!=typeof e.forEach)if(u&&Symbol.iterator in e&&"function"!=typeof e.next&&(e=e[Symbol.iterator]()),"function"!=typeof e.next)for(o in e)e.hasOwnProperty(o)&&s(e[o],o);else for(n=e,f=0;!0!==(_=n.next()).done;)s(_.value,f),f++;else e.forEach(s)}},function(e,s){var n=Math.pow(2,8)-1,o=Math.pow(2,16)-1,a=Math.pow(2,32)-1,u=Math.pow(2,7)-1,f=Math.pow(2,15)-1,g=Math.pow(2,31)-1;s.getPointerArray=function(e){var s=e-1;if(s<=n)return Uint8Array;if(s<=o)return Uint16Array;if(s<=a)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},s.getSignedPointerArray=function(e){var s=e-1;return s<=u?Int8Array:s<=f?Int16Array:s<=g?Int32Array:Float64Array},s.getNumberType=function(e){return e===(0|e)?-1===Math.sign(e)?e<=127&&e>=-128?Int8Array:e<=32767&&e>=-32768?Int16Array:Int32Array:e<=255?Uint8Array:e<=65535?Uint16Array:Uint32Array:Float64Array};var _={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};s.getMinimalRepresentation=function(e,n){var o,a,u,f,g,b=null,v=0;for(f=0,g=e.length;f<g;f++)u=n?n(e[f]):e[f],a=s.getNumberType(u),(o=_[a.name])>v&&(v=o,b=a);return b},s.isTypedArray=function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(e)},s.concat=function(){var e,s,n,o=0;for(e=0,n=arguments.length;e<n;e++)o+=arguments[e].length;var a=new arguments[0].constructor(o);for(e=0,s=0;e<n;e++)a.set(arguments[e],s),s+=arguments[e].length;return a},s.indices=function(e){for(var n=new(s.getPointerArray(e))(e),o=0;o<e;o++)n[o]=o;return n}},,function(e,s,n){"use strict";n.d(s,"a",(function(){return FineRouter}));var o=n(75),a=n(4),u=n(0);class FineRouter extends a.default{constructor(...e){super(...e),this.inject("..fine"),this.__routes=[],this.routes={},this.route_names={},this.current=null,this.current_name=null,this.match=null,this.location=null}onEnable(){const e=this.fine.searchTree(null,(e=>e.props&&e.props.history)),s=this.history=e&&e.props&&e.props.history;if(!s)return new Promise((e=>setTimeout(e,50))).then((()=>this.onEnable()));s.listen((e=>{this.enabled&&this._navigateTo(e)})),this._navigateTo(s.location)}navigate(e,s,n,o){this.history.push(this.getURL(e,s,n),o)}_navigateTo(e){this.log.debug("New Location",e);const s=window.location.host,n=e.pathname,o=e.state;n===this.location&&s===this.domain&&Object(u.deep_equals)(o,this.current_state)||(this.old_location=this.location,this.old_domain=this.domain,this.old_state=this.current_state,this.location=n,this.domain=s,this.current_state=o,this._pickRoute())}_pickRoute(){const e=this.location,s=this.domain;this.old_route=this.current,this.old_name=this.current_name,this.old_match=this.match;for(const n of this.__routes){if(n.domain&&n.domain!==s)continue;const o=n.regex.exec(e);if(o&&(!n.state_fn||n.state_fn(this.current_state)))return this.log.debug("Matching Route",n,o),this.current=n,this.current_name=n.name,this.match=o,this.emit(":route",n,o),void this.emit(`:route:${n.name}`,...o)}this.current=this.current_name=this.match=null,this.emit(":route",null,null)}getURL(e,s,n,...o){const a=this.routes[e];if(!a)throw new Error(`unable to find route "${e}"`);if("object"!=typeof s){const e=[s,n,...o];s={};let u=0;for(const n of a.parts)if(n&&n.name&&(s[n.name]=e[u],u++,u>=e.length))break}return a.url(s,n)}getRoute(e){return this.routes[e]}getRoutes(){return this.routes}getRouteNames(){for(const e of Object.keys(this.getRoutes()))this.getRouteName(e);return this.route_names}getRouteName(e){return this.route_names[e]||(this.route_names[e]=e.replace(/^dash-([a-z])/,((e,s)=>`Dashboard: ${s.toLocaleUpperCase()}`)).replace(/(^|-)([a-z])/g,((e,s,n)=>`${s?" ":""}${n.toLocaleUpperCase()}`))),this.route_names[e]}routeName(e,s,n=!0){if("object"!=typeof e)this.route_names[e]=s,n&&this.emit(":updated-route-names");else{for(const s in e)Object(u.has)(e,s)&&this.routeName(s,e[s],!1);n&&this.emit(":updated-route-names")}}route(e,s,n=null,a=null,f=!0){if("object"==typeof e){n=s;for(const s in e)Object(u.has)(e,s)&&this.route(s,e[s],n,a,!1);return void(f&&(this.__routes.sort(((e,s)=>s.score-e.score)),this.location&&this._pickRoute(),this.emit(":updated-routes")))}const g=Object(o.parse)(s),_=g.reduce(((e,s)=>e+("string"==typeof s?s.split("/").length-1:0)),0),b=this.routes[e]={name:e,parts:g,score:_,domain:n,state_fn:a,regex:Object(o.tokensToRegExp)(g),url:Object(o.tokensToFunction)(g)};this.__routes.push(b),f&&(this.__routes.sort(((e,s)=>s.score-e.score)),this.location&&this._pickRoute(),this.emit(":updated-routes"))}}},function(e,s,n){"use strict";e.exports=()=>/\u{1F3F4}\u{E0067}\u{E0062}(?:\u{E0077}\u{E006C}\u{E0073}|\u{E0073}\u{E0063}\u{E0074}|\u{E0065}\u{E006E}\u{E0067})\u{E007F}|(?:\u{1F9D1}\u{1F3FF}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FF}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FE}]|(?:\u{1F9D1}\u{1F3FE}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FE}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FD}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FD}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FC}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FC}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|(?:\u{1F9D1}\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F9D1}|\u{1F469}\u{1F3FB}\u200D\u{1F91D}\u200D[\u{1F468}\u{1F469}])[\u{1F3FC}-\u{1F3FF}]|\u{1F468}(?:\u{1F3FB}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u{1F91D}\u200D\u{1F468}[\u{1F3FC}-\u{1F3FF}]|[\u2695\u2696\u2708]\uFE0F|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]))?|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FF}]|\u{1F468}[\u{1F3FB}-\u{1F3FF}])|\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D)?\u{1F468}|[\u{1F468}\u{1F469}]\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FE}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FE}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}-\u{1F3FD}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FD}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FC}\u{1F3FE}\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FC}\u200D(?:\u{1F91D}\u200D\u{1F468}[\u{1F3FB}\u{1F3FD}-\u{1F3FF}]|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])\uFE0F|\u200D(?:[\u{1F468}\u{1F469}]\u200D[\u{1F466}\u{1F467}]|[\u{1F466}\u{1F467}])|\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC})?|(?:\u{1F469}(?:\u{1F3FB}\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F3FC}-\u{1F3FF}]\u200D\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}]))|\u{1F9D1}[\u{1F3FB}-\u{1F3FF}]\u200D\u{1F91D}\u200D\u{1F9D1})[\u{1F3FB}-\u{1F3FF}]|\u{1F469}\u200D\u{1F469}\u200D(?:\u{1F466}\u200D\u{1F466}|\u{1F467}\u200D[\u{1F466}\u{1F467}])|\u{1F469}(?:\u200D(?:\u2764\uFE0F\u200D(?:\u{1F48B}\u200D[\u{1F468}\u{1F469}]|[\u{1F468}\u{1F469}])|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F9D1}(?:\u200D(?:\u{1F91D}\u200D\u{1F9D1}|[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F3FF}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FE}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FD}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FC}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}]|\u{1F3FB}\u200D[\u{1F33E}\u{1F373}\u{1F37C}\u{1F384}\u{1F393}\u{1F3A4}\u{1F3A8}\u{1F3EB}\u{1F3ED}\u{1F4BB}\u{1F4BC}\u{1F527}\u{1F52C}\u{1F680}\u{1F692}\u{1F9AF}-\u{1F9B3}\u{1F9BC}\u{1F9BD}])|\u{1F469}\u200D\u{1F466}\u200D\u{1F466}|\u{1F469}\u200D\u{1F469}\u200D[\u{1F466}\u{1F467}]|\u{1F469}\u200D\u{1F467}\u200D[\u{1F466}\u{1F467}]|(?:\u{1F441}\uFE0F\u200D\u{1F5E8}|\u{1F9D1}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F469}(?:\u{1F3FF}\u200D[\u2695\u2696\u2708]|\u{1F3FE}\u200D[\u2695\u2696\u2708]|\u{1F3FD}\u200D[\u2695\u2696\u2708]|\u{1F3FC}\u200D[\u2695\u2696\u2708]|\u{1F3FB}\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708])|\u{1F636}\u200D\u{1F32B}|\u{1F3F3}\uFE0F\u200D\u26A7|\u{1F43B}\u200D\u2744|(?:[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}])\u200D[\u2640\u2642]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]\u200D[\u2640\u2642]|\u{1F3F4}\u200D\u2620|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]\u200D[\u2640\u2642]|[\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u2328\u23CF\u23ED-\u23EF\u23F1\u23F2\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB\u25FC\u2600-\u2604\u260E\u2611\u2618\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u2692\u2694-\u2697\u2699\u269B\u269C\u26A0\u26A7\u26B0\u26B1\u26C8\u26CF\u26D1\u26D3\u26E9\u26F0\u26F1\u26F4\u26F7\u26F8\u2702\u2708\u2709\u270F\u2712\u2714\u2716\u271D\u2721\u2733\u2734\u2744\u2747\u2763\u27A1\u2934\u2935\u2B05-\u2B07\u3030\u303D\u3297\u3299\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F202}\u{1F237}\u{1F321}\u{1F324}-\u{1F32C}\u{1F336}\u{1F37D}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}\u{1F39F}\u{1F3CD}\u{1F3CE}\u{1F3D4}-\u{1F3DF}\u{1F3F5}\u{1F3F7}\u{1F43F}\u{1F4FD}\u{1F549}\u{1F54A}\u{1F56F}\u{1F570}\u{1F573}\u{1F576}-\u{1F579}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}\u{1F6CB}\u{1F6CD}-\u{1F6CF}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6F0}\u{1F6F3}])\uFE0F|\u{1F3F3}\uFE0F\u200D\u{1F308}|\u{1F469}\u200D\u{1F467}|\u{1F469}\u200D\u{1F466}|\u{1F635}\u200D\u{1F4AB}|\u{1F62E}\u200D\u{1F4A8}|\u{1F415}\u200D\u{1F9BA}|\u{1F9D1}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F469}(?:\u{1F3FF}|\u{1F3FE}|\u{1F3FD}|\u{1F3FC}|\u{1F3FB})?|\u{1F1FD}\u{1F1F0}|\u{1F1F6}\u{1F1E6}|\u{1F1F4}\u{1F1F2}|\u{1F408}\u200D\u2B1B|\u2764\uFE0F\u200D[\u{1F525}\u{1FA79}]|\u{1F441}\uFE0F|\u{1F3F3}\uFE0F|\u{1F1FF}[\u{1F1E6}\u{1F1F2}\u{1F1FC}]|\u{1F1FE}[\u{1F1EA}\u{1F1F9}]|\u{1F1FC}[\u{1F1EB}\u{1F1F8}]|\u{1F1FB}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1EE}\u{1F1F3}\u{1F1FA}]|\u{1F1FA}[\u{1F1E6}\u{1F1EC}\u{1F1F2}\u{1F1F3}\u{1F1F8}\u{1F1FE}\u{1F1FF}]|\u{1F1F9}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1ED}\u{1F1EF}-\u{1F1F4}\u{1F1F7}\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FF}]|\u{1F1F8}[\u{1F1E6}-\u{1F1EA}\u{1F1EC}-\u{1F1F4}\u{1F1F7}-\u{1F1F9}\u{1F1FB}\u{1F1FD}-\u{1F1FF}]|\u{1F1F7}[\u{1F1EA}\u{1F1F4}\u{1F1F8}\u{1F1FA}\u{1F1FC}]|\u{1F1F5}[\u{1F1E6}\u{1F1EA}-\u{1F1ED}\u{1F1F0}-\u{1F1F3}\u{1F1F7}-\u{1F1F9}\u{1F1FC}\u{1F1FE}]|\u{1F1F3}[\u{1F1E6}\u{1F1E8}\u{1F1EA}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F4}\u{1F1F5}\u{1F1F7}\u{1F1FA}\u{1F1FF}]|\u{1F1F2}[\u{1F1E6}\u{1F1E8}-\u{1F1ED}\u{1F1F0}-\u{1F1FF}]|\u{1F1F1}[\u{1F1E6}-\u{1F1E8}\u{1F1EE}\u{1F1F0}\u{1F1F7}-\u{1F1FB}\u{1F1FE}]|\u{1F1F0}[\u{1F1EA}\u{1F1EC}-\u{1F1EE}\u{1F1F2}\u{1F1F3}\u{1F1F5}\u{1F1F7}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1EF}[\u{1F1EA}\u{1F1F2}\u{1F1F4}\u{1F1F5}]|\u{1F1EE}[\u{1F1E8}-\u{1F1EA}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}]|\u{1F1ED}[\u{1F1F0}\u{1F1F2}\u{1F1F3}\u{1F1F7}\u{1F1F9}\u{1F1FA}]|\u{1F1EC}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EE}\u{1F1F1}-\u{1F1F3}\u{1F1F5}-\u{1F1FA}\u{1F1FC}\u{1F1FE}]|\u{1F1EB}[\u{1F1EE}-\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1F7}]|\u{1F1EA}[\u{1F1E6}\u{1F1E8}\u{1F1EA}\u{1F1EC}\u{1F1ED}\u{1F1F7}-\u{1F1FA}]|\u{1F1E9}[\u{1F1EA}\u{1F1EC}\u{1F1EF}\u{1F1F0}\u{1F1F2}\u{1F1F4}\u{1F1FF}]|\u{1F1E8}[\u{1F1E6}\u{1F1E8}\u{1F1E9}\u{1F1EB}-\u{1F1EE}\u{1F1F0}-\u{1F1F5}\u{1F1F7}\u{1F1FA}-\u{1F1FF}]|\u{1F1E7}[\u{1F1E6}\u{1F1E7}\u{1F1E9}-\u{1F1EF}\u{1F1F1}-\u{1F1F4}\u{1F1F6}-\u{1F1F9}\u{1F1FB}\u{1F1FC}\u{1F1FE}\u{1F1FF}]|\u{1F1E6}[\u{1F1E8}-\u{1F1EC}\u{1F1EE}\u{1F1F1}\u{1F1F2}\u{1F1F4}\u{1F1F6}-\u{1F1FA}\u{1F1FC}\u{1F1FD}\u{1F1FF}]|[#\*0-9]\uFE0F\u20E3|\u2764\uFE0F|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}][\u{1F3FB}-\u{1F3FF}]|[\u26F9\u{1F3CB}\u{1F3CC}\u{1F575}][\uFE0F\u{1F3FB}-\u{1F3FF}]|\u{1F3F4}|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}][\u{1F3FB}-\u{1F3FF}]|[\u261D\u270C\u270D\u{1F574}\u{1F590}][\uFE0F\u{1F3FB}-\u{1F3FF}]|[\u270A\u270B\u{1F385}\u{1F3C2}\u{1F3C7}\u{1F408}\u{1F415}\u{1F43B}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}\u{1F467}\u{1F46B}-\u{1F46D}\u{1F472}\u{1F474}-\u{1F476}\u{1F478}\u{1F47C}\u{1F483}\u{1F485}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F57A}\u{1F595}\u{1F596}\u{1F62E}\u{1F635}\u{1F636}\u{1F64C}\u{1F64F}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91C}\u{1F91E}\u{1F91F}\u{1F930}-\u{1F934}\u{1F936}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9BB}\u{1F9D2}\u{1F9D3}\u{1F9D5}]|[\u{1F3C3}\u{1F3C4}\u{1F3CA}\u{1F46E}\u{1F470}\u{1F471}\u{1F473}\u{1F477}\u{1F481}\u{1F482}\u{1F486}\u{1F487}\u{1F645}-\u{1F647}\u{1F64B}\u{1F64D}\u{1F64E}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F926}\u{1F935}\u{1F937}-\u{1F939}\u{1F93D}\u{1F93E}\u{1F9B8}\u{1F9B9}\u{1F9CD}-\u{1F9CF}\u{1F9D4}\u{1F9D6}-\u{1F9DD}]|[\u{1F46F}\u{1F93C}\u{1F9DE}\u{1F9DF}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F384}\u{1F386}-\u{1F393}\u{1F3A0}-\u{1F3C1}\u{1F3C5}\u{1F3C6}\u{1F3C8}\u{1F3C9}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F8}-\u{1F407}\u{1F409}-\u{1F414}\u{1F416}-\u{1F43A}\u{1F43C}-\u{1F43E}\u{1F440}\u{1F444}\u{1F445}\u{1F451}-\u{1F465}\u{1F46A}\u{1F479}-\u{1F47B}\u{1F47D}-\u{1F480}\u{1F484}\u{1F488}-\u{1F48E}\u{1F490}\u{1F492}-\u{1F4A9}\u{1F4AB}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F5A4}\u{1F5FB}-\u{1F62D}\u{1F62F}-\u{1F634}\u{1F637}-\u{1F644}\u{1F648}-\u{1F64A}\u{1F680}-\u{1F6A2}\u{1F6A4}-\u{1F6B3}\u{1F6B7}-\u{1F6BF}\u{1F6C1}-\u{1F6C5}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90D}\u{1F90E}\u{1F910}-\u{1F917}\u{1F91D}\u{1F920}-\u{1F925}\u{1F927}-\u{1F92F}\u{1F93A}\u{1F93F}-\u{1F945}\u{1F947}-\u{1F976}\u{1F978}\u{1F97A}-\u{1F9B4}\u{1F9B7}\u{1F9BA}\u{1F9BC}-\u{1F9CB}\u{1F9D0}\u{1F9E0}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55\u{1F004}\u{1F0CF}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F236}\u{1F238}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F320}\u{1F32D}-\u{1F335}\u{1F337}-\u{1F37C}\u{1F37E}-\u{1F393}\u{1F3A0}-\u{1F3CA}\u{1F3CF}-\u{1F3D3}\u{1F3E0}-\u{1F3F0}\u{1F3F4}\u{1F3F8}-\u{1F43E}\u{1F440}\u{1F442}-\u{1F4FC}\u{1F4FF}-\u{1F53D}\u{1F54B}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F57A}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5FB}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CC}\u{1F6D0}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6EB}\u{1F6EC}\u{1F6F4}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]|[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u265F\u2660\u2663\u2665\u2666\u2668\u267B\u267E\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26A7\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299\u{1F004}\u{1F0CF}\u{1F170}\u{1F171}\u{1F17E}\u{1F17F}\u{1F18E}\u{1F191}-\u{1F19A}\u{1F1E6}-\u{1F1FF}\u{1F201}\u{1F202}\u{1F21A}\u{1F22F}\u{1F232}-\u{1F23A}\u{1F250}\u{1F251}\u{1F300}-\u{1F321}\u{1F324}-\u{1F393}\u{1F396}\u{1F397}\u{1F399}-\u{1F39B}\u{1F39E}-\u{1F3F0}\u{1F3F3}-\u{1F3F5}\u{1F3F7}-\u{1F4FD}\u{1F4FF}-\u{1F53D}\u{1F549}-\u{1F54E}\u{1F550}-\u{1F567}\u{1F56F}\u{1F570}\u{1F573}-\u{1F57A}\u{1F587}\u{1F58A}-\u{1F58D}\u{1F590}\u{1F595}\u{1F596}\u{1F5A4}\u{1F5A5}\u{1F5A8}\u{1F5B1}\u{1F5B2}\u{1F5BC}\u{1F5C2}-\u{1F5C4}\u{1F5D1}-\u{1F5D3}\u{1F5DC}-\u{1F5DE}\u{1F5E1}\u{1F5E3}\u{1F5E8}\u{1F5EF}\u{1F5F3}\u{1F5FA}-\u{1F64F}\u{1F680}-\u{1F6C5}\u{1F6CB}-\u{1F6D2}\u{1F6D5}-\u{1F6D7}\u{1F6E0}-\u{1F6E5}\u{1F6E9}\u{1F6EB}\u{1F6EC}\u{1F6F0}\u{1F6F3}-\u{1F6FC}\u{1F7E0}-\u{1F7EB}\u{1F90C}-\u{1F93A}\u{1F93C}-\u{1F945}\u{1F947}-\u{1F978}\u{1F97A}-\u{1F9CB}\u{1F9CD}-\u{1F9FF}\u{1FA70}-\u{1FA74}\u{1FA78}-\u{1FA7A}\u{1FA80}-\u{1FA86}\u{1FA90}-\u{1FAA8}\u{1FAB0}-\u{1FAB6}\u{1FAC0}-\u{1FAC2}\u{1FAD0}-\u{1FAD6}]\uFE0F|[\u261D\u26F9\u270A-\u270D\u{1F385}\u{1F3C2}-\u{1F3C4}\u{1F3C7}\u{1F3CA}-\u{1F3CC}\u{1F442}\u{1F443}\u{1F446}-\u{1F450}\u{1F466}-\u{1F478}\u{1F47C}\u{1F481}-\u{1F483}\u{1F485}-\u{1F487}\u{1F48F}\u{1F491}\u{1F4AA}\u{1F574}\u{1F575}\u{1F57A}\u{1F590}\u{1F595}\u{1F596}\u{1F645}-\u{1F647}\u{1F64B}-\u{1F64F}\u{1F6A3}\u{1F6B4}-\u{1F6B6}\u{1F6C0}\u{1F6CC}\u{1F90C}\u{1F90F}\u{1F918}-\u{1F91F}\u{1F926}\u{1F930}-\u{1F939}\u{1F93C}-\u{1F93E}\u{1F977}\u{1F9B5}\u{1F9B6}\u{1F9B8}\u{1F9B9}\u{1F9BB}\u{1F9CD}-\u{1F9CF}\u{1F9D1}-\u{1F9DD}]/gu},function(e,s,n){e.exports=n.p+"font-awesome.f151bea153df11d509d07ac18047a5c1.css"},function(e,s,n){"use strict";n.d(s,"a",(function(){return Emotes}));var o=n(4),a=n(1),u=n(0),f=n(2),g=n(107),_=n.n(g),b=n(123),v=n.n(b);const k=Symbol("FFZ:Hover:RAF"),x=Symbol("FFZ:Hover:State"),C=f.IS_OSX?"metaKey":"ctrlKey",E={59847:{modifier_offset:"0 15px 15px 0",modifier:!0},70852:{modifier:!0,modifier_offset:"0 5px 20px 0",extra_width:5,shrink_to_fit:!0},70854:{modifier:!0,modifier_offset:"30px 0 0"},147049:{modifier:!0,modifier_offset:"4px 1px 0 3px"},147011:{modifier:!0,modifier_offset:"0"},70864:{modifier:!0,modifier_offset:"0"},147038:{modifier:!0,modifier_offset:"0"}};class Emotes extends o.default{constructor(...e){super(...e),this.EmoteTypes=f.EmoteTypes,this.inject("settings"),this.inject("experiments"),this.twitch_inventory_sets=new Set,this.__twitch_emote_to_set={},this.__twitch_set_to_channel={},this.default_sets=new u.SourcedSet,this.global_sets=new u.SourcedSet,this.providers=new Map,this.providers.set("featured",{name:"Featured",i18n_key:"emote-menu.featured",sort_key:75}),this.emote_sets={},this._set_refs={},this._set_timers={},this.settings.add("chat.emotes.enabled",{default:2,ui:{path:"Chat > Appearance >> Emotes",title:"Display Emotes",sort:-100,force_seen:!0,description:"If you do not wish to see emotes, you can disable them here.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Only"},{value:2,title:"Enabled"}]}}),this.settings.add("chat.emotes.2x",{default:0,process:(e,s)=>!0===s?1:!1===s?0:s,ui:{path:"Chat > Appearance >> Emotes",title:"Larger Emotes",description:"This setting will make emotes appear twice as large in chat. It's good for use with larger fonts or just if you really like emotes.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Emotes"},{value:2,title:"Emotes and Emoji"}]}}),this.settings.add("chat.emotes.limit-size",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Limit Native Emote Size",description:"Sometimes, really obnoxiously large emotes slip through the cracks and wind up on Twitch. This limits the size of Twitch emotes to mitigate the issue.",component:"setting-check-box"}}),this.settings.add("chat.fix-bad-emotes",{default:!0,ui:{path:"Chat > Appearance >> Emotes",title:"Fix Bad Twitch Global Emotes",description:"Clean up the images for bad Twitch global emotes, removing white borders and solid backgrounds.",component:"setting-check-box"}}),this.settings.add("chat.click-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information pages by Shift-Clicking them.",component:"setting-check-box"}}),this.settings.add("chat.sub-emotes",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open Twitch subscription pages by Shift-Clicking emotes when relevant.",component:"setting-check-box"}}),this.settings.add("chat.emote-dialogs",{default:!0,ui:{path:"Chat > Behavior >> General",title:"Open emote information cards for Twitch emotes by clicking them.",component:"setting-check-box"}}),this.handleClick=this.handleClick.bind(this),this.animHover=this.animHover.bind(this),this.animLeave=this.animLeave.bind(this)}onEnable(){this.style=new a.ManagedStyle("emotes");const e=this.getFavorites("twitch");let s=!1;for(let n=0;n<e.length;n++)"number"==typeof e[n]&&(s=!0,e[n]=`${e[n]}`);if(s&&this.setFavorites("twitch",e),Object.keys(this.emote_sets).length){this.log.info("Generating CSS for existing emote sets.");for(const e in this.emote_sets)if(Object(u.has)(this.emote_sets,e)){const s=this.emote_sets[e];s&&s.pending_css&&(this.style.set(`es--${e}`,s.pending_css+(s.css||"")),s.pending_css=null)}}this.on("socket:command:follow_sets",this.updateFollowSets,this),this.loadGlobalSets()}updateFollowSets(e){for(const s in e)if(Object(u.has)(e,s)){const n=this.parent.getRoom(null,s,!0);if(!n||n.destroyed)continue;const o=e[s]||[],a=n.emote_sets,u=a&&a._sources;if(u&&u.has("featured"))for(const e of u.get("featured")){const s=o.indexOf(e);-1===s?n.removeSet("featured",e):o.splice(s,1)}for(const e of o)n.addSet("featured",e),this.emote_sets[e]||this.loadSet(e)}}toggleHidden(e,s,n=null){const o=`hidden-emotes.${e}`,a=this.settings.provider,u=a.get(o,[]),f=u.indexOf(s);if(null===n&&(n=-1===f),n&&-1===f)u.push(s);else{if(n||-1===f)return;u.splice(f,1)}u.length?a.set(o,u):a.delete(o),this.emit(":change-hidden",e,s,n)}isHidden(e,s){return this.getHidden(e).includes(s)}getHidden(e){return this.settings.provider.get(`hidden-emotes.${e}`)||[]}setHidden(e,s){const n=`hidden-emotes.${e}`;Array.isArray(s)&&s.length?this.settings.provider.set(n,s):this.settings.provider.delete(n)}animHover(e){const s=e.currentTarget;s[x]||(s[k]&&cancelAnimationFrame(s[k]),s[k]=requestAnimationFrame((()=>{if(s[k]=null,s[x])return;if(!s.matches(":hover"))return;s[x]=!0;const e=s.querySelectorAll(".ffz-hover-emote");for(const s of e){const e=s.dataset;e.normalSrc&&e.hoverSrc&&(s.src=e.hoverSrc,s.srcset=e.hoverSrcSet)}})))}animLeave(e){const s=e.currentTarget;s[x]&&(s[k]&&cancelAnimationFrame(s[k]),s[k]=requestAnimationFrame((()=>{if(s[k]=null,!s[x])return;if(s.matches(":hover"))return;s[x]=!1;const e=s.querySelectorAll(".ffz-hover-emote");for(const s of e){const e=s.dataset;e.normalSrc&&(s.src=e.normalSrc,s.srcset=e.normalSrcSet)}})))}toggleFavorite(e,s,n=null){const o=`favorite-emotes.${e}`,a=this.settings.provider,u=a.get(o)||[],f=u.indexOf(s);if(null===n&&(n=-1===f),n&&-1===f)u.push(s);else{if(n||-1===f)return;u.splice(f,1)}u.length?a.set(o,u):a.delete(o),this.emit(":change-favorite",e,s,n)}isFavorite(e,s){const n=this.settings.provider.get(`favorite-emotes.${e}`);return n&&n.includes(s)}getFavorites(e){return this.settings.provider.get(`favorite-emotes.${e}`)||[]}setFavorites(e,s){const n=`favorite-emotes.${e}`;Array.isArray(s)&&s.length?this.settings.provider.set(n,s):this.settings.provider.delete(n)}handleClick(e){const s=e.target,n=s&&s.dataset;if(!n)return;const o=n.provider,a=this.parent.context.get("chat.click-emotes"),f=this.parent.context.get("chat.sub-emotes");if(e.shiftKey&&(a||f)){let e;if("twitch"===o){if(e=`https://twitchemotes.com/emotes/${n.id}`,f){const s=this.resolve("site.apollo");if(s)return s.client.query({query:_.a,variables:{id:n.id}}).then((s=>{const n=Object(u.get)("data.emote.subscriptionProduct",s);if(n&&"ACTIVE"===n.state&&n.owner&&n.owner.login)e=`https://www.twitch.tv/subs/${n.owner.login}`;else if(!a)return!1;if(e){const s=window.open();s&&(s.opener=null,s.location=e)}})),!0}}else if("ffz"===o){const s=this.emote_sets[n.set],o=s&&s.emotes[n.id];if(!o)return;o.click_url?e=o.click_url:s.source||(e=`https://www.frankerfacez.com/emoticons/${o.id}`)}if(!a)return!1;if(e){const s=window.open();s&&(s.opener=null,s.location=e)}return!0}if(e[C]){let e,a;if("twitch"===o)e="twitch",a=n.id;else if("ffz"===o){const s=this.emote_sets[n.set],o=s&&s.emotes[n.id];if(!o)return;e=s.source||"ffz",a=o.id}else{if("emoji"!==o)return;e="emoji",a=n.code}this.toggleFavorite(e,a);const u=s._ffz_tooltip;return u&&u.visible&&(u.hide(),setTimeout((()=>document.contains(s)&&u.show()),0)),!0}if("twitch"===o&&this.parent.context.get("chat.emote-dialogs")){const e=this.resolve("site.fine");if(!e)return;const o=e.searchParent(s,(e=>e.props&&e.props.message)),a=e.searchParent(s,(e=>e.onShowEmoteCard),200);if(!o||!a)return;const u=s.getBoundingClientRect();return a.onShowEmoteCard({channelID:o.props.channelID||"",channelLogin:o.props.channelLogin||"",emoteID:n.id,emoteCode:s.alt,sourceID:"chat",referrerID:"",initialTopOffset:u.bottom,initialBottomOffset:u.top}),!0}}getSetIDs(e,s,n,o){const a=this.parent.getRoom(n,o,!0),u=a&&a.getUser(e,s,!0),f=this.parent.getUser(e,s,!0);return(null!=f&&f.emote_sets?f.emote_sets._cache:[]).concat(null!=u&&u.emote_sets?u.emote_sets._cache:[],null!=a&&a.emote_sets?a.emote_sets._cache:[],this.default_sets._cache)}getSets(e,s,n,o){return this.getSetIDs(e,s,n,o).map((e=>this.emote_sets[e]))}_withSources(e,s,n){if(null!=n&&n._sources){for(const[o,a]of n._sources)for(const n of a)s.has(n)||(e.push([n,o]),s.add(n));return e}}getRoomSetIDsWithSources(e,s,n,o){const a=this.parent.getRoom(n,o,!0),u=a&&a.getUser(e,s,!0);if(!a)return[];const f=[],g=new Set;return this._withSources(f,g,a.emote_sets),u&&this._withSources(f,g,u),f}getRoomSetsWithSources(e,s,n,o){return this.getRoomSetIDsWithSources(e,s,n,o).map((([e,s])=>[this.emote_sets[e],s]))}getRoomSetIDs(e,s,n,o){const a=this.parent.getRoom(n,o,!0),u=a&&a.getUser(e,s,!0);return a?null!=u&&u.emote_sets?a.emote_sets?u.emote_sets._cache.concat(a.emote_sets._cache):u.emote_sets._cache:a.emote_sets?a.emote_sets._cache:[]:[]}getRoomSets(e,s,n,o){return this.getRoomSetIDs(e,s,n,o).map((e=>this.emote_sets[e]))}getGlobalSetIDsWithSources(e,s){const n=this.parent.getUser(e,s,!0),o=[],a=new Set;return this._withSources(o,a,this.default_sets),n&&this._withSources(o,a,n.emote_sets),o}getGlobalSetsWithSources(e,s){return this.getGlobalSetIDsWithSources(e,s).map((([e,s])=>[this.emote_sets[e],s]))}getGlobalSetIDs(e,s){const n=this.parent.getUser(e,s,!0);return null!=n&&n.emote_sets?n.emote_sets._cache.concat(this.default_sets._cache):this.default_sets._cache}getGlobalSets(e,s){return this.getGlobalSetIDs(e,s).map((e=>this.emote_sets[e]))}getEmotes(e,s,n,o){const a={};for(const f of this.getSets(e,s,n,o))if(f&&f.emotes)for(const e of Object.values(f.emotes))e&&!Object(u.has)(a,e.name)&&(a[e.name]=e);return a}addDefaultSet(e,s,n){"number"==typeof s&&(s=`${s}`);let o=!1,a=!1;return this.default_sets.sourceIncludes(e,s)||(o=!this.default_sets.includes(s),this.default_sets.push(e,s),a=!0),n&&this.loadSetData(s,n),o&&(this.refSet(s),this.emit(":update-default-sets",e,s,!0)),a}removeDefaultSet(e,s){return"number"==typeof s&&(s=`${s}`),!!this.default_sets.sourceIncludes(e,s)&&(this.default_sets.remove(e,s),this.default_sets.includes(s)||(this.unrefSet(s),this.emit(":update-default-sets",e,s,!1)),!0)}refSet(e){this._set_refs[e]=(this._set_refs[e]||0)+1,this._set_timers[e]&&(clearTimeout(this._set_timers[e]),this._set_timers[e]=null)}unrefSet(e){(this._set_refs[e]=(this._set_refs[e]||1)-1)<=0&&!this._set_timers[e]&&(this._set_timers[e]=setTimeout((()=>this.unloadSet(e)),5e3))}async loadGlobalSets(e=0){let s,n;if(this.experiments.getAssignment("api_load")&&e<1)try{fetch(`${f.NEW_API}/v1/set/global`).catch((()=>{}))}catch(e){}try{s=await fetch(`${f.API_SERVER}/v1/set/global`)}catch(s){return++e<10?setTimeout((()=>this.loadGlobalSets(e)),500*e):(this.log.error("Error loading global emote sets.",s),!1)}if(!s.ok)return!1;try{n=await s.json()}catch(e){return this.log.error("Error parsing global emote data.",e),!1}const o=n.sets||{};for(const e of n.default_sets)this.addDefaultSet("ffz-global",e);for(const e in o)Object(u.has)(o,e)&&this.loadSetData(e,o[e]);return n.users&&this.loadSetUsers(n.users),!0}async loadSet(e,s=!1,n=0){let o,a;if(this.experiments.getAssignment("api_load"))try{fetch(`${f.NEW_API}/v1/set/${e}`).catch((()=>{}))}catch(e){}try{o=await fetch(`${f.API_SERVER}/v1/set/${e}`)}catch(s){return++n<10?setTimeout((()=>this.loadGlobalSets(n)),500*n):(this.log.error(`Error loading data for set "${e}".`,s),!1)}if(!o.ok)return!1;try{a=await o.json()}catch(s){return this.log.error(`Error parsing data for set "${e}".`,s),!1}const u=a.set;return u&&this.loadSetData(u.id,u,s),a.users&&this.loadSetUsers(a.users),!0}loadSetUsers(e,s=!1){for(const n in e)if(Object(u.has)(e,n)){const o=this.emote_sets[n],a=e[n];for(const e of a)this.parent.getUser(void 0,e).addSet("ffz-global",n);s||this.log.info(`Added "${o?o.title:n}" emote set to ${a.length} users.`)}}loadSetData(e,s,n=!1){const o=this.emote_sets[e];if(!s)return void(o&&(this.emote_sets[e]=null));this.emote_sets[e]=s;let a=0;const f=s.emotes||s.emoticons,g=s.emotes={},_=[];s.id=e,s.emoticons=void 0;const b=[];for(const s of f){var v;if(!s.id||!s.name||!s.urls){b.push(s);continue}s.set_id=e,s.src=s.urls[1],s.srcSet=`${s.urls[1]} 1x`,s.urls[2]&&(s.srcSet+=`, ${s.urls[2]} 2x`),s.urls[4]&&(s.srcSet+=`, ${s.urls[4]} 4x`),s.urls[2]&&(s.can_big=!0,s.src2=s.urls[2],s.srcSet2=`${s.urls[2]} 1x`,s.urls[4]&&(s.srcSet2+=`, ${s.urls[4]} 2x`)),null!==(v=s.animated)&&void 0!==v&&v[1]&&(s.animSrc=s.animated[1],s.animSrcSet=`${s.animated[1]} 1x`,s.animated[2]&&(s.animSrcSet+=`, ${s.animated[2]} 2x`,s.animSrc2=s.animated[2],s.animSrcSet2=`${s.animated[2]} 1x`,s.animated[4]&&(s.animSrcSet+=`, ${s.animated[4]} 4x`,s.animSrcSet2+=`, ${s.animated[4]} 2x`))),s.token={type:"emote",id:s.id,set:e,provider:"ffz",src:s.src,srcSet:s.srcSet,can_big:!!s.urls[2],src2:s.src2,srcSet2:s.srcSet2,animSrc:s.animSrc,animSrcSet:s.animSrcSet,animSrc2:s.animSrc2,animSrcSet2:s.animSrcSet2,text:s.hidden?"???":s.name,length:s.name.length,height:s.height},Object(u.has)(E,s.id)&&Object.assign(s,E[s.id]);const n=this.generateEmoteCSS(s);n&&_.push(n),a++,g[s.id]=s}b.length&&this.log.warn(`Bad Emote Data for Set #${e}`,b),s.count=a,this.style&&(_.length||s.css)?this.style.set(`es--${e}`,_.join("")+(s.css||"")):_.length&&(s.pending_css=_.join("")),n||this.log.info(`Loaded emote set #${e}: ${s.title} (${a} emotes)`),this.emit(":loaded",e,s);(this._set_refs[e]||0)<=0&&!this._set_timers[e]&&(this._set_timers[e]=setTimeout((()=>this.unloadSet(e)),5e3))}unloadSet(e,s=!1,n=!1){const o=this.emote_sets[e],a=this._set_refs[e]||0;if(o){if(a>0){if(!s)return this.log.warn(`Attempted to unload emote set #${e} with ${a} users.`);this.log.warn(`Unloading emote set ${e} with ${a} users.`)}n||this.log.info(`Unloaded emote set #${e}: ${o.title}`),this._set_timers[e]&&(clearTimeout(this._set_timers[e]),this._set_timers[e]=null),this.emit(":unloaded",e,o),this.emote_sets[e]=null}}generateEmoteCSS(e){if(!(e.margins||e.modifier&&(e.modifier_offset||e.extra_width||e.shrink_to_fit)||e.css))return"";let s="";if(e.modifier&&(e.modifier_offset||e.margins||e.extra_width||e.shrink_to_fit)){let n=e.modifier_offset||e.margins||"0";n=n.split(/\s+/).map((e=>parseInt(e,10))),3===n.length&&n.push(n[1]);const o=n.length,a=n[0%o],u=n[1%o],f=n[2%o],g=n[3%o];s=`.modified-emote span .ffz-emote[data-id="${e.id}"] {\n\tpadding: ${a}px ${u}px ${f}px ${g}px;\n\t${e.shrink_to_fit?`max-width: calc(100% - ${40-g-u-(e.extra_width||0)}px);`:""}\n\tmargin: 0 !important;\n}`}return`${s}.ffz-emote[data-id="${e.id}"] {\n\t${e.margins&&!e.modifier?`margin: ${e.margins} !important;`:""}\n\t${e.css||""}\n}`}setTwitchEmoteSet(e,s){if("number"==typeof e){if(isNaN(e)||!isFinite(e))return;e=`${e}`}if("number"==typeof s){if(isNaN(s)||!isFinite(s))return;s=`${s}`}this.__twitch_emote_to_set[e]=s}setTwitchSetChannel(e,s){if("number"==typeof e){if(isNaN(e)||!isFinite(e))return;e=`${e}`}this.__twitch_set_to_channel[e]=s}_getTwitchEmoteSet(e){const s=this.__twitch_emote_to_set,n=this.__twitch_set_to_channel;if("number"==typeof e){if(isNaN(e)||!isFinite(e))return Promise.resolve(null);e=`${e}`}if(Object(u.has)(s,e)){const n=s[e];return Array.isArray(n)?new Promise((e=>n.push(e))):Promise.resolve(n)}const o=this.resolve("site.apollo");return null!=o&&o.client?new Promise((a=>{const g=[a];s[e]=g,Object(u.timeout)(o.client.query({query:_.a,variables:{id:`${e}`}}),2e3).then((o=>{var a;const _=null==o||null===(a=o.data)||void 0===a?void 0:a.emote;let b=null;if(_&&(b=_.setID,b&&!Object(u.has)(n,b))){var v;const e=function determineEmoteType(e){const s=e.subscriptionProduct;if(s){if(12658==s.id)return f.EmoteTypes.Prime;if(324==s.id)return f.EmoteTypes.Turbo;const e=s.owner;if(e)return 139075904==e.id||"INACTIVE"===s.state?f.EmoteTypes.LimitedTime:f.EmoteTypes.Subscription}if(300238151==e.setID)return f.EmoteTypes.ChannelPoints;if(300374282==e.setID)return f.EmoteTypes.TwoFactor;const n=parseInt(e.setID,10);return!isNaN(n)&&isFinite(n)&&n>=5e8?f.EmoteTypes.BitsTier:f.EmoteTypes.Global}(_);n[b]={id:b,type:e,owner:(null==_||null===(v=_.subscriptionProduct)||void 0===v?void 0:v.owner)||(null==_?void 0:_.owner)}}s[e]=b;for(const e of g)e(b)})).catch((()=>{s[e]=null;for(const e of g)e(null)}))})):Promise.resolve(null)}getTwitchEmoteSet(e,s){const n=this._getTwitchEmoteSet(e);if(!s)return n;n.then(s)}_getTwitchSetChannel(e){const s=this.__twitch_set_to_channel;if("number"==typeof e){if(isNaN(e)||!isFinite(e))return Promise.resolve(null);e=`${e}`}if(Object(u.has)(s,e)){const n=s[e];return Array.isArray(n)?new Promise((e=>n.push(e))):Promise.resolve(n)}const n=this.resolve("site.apollo");return null!=n&&n.client?new Promise((o=>{const a=[o];s[e]=a,Object(u.timeout)(n.client.query({query:v.a,variables:{id:`${e}`}}),2e3).then((n=>{var o;const u=null==n||null===(o=n.data)||void 0===o?void 0:o.emoteSet;let f=null;u&&(f={id:e,type:determineSetType(u),owner:u.owner?{id:u.owner.id,login:u.owner.login,displayName:u.owner.displayName}:null}),s[e]=f;for(const e of a)e(f)})).catch((()=>{s[e]=null;for(const e of a)e(null)}))})):Promise.resolve(null)}getTwitchSetChannel(e,s){const n=this._getTwitchSetChannel(e);if(!s)return n;n.then(s)}}function determineSetType(e){const s=/^\d+$/.test(e.id)?parseInt(e.id,10):null;if(s&&f.TWITCH_GLOBAL_SETS.includes(s))return f.EmoteTypes.Global;if(s&&f.TWITCH_POINTS_SETS.includes(s))return f.EmoteTypes.ChannelPoints;if(s&&f.TWITCH_PRIME_SETS.includes(s))return f.EmoteTypes.Prime;if(300374282==s)return f.EmoteTypes.TwoFactor;const n=e.owner;if(n){if(139075904==n.id)return f.EmoteTypes.LimitedTime;let s;if(Array.isArray(n.subscriptionProducts))for(const o of n.subscriptionProducts)if(e.id==o.emoteSetID){s=o;break}if(s){if(12658==s.id)return f.EmoteTypes.Prime;if(324==s.id)return f.EmoteTypes.Turbo;if("INACTIVE"===s.state)return f.EmoteTypes.LimitedTime}return f.EmoteTypes.Subscription}return s>=5e8?f.EmoteTypes.BitsTier:f.EmoteTypes.Global}},function(e,s){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetEmoteSetInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"emoteSet"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionProducts"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"state"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:175}};n.loc.source={body:"query FFZ_GetEmoteSetInfo($id: ID!) {\n\temoteSet(id: $id) {\n\t\tid\n\t\towner {\n\t\t\tid\n\t\t\tlogin\n\t\t\tdisplayName\n\t\t\tsubscriptionProducts {\n\t\t\t\tid\n\t\t\t\temoteSetID\n\t\t\t\tstate\n\t\t\t}\n\t\t}\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function collectFragmentReferences(e,s){if("FragmentSpread"===e.kind)s.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&s.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,s)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,s)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,s)}))}var o={};function findOperation(e,s){for(var n=0;n<e.definitions.length;n++){var o=e.definitions[n];if(o.name&&o.name.value==s)return o}}!function extractReferences(){n.definitions.forEach((function(e){if(e.name){var s=new Set;collectFragmentReferences(e,s),o[e.name.value]=s}}))}(),e.exports=n,e.exports.FFZ_GetEmoteSetInfo=function oneQuery(e,s){var n={kind:e.kind,definitions:[findOperation(e,s)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var a=o[s]||new Set,u=new Set,f=new Set;for(a.forEach((function(e){f.add(e)}));f.size>0;){var g=f;f=new Set,g.forEach((function(e){u.has(e)||(u.add(e),(o[e]||new Set).forEach((function(e){f.add(e)})))}))}return u.forEach((function(s){var o=findOperation(e,s);o&&n.definitions.push(o)})),n}(n,"FFZ_GetEmoteSetInfo")},function(e,s,n){"use strict";n.d(s,"a",(function(){return Overrides}));var o=n(4),a=n(1),u=n(27);class Overrides extends o.default{constructor(...e){super(...e),this.inject("settings"),this.color_cache=null,this.name_cache=null}onEnable(){this.settings.provider.on("changed",this.onProviderChange,this)}renderUserEditor(e,s){let o,f,g;const destroy=()=>{const e=o,s=f,n=g;o=f=g=null,e&&e.destroy(),s&&s.destroy(),n&&n.$destroy()},_=document.fullscreenElement||document.body.querySelector("#root>div")||document.body;f=new u.default(_,[],{logger:this.log,manual:!0,live:!1,html:!0,hover_events:!0,no_update:!0,no_auto_remove:!0,tooltipClass:"ffz-action-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"",arrowInner:"",innerClass:"",popper:{placement:"bottom",modifiers:{preventOverflow:{boundariesElement:_},flip:{behavior:["bottom","top","left","right"]}}},content:async(s,o)=>{const u=this.resolve("vue"),f=n.e(155).then(n.bind(null,371)),[,_]=await Promise.all([u.enable(),f]);return u.component("override-editor",_.default),g=new u.Vue({el:Object(a.createElement)("div"),render:s=>s("override-editor",{user:e,name:this.getName(e.id),color:this.getColor(e.id),updateTip:()=>o.update(),setColor:s=>this.setColor(e.id,s),deleteColor:()=>this.deleteColor(e.id),setName:s=>this.setName(e.id,s),deleteName:()=>this.deleteName(e.id),close:()=>o.hide()})}),g.$el},onShow:async(e,s)=>{await s.waitForDom(),requestAnimationFrame((()=>{o=new a.ClickOutside(s.outer,destroy)}))},onMove:(e,s,n)=>{this.emit("tooltips:mousemove",e,s,n)},onLeave:(e,s,n)=>{this.emit("tooltips:leave",e,s,n)},onHide:destroy}),f._enter(s)}onProviderChange(e){"overrides.colors"===e?this.loadColors():"overrides.names"===e&&this.loadNames()}get colors(){return this.color_cache||this.loadColors(),this.color_cache}get names(){return this.name_cache||this.loadNames(),this.name_cache}loadColors(){let e,s=!0;this.color_cache?e=new Set(Object.keys(this.color_cache)):(s=!1,this.color_cache={},e=new Set);for(const[n,o]of Object.entries(this.settings.provider.get("overrides.colors",{})))e.delete(n),this.color_cache[n]!==o&&(this.color_cache[n]=o,s&&this.emit(":changed",n,"color",o));for(const n of e)this.color_cache[n]=void 0,s&&this.emit(":changed",n,"color",void 0)}loadNames(){let e,s=!0;this.name_cache?e=new Set(Object.keys(this.name_cache)):(s=!1,this.name_cache={},e=new Set);for(const[n,o]of Object.entries(this.settings.provider.get("overrides.names",{})))e.delete(n),this.name_cache[n]!==o&&(this.name_cache[n]=o,s&&this.emit(":changed",n,"name",o));for(const n of e)this.name_cache[n]=void 0,s&&this.emit(":changed",n,"name",void 0)}getColor(e){return null!=this.colors[e]?this.colors[e]:null}getName(e){return null!=this.names[e]?this.names[e]:null}setColor(e,s){this.colors[e]!==s&&(this.colors[e]=s,this.settings.provider.set("overrides.colors",this.colors),this.emit(":changed",e,"color",s))}setName(e,s){this.names[e]!==s&&(this.names[e]=s,this.settings.provider.set("overrides.names",this.names),this.emit(":changed",e,"name",s))}deleteColor(e){this.setColor(e,void 0)}deleteName(e){this.setName(e,void 0)}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return Room}));var o=n(76),a=n(2),u=n(1),f=n(0),g=n(74);class Room{constructor(e,s,n){this._destroy_timer=null,this.refs=new Set,this.style=new u.ManagedStyle(`room--${n}`),this.emote_sets=null,this.badges=null,this.users={},this.user_ids={},this.manager=e,this._id=s,this.login=n,s&&(this.manager.room_ids[s]=this),this.manager.emit(":room-add",this),this.load_data()}destroy(){if(clearTimeout(this._destroy_timer),this._destroy_timer=null,this.destroyed=!0,this.manager.emit(":room-remove",this),this.users)for(const e of Object.values(this.users))e&&e.destroy();if(this.user_ids)for(const e of Object.values(this.user_ids))e&&e.destroy();if(this.refs=null,this.users=null,this.user_ids=null,this.style&&(this.style.destroy(),this.style=null),this.emote_sets){for(const e of this.emote_sets._cache)this.manager.emotes.unrefSet(e);this.emote_sets=null}this._login&&(this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null),this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`)),this.manager.room_ids[this._id]===this&&(this.manager.room_ids[this._id]=null)}merge(e){if(!this.login&&e.login&&(this.login=e.login),e.refs)for(const s of e.refs)this.ref(s);if(e.emote_sets&&e.emote_sets._sources)for(const[s,n]of e.emote_sets._sources.entries())for(const e of n)this.addSet(s,e);e.data&&!this.data&&(this.data=e.data,this.data.css?this.style.set("css",this.data.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS()),e.badges&&!this.badges&&(this.badges=e.badges,this.buildBadgeCSS()),e.bitsConfig&&!this.bitsConfig&&(this.bitsConfig=e.bitsConfig,this.buildBitsCSS());const s=new Set;if(e.users)for(const n of Object.values(e.users))n.destroyed||s.has(n)||(this.getUser(n.id,n.login).merge(n),s.add(n));if(e.user_ids)for(const n of Object.values(e.user_ids))n.destroyed||s.has(n)||(this.getUser(n.id,n.login).merge(n),s.add(n))}get id(){return this._id}get login(){return this._login}set login(e){if(this._login===e)return;if(this._login){this.manager.rooms[this._login]===this&&(this.manager.rooms[this._login]=null,this.manager.socket&&this.manager.socket.unsubscribe(this,`room.${this.login}`))}if(this._login=e,!e)return;const s=this.manager.rooms[e];s&&s!==this&&(s.login=null),this._login=e,this.manager.rooms[e]=this,this.manager.socket&&this.manager.socket.subscribe(this,`room.${e}`),this.manager.emit(":room-update-login",this,e)}getUser(e,s,n,a,u=!1){if(this.destroyed)return null;let f;if(e&&"number"==typeof e&&(e=`${e}`),e&&this.user_ids[e]?f=this.user_ids[e]:s&&this.users[s]&&!a&&(f=this.users[s]),f&&f.destroyed&&(f=null),!f){if(n)return null;f=new o.a(this.manager,this,e,s)}if(e&&e!==f.id){if(f.id){if(this.manager.log.warn(`Data mismatch for user #${e} -- Stored ID: ${f.id} -- Login: ${s} -- Stored Login: ${f.login}`),u)throw new Error("id mismatch");this.user_ids[f.id]===f&&(this.user_ids[f.id]=null)}f._id=e,this.user_ids[e]=f}if(s){const e=this.users[s];e?e===f||a||(e.id?this.users[s]=f:(f.merge(e),e.destroy())):this.users[s]=f}return f}async load_data(e=0){var s;if(this.destroyed)return;if(this.manager.experiments.getAssignment("api_load"))try{fetch(`${a.NEW_API}/v1/room/${this.id?`id/${this.id}`:this.login}`).catch((()=>{}))}catch(e){}let n,o;try{n=await fetch(`${a.API_SERVER}/v1/room/${this.id?`id/${this.id}`:this.login}`)}catch(s){return++e<10?setTimeout((()=>this.load_data(e)),500*e):(this.manager.log.error(`Error loading room data for ${this.id}:${this.login}`,s),!1)}if(!n.ok)return!1;try{o=await n.json()}catch(e){return this.manager.log.error(`Error parsing room data for ${this.id}:${this.login}`,e),!1}const u=null===(s=this.data)||void 0===s?void 0:s.user_badge_ids;if(u)for(const e in u)if(Object(f.has)(u,e))for(const s of u[e])this.getUser(s,void 0).removeBadge("ffz",e);const g=o.room,_=`${g.twitch_id}`;if(this._id){if(this._id!==_)return this.manager.log.warn(`Received data for ${this.id}:${this.login} with the wrong ID: ${_}`),!1}else this._id=_,this.manager.room_ids[_]=this;if(this.login?this.login!==g.id&&this.manager.log.warn(`Login mismatch for room ${this.id}:${this.login}. Got "${g.id}" from FFZ's API.`):this.login=g.id,this.data=g,g.set?this.addSet("main",g.set):this.removeAllSets("main"),o.sets)for(const e in o.sets)Object(f.has)(o.sets,e)&&this.manager.emotes.loadSetData(e,o.sets[e]);const b=g.user_badge_ids;if(b)for(const e in b)if(Object(f.has)(b,e))for(const s of b[e])this.getUser(s,void 0).addBadge("ffz",e);return g.css?this.style.set("css",g.css):this.style.delete("css"),this.buildModBadgeCSS(),this.buildVIPBadgeCSS(),!0}addSet(e,s,n){if(this.destroyed)return;this.emote_sets||(this.emote_sets=new f.SourcedSet),"number"==typeof s&&(s=`${s}`);let o=!1,a=!1;return this.emote_sets.sourceIncludes(e,s)||(o=!this.emote_sets.includes(s),this.emote_sets.push(e,s),a=!0),n&&this.manager.emotes.loadSetData(s,n),o&&(this.manager.emotes.refSet(s),this.manager.emotes.emit(":update-room-sets",this,e,s,!0)),a}removeAllSets(e){if(this.destroyed||!this.emote_sets)return!1;const s=this.emote_sets.get(e);if(!Array.isArray(s)||!s.length)return!1;for(const n of s)this.removeSet(e,n);return!0}removeSet(e,s){if(!this.destroyed&&this.emote_sets)return"number"==typeof s&&(s=`${s}`),!!this.emote_sets.sourceIncludes(e,s)&&(this.emote_sets.remove(e,s),this.emote_sets.includes(s)||(this.manager.emotes.unrefSet(s),this.manager.emotes.emit(":update-room-sets",this,e,s,!1)),!0)}ref(e){if(!this.refs)throw new Error("Attempting to use destroyed Room");clearTimeout(this._destroy_timer),this._destroy_timer=null,this.refs.add(e)}unref(e){this.refs&&(this.refs.delete(e),this.refs.size||this._destroy_timer||(this._destroy_timer=setTimeout((()=>this.destroy()),5e3)))}badgeCount(){return this.badge_count||0}updateBadges(e){if(this.badge_count=0,Array.isArray(e)){const s={};for(const n of e){const e=n.setID;(s[e]=s[e]||{__cat:Object(g.c)(e)})[n.version]=Object(g.b)(n),this.badge_count++}this.badges=s}else this.badges=e;this.buildBadgeCSS()}buildVIPBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.vip_badge||!this.manager.context.get("chat.badges.custom-vip"))return this.style.delete("vip-badge");const e=this.data.vip_badge,s=`url("${e[1]}")`;let n;(e[2]||e[4])&&(n=`${a.WEBKIT_CSS}image-set(${s} 1x${e[2]?`, url("${e[2]}") 2x`:""}${e[4]?`, url("${e[4]}") 4x`:""})`),this.style.set("vip-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="vip"] {\n\t\t\tbackground-color: transparent;\n\t\t\tbackground-image: ${s};\n\t\t\t${n?`background-image: ${n};`:""}\n\t\t\t${a.WEBKIT_CSS}mask-image: unset;\n\t\t}`)}buildModBadgeCSS(){if(this.destroyed)return;if(!this.data||!this.data.mod_urls||!this.manager.context.get("chat.badges.custom-mod"))return this.style.delete("mod-badge");const e=this.manager.context.get("chat.badges.style"),s=e>5?`${a.WEBKIT_CSS}mask`:"background";if(!(3!==e&&4!==e))return this.style.delete("mod-badge");const n=this.data.mod_urls,o=`url("${n[1]}")`;let u;(n[2]||n[4])&&(u=`${a.WEBKIT_CSS}image-set(${o} 1x${n[2]?`, url("${n[2]}") 2x`:""}${n[4]?`, url("${n[4]}") 4x`:""})`),this.style.set("mod-badge",`[data-room-id="${this.id}"] .ffz-badge[data-badge="moderator"] {\n\t\t\t${s}-image: ${o};\n\t\t\t${u?`${s}-image: ${u};`:""}\n\t\t}`)}buildBadgeCSS(){if(this.destroyed)return;if(!this.badges)return this.style.delete("badges");const e=a.IS_FIREFOX&&this.manager.context.get("chat.badges.media-queries"),s=this.manager.context.get("chat.badges.clickable"),n=[],o=this.id;for(const u in this.badges)if(Object(f.has)(this.badges,u)){const g=this.badges[u];for(const _ in g)if(Object(f.has)(g,_)){const f=g[_],b=`[data-room-id="${o}"] .ffz-badge[data-badge="${u}"][data-version="${_}"]`;n.push(`${b} {\n\t\t\t${s&&(f.click_action||f.click_url)?"cursor:pointer;":""}\n\t\t\tbackground-color: transparent;\n\t\t\tfilter: none;\n\t\t\t${a.WEBKIT_CSS}mask-image: none;\n\t\t\theight: 1.8rem;\n\t\t\twidth: 1.8rem;\n\t\t\tbackground-size: 1.8rem;\n\t\t\tbackground-image: url("${f.image1x}");\n\t\t\tbackground-image: ${a.WEBKIT_CSS}image-set(\n\t\t\t\turl("${f.image1x}") 1x,\n\t\t\t\turl("${f.image2x}") 2x,\n\t\t\t\turl("${f.image4x}") 4x\n\t\t\t);\n\t\t}`),e&&(n.push(`@media (min-resolution: 100dpi) and (max-resolution:199dpi) { ${b} {\n\t\t\t\t\t\t\t\tbackground-image: url("${f.image2x}");\n\t\t\t\t\t\t\t}}`),n.push(`@media (min-resolution: 200dpi) { ${b} {\n\t\t\t\t\t\t\t\tbackground-image: url("${f.image4x}");\n\t\t\t\t\t\t\t}}`))}}this.style.set("badges",n.join("\n"))}updateBitsConfig(e,s){if(!s&&this.bitsConfig&&e){const s=new Set(Object.keys(this.bitsConfig)),n=new Set(Object.keys(e));if(Object(f.set_equals)(s,n))return}this.bitsConfig=e,this.buildBitsCSS()}buildBitsCSS(){if(this.destroyed)return;if(!this.bitsConfig)return this.style.delete("bits");const e=this.manager.context.get("chat.bits.animated")?"animated":"static",s=this.manager.context.get("theme.is-dark")?"dark":"light",n=this.manager.context.get("theme.tooltips-dark")?"dark":"light",o=[];for(const u in this.bitsConfig)if(Object(f.has)(this.bitsConfig,u)){const f=this.bitsConfig[u],g=f.prefix.toLowerCase(),_=f.tiers,b=_.length;for(let u=0;u<b;u++){const f=_[u].images[s][e],b=_[u].images[n][e];o.push(`.ffz-cheer[data-prefix="${g}"][data-tier="${u}"] {\n\tcolor: ${_[u].color||"inherit"};\n\tbackground-image: url("${f[1]}");\n\tbackground-image: ${a.WEBKIT_CSS}image-set(\n\t\turl("${f[1]}") 1x,\n\t\turl("${f[2]}") 2x,\n\t\turl("${f[4]}") 4x\n\t);\n}\n.ffz__tooltip .ffz-cheer[data-prefix="${g}"][data-tier="${u}"] {\n\tbackground-image: url("${b[1]}");\n\tbackground-image: ${a.WEBKIT_CSS}image-set(\n\t\turl("${b[1]}") 1x,\n\t\turl("${b[2]}") 2x,\n\t\turl("${b[4]}") 4x\n\t);\n}\n.ffz-cheer-preview[data-prefix="${g}"][data-tier="${u}"] {\n\tbackground-image: url("${b[4]}");\n}`)}}this.style.set("bits",o.join("\n"))}}},function(e,s){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetClipInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slug"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"clip"},arguments:[{kind:"Argument",name:{kind:"Name",value:"slug"},value:{kind:"Variable",name:{kind:"Name",value:"slug"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"curator"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"broadcaster"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"86"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"45"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:254}};n.loc.source={body:"query FFZ_GetClipInfo($slug: ID!) {\n\tclip(slug: $slug) {\n\t\tid\n\t\tcurator {\n\t\t\tid\n\t\t\tlogin\n\t\t\tdisplayName\n\t\t}\n\t\tbroadcaster {\n\t\t\tid\n\t\t\tlogin\n\t\t\tdisplayName\n\t\t}\n\t\tgame {\n\t\t\tid\n\t\t\tdisplayName\n\t\t}\n\t\ttitle\n\t\tthumbnailURL(width: 86, height: 45)\n\t\tviewCount\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function collectFragmentReferences(e,s){if("FragmentSpread"===e.kind)s.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&s.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,s)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,s)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,s)}))}var o={};function findOperation(e,s){for(var n=0;n<e.definitions.length;n++){var o=e.definitions[n];if(o.name&&o.name.value==s)return o}}!function extractReferences(){n.definitions.forEach((function(e){if(e.name){var s=new Set;collectFragmentReferences(e,s),o[e.name.value]=s}}))}(),e.exports=n,e.exports.FFZ_GetClipInfo=function oneQuery(e,s){var n={kind:e.kind,definitions:[findOperation(e,s)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var a=o[s]||new Set,u=new Set,f=new Set;for(a.forEach((function(e){f.add(e)}));f.size>0;){var g=f;f=new Set,g.forEach((function(e){u.has(e)||(u.add(e),(o[e]||new Set).forEach((function(e){f.add(e)})))}))}return u.forEach((function(s){var o=findOperation(e,s);o&&n.definitions.push(o)})),n}(n,"FFZ_GetClipInfo")},function(e,s){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_GetVideoInfo"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"video"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"title"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"previewThumbnailURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"86"}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"IntValue",value:"45"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"lengthSeconds"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publishedAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"viewCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"game"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"owner"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:235}};n.loc.source={body:"query FFZ_GetVideoInfo($id: ID!) {\n\tvideo(id: $id) {\n\t\tid\n\t\ttitle\n\t\tpreviewThumbnailURL(width: 86, height: 45)\n\t\tlengthSeconds\n\t\tpublishedAt\n\t\tviewCount\n\t\tgame {\n\t\t\tid\n\t\t\tdisplayName\n\t\t}\n\t\towner {\n\t\t\tid\n\t\t\tlogin\n\t\t\tdisplayName\n\t\t}\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function collectFragmentReferences(e,s){if("FragmentSpread"===e.kind)s.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&s.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,s)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,s)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,s)}))}var o={};function findOperation(e,s){for(var n=0;n<e.definitions.length;n++){var o=e.definitions[n];if(o.name&&o.name.value==s)return o}}!function extractReferences(){n.definitions.forEach((function(e){if(e.name){var s=new Set;collectFragmentReferences(e,s),o[e.name.value]=s}}))}(),e.exports=n,e.exports.FFZ_GetVideoInfo=function oneQuery(e,s){var n={kind:e.kind,definitions:[findOperation(e,s)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var a=o[s]||new Set,u=new Set,f=new Set;for(a.forEach((function(e){f.add(e)}));f.size>0;){var g=f;f=new Set,g.forEach((function(e){u.has(e)||(u.add(e),(o[e]||new Set).forEach((function(e){f.add(e)})))}))}return u.forEach((function(s){var o=findOperation(e,s);o&&n.definitions.push(o)})),n}(n,"FFZ_GetVideoInfo")},function(e,s,n){"use strict";n.r(s),n.d(s,"SEPARATORS",(function(){return T})),n.d(s,"default",(function(){return Chat}));var o=n(20),a=n.n(o),u=n(4),f=n(1),g=n(0),_=n(11),b=n(74),v=n(122),k=n(49),x=n(124),C=n(125),E=n(76),z=n(79),j=n(80),O=n(112),A=n(29);const T="[\\s`~<>!-#%-\\x2A,-/:;\\x3F@\\x5B-\\x5D_\\x7B}\\u00A1\\u00A7\\u00AB\\u00B6\\u00B7\\u00BB\\u00BF\\u037E\\u0387\\u055A-\\u055F\\u0589\\u058A\\u05BE\\u05C0\\u05C3\\u05C6\\u05F3\\u05F4\\u0609\\u060A\\u060C\\u060D\\u061B\\u061E\\u061F\\u066A-\\u066D\\u06D4\\u0700-\\u070D\\u07F7-\\u07F9\\u0830-\\u083E\\u085E\\u0964\\u0965\\u0970\\u0AF0\\u0DF4\\u0E4F\\u0E5A\\u0E5B\\u0F04-\\u0F12\\u0F14\\u0F3A-\\u0F3D\\u0F85\\u0FD0-\\u0FD4\\u0FD9\\u0FDA\\u104A-\\u104F\\u10FB\\u1360-\\u1368\\u1400\\u166D\\u166E\\u169B\\u169C\\u16EB-\\u16ED\\u1735\\u1736\\u17D4-\\u17D6\\u17D8-\\u17DA\\u1800-\\u180A\\u1944\\u1945\\u1A1E\\u1A1F\\u1AA0-\\u1AA6\\u1AA8-\\u1AAD\\u1B5A-\\u1B60\\u1BFC-\\u1BFF\\u1C3B-\\u1C3F\\u1C7E\\u1C7F\\u1CC0-\\u1CC7\\u1CD3\\u2010-\\u2027\\u2030-\\u2043\\u2045-\\u2051\\u2053-\\u205E\\u207D\\u207E\\u208D\\u208E\\u2329\\u232A\\u2768-\\u2775\\u27C5\\u27C6\\u27E6-\\u27EF\\u2983-\\u2998\\u29D8-\\u29DB\\u29FC\\u29FD\\u2CF9-\\u2CFC\\u2CFE\\u2CFF\\u2D70\\u2E00-\\u2E2E\\u2E30-\\u2E3B\\u3001-\\u3003\\u3008-\\u3011\\u3014-\\u301F\\u3030\\u303D\\u30A0\\u30FB\\uA4FE\\uA4FF\\uA60D-\\uA60F\\uA673\\uA67E\\uA6F2-\\uA6F7\\uA874-\\uA877\\uA8CE\\uA8CF\\uA8F8-\\uA8FA\\uA92E\\uA92F\\uA95F\\uA9C1-\\uA9CD\\uA9DE\\uA9DF\\uAA5C-\\uAA5F\\uAADE\\uAADF\\uAAF0\\uAAF1\\uABEB\\uFD3E\\uFD3F\\uFE10-\\uFE19\\uFE30-\\uFE52\\uFE54-\\uFE61\\uFE63\\uFE68\\uFE6A\\uFE6B\\uFF01-\\uFF03\\uFF05-\\uFF0A\\uFF0C-\\uFF0F\\uFF1A\\uFF1B\\uFF1F\\uFF20\\uFF3B-\\uFF3D\\uFF3F\\uFF5B\\uFF5D\\uFF5F-\\uFF65]";function sortPriorityColorTerms(e){return e.sort(((e,s)=>e[0]<s[0]?1:e[0]>s[0]?-1:!e[1]&&s[1]?1:e[1]&&!s[1]?-1:0)),e}const D=["g","gi"];function formatTerms(e){const s=[];for(let o=0;o<e.length;o++){const a=e[o];a[0].length&&a[1].push((n=a[0].join("|"),`(^|.*?${T})(?:${n})(?=$|${T})`)),s.push(a[1].length?new RegExp(a[1].join("|"),D[o]||"gi"):null)}var n;return s}const B=/[ .,!]/,P=["gif emotes","gif emoticons","gifs"];class Chat extends u.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("i18n"),this.inject("tooltips"),this.inject("experiments"),this.inject(b.a),this.inject(v.a),this.inject(k.f),this.inject(O.default),this.inject(x.a),this._link_info={},this.clickToReveal=this.clickToReveal.bind(this),this.handleMentionClick=this.handleMentionClick.bind(this),this.handleReplyClick=this.handleReplyClick.bind(this),this.style=new f.ManagedStyle,this.context=this.settings.context({}),this.rooms={},this.users={},this.room_ids={},this.user_ids={},this.tokenizers={},this.__tokenizers=[],this.rich_providers={},this.__rich_providers=[],this._hl_reasons={},this.addHighlightReason("mention","Mentioned"),this.addHighlightReason("user","Highlight User"),this.addHighlightReason("badge","Highlight Badge"),this.addHighlightReason("term","Highlight Term"),this.settings.add("debug.link-resolver.source",{default:null,ui:{path:"Debugging > Data Sources >> Links",title:"Link Resolver",component:"setting-select-box",force_seen:!0,data:[{value:null,title:"Automatic"},{value:"dev",title:"localhost"},{value:"test",title:"API Test"},{value:"prod",title:"API Production"},{value:"socket",title:"Socket Cluster (Deprecated)"}]},changed:()=>this.clearLinkCache()}),this.settings.addUI("debug.link-resolver.test",{path:"Debugging > Data Sources >> Links",component:"link-tester",getChat:()=>this,force_seen:!0}),this.settings.add("chat.timestamp-size",{default:null,ui:{path:"Chat > Appearance >> General",title:"Timestamp Font Size",description:"How large should timestamps be, in pixels. Defaults to Font Size if not set.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-size",{default:13,ui:{path:"Chat > Appearance >> General",title:"Font Size",description:"How large should text in chat be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.font-family",{default:"",ui:{path:"Chat > Appearance >> General",title:"Font Family",description:"Set the font used for displaying chat messages.",component:"setting-combo-box",data:()=>Object(A.a)()}}),this.settings.add("chat.name-format",{default:0,ui:{path:"Chat > Appearance >> Usernames",title:"Display Style",description:"Change how usernames are displayed in chat when users have an international display name set.",component:"setting-select-box",data:[{value:0,title:"International Name (Username) <Default>"},{value:1,title:"International Name"},{value:2,title:"Username"}]}}),this.settings.add("chat.lines.emote-alignment",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Emote Alignment",description:"Change how emotes are positioned in chat, potentially making messages taller in order to avoid having emotes overlap.",component:"setting-select-box",data:[{value:0,title:"Standard"},{value:1,title:"Padded"},{value:2,title:"Baseline (BTTV-Like)"}]}}),this.settings.add("chat.rich.enabled",{default:!0,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content in chat.",description:"This displays rich content blocks for things like linked clips and videos.",component:"setting-check-box"}}),this.settings.add("chat.rich.want-mid",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display larger rich content in chat.",description:"This enables the use of bigger rich content embeds in chat. This is **not** recommended for most users and/or chats.\n\n**Note:** Enabling this may cause chat to scroll at inopportune times due to content loading. Moderators should not use this feature.",component:"setting-check-box"}}),this.settings.add("chat.rich.hide-tokens",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Hide matching links for rich content.",component:"setting-check-box"}}),this.settings.add("chat.rich.all-links",{default:!1,ui:{path:"Chat > Appearance >> Rich Content",title:"Display rich content embeds for all links.",description:"*Streamers: Please be aware that this is a potential vector for NSFW imagery via thumbnails, so be mindful when capturing chat with this enabled.*",component:"setting-check-box",extra:{component:"chat-rich-example",getChat:()=>this}}}),this.settings.add("chat.rich.minimum-level",{default:0,ui:{path:"Chat > Appearance >> Rich Content",title:"Required User Level",description:"Only display rich content embeds on messages posted by users with this level or higher.",component:"setting-select-box",data:[{value:4,title:"Broadcaster"},{value:3,title:"Moderator"},{value:2,title:"VIP"},{value:1,title:"Subscriber"},{value:0,title:"Everyone"}]}}),this.settings.add("chat.scrollback-length",{default:150,ui:{path:"Chat > Behavior >> General",title:"Scrollback Length",description:"Keep up to this many lines in chat. Setting this too high will create lag.",component:"setting-text-box",process:"to_int",bounds:[1]}}),this.settings.add("chat.filtering.debug",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Display a list of highlight reasons on every chat message for debugging.",component:"setting-check-box",force_seen:!0}}),this.settings.addUI("chat.filtering.pad-bottom",{path:"Chat > Filtering > Highlight",sort:1e3,component:"setting-spacer",top:"30rem",force_seen:!0}),this.settings.add("chat.filtering.click-to-reveal",{default:!1,ui:{path:'Chat > Filtering > General @{"sort":-1} >> Behavior',title:"Click to reveal deleted terms.",component:"setting-check-box"}}),this.settings.add("chat.filtering.deleted-style",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Detailed Message Style",description:"This style will be applied to deleted messages showed in Detailed rendering mode to differentiate them from normal chat messages.",component:"setting-select-box",data:[{value:0,title:"Faded"},{value:1,title:"Faded, Line Through"},{value:2,title:"Line Through"},{value:3,title:"No Change"}]}}),this.settings.add("chat.filtering.display-deleted",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",sort:-1,title:"Rendering Mode",description:"This, when set, overrides the `Deleted Messages` mode selected in Twitch chat settings, which is normally only accessible for moderators. Brief hides messages entirely and shows a notice in chat that a number of messages were hidden. Detailed shows the contents of the message. Legacy shows `<message deleted>` with click to reveal.",component:"setting-select-box",data:[{value:!1,title:"Do Not Override"},{value:"BRIEF",title:"Brief"},{value:"DETAILED",title:"Detailed"},{value:"LEGACY",title:"Legacy"}]}}),this.settings.add("chat.filtering.display-mod-action",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Display Reason",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"In Detailed Mode"},{value:2,title:"Always"}]}}),this.settings.add("chat.automod.delete-messages",{default:!0,ui:{path:'Chat > Filtering > General >> AutoMod Filters @{"description": "Extra configuration for Twitch\'s native `Chat Filters`."}',title:"Mark messages as deleted if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.remove-messages",{default:!0,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Remove messages entirely if they contain filtered phrases.",component:"setting-check-box"}}),this.settings.add("chat.automod.run-as-mod",{default:!1,ui:{path:"Chat > Filtering > General >> AutoMod Filters",title:"Use Chat Filters as a moderator.",description:"By default, Twitch's Chat Filters feature does not function for moderators. This overrides that behavior.",component:"setting-check-box"}}),this.settings.add("chat.filtering.process-own",{default:!1,ui:{path:"Chat > Filtering > General >> Behavior",title:"Filter your own messages.",component:"setting-check-box"}}),this.settings.add("chat.filtering.ignore-clear",{default:!1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Do not Clear Chat when commanded to.",component:"setting-check-box"}}),this.settings.add("chat.filtering.remove-deleted",{default:1,ui:{path:"Chat > Behavior >> Deleted Messages",title:"Remove deleted messages from chat.",description:"Deleted messages will be removed from chat entirely. This setting is not recommended for moderators.",component:"setting-select-box",data:[{value:0,title:"Do Not Remove"},{value:1,title:"Remove Unseen (Default)"},{value:2,title:"Remove Unseen as Moderator"},{value:3,title:"Remove All"}]}}),this.settings.add("chat.delay",{default:-1,ui:{path:"Chat > Behavior >> General",title:"Artificial Chat Delay",description:"Delay the appearance of chat messages to allow for moderation before you see them.",component:"setting-select-box",data:[{value:-1,title:"Default Delay (Room Specific; Non-Mod Only)"},{value:0,title:"No Delay"},{value:300,title:"Minor (Bot Moderation; 0.3s)"},{value:1200,title:"Normal (Human Moderation; 1.2s)"},{value:5e3,title:"Large (Spoiler Removal / Slow Mods; 5s)"},{value:1e4,title:"Extra Large (10s)"},{value:15e3,title:"Extremely Large (15s)"},{value:2e4,title:"Mods Asleep; Delay Chat (20s)"},{value:3e4,title:"Half a Minute (30s)"},{value:6e4,title:"Why??? (1m)"},{value:7884e8,title:"The CBenni Option (Literally 25 Years)"}]}}),this.settings.add("chat.filtering.highlight-basic-users",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight @{"description": "These settings allow you to highlight messages in chat based on their contents. Setting priorities on rules allows you to determine which highlight color should be applied if a message matches multiple rules. Rules with a higher priority take priority over rules with lower priorities.\\n\\nYou can also create a rule that removes highlights from messages, preventing lower priority rules from highlighting them, by setting a color with an alpha value of zero. Example: `#00000000`"} >> Users',component:"basic-terms",colored:!0,words:!1,priority:!0}}),this.settings.add("__filter:highlight-users",{requires:["chat.filtering.highlight-basic-users"],equals:"requirements",process(e){const s=e.get("chat.filtering.highlight-basic-users");if(!s||!s.length)return null;const n=new Map;for(const e of s){const s=e.p||0,o=e.t;let a=e.c||null,u=e.v;if("glob"===o?u=Object(g.glob_to_regex)(u):"raw"!==o&&(u=Object(g.escape_regex)(u)),!u||!u.length)continue;try{new RegExp(u)}catch(e){continue}let f=n.get(s);if(f||(f=new Map,n.set(s,f)),a){const e=_.Color.RGBA.fromCSS(a);e&&e.a||(a=!1)}f.has(a)?f.get(a).push(u):f.set(a,[u])}const o=[];for(const[e,s]of n)for(const[n,a]of s)o.push([e,n,new RegExp(`^(?:${a.join("|")})$`,"gi")]);return sortPriorityColorTerms(o)}}),this.settings.add("chat.filtering.highlight-basic-users-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Block >> Users",component:"basic-terms",removable:!0,words:!1}}),this.settings.add("__filter:block-users",{requires:["chat.filtering.highlight-basic-users-blocked"],equals:"requirements",process(e){const s=e.get("chat.filtering.highlight-basic-users-blocked");if(!s||!s.length)return null;const n=[[],[]];for(const e of s){const s=e.t;let o=e.v;"glob"===s?o=Object(g.glob_to_regex)(o):"raw"!==s&&(o=Object(g.escape_regex)(o)),o&&o.length&&n[e.remove?1:0].push(o)}return n.map((e=>e.length?new RegExp(`^(?:${e.join("|")})$`,"gi"):null))}}),this.settings.add("chat.filtering.highlight-basic-badges",{default:[],type:"array_merge",always_inherit:!0,ui:{path:"Chat > Filtering > Highlight >> Badges",component:"badge-highlighting",colored:!0,priority:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:highlight-badges",{requires:["chat.filtering.highlight-basic-badges"],equals:"requirements",process(e){const s=e.get("chat.filtering.highlight-basic-badges");if(!s||!s.length)return null;const n=new Map;for(const e of s){let s=e.c||null;const o=e.p||0,a=e.v;if(s){const e=_.Color.RGBA.fromCSS(s);e&&e.a||(s=!1)}const u=n.get(a);(!u||u[0]<o||s&&!u[1]&&u[0]<=o)&&n.set(a,[o,s])}return n}}),this.settings.add("chat.filtering.highlight-basic-badges-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Badges @{"description": "**Note:** This section is for filtering messages out of chat from users with specific badges. If you wish to hide a badge, go to [Chat > Badges >> Visibility](~chat.badges.tabs.visibility)."}',component:"badge-highlighting",removable:!0,data:()=>this.badges.getSettingsBadges(!0)}}),this.settings.add("__filter:block-badges",{requires:["chat.filtering.highlight-basic-badges-blocked"],equals:"requirements",process(e){const s=e.get("chat.filtering.highlight-basic-badges-blocked");if(!s||!s.length)return null;const n=[[],[]];for(const e of s)e.v&&n[e.remove?1:0].push(e.v);return n[0].length||n[1].length?n:null}}),this.settings.add("chat.filtering.highlight-basic-terms",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Highlight >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",colored:!0,priority:!0,highlight:!0}}),this.settings.add("__filter:highlight-terms",{requires:["chat.filtering.highlight-tokens","chat.filtering.highlight-basic-terms"],equals:"requirements",process(e){const s=e.get("chat.filtering.highlight-tokens"),n=e.get("chat.filtering.highlight-basic-terms");if(!n||!n.length)return null;const o=new Map;let a=!1,u=!1;for(const e of n){const n=e.p||0,f=s&&(!Object(g.has)(e,"h")||e.h),b=e.s,v=e.t,k=Object(g.has)(e,"w")?e.w:"raw"!==v;let x=e.c||null,C=e.v;if("glob"===v?C=Object(g.glob_to_regex)(C):"regex"!==v&&"raw"!==v&&(C=Object(g.escape_regex)(C)),!C||!C.length)continue;try{new RegExp(C)}catch(e){continue}f?a=!0:u=!0;let E=o.get(n);if(E||(E=new Map,o.set(n,E)),x){const e=_.Color.RGBA.fromCSS(x);e&&e.a||(x=!1)}let z=E.get(x);z||E.set(x,z=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]]),z[f?0:1][b?0:1][k?0:1].push(C)}if(!a&&!u)return null;const f={hl:a?[]:null,non:u?[]:null};for(const[e,s]of o)for(const[n,o]of s){const s=formatTerms(o[0]),a=formatTerms(o[1]);(s[0]||s[1])&&f.hl.push([e,n,s]),(a[0]||a[1])&&f.non.push([e,n,a])}return a&&sortPriorityColorTerms(f.hl),u&&sortPriorityColorTerms(f.non),f}}),this.settings.add("chat.filtering.highlight-basic-blocked",{default:[],type:"array_merge",always_inherit:!0,ui:{path:'Chat > Filtering > Block >> Terms @{"description": "Please see [Chat > Filtering > Syntax Help](~) for details on how to use terms."}',component:"basic-terms",removable:!0}}),this.settings.add("__filter:block-terms",{requires:["chat.filtering.highlight-basic-blocked"],equals:"requirements",process(e){const s=e.get("chat.filtering.highlight-basic-blocked");if(!s||!s.length)return null;const n=[[[[],[]],[[],[]]],[[[],[]],[[],[]]]];let o=!1,a=!1;for(const e of s){const s=e.t,u=e.s,f=Object(g.has)(e,"w")?e.w:"raw"!==s;let _=e.v;"glob"===s?_=Object(g.glob_to_regex)(_):"regex"!==s&&"raw"!==s&&(_=Object(g.escape_regex)(_)),_&&_.length&&(e.remove?o=!0:a=!0,n[e.remove?1:0][u?0:1][f?0:1].push(_))}return o||a?{remove:o?formatTerms(n[1]):null,non:a?formatTerms(n[0]):null}:null}}),this.settings.add("chat.filtering.clickable-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Viewer Cards >> Behavior",title:"Enable opening viewer cards by clicking mentions in chat."}}),this.settings.add("chat.filtering.color-mentions",{default:!1,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with username colors.",description:"**Note:** Not compatible with color overrides as mentions do not include user IDs."}}),this.settings.add("chat.filtering.bold-mentions",{default:!0,ui:{component:"setting-check-box",path:"Chat > Filtering > General >> Appearance",title:"Display mentions in chat with a bold font."}}),this.settings.add("chat.filtering.mention-priority",{default:0,ui:{path:"Chat > Filtering > General >> Appearance",title:"Mention Priority",component:"setting-text-box",type:"number",process:"to_int",description:"Mentions of your name have this priority for the purpose of highlighting. See [Chat > Filtering > Highlight](~chat.filtering.highlight) for more details."}}),this.settings.add("chat.filtering.mention-color",{default:"",ui:{path:"Chat > Filtering > General >> Appearance",title:"Custom Highlight Color",component:"setting-color-box",description:"If this is set, highlighted messages with no default color set will use this color rather than red."}}),this.settings.add("chat.filtering.highlight-mentions",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight messages that mention you.",component:"setting-check-box"}}),this.settings.add("chat.filtering.highlight-tokens",{default:!1,ui:{path:"Chat > Filtering > General >> Appearance",title:"Highlight matched words in chat.",component:"setting-check-box"}}),this.settings.add("tooltip.images",{default:!0,ui:{path:'Chat > Tooltips >> General @{"sort": -1}',title:"Display images in tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.badge-images",{default:!0,requires:["tooltip.images"],process:(e,s)=>!!e.get("tooltip.images")&&s,ui:{path:"Chat > Tooltips >> Badges",title:"Display large images of badges.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-sources",{default:!0,ui:{path:"Chat > Tooltips >> Emotes",title:"Display known sources.",component:"setting-check-box"}}),this.settings.add("tooltip.emote-images",{default:!0,requires:["tooltip.images"],process:(e,s)=>!!e.get("tooltip.images")&&s,ui:{path:"Chat > Tooltips >> Emotes",title:"Display large images of emotes.",component:"setting-check-box"}}),this.settings.add("tooltip.rich-links",{default:!0,ui:{sort:-1,path:"Chat > Tooltips >> Links",title:"Display rich tooltips for links.",component:"setting-check-box",extra:{component:"chat-tooltip-example"}}}),this.settings.add("tooltip.link-interaction",{default:!0,ui:{path:"Chat > Tooltips >> Links",title:"Allow interaction with supported link tooltips.",component:"setting-check-box"}}),this.settings.add("tooltip.link-images",{default:!0,requires:["tooltip.images"],process:(e,s)=>!!e.get("tooltip.images")&&s,ui:{path:"Chat > Tooltips >> Links",title:"Display images for links.",component:"setting-check-box"}}),this.settings.add("tooltip.link-nsfw-images",{default:!1,ui:{path:"Chat > Tooltips >> Links",title:"Display potentially NSFW images.",description:"When enabled, FrankerFaceZ will include images that are tagged as unsafe or that are not rated.",component:"setting-check-box"}}),this.settings.add("chat.adjustment-mode",{default:null,process(e,s){var n;return null==s?null===(n=e.get("ls.useHighContrastColors"))||void 0===n||n?1:0:s},requires:["ls.useHighContrastColors"],ui:{path:"Chat > Appearance >> Colors",title:"Adjustment",description:"Alter user colors to ensure that they remain readable.",default(e){var s;return null===(s=e.get("ls.useHighContrastColors"))||void 0===s||s?1:0},component:"setting-select-box",data:[{value:-1,title:"No Color"},{value:0,title:"Unchanged"},{value:1,title:"HSL Luma"},{value:2,title:"Luv Luma"},{value:3,title:"HSL Loop (BTTV-Like)"},{value:4,title:"RGB Loop (Deprecated)"}]}}),this.settings.add("chat.adjustment-contrast",{default:4.5,ui:{path:"Chat > Appearance >> Colors",title:"Minimum Contrast",description:"Set the minimum contrast ratio used by Luma adjustments when determining readability.",component:"setting-text-box",process:"to_float"}}),this.settings.add("chat.me-style",{default:2,ui:{path:"Chat > Appearance >> Chat Lines",title:"Action Style",description:"When someone uses `/me`, the message will be rendered in this style.",component:"setting-select-box",data:[{value:0,title:"No Style"},{value:1,title:"Colorized (Old Style)"},{value:2,title:"Italic (New Style)"},{value:3,title:"Colorized Italic"}]}}),this.settings.add("chat.bits.stack",{default:0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Cheer Stacking",description:"Collect all the cheers in a message into a single cheer at the start of the message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Grouped by Type"},{value:2,title:"All in One"}]}}),this.settings.add("chat.emotes.animated",{default:null,requires:["ls.emoteAnimationsEnabled"],process(e,s){var n;return null==s?null===(n=e.get("ls.emoteAnimationsEnabled"))||void 0===n||n?1:0:s},ui:{path:"Chat > Appearance >> Emotes",sort:-50,title:"Animated Emotes",default(e){var s;return null===(s=e.get("ls.emoteAnimationsEnabled"))||void 0===s||s?1:0},getExtraTerms:()=>P,description:"This controls whether or not animated emotes are allowed to play in chat. When this is `Disabled`, emotes will appear as static images. Setting this to `Enable on Hover` may cause performance issues.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enable on Hover"}]}}),this.settings.add("tooltip.emote-images.animated",{requires:["chat.emotes.animated"],default:null,process:(e,s)=>(null==s&&(s=!!e.get("chat.emotes.animated")),s),ui:{path:"Chat > Tooltips >> Emotes",title:"Display animated images of emotes.",getExtraTerms:()=>P,description:"If this is not overridden, animated images are only shown in emote tool-tips if [Chat > Appearance >> Emotes > Animated Emotes](~chat.appearance.emotes) is not disabled.",component:"setting-check-box"}}),this.settings.add("chat.bits.animated",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display animated cheers.",component:"setting-check-box"}});const s=new Date(0).toLocaleTimeString().toUpperCase(),n=-1===s.lastIndexOf("PM")&&-1===s.lastIndexOf("AM");this.settings.add("chat.timestamp-format",{default:n?"H:mm":"h:mm",ui:{path:"Chat > Appearance >> Chat Lines",title:"Timestamp Format",component:"setting-combo-box",description:"Timestamps are formatted using the [Day.js](https://github.com/iamkun/dayjs#readme) library. More details about formatting strings [can be found here](https://github.com/iamkun/dayjs/blob/HEAD/docs/en/API-reference.md#list-of-all-available-formats)",data:[{value:"h:mm",title:"12 Hour"},{value:"h:mm:ss",title:"12 Hour with Seconds"},{value:"H:mm",title:"24 Hour"},{value:"H:mm:ss",title:"24 Hour with Seconds"},{value:"hh:mm",title:"Padded"},{value:"hh:mm:ss",title:"Padded with Seconds"},{value:"HH:mm",title:"Padded 24 Hour"},{value:"HH:mm:ss",title:"Padded 24 Hour with Seconds"}]}}),this.context.on("changed:theme.is-dark",(()=>{for(const e of this.iterateRooms())e.buildBitsCSS()})),this.context.on("changed:chat.bits.animated",(()=>{for(const e of this.iterateRooms())e.buildBitsCSS()})),this.context.on("changed:chat.filtering.color-mentions",(async e=>{e?await this.createColorCache():this.color_cache=null,this.emit(":update-line-tokens")}))}async createColorCache(){const e=await n(138);this.color_cache=new e(150)}generateLog(){const e=["chat settings","-------------------------------------------------------------------------------"];for(const[s,n]of this.context.__cache.entries())e.push(`${s}: ${JSON.stringify(n)}`);return e.join("\n")}onEnable(){this.socket=this.resolve("socket"),this.context.get("chat.filtering.color-mentions")&&this.createColorCache().then((()=>this.emit(":update-line-tokens")));for(const e in z)Object(g.has)(z,e)&&this.addTokenizer(z[e]);for(const e in j)Object(g.has)(j,e)&&this.addRichProvider(j[e])}getUser(e,s,n,o,a=!1){let u;if(e&&"number"==typeof e&&(e=`${e}`),e&&this.user_ids[e]?u=this.user_ids[e]:s&&this.users[s]&&!o&&(u=this.users[s]),u&&u.destroyed&&(u=null),!u){if(n)return null;u=new E.a(this,null,e,s)}if(e&&e!==u.id){if(u.id){if(this.log.warn(`Data mismatch for user #${e} -- Stored ID: ${u.id} -- Login: ${s} -- Stored Login: ${u.login}`),a)throw new Error("id mismatch");this.user_ids[u.id]===u&&(this.user_ids[u.id]=null)}u._id=e,this.user_ids[e]=u}if(s){const e=this.users[s];e?e===u||o||(e.id?this.users[s]=u:(u.merge(e),e.destroy(!0))):this.users[s]=u}return u}getRoom(e,s,n,o,a=!1){let u;if(e&&"number"==typeof e&&(e=`${e}`),e&&this.room_ids[e]?u=this.room_ids[e]:s&&this.rooms[s]&&!o&&(u=this.rooms[s]),u&&u.destroyed&&(u=null),!u){if(n)return null;u=new C.a(this,e,s)}if(e&&e!==u.id){if(u.id){if(this.log.warn(`Data mismatch for room #${e} -- Stored ID: ${u.id} -- Login: ${s} -- Stored Login: ${u.login}`),a)throw new Error("id mismatch");this.room_ids[u.id]===u&&(this.room_ids[u.id]=null)}u._id=e,this.room_ids[e]=u}if(s){const e=this.rooms[s];e?e===u||o||(e.id?this.rooms[s]=u:(u.merge(e),e.destroy(!0))):this.rooms[s]=u}return u}*iterateRooms(){const e=new Set;for(const s in this.room_ids)if(Object(g.has)(this.room_ids,s)){const n=this.room_ids[s];n&&!n.destroyed&&(e.add(n),yield n)}for(const s in this.rooms)if(Object(g.has)(this.rooms,s)){const n=this.rooms[s];!n||n.destroyed||e.has(n)||(yield n)}}handleReplyClick(e){const s=e.target,n=this.resolve("site.fine");if(!s||!n)return;const o=n.searchParent(s,(e=>e.props&&e.props.reply&&e.setOPCardTray));o&&o.setOPCardTray(o.props.reply)}handleMentionClick(e){if(!this.context.get("chat.filtering.clickable-mentions"))return;const s=e.target,n=s&&s.dataset;if(!n||!n.login)return;const o=this.resolve("site.fine");if(!o)return;const a=o.searchParent(s,(e=>e.props&&e.props.onUsernameClick));a&&a.props.onUsernameClick(n.login,void 0,void 0,e.currentTarget.getBoundingClientRect().bottom)}clickToReveal(e){const s=e.target;if(s){if(s._ffz_visible)s.textContent="×××";else{if(!this.context.get("chat.filtering.click-to-reveal"))return;s.dataset&&(s.textContent=s.dataset.text)}s._ffz_visible=!s._ffz_visible}}standardizeWhisper(e){if(!e)return e;if(e._ffz_message)return e._ffz_message;const s={},n=e.content.startsWith("/me "),o=n?4:0,a=e._ffz_message={user:Object.assign({},e.from),message:e.content.slice(o),is_action:n,ffz_emotes:s,timestamp:e.sentAt&&e.sentAt.getTime(),deleted:!1};if(a.user.color=a.user.chatColor,Array.isArray(e.emotes)&&e.emotes.length)for(const n of e.emotes){const e=n.emoteID;(s[e]=s[e]||[]).push({startIndex:n.from-o,endIndex:n.to-o})}return a}getUserLevel(e){return e&&e.user?e.user.login===e.roomLogin||e.badges&&e.badges.broadcaster?4:e.badges?e.badges.moderator?3:e.badges.vip?2:e.badges.subscriber?1:0:0:0}tokenizeReply(e){return e?[{type:"reply",text:e.parentDisplayName,color:this.color_cache?this.color_cache.get(e.parentUserLogin):null,recipient:e.parentUserLogin},{type:"text",text:" "}]:null}applyHighlight(e,s,n,o,a=!1){if(!e)return e;const u=null==e.mention_priority,f=u||s>=e.mention_priority,g=u||s>e.mention_priority;if(e.filters&&e.filters.push(`${o}(${s})${f&&!1===n?":remove":n?`:${n}`:""}`),f){if(e.mention_priority=s,!1===n)return void(g&&(e.mentioned=!1,e.clear_priority=s,e.mention_color=e.highlights=null));e.mentioned=!0,e.highlights||(e.highlights=new Set)}e.mentioned&&(null==e.clear_priority||s>=e.clear_priority)&&(e.highlights.add(o),!n&&!a||!g&&e.mention_color||(e.mention_color=n))}standardizeMessage(e){if(!e)return e;e.sender&&!e.user&&(e.user=e.sender),e.from&&!e.user&&(e.user=e.from);let s=e.user;s||(s=e.user={});const n=e.extension||{};if(s.color=s.color||s.chatColor||n.chatColor||null,s.type=s.type||s.userType||null,s.id=s.id||s.userID||null,s.login=s.login||s.userLogin||null,s.displayName=s.displayName||s.userDisplayName||s.login||n.displayName,s.isIntl=s.login&&s.displayName&&s.displayName.trim().toLowerCase()!==s.login,this.color_cache&&s.color&&this.color_cache.set(s.login,s.color),!e.message&&e.messageParts&&this.detokenizeMessage(e),e.content&&!e.message&&(e.content.fragments?this.detokenizeContent(e):e.message=e.content.text),e.ffz_emotes||this.standardizeEmotes(e),!e.badges&&s.displayBadges){const n=e.badges={};for(const e of s.displayBadges)n[e.setID]=e.version}if(!e.badges&&n.displayBadges){const s=e.badges={};for(const e of n.displayBadges)s[e.setID]=e.version}return!e.timestamp&&e.sentAt&&(e.timestamp=new Date(e.sentAt).getTime()),void 0!==e.deletedAt&&(e.deleted=!!e.deletedAt),e.ffz_badges=this.badges.getBadges(s.id,s.login,e.roomID,e.roomLogin),e}standardizeEmotes(e){if(e.emotes&&e.message){const s={},n=Object(g.split_chars)(e.message);let o=0;e.message&&e.messageBody&&e.message!==e.messageBody&&(o=n.length-Object(g.split_chars)(e.messageBody).length);for(const a in e.emotes)if(Object(g.has)(e.emotes,a)){const u=e.emotes[a];if(Array.isArray(u))return e.ffz_emotes=e.emotes;const f=s[u.id]=s[u.id]||[];let g=u.startIndex+1+o;for(;g<n.length&&!B.test(n[g]);)g++;f.push({startIndex:u.startIndex+o,endIndex:g-1})}e.ffz_emotes=s}else e.messageParts?this.detokenizeMessage(e,!0):e.content&&e.content.fragments&&this.detokenizeContent(e,!0)}detokenizeContent(e,s=!1){const n=[],o=e.content.fragments,a=o.length,u={};let f,_=0,b=!0;for(let s=0;s<a;s++){const a=o[s],v=a.content,k=v&&v.__typename;if(f=a.text,"Emote"===k){const e=v.emoteID;(u[e]=u[e]||[]).push({startIndex:_,endIndex:_+f.length-1})}f&&f.length&&(b&&f.startsWith("/me ")&&(e.is_action=!0,f=f.slice(4)),_+=Object(g.split_chars)(f).length,n.push(f)),b=!1}return s||(e.message=n.join("")),e.ffz_emotes=u,e}detokenizeMessage(e,s=!1){const n=[],o=e.messageParts,a=o.length,u={};let f,_=0,b=null,v=0;for(let e=0;e<a;e++){var k;const s=o[e],a=null!==(k=s.ffz_content)&&void 0!==k?k:s.content;if(a){if("string"==typeof a)f=a;else if(a.recipient)f=`@${a.recipient}`;else if(a.url)f=a.url;else if(a.cheerAmount)v+=a.cheerAmount,f=`${a.alt}${a.cheerAmount}`;else{if(!a.images)continue;{const e=a.images.themed?a.images.dark:a.images.sources;let s=a.emoteID;if(!s){const n=e&&(/\/emoticons\/v1\/(\d+)\/[\d.]+$/.exec(e["1x"])||/\/emoticons\/v2\/(\d+)\//.exec(e["1x"]));s=n&&n[1]}if(f=a.alt,s){const e=b>0?1:0;(u[s]=u[s]||[]).push({startIndex:_+e,endIndex:_+f.length-1})}b>0&&(f=` ${f}`)}}f&&(_+=Object(g.split_chars)(f).length,b=s.type,n.push(f))}}return s||(e.message=n.join("")),e.bits=v,e.ffz_emotes=u,e}formatUser(e,s){const n=this.context.get("chat.name-format"),o=[s("span",{className:"chat-author__display-name"},2===n&&e.isIntl?e.login:e.displayName||e.login)];return 0===n&&e.isIntl&&o.push(s("span",{className:"chat-author__intl-login"},` (${e.login})`)),[o]}formatTime(e){e instanceof Date||(e=new Date(e));const s=this.context.get("chat.timestamp-format"),n=a()(e);try{return n.locale(this.i18n.locale).format(s)}catch(e){return n.format(s)}}addHighlightReason(e,s){if("object"==typeof e&&e.key?e=(s=e).key:"string"==typeof s&&(s={title:s}),s.value=s.key=e,s.i18n_key||(s.i18n_key=`hl-reason.${e}`),this._hl_reasons[e])throw new Error(`Highlight Reason already exists with key ${e}`);this._hl_reasons[e]=s}getHighlightReasons(){return Object.values(this._hl_reasons)}addTokenizer(e){const s=e.type;if(this.tokenizers[s]=e,null==e.priority&&(e.priority=0),e.tooltip){const n=e.tooltip,o=this.tooltips.types[s]=n.bind(this);for(const e of["interactive","delayShow","delayHide","onShow","onHide"])o[e]="function"==typeof n[e]?n[e].bind(this):n[e]}this.__tokenizers.push(e),this.__tokenizers.sort(((e,s)=>e.priority>s.priority?-1:e.priority<s.priority?1:e.type<s.type))}removeTokenizer(e){let s;if(s="string"==typeof e?e:e.type,!(e=this.tokenizers[s]))return null;e.tooltip&&delete this.tooltips.types[s];const n=this.__tokenizers.indexOf(e);return-1!==n&&this.__tokenizers.splice(n,1),e}addRichProvider(e){const s=e.type;this.rich_providers[s]=e,null==e.priority&&(e.priority=0),this.__rich_providers.push(e),this.__rich_providers.sort(((e,s)=>e.priority>s.priority?-1:e.priority<s.priority?1:e.type<s.type))}removeRichProvider(e){let s;if(s="string"==typeof e?e:e.type,!(e=this.rich_providers[s]))return null;const n=this.__rich_providers.indexOf(e);return-1!==n&&this.__rich_providers.splice(n,1),e}tokenizeString(e,s,n,o=!1){let a=[{type:"text",text:e}];for(const e of this.__tokenizers){if(!e.process)continue;const u=e.process.call(this,a,s,n,o);if(u&&(a=u),o&&s.ffz_halt_tokens){s.ffz_halt_tokens=void 0;break}}return a}pluckRichContent(e,s){if(!this.context.get("chat.rich.enabled")||this.context.get("chat.rich.minimum-level")>this.getUserLevel(s))return;if(!Array.isArray(e))return;const n=this.__rich_providers,o=this.context.get("chat.rich.want-mid");for(const a of e)for(const e of n)if(e.test.call(this,a,s))return a.hidden=e.can_hide_token&&(this.context.get("chat.rich.hide-tokens")||e.hide_token),e.process.call(this,a,o)}tokenizeMessage(e,s,n=!1){if(e.content&&!e.message&&(e.message=e.content.text),e.sender&&!e.user&&(e.user=e.sender),!e.message)return[];let o=[{type:"text",text:e.message}];for(const a of this.__tokenizers){if(!a.process)continue;const u=a.process.call(this,o,e,s,n);if(u&&(o=u),n&&e.ffz_halt_tokens){e.ffz_halt_tokens=void 0;break}}return o||[]}renderTokens(e,s,n){s||(s=f.createElement);const o=[],a=this.tokenizers,u=e.length;for(let f=0;f<u;f++){const u=e[f],g=u.type,_=a[g];if(u.hidden)continue;let b;n&&0===f&&"mention"===g&&u.recipient&&u.recipient===n.parentUserLogin||(b="text"===g?s("span",{className:"text-fragment","data-a-target":"chat-message-text"},u.text):_?_.render.call(this,u,s,n):s("em",{className:"ffz-unknown-token ffz-tooltip","data-tooltip-type":"json","data-data":JSON.stringify(u,null,2)},`[unknown token: ${g}]`),b&&o.push(b))}return o}clearLinkCache(e){if(e){const s=this._link_info[e];if(!s[0])for(const e of s[2])e[1]();return this._link_info[e]=null,void this.emit(":update-link-resolver",e)}const s=this._link_info;this._link_info={};for(const e of Object.values(s))if(!e[0])for(const s of e[2])s[1]();this.emit(":update-link-resolver")}get_link_info(e,s,n=!1){let o=this._link_info[e];const a=o&&o[1];return(o&&o[0]&&n||a&&Date.now()>a)&&(o=this._link_info[e]=null),o&&o[0]?s?o[2]:Promise.resolve(o[2]):s?null:new Promise(o?(e,s)=>o[2].push([e,s]):(s,n)=>{o=this._link_info[e]=[!1,null,[[s,n]]];const handle=(e,s)=>{s=this.fixLinkInfo(s);const n=!o[0]&&o[2];if(o[0]=!0,o[1]=Date.now()+12e4,o[2]=e?s:null,n)for(const o of n)o[e?0:1](s)};let a=this.settings.get("debug.link-resolver.source");if(null==a&&(a=this.experiments.getAssignment("api_links")?"test":"socket"),"socket"!==a||this.socket||(a="test"),"socket"===a)Object(g.timeout)(this.socket.call("get_link",e),15e3).then((e=>handle(!0,e))).catch((e=>handle(!1,e)));else{const s="dev"===a?"https://localhost:8002/":"test"===a?"https://api-test.frankerfacez.com/v2/link":"https://api.frankerfacez.com/v2/link";Object(g.timeout)(fetch(`${s}?url=${encodeURIComponent(e)}`).then((e=>e.json())),15e3).then((e=>handle(!0,e))).catch((e=>handle(!1,e)))}})}fixLinkInfo(e){if(e.error&&e.message&&(e.error=e.message),e.error&&(e={v:5,title:this.i18n.t("card.error","An error occurred."),description:e.error,short:{type:"header",image:{type:"image",url:"https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0"},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:e.error}}),e.v<5&&!e.short&&!e.full&&(e.title||e.desc_1||e.desc_2)){var s;const n=e.preview||e.image;e={v:5,short:{type:"header",image:n?{type:"image",url:n,sfw:null!==(s=e.image_safe)&&void 0!==s&&s}:null,title:e.title,subtitle:e.desc_1,extra:e.desc_2}}}return e}}},function(e,s,n){"use strict";function isAutomaticReward(e){return"CommunityPointsAutomaticReward"===(null==e?void 0:e.__typename)}function isHighlightedReward(e){return isAutomaticReward(e)&&"SEND_HIGHLIGHTED_MESSAGE"===e.type}function getRewardCost(e){return isAutomaticReward(e)?e.cost||e.defaultCost:e.cost}function getRewardTitle(e,s){if(function isCustomReward(e){return"CommunityPointsCustomReward"===(null==e?void 0:e.__typename)}(e))return e.title;switch(e.type){case"SEND_HIGHLIGHTED_MESSAGE":return s.t("chat.points.highlighted","Highlight My Message");case"SINGLE_MESSAGE_BYPASS_SUB_MODE":return s.t("chat.points.bypass-sub","Send a Message in Sub-Only Mode");case"CHOSEN_SUB_EMOTE_UNLOCK":return s.t("chat.points.choose-emote","Choose an Emote to Unlock");case"RANDOM_SUB_EMOTE_UNLOCK":return s.t("chat.points.random-emote","Unlock a Random Sub Emote");case"CHOSEN_MODIFIED_SUB_EMOTE_UNLOCK":return s.t("chat.points.modify-emote","Modify a Single Emote");default:return s.t("chat.points.reward","Reward")}}n.d(s,"c",(function(){return isHighlightedReward})),n.d(s,"a",(function(){return getRewardCost})),n.d(s,"b",(function(){return getRewardTitle}))},,,,,,,,,function(e,s,n){var o=n(139),a=n(116),u=n(117),f=n(141);function LRUCache(e,s,n){if(arguments.length<2&&(n=e,e=null,s=null),this.capacity=n,"number"!=typeof this.capacity||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var o=u.getPointerArray(n);this.forward=new o(n),this.backward=new o(n),this.K="function"==typeof e?new e(n):new Array(n),this.V="function"==typeof s?new s(n):new Array(n),this.size=0,this.head=0,this.tail=0,this.items={}}LRUCache.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}},LRUCache.prototype.splayOnTop=function(e){var s=this.head;if(this.head===e)return this;var n=this.backward[e],o=this.forward[e];return this.tail===e?this.tail=n:this.backward[o]=n,this.forward[n]=o,this.backward[s]=e,this.head=e,this.forward[e]=s,this},LRUCache.prototype.set=function(e,s){var n=this.items[e];if(void 0!==n)return this.splayOnTop(n),void(this.V[n]=s);this.size<this.capacity?n=this.size++:(n=this.tail,this.tail=this.backward[n],delete this.items[this.K[n]]),this.items[e]=n,this.K[n]=e,this.V[n]=s,this.forward[n]=this.head,this.backward[this.head]=n,this.head=n},LRUCache.prototype.setpop=function(e,s){var n=null,o=null,a=this.items[e];return void 0!==a?(this.splayOnTop(a),n=this.V[a],this.V[a]=s,{evicted:!1,key:e,value:n}):(this.size<this.capacity?a=this.size++:(a=this.tail,this.tail=this.backward[a],n=this.V[a],o=this.K[a],delete this.items[this.K[a]]),this.items[e]=a,this.K[a]=e,this.V[a]=s,this.forward[a]=this.head,this.backward[this.head]=a,this.head=a,o?{evicted:!0,key:o,value:n}:null)},LRUCache.prototype.has=function(e){return e in this.items},LRUCache.prototype.get=function(e){var s=this.items[e];if(void 0!==s)return this.splayOnTop(s),this.V[s]},LRUCache.prototype.peek=function(e){var s=this.items[e];if(void 0!==s)return this.V[s]},LRUCache.prototype.forEach=function(e,s){s=arguments.length>1?s:this;for(var n=0,o=this.size,a=this.head,u=this.K,f=this.V,g=this.forward;n<o;)e.call(s,f[a],u[a],this),a=g[a],n++},LRUCache.prototype.keys=function(){var e=0,s=this.size,n=this.head,a=this.K,u=this.forward;return new o((function(){if(e>=s)return{done:!0};var o=a[n];return++e<s&&(n=u[n]),{done:!1,value:o}}))},LRUCache.prototype.values=function(){var e=0,s=this.size,n=this.head,a=this.V,u=this.forward;return new o((function(){if(e>=s)return{done:!0};var o=a[n];return++e<s&&(n=u[n]),{done:!1,value:o}}))},LRUCache.prototype.entries=function(){var e=0,s=this.size,n=this.head,a=this.K,u=this.V,f=this.forward;return new o((function(){if(e>=s)return{done:!0};var o=a[n],g=u[n];return++e<s&&(n=f[n]),{done:!1,value:[o,g]}}))},"undefined"!=typeof Symbol&&(LRUCache.prototype[Symbol.iterator]=LRUCache.prototype.entries),LRUCache.prototype.inspect=function(){for(var e,s=new Map,n=this.entries();!(e=n.next()).done;)s.set(e.value[0],e.value[1]);return Object.defineProperty(s,"constructor",{value:LRUCache,enumerable:!1}),s},"undefined"!=typeof Symbol&&(LRUCache.prototype[Symbol.for("nodejs.util.inspect.custom")]=LRUCache.prototype.inspect),LRUCache.from=function(e,s,n,o){if(arguments.length<2){if("number"!=typeof(o=f.guessLength(e)))throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else 2===arguments.length&&(o=s,s=null,n=null);var u=new LRUCache(s,n,o);return a(e,(function(e,s){u.set(s,e)})),u},e.exports=LRUCache},function(e,s){function Iterator(e){if("function"!=typeof e)throw new Error("obliterator/iterator: expecting a function!");this.next=e}"undefined"!=typeof Symbol&&(Iterator.prototype[Symbol.iterator]=function(){return this}),Iterator.of=function(){var e=arguments,s=e.length,n=0;return new Iterator((function(){return n>=s?{done:!0}:{done:!1,value:e[n++]}}))},Iterator.empty=function(){return new Iterator((function(){return{done:!0}}))},Iterator.fromSequence=function(e){var s=0,n=e.length;return new Iterator((function(){return s>=n?{done:!0}:{done:!1,value:e[s++]}}))},Iterator.is=function(e){return e instanceof Iterator||"object"==typeof e&&null!==e&&"function"==typeof e.next},e.exports=Iterator},function(e,s){s.ARRAY_BUFFER_SUPPORT="undefined"!=typeof ArrayBuffer,s.SYMBOL_SUPPORT="undefined"!=typeof Symbol},function(e,s,n){var o=n(116),a=n(117);function guessLength(e){return"number"==typeof e.length?e.length:"number"==typeof e.size?e.size:void 0}s.isArrayLike=function isArrayLike(e){return Array.isArray(e)||a.isTypedArray(e)},s.guessLength=guessLength,s.toArray=function toArray(e){var s=guessLength(e),n="number"==typeof s?new Array(s):[],a=0;return o(e,(function(e){n[a++]=e})),n},s.toArrayWithIndices=function toArrayWithIndices(e){var s=guessLength(e),n="number"==typeof s?a.getPointerArray(s):Array,u="number"==typeof s?new Array(s):[],f="number"==typeof s?new n(s):[],g=0;return o(e,(function(e){u[g]=e,f[g]=g++})),[u,f]}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return ChatHook})),n.d(s,"formatBitsConfig",(function(){return formatBitsConfig}));var o=n(11),a=n(0),u=n(2),f=n(7),g=n(29),_=n(4),b=n(16),v=n(316),k=n(317),x=n(319),C=n(320),E=n(321),z=n(322);const j=Object(a.make_enum)("Post","Action"),O=Object(a.make_enum)("Ban","Timeout","Delete"),A=Object(a.make_enum)("MessageRejectedPrompt","CheerMessageRejectedPrompt","MessageRejected","MessageAllowed","MessageDenied","CheerMessageDenied","CheerMessageTimeout","MessageModApproved","MessageModDenied"),T=["Message","Notice","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","RoomMods","RoomState","BadgesUpdated"],D=Object(a.make_enum)("Message","ExtensionMessage","Moderation","ModerationAction","TargetedModerationAction","AutoMod","SubscriberOnlyMode","FollowerOnlyMode","SlowMode","EmoteOnlyMode","R9KMode","Connected","Disconnected","Reconnect","Hosting","Unhost","Hosted","Subscription","Resubscription","GiftPaidUpgrade","AnonGiftPaidUpgrade","PrimePaidUpgrade","PrimeCommunityGiftReceivedEvent","ExtendSubscription","SubGift","AnonSubGift","Clear","RoomMods","RoomState","Raid","Unraid","Ritual","Notice","Info","BadgesUpdated","Purchase","BitsCharity","CrateGift","RewardGift","SubMysteryGift","AnonSubMysteryGift","StandardPayForward","CommunityPayForward","FirstCheerMessage","FirstMessageHighlight","BitsBadgeTierMessage","InlinePrivateCallout","ChannelPointsReward","CommunityChallengeContribution","CelebrationPurchase","LiveMessageSeparator","RestrictedLowTrustUserMessage","CommunityIntroduction"),B=["Reconnect","RoomState","BadgesUpdated","Clear"],P=["onBadgesUpdatedEvent"];class ChatHook extends _.default{constructor(...e){super(...e),this.should_enable=!0,this.colors=new o.ColorAdjuster,this.inverse_colors=new o.ColorAdjuster,this.inject("settings"),this.inject("i18n"),this.inject("experiments"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.inject("site.subpump"),this.inject("chat"),this.inject(v.a),this.inject(k.a),this.inject(x.a),this.inject(C.a),this.inject(E.a),this.inject(z.a),this.ChatService=this.fine.define("chat-service",(e=>e.join&&e.connectHandlers),b.a.CHAT_ROUTES),this.ChatBuffer=this.fine.define("chat-buffer",(e=>e.updateHandlers&&e.delayedMessageBuffer&&e.handleMessage),b.a.CHAT_ROUTES),this.ChatController=this.fine.define("chat-controller",(e=>e.hostingHandler&&e.onRoomStateUpdated),b.a.CHAT_ROUTES),this.ChatContainer=this.fine.define("chat-container",(e=>e.closeViewersList&&e.onChatInputFocus),b.a.CHAT_ROUTES),this.ChatBufferConnector=this.fine.define("chat-buffer-connector",(e=>e.clearBufferHandle&&e.syncBufferedMessages),b.a.CHAT_ROUTES),this.joined_raids=new Set,this.RaidController=this.fine.define("raid-controller",(e=>e.handleLeaveRaid&&e.handleJoinRaid),b.a.CHAT_ROUTES),this.InlineCallout=this.fine.define("inline-callout",(e=>e.showCTA&&e.toggleContextMenu&&e.actionClick),b.a.CHAT_ROUTES),this.PinnedCallout=this.fine.define("pinned-callout",(e=>e.getCalloutTitle&&e.buildCalloutProps&&e.pin),b.a.CHAT_ROUTES),this.CalloutSelector=this.fine.define("callout-selector",(e=>e.selectCalloutComponent&&e.props&&e.props.callouts),b.a.CHAT_ROUTES),this.PointsButton=this.fine.define("points-button",(e=>e.renderIcon&&e.renderFlame&&e.handleIconAnimationComplete),b.a.CHAT_ROUTES),this.PointsClaimButton=this.fine.define("points-claim-button",(e=>e.getClaim&&e.onClick&&e.props&&e.props.claimCommunityPoints),b.a.CHAT_ROUTES),this.CommunityChestBanner=this.fine.define("community-chest-banner",(e=>e.getLastGifterText&&e.getBannerText&&Object(a.has)(e,"finalCount")),b.a.CHAT_ROUTES),this.PointsInfo=this.fine.define("points-info",(e=>void 0!==e.pointIcon&&void 0!==e.pointName),b.a.CHAT_ROUTES),this.GiftBanner=this.fine.define("gift-banner",(e=>e.getBannerText&&e.onGiftMoreClick),b.a.CHAT_ROUTES),this.settings.add("chat.filtering.blocked-types",{default:[],type:"array_merge",always_inherit:!0,process(e,s){const n=new Set;for(const e of s)(null!=e&&e.v||!T.includes(e.v))&&n.add(e.v);return n},ui:{path:'Chat > Filtering > Block >> Message Types @{"description":"This filter allows you to remove all messages of a certain type from Twitch chat. It can be used to filter system messages, such as Hosts or Raids. Some types, such as moderation actions, cannot be blocked to prevent chat functionality from breaking."}',component:"blocked-types",data:()=>Object.keys(this.chat_types).filter((e=>!T.includes(e)&&!/^\d+$/.test(e))).sort()}}),this.settings.add("chat.replies.style",{default:1,ui:{path:"Chat > Appearance >> Replies",title:"Style",description:"Twitch's default style adds a floating button to the right and displays a notice above messages that are replies. FrankerFaceZ uses an In-Line Chat Action (that can be removed in [Chat > Actions > In-Line](~chat.actions.in_line)) and uses an in-line mention to denote replies.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch (Default)"},{value:2,title:"FrankerFaceZ"}]}}),this.settings.add("channel.raids.no-autojoin",{default:!1,ui:{path:"Channel > Behavior >> Raids",title:"Do not automatically join raids.",component:"setting-check-box"}}),this.settings.add("chat.hide-community-highlights",{default:!1,ui:{path:"Chat > Appearance >> Community",title:"Hide all Community Highlights from the top of chat.",component:"setting-check-box",description:"Community Highlights are polls, community gift subs, etc. that float over the top of chat temporarily with no way to close them."}}),this.settings.add("chat.subs.gift-banner",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display a banner at the top of chat when a mass gift sub happens.",component:"setting-check-box"}}),this.settings.add("chat.banners.hype-train",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow the Hype Train to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.drops",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow messages about Drops to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.polls",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Polls to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.banners.prediction",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Allow Predictions to be displayed in chat.",component:"setting-check-box"}}),this.settings.add("chat.community-chest.show",{default:!0,ui:{path:"Chat > Appearance >> Community",title:"Display the Community Gift Chest banner.",component:"setting-check-box"}}),this.settings.add("chat.points.allow-highlight",{default:2,ui:{path:"Chat > Channel Points >> Appearance",title:"Highlight the message in chat when someone redeems Highlight My Message.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Twitch Style"},{value:2,title:"FFZ Style"}]}}),this.settings.add("chat.points.show-callouts",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display messages in chat about Channel Points rewards.",component:"setting-check-box"}}),this.settings.add("chat.points.show-button",{default:!0,ui:{path:"Chat > Channel Points >> General",title:"Display Channel Points button beneath chat.",component:"setting-check-box"}}),this.settings.add("chat.points.show-rewards",{default:!0,requires:["layout.portrait-min-chat"],process:(e,s)=>!e.get("layout.portrait-min-chat")&&s,ui:{path:"Chat > Channel Points >> Behavior",title:"Allow available rewards to appear next to the Channel Points button.",component:"setting-check-box"}}),this.settings.add("chat.points.auto-rewards",{default:!1,ui:{path:"Chat > Channel Points >> Behavior",title:"Automatically claim bonus rewards.",component:"setting-check-box",force_seen:!0}}),this.settings.add("chat.pin-resubs",{default:!1,ui:{path:"Chat > Behavior >> General",title:"Automatically pin re-subscription messages in chat.",component:"setting-check-box"}}),this.settings.add("chat.width",{default:null,ui:{path:'Chat > Appearance >> General @{"sort": -1}',title:"Width",description:"How wide chat should be, in pixels. This may be affected by your browser's zoom and font size settings.",component:"setting-text-box",process:e=>(e=parseInt(e,10),isNaN(e)||!isFinite(e)||e<=0?null:e)}}),this.settings.add("chat.effective-width",{requires:["chat.width","context.ui.rightColumnWidth"],process(e){const s=e.get("chat.width");return null==s?e.get("context.ui.rightColumnWidth")||340:s}}),this.settings.add("chat.use-width",{requires:["chat.width","context.ui.rightColumnExpanded","context.isWatchParty"],process:e=>!(!e.get("context.ui.rightColumnExpanded")||e.get("context.isWatchParty"))&&null!=e.get("chat.width")}),this.settings.add("chat.bits.show-pinned",{requires:["chat.bits.show"],default:null,process:(e,s)=>null!=s?s:e.get("chat.bits.show"),ui:{path:"Chat > Appearance >> Community",title:"Display Leaderboard",description:"The leaderboard shows the top cheerers and sub gifters in a channel.\n\nBy default due to a previous implementation, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering).",component:"setting-check-box"}}),this.settings.add("chat.bits.show-rewards",{requires:["chat.bits.show"],default:null,process:(e,s)=>null!=s?s:e.get("chat.bits.show"),ui:{path:"Chat > Bits and Cheering >> Behavior",title:"Display messages when a cheer shares rewards to people in chat.",description:"By default, this inherits its value from Display Bits. This setting only affects newly arrived messages.",component:"setting-check-box"}}),this.settings.add("chat.bits.cheer-notice",{default:!0,ui:{path:"Chat > Bits and Cheering >> Appearance",title:"Display a notice on chat messages that include cheers.",description:"This feature is intended to prevent possible confusion from chatters using emotes to fake cheers in messages. When enabled, messages that contain real cheers will display a message above them, similar to how resubscription messages or point redemptions with messages function.",component:"setting-check-box"}}),this.settings.add("chat.rituals.show",{default:!0,ui:{path:"Chat > Filtering > General >> Rituals",title:'Display ritual messages such as "User is new here! Say Hello!".',component:"setting-check-box"}}),this.settings.add("chat.extra-timestamps",{default:!0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display timestamps on notices.",description:"When enabled, timestamps will be displayed on point redemptions, subscriptions, etc.",component:"setting-check-box"}}),this.settings.add("chat.subs.show",{default:3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display Subs in Chat",component:"setting-select-box",description:'**Note**: Messages sent with re-subs will always be displayed. This only controls the special "X subscribed!" message.',data:[{value:0,title:"Do Not Display"},{value:1,title:"Re-Subs with Messages Only"},{value:2,title:"Re-Subs Only"},{value:3,title:"Display All"}]}}),this.settings.add("chat.subs.compact",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Display subscription notices in a more compact (classic style) form.",component:"setting-check-box"}}),this.settings.add("chat.subs.merge-gifts",{default:1e3,ui:{path:"Chat > Appearance >> Subscriptions",title:"Merge Mass Sub Gifts",component:"setting-select-box",data:[{value:1e3,title:"Disabled"},{value:50,title:"More than 50"},{value:20,title:"More than 20"},{value:10,title:"More than 10"},{value:5,title:"More than 5"},{value:0,title:"Always"}],description:"Merge mass gift subscriptions into a single message, depending on the quantity.\n**Note:** Only affects newly gifted subs."}}),this.settings.add("chat.subs.merge-gifts-visibility",{default:!1,ui:{path:"Chat > Appearance >> Subscriptions",title:"Expand merged mass sub gift messages by default.",component:"setting-check-box"}}),this.settings.add("chat.lines.alternate",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Display lines with alternating background colors.",component:"setting-check-box"}}),this.settings.add("chat.lines.padding",{default:!1,ui:{path:"Chat > Appearance >> Chat Lines",title:"Reduce padding around lines.",component:"setting-check-box"}}),this.settings.add("chat.lines.borders",{default:0,ui:{path:"Chat > Appearance >> Chat Lines",title:"Separators",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Basic Line (1px Solid)"},{value:2,title:"3D Line (2px Groove)"},{value:3,title:"3D Line (2px Groove Inset)"},{value:4,title:"Wide Line (2px Solid)"}]}}),this.settings.add("chat.input.show-mod-view",{default:!0,ui:{path:"Chat > Input >> Appearance",title:"Display the Mod View button in relevant channels.",component:"setting-check-box"}})}get currentChat(){for(const e of this.ChatController.instances)if(e&&e.chatService)return e;return null}updateColors(){const e=this.chat.context.get("theme.is-dark"),s=this.chat.context.get("chat.adjustment-mode"),n=this.chat.context.get("chat.adjustment-contrast"),a=this.colors,u=this.inverse_colors;let f=e,g=o.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-background")||this.chat.context.get("theme.color.background"));g&&(f=g.toHSLA().l<.5),g=f?"#191919":"#E0E0E0";let _=!f,b=o.Color.RGBA.fromCSS(this.chat.context.get("theme.color.chat-text")||this.chat.context.get("theme.color.text"));b&&(_=b.toHSLA().l<.5),b=_?"#19171c":"#dad8de",a._base=g,a.mode=s,a.contrast=n,u._base=b,u.mode=s,u.contrast=n,this.chat_line.rerenderLines(),this.updateMentionCSS(),this.emit(":update-colors")}updateChatCSS(){this._update_css_waiter||(this._update_css_waiter=requestAnimationFrame((()=>this._updateChatCSS())))}_updateChatCSS(){cancelAnimationFrame(this._update_css_waiter),this._update_css_waiter=null;const e=this.chat.context.get("chat.effective-width"),s=this.chat.context.get("chat.actions.size"),n=this.chat.context.get("chat.timestamp-size"),o=this.chat.context.get("chat.font-size"),a=this.chat.context.get("chat.lines.emote-alignment"),u=Math.round(20/12*o);let f=this.chat.context.get("chat.font-family")||"inherit";const[_,b]=Object(g.b)(f);f=_,this._font_unloader&&this._font_unloader(),this._font_unloader=b,-1!==f.indexOf(" ")&&-1===f.indexOf(",")&&-1===f.indexOf('"')&&-1===f.indexOf("'")&&(f=`"${f}"`),n?this.css_tweaks.set("ts-size",`.chat-line__timestamp{font-size:${n/10}rem}`):this.css_tweaks.delete("ts-size"),this.css_tweaks.setVariable("chat-actions-size",s/10+"rem"),this.css_tweaks.setVariable("chat-font-size",o/10+"rem"),this.css_tweaks.setVariable("chat-line-height",u/10+"rem"),this.css_tweaks.setVariable("chat-font-family",f),this.css_tweaks.setVariable("chat-width",e/10+"rem"),this.css_tweaks.setVariable("negative-chat-width",-e/10+"rem"),this.css_tweaks.toggle("chat-font",13!==o||"inherit"!==f),this.css_tweaks.toggle("chat-width",this.settings.get("chat.use-width")),this.css_tweaks.toggle("emote-alignment-padded",1===a),this.css_tweaks.toggle("emote-alignment-baseline",2===a),this.emit(":update-chat-css"),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateLineBorders(){const e=this.chat.context.get("chat.lines.borders");this.css_tweaks.toggle("chat-borders",e>0),this.css_tweaks.toggle("chat-borders-3d",2===e),this.css_tweaks.toggle("chat-borders-3d-inset",3===e),this.css_tweaks.toggle("chat-borders-wide",4===e)}updateMentionCSS(){const e=this.chat.context.get("chat.filtering.highlight-mentions");this.css_tweaks.toggle("chat-mention-token",this.chat.context.get("chat.filtering.highlight-tokens"));const s=this.chat.context.get("chat.filtering.mention-color");s?(this.css_tweaks.toggle("chat-mention-bg",!1),this.css_tweaks.toggle("chat-mention-bg-alt",!1),this.css_tweaks.toggle("chat-mention-bg-custom",!0),this.css_tweaks.setVariable("chat-mention-color",this.inverse_colors.process(s))):(this.css_tweaks.toggle("chat-mention-bg-custom",!1),this.css_tweaks.toggle("chat-mention-bg",e),this.css_tweaks.toggle("chat-mention-bg-alt",e&&this.chat.context.get("chat.lines.alternate")))}updatePointsInfo(e){const s=null==e?void 0:e.pointIcon,n=null==e?void 0:e.pointName;s?this.css_tweaks.set("points-icon",`.ffz--points-icon:before { display: none }\n.ffz--points-icon:after {\n\tdisplay: inline-block;\n\tmargin: 0 0.5rem -0.6rem;\n\tbackground-image: url("${s.url}");\n\tbackground-image: ${u.WEBKIT_CSS}image-set(url("${s.url}") 1x, url("${s.url2x}") 2x, url("${s.url4x}") 4x);\n}`):this.css_tweaks.delete("points-icon"),this.point_name=n||null}async grabTypes(){if(this.types_loaded)return;const e=await this.web_munch.findModule("chat-types");if(this.automod_types=(null==e?void 0:e.automod)||A,this.chat_types=(null==e?void 0:e.chat)||D,this.message_types=(null==e?void 0:e.message)||j,this.mod_types=(null==e?void 0:e.mod)||O,!e)return;this.types_loaded=!0;const s=[];Object(a.shallow_object_equals)(this.automod_types,A)||s.push("AUTOMOD_TYPES"),Object(a.shallow_object_equals)(this.chat_types,D)||s.push("CHAT_TYPES"),Object(a.shallow_object_equals)(this.message_types,j)||s.push("MESSAGE_TYPES"),Object(a.shallow_object_equals)(this.mod_types,O)||s.push("MOD_TYPES"),s.length&&this.log.info("Chat Types have changed from static mappings for categories:",s.join(" "))}onEnable(){this.on("site.web_munch:loaded",this.grabTypes),this.on("site.web_munch:loaded",this.defineClasses),this.grabTypes(),this.defineClasses(),this.chat.context.on("changed:chat.points.show-callouts",(()=>{this.InlineCallout.forceUpdate(),this.CalloutSelector.forceUpdate()})),this.chat.context.on("changed:chat.points.show-button",(()=>this.PointsButton.forceUpdate())),this.chat.context.on("changed:chat.points.show-rewards",(()=>{this.PointsButton.forceUpdate(),this.PointsClaimButton.forceUpdate()})),this.chat.context.on("changed:chat.banners.hype-train",this.cleanHighlights,this),this.chat.context.on("changed:chat.subs.gift-banner",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.polls",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.prediction",this.cleanHighlights,this),this.chat.context.on("changed:chat.banners.drops",this.cleanHighlights,this),this.chat.context.on("changed:chat.subs.gift-banner",(()=>this.GiftBanner.forceUpdate()),this),this.chat.context.on("changed:chat.effective-width",this.updateChatCSS,this),this.settings.main_context.on("changed:chat.use-width",this.updateChatCSS,this),this.chat.context.on("changed:chat.actions.size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.timestamp-size",this.updateChatCSS,this),this.chat.context.on("changed:chat.font-family",this.updateChatCSS,this),this.chat.context.on("changed:chat.lines.emote-alignment",this.updateChatCSS,this),this.chat.context.on("changed:chat.adjustment-mode",this.updateColors,this),this.chat.context.on("changed:chat.adjustment-contrast",this.updateColors,this),this.chat.context.on("changed:theme.is-dark",this.updateColors,this),this.chat.context.on("changed:theme.color.background",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-background",this.updateColors,this),this.chat.context.on("changed:theme.color.text",this.updateColors,this),this.chat.context.on("changed:theme.color.chat-text",this.updateColors,this),this.chat.context.on("changed:chat.lines.borders",this.updateLineBorders,this),this.chat.context.on("changed:chat.filtering.highlight-mentions",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.highlight-tokens",this.updateMentionCSS,this),this.chat.context.on("changed:chat.filtering.mention-color",this.updateMentionCSS,this),this.chat.context.on("changed:chat.pin-resubs",(e=>{e&&(this.updateInlineCallouts(),this.updatePinnedCallouts())}),this),this.chat.context.on("changed:chat.community-chest.show",(()=>{this.CommunityChestBanner.forceUpdate(),this.CalloutSelector.forceUpdate()}),this),this.chat.context.getChanges("chat.emotes.2x",(e=>{this.css_tweaks.toggle("big-emoji",e>1),this.toggleEmoteJail()})),this.chat.context.getChanges("chat.emotes.limit-size",(()=>this.toggleEmoteJail())),this.chat.context.getChanges("chat.input.show-mod-view",(e=>this.css_tweaks.toggleHide("mod-view",!e))),this.chat.context.getChanges("chat.lines.padding",(e=>this.css_tweaks.toggle("chat-padding",e))),this.chat.context.getChanges("chat.bits.show",(e=>this.css_tweaks.toggle("hide-bits",!e))),this.chat.context.getChanges("chat.bits.show-pinned",(e=>this.css_tweaks.toggleHide("pinned-cheer",!e))),this.chat.context.getChanges("chat.filtering.deleted-style",(e=>{this.css_tweaks.toggle("chat-deleted-strike",1===e||2===e),this.css_tweaks.toggle("chat-deleted-fade",e<2)})),this.chat.context.getChanges("chat.filtering.clickable-mentions",(e=>this.css_tweaks.toggle("clickable-mentions",e))),this.chat.context.getChanges("chat.filtering.bold-mentions",(e=>this.css_tweaks.toggle("chat-mention-no-bold",!e))),this.chat.context.getChanges("chat.hide-community-highlights",(e=>this.css_tweaks.toggleHide("community-highlights",e))),this.chat.context.getChanges("chat.lines.alternate",(e=>{this.css_tweaks.toggle("chat-rows",e),this.updateMentionCSS()})),this.updateChatCSS(),this.updateColors(),this.updateLineBorders(),this.RaidController.on("mount",this.wrapRaidController,this),this.RaidController.on("update",this.noAutoRaids,this),this.RaidController.ready(((e,s)=>{for(const e of s)this.wrapRaidController(e)})),this.InlineCallout.on("mount",this.onInlineCallout,this),this.InlineCallout.on("update",this.onInlineCallout,this),this.InlineCallout.ready((()=>this.updateInlineCallouts())),this.PinnedCallout.on("mount",this.onPinnedCallout,this),this.PinnedCallout.on("update",this.onPinnedCallout,this),this.PinnedCallout.ready((()=>this.updatePinnedCallouts()));const e=this;this.PointsInfo.on("mount",this.updatePointsInfo,this),this.PointsInfo.on("update",this.updatePointsInfo,this),this.PointsInfo.on("unmount",(()=>this.updatePointsInfo(null))),this.PointsInfo.ready((()=>this.updatePointsInfo(this.PointsInfo.first))),this.GiftBanner.ready((s=>{const n=s.prototype.render;s.prototype.render=function(){return e.chat.context.get("chat.subs.gift-banner")?n.call(this):null},this.GiftBanner.forceUpdate()})),this.CommunityChestBanner.ready((s=>{const n=s.prototype.render;s.prototype.render=function(){try{if(!e.chat.context.get("chat.community-chest.show"))return null}catch(s){e.log.capture(s),e.log.error(s)}return n.call(this)},this.CommunityChestBanner.forceUpdate()})),this.InlineCallout.ready((s=>{const n=s.prototype.render;s.prototype.render=function(){try{var s,o;const n=null===(s=this.props)||void 0===s||null===(o=s.event)||void 0===o?void 0:o.callout,a=null==n?void 0:n.trackingType;if("community_points_reward"===a&&!e.chat.context.get("chat.points.show-callouts"))return null;if("prime_gift_bomb"===a&&!e.chat.context.get("chat.community-chest.show"))return null;if("megacheer_emote_recipient"===a&&!e.chat.context.get("chat.bits.show-rewards"))return null}catch(s){e.log.capture(s),e.log.error(s)}return n.call(this)},this.InlineCallout.forceUpdate()})),this.CalloutSelector.ready((s=>{const n=s.prototype.render;s.prototype.render=function(){try{var s;const n=this.props.callouts[0]||this.props.pinnedCallout,o=null==n||null===(s=n.event)||void 0===s?void 0:s.type;if("prime-gift-bomb-gifter"===o&&!e.chat.context.get("chat.community-chest.show"))return null;if("community-points-rewards"===o&&!e.chat.context.get("chat.points.show-callouts"))return null;if(("mega-recipient-rewards"===o||"mega-benefactor-rewards"===o)&&!e.chat.context.get("chat.bits.show-rewards"))return null}catch(s){e.log.capture(s),e.log.error(s)}return n.call(this)},this.CalloutSelector.forceUpdate()})),this.PointsButton.ready((s=>{const n=s.prototype.render;s.prototype.render=function(){try{if(!e.chat.context.get("chat.points.show-button"))return null;if(!e.chat.context.get("chat.points.show-rewards")){const e=this.state.animationQueue;this.state.animationQueue=[];const s=n.call(this);return this.state.animationQueue=e,s}}catch(s){e.log.capture(s),e.log.error(s)}return n.call(this)},this.PointsButton.forceUpdate()})),this.PointsClaimButton.ready((s=>{s.prototype.ffzHasOffer=function(){var e;return!(this.props.hidden||null!==(e=this.state)&&void 0!==e&&e.error||null==this.getClaim())};const n=s.prototype.render;s.prototype.render=function(){try{if(this.ffzHasOffer()&&!this._ffz_timer&&e.chat.context.get("chat.points.auto-rewards")&&(this._ffz_timer=setTimeout((()=>{this._ffz_timer=null,this.onClick&&this.ffzHasOffer()&&this.onClick()}),1e3+Math.floor(5e3*Math.random()))),!e.chat.context.get("chat.points.show-rewards"))return null}catch(s){e.log.capture(s),e.log.error(s)}return n.call(this)},this.PointsClaimButton.forceUpdate()})),this.ChatController.on("mount",this.chatMounted,this),this.ChatController.on("unmount",this.chatUnmounted,this),this.ChatController.on("update",this.chatUpdated,this),this.ChatService.ready(((e,s)=>{this.wrapChatService(e);for(const e of s){var n,o,a,u;e.client.events.removeAll(),e._ffzInstall();const s=e.joinedChannel,f=null===(n=e.client)||void 0===n||null===(o=n.session)||void 0===o||null===(a=o.channelstate)||void 0===a||null===(u=a[`#${s}`])||void 0===u?void 0:u.roomState;f&&this.updateChatState(f),e.connectHandlers(),e.props.setChatConnectionAPI({sendMessage:e.sendMessage,_ffz_inst:e})}})),this.ChatBuffer.ready(((e,s)=>{this.wrapChatBuffer(e);for(const e of s){const s=e.props.messageHandlerAPI;s&&s.removeMessageHandler(e.handleMessage),e._ffzInstall(),s&&s.addMessageHandler(e.handleMessage),e.props.setMessageBufferAPI({addUpdateHandler:e.addUpdateHandler,removeUpdateHandler:e.removeUpdateHandler,getMessages:e.getMessages,isPaused:e.isPaused,setPaused:e.setPaused,hasNewerLeft:e.hasNewerLeft,loadNewer:e.loadNewer,loadNewest:e.loadNewest,_ffz_inst:e})}})),this.ChatBufferConnector.on("mount",this.connectorMounted,this),this.ChatBufferConnector.on("update",this.connectorUpdated,this),this.ChatBufferConnector.on("unmount",this.connectorUnmounted,this),this.ChatBufferConnector.ready(((e,s)=>{for(const e of s)this.connectorMounted(e)})),this.ChatController.ready(((e,s)=>{const n=this,o=e.prototype.componentDidCatch,a=e.prototype.render;e.prototype.componentDidCatch=function(e,s){const a=this.state.ffz_errors||0;if(a<100&&(this.setState({ffz_errors:a+1}),n.log.info("Error within Chat",e,s,a)),o)return o.call(this,e,s)},e.prototype.render=function(){if(this.state.ffz_errors>0){const e=n.web_munch.getModule("react"),s=e&&e.createElement;return s?s("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},"There was an error displaying chat."):null}return a.call(this)};for(const e of s)this.chatMounted(e)})),this.ChatContainer.on("mount",this.containerMounted,this),this.ChatContainer.on("unmount",this.containerUnmounted,this),this.ChatContainer.on("update",this.containerUpdated,this),this.ChatContainer.ready(((e,s)=>{const n=this,o=e.prototype.render,a=e.prototype.componentDidCatch;e.prototype.render=function(){try{if(n.CommunityStackHandler){var e,s,a;const u=n.web_munch.getModule("react"),f=o.call(this),g=null==f||null===(e=f.props)||void 0===e||null===(s=e.children)||void 0===s||null===(a=s.props)||void 0===a?void 0:a.children;return u&&Array.isArray(g)&&g.push(u.createElement(n.CommunityStackHandler)),f}}catch(e){}return o.call(this)},e.prototype.componentDidCatch=function(e,s){const o=this.state.ffz_errors||0;if(o<100&&(this.setState({ffz_errors:o+1}),n.log.info("Error within Chat Container",e,s,o)),a)return a.call(this,e,s)};for(const e of s)this.containerMounted(e)})),this.subpump.on(":pubsub-message",(e=>{var s,n;if("community-points-channel-v1"!==e.prefix)return;const o=this.ChatService.first,u=e.message,f=null==u||null===(s=u.data)||void 0===s?void 0:s.redemption;if(!u||!o||"reward-redeemed"!==u.type||o.props.channelID!=(null==f?void 0:f.channel_id))return;if(f.user_input)return;const g=(null===(n=f.reward)||void 0===n?void 0:n.id)&&Object(a.get)(f.reward.id,o.props.rewardMap);if(g&&!this.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward")){const e={id:f.id,type:this.chat_types.Message,ffz_type:"points",ffz_reward:g,messageParts:[],user:{id:f.user.id,login:f.user.login,displayName:f.user.display_name},timestamp:new Date(u.data.timestamp||f.redeemed_at).getTime()};o.postMessageToCurrentChannel({},e)}}))}wrapRaidController(e){if(e._ffz_wrapped)return this.noAutoRaids(e);e._ffz_wrapped=!0;const s=this,n=e.handleJoinRaid;e.handleJoinRaid=function(o,...a){const u=e.props&&e.props.raid&&e.props.raid.id;return o&&o.type&&u&&s.joined_raids.add(u),n.call(this,o,...a)},this.noAutoRaids(e)}noAutoRaids(e){this.settings.get("channel.raids.no-autojoin")&&setTimeout((()=>{if(e.props&&e.props.raid&&!e.isRaidCreator&&e.hasJoinedCurrentRaid){const s=e.props.raid.id;if(this.joined_raids.has(s))return;this.log.info("Automatically leaving raid:",s),e.handleLeaveRaid()}}))}toggleEmoteJail(){const e=this.chat.context.get("chat.emotes.2x"),s=this.chat.context.get("chat.emotes.limit-size");this.css_tweaks.toggle("big-emote-jail",s&&!e),this.css_tweaks.toggle("bigger-emote-jail",s&&e)}cleanHighlights(){var e;const s={community_sub_gift:this.chat.context.get("chat.subs.gift-banner"),megacheer:this.chat.context.get("chat.bits.show"),hype_train:this.chat.context.get("chat.banners.hype-train"),prediction:this.chat.context.get("chat.banners.prediction"),poll:this.chat.context.get("chat.banners.polls"),"mw-drop-available":this.chat.context.get("chat.banners.drops")},n=null===(e=this.community_stack)||void 0===e?void 0:e.highlights;if(Array.isArray(n))for(const e of n){if(!e||!e.event||!e.id)continue;const n=e.event.type;n&&Object(a.has)(s,n)&&!s[n]&&(this.log.info("Removing community highlight: ",n,"#",e.id),this.community_dispatch({type:"remove-highlight",id:e.id}))}}defineClasses(){if(this.CommunityStackHandler)return!0;const e=this,s=this.web_munch.getModule("react"),n=s&&s.createElement,o=this.web_munch.getModule("highlightstack");if(!n||!o)return!1;this.CommunityStackHandler=function(){const n=s.useContext(o.stack),a=s.useContext(o.dispatch);return e.community_stack=n,e.community_dispatch=a,e.cleanHighlights(),null},this.ChatContainer.forceUpdate()}updateChatState(e){const s=this.chat.context.get("context.chat_state")||{};Object(a.deep_equals)(e,s)||(this.chat.context.updateContext({chat_state:e}),this.input.updateInput())}updatePinnedCallouts(){for(const e of this.PinnedCallout.instances)this.onPinnedCallout(e)}onPinnedCallout(e){if(!this.chat.context.get("chat.pin-resubs")||e._ffz_pinned)return;const s=e.props,n=s&&s.event;!s.pinned&&n&&"share-resub"===n.type&&(this.log.info("Automatically pinning re-sub notice."),e._ffz_pinned=!0,e.pin())}updateInlineCallouts(){for(const e of this.InlineCallout.instances)this.onInlineCallout(e)}onInlineCallout(e){if(!this.chat.context.get("chat.pin-resubs")||e._ffz_pinned)return;const s=Object(a.get)("props.event.callout",e);if(!s||"Share"!==s.cta)return;const n=Object(a.get)("contextMenuProps.onPin",s);n&&(this.log.info("Automatically pinning re-sub notice."),e._ffz_pinned=!0,e.hideOnContextMenuAction?e.hideOnContextMenuAction(n)():n())}tryUpdateBadges(){this._badge_timer||(this._badge_timer=setTimeout((()=>this._tryUpdateBadges()),0))}_tryUpdateBadges(){this._badge_timer&&clearTimeout(this._badge_timer),this._badge_timer=null,this.log.info("Trying to update badge data from the chat container.");const e=this.ChatContainer.first;e&&this.containerUpdated(e,e.props)}wrapChatBuffer(e){if(e.prototype._ffz_was_here)return;const s=this,n=e.prototype.clear,o=e.prototype.flushRawMessages,a=e.prototype.componentDidMount;e.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const e=this,n=e.handleMessage,o=e.props.setMessageBufferAPI;e.props.setMessageBufferAPI=function(s){return s&&(s._ffz_inst=e),o(s)},e.handleMessage=function(o){if(o)try{const n=s.chat_types||{};s.mod_types;if(s.chat.context.get("chat.filtering.blocked-types").has(n[o.type]))return;if(o.type===n.ChannelPointsReward)return;if(o.type===n.RewardGift&&!s.chat.context.get("chat.bits.show-rewards"))return;if(o.type===n.Message){var a,u,g;const n=s.chat.standardizeMessage(o),_=null!==(a=e._ffz_connector)&&void 0!==a?a:e.ffzGetConnector();let b=n.roomID=n.roomID?n.roomID:null==_||null===(u=_.props)||void 0===u?void 0:u.channelID,v=n.roomLogin=n.roomLogin?n.roomLogin:n.channel?n.channel.slice(1):null==_||null===(g=_.props)||void 0===g?void 0:g.channelLogin;if(!v&&b){const e=s.chat.getRoom(b,null,!0);e&&e.login&&(v=n.roomLogin=e.login)}if(!b&&v){const e=s.chat.getRoom(null,v,!0);e&&e.id&&(b=n.roomID=e.id)}const k=s.site.getUser();if(k&&_&&(k.moderator=_.props.isCurrentUserModerator,k.staff=_.props.isStaff),n.ffz_tokens=n.ffz_tokens||s.chat.tokenizeMessage(n,k,!0),n.ffz_removed)return;if(s.hasListeners("chat:receive-message")){const o=new f.FFZEvent({message:n,inst:e,channel:v,channelID:b});if(s.emit("chat:receive-message",o),o.defaultPrevented||n.ffz_removed)return}}else o.type===n.Moderation?s.emit("chat:mod-user",o.moderationType,o.userLogin,o.targetMessageID,o):o.type===n.Clear&&(s.chat.context.get("chat.filtering.ignore-clear")?o={type:n.Info,message:s.i18n.t("chat.ignore-clear","An attempt by a moderator to clear chat was ignored.")}:s.emit("chat:clear-chat",o))}catch(e){s.log.error("Error processing chat event.",e),s.log.capture(e,{extra:{msg:o}})}return n.call(e,o)},e.setPaused=function(n){e.paused!==n&&(e.paused=n,n||(e.slidingWindowEnd=Math.min(e.buffer.length,s.chat.context.get("chat.scrollback-length")),e.props.isBackground||e.notifySubscribers()))},e.loadNewer=function(){if(!e.hasNewerLeft())return;const n=Math.min(e.buffer.length,e.slidingWindowEnd+40),o=Math.max(0,n-s.chat.context.get("chat.scrollback-length"));e.clear(e.buffer.length-o),e.slidingWindowEnd=n-o,e.props.isBackground||e.notifySubscribers()},e.loadNewest=function(){if(!e.hasNewerLeft())return;const n=s.chat.context.get("chat.scrollback-length");e.clear(n),e.slidingWindowEnd=Math.min(n,e.buffer.length),e.props.isBackground||e.notifySubscribers()},e.getMessages=function(){return e.buffer.slice(0,e.slidingWindowEnd+(e.ffz_extra||0))}},e.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(e){s.log.error("Error installing FFZ features onto chat buffer.",e)}return a.call(this)},e.prototype.clear=function(e){try{null==e&&(e=0);const n=s.chat.context.get("chat.scrollback-length");if(!this.isPaused()&&e>n&&(e=n),e<=0)this.ffz_extra=0,this.buffer=[],this.delayedMessageBuffer=[],this.paused=!1;else{const n=this.buffer,o=s.chat_types||D,a=n.length-e;if(a>0){let s,u=0;for(let e=0;e<a;e++)n[e]&&!B.includes(o[n[e].type])&&(u++,s=e);this.buffer=n.slice(u%2!=0?Math.max(a-4,s):a),this.ffz_extra=n.length-e}else this.ffz_extra=0,this.buffer=this.buffer.slice(0);this.paused&&this.buffer.length>=900&&this.setPaused(!1)}}catch(o){return s.log.error("Error running clear",o),n.call(this,e)}},e.prototype.ffzGetConnector=function(){if(this._ffz_connector)return this._ffz_connector;const e=Date.now();if(e-(this._ffz_connect_tried||0)>5e3){var n,o;this._ffz_connect_tried=e;const a=s.ChatBufferConnector.first;if((null==a||null===(n=a.props)||void 0===n||null===(o=n.messageBufferAPI)||void 0===o?void 0:o._ffz_inst)===this)return this._ffz_connector=a}},e.prototype.flushRawMessages=function(){try{const n=[],o=s.chat_types||D,a=Date.now(),u=s.chat.context.get("chat.delay"),g=a-(-1===u?this.delayDuration:u),_=this.shouldSeeBlockedAndDeletedMessages||this.props&&this.props.shouldSeeBlockedAndDeletedMessages,b=this.hasNewerLeft(),v=this.isPaused(),k=s.chat.context.get("chat.scrollback-length"),x=s.chat.context.get("chat.filtering.remove-deleted"),C=s.hasListeners("chat:buffer-message");let E,z=0,j=this.slidingWindowEnd,O=!1;for(const a of this.delayedMessageBuffer)if(a.time<=g||!a.shouldDelay){if(0!==x&&(x>1||!_)&&this.isDeletable(a.event)&&a.event.deleted)continue;if(C){if(E)E._reset();else{var e;E=new f.FFZEvent;const n=null!==(e=this._ffz_connector)&&void 0!==e?e:this.ffzGetConnector(),o=n&&n.props.channelID;if(E.inst=this,E.channelID=o,o){const e=s.chat.getRoom(o,null,!0);e&&e.login&&(E.channel=e.login)}}if(E.message=a.event,s.emit("chat:buffer-message",E),E.defaultPrevented||a.event.ffz_removed)continue}const n=this.buffer[this.buffer.length-1],u=null==n?void 0:n.type;!this.props.isLoadingHistoricalMessages&&!this.props.historicalMessages||u!==o.Connected||a.event.type===o.Connected||this.buffer.find((e=>e.type===o.LiveMessageSeparator))||this.buffer.push({type:o.LiveMessageSeparator,id:"live-message-separator"}),this.buffer.push(a.event),O=!0,this.paused||(this.buffer.length>k?z++:j++)}else n.push(a);this.delayedMessageBuffer=n,O&&(this.clear(Math.min(900,this.buffer.length-z)),0===z&&j===this.slidingWindowEnd&&b===this.hasNewerLeft()&&v===this.isPaused()||(this.slidingWindowEnd=j,this.props.isBackground||this.notifySubscribers()))}catch(e){return s.log.error("Error running flush.",e),o.call(this)}}}addNotice(e,s){if(!e)return!1;e.startsWith("#")&&(e=e.slice(1)),e=e.toLowerCase();for(const n of this.ChatService.instances)if(n.props.channelLogin.toLowerCase()===e)return n.addMessage({type:this.chat_types.Notice,message:s}),!0;return!1}sendMessage(e,s){const n=this.ChatService.first;return n&&e?(e.startsWith("#")&&(e=e.slice(1)),e.toLowerCase()!==n.props.channelLogin.toLowerCase()?n.client.sendCommand(e,s):void n.sendMessage(s)):null}scheduleMystery(e){e.line&&(e._timer||(e._timer=setTimeout((()=>requestAnimationFrame((()=>{e._timer=null,e.line&&e.line.forceUpdate()}))),250)))}wrapChatService(e){const s=this,n=e.prototype.componentDidMount,o=e.prototype.connectHandlers;e.prototype._ffz_was_here=!0,e.prototype._ffzInstall=function(){if(this._ffz_installed)return;this._ffz_installed=!0;const e=this,n=this.sendMessage,addMessage=(...s)=>e.addMessage(...s),sendMessage=(s,n)=>e.sendMessage(s,n);e.sendMessage=function(o,a){if((o=o.replace(/\s+/g," ")).startsWith("/ffz"))return e.addMessage({type:s.chat_types.Notice,message:"The /ffz command is not yet re-implemented."}),!1;const u=new f.FFZEvent({message:o,extra:a,context:s.chat.context,channel:e.props.channelLogin,addMessage:addMessage,sendMessage:sendMessage});return s.emit("chat:pre-send-message",u),u.defaultPrevented?void 0:n.call(this,u.message,u.extra)}},e.prototype.componentDidMount=function(){try{this._ffzInstall()}catch(e){s.log.error("Error installing FFZ features onto chat service.",e)}return n.call(this)},e.prototype.connectHandlers=function(...e){if(!this._ffz_init){const e=this;for(const s of P){const n=this[s];n&&(this[s]=function(s,o){e._wrapped=s;const a=n.call(e,s,o);return e._wrapped=null,a})}const n=this.onAnnouncementEvent;this.onAnnouncementEvent=function(e){return console.log("announcement",e),n.call(this,e)};const o=this.onSubscriptionEvent;this.onSubscriptionEvent=function(n){try{if(s.chat.context.get("chat.filtering.blocked-types").has("Subscription"))return;if(s.chat.context.get("chat.subs.show")<3)return;n.body="";const o=e.convertMessage({message:n});return o.ffz_type="resub",o.gift_theme=n.giftTheme,o.sub_goal=e.getGoalData?e.getGoalData(n.goalData):null,o.sub_plan=n.methods,e.postMessageToCurrentChannel(n,o)}catch(a){return s.log.capture(a,{extra:n}),o.call(e,n)}};const u=this.onRoomStateEvent;this.onRoomStateEvent=function(n){try{const e=n.channel,o=s.chat.context.get("context.channel");!e||e!==o&&e!==`#${o}`||s.updateChatState(n.state)}catch(e){s.log.capture(e,{extra:n})}return u.call(e,n)};const f=this.onResubscriptionEvent;this.onResubscriptionEvent=function(n){try{if(s.chat.context.get("chat.filtering.blocked-types").has("Resubscription"))return;if(s.chat.context.get("chat.subs.show")<2&&!n.body)return;const o=e.convertMessage({message:n});return o.ffz_type="resub",o.gift_theme=n.giftTheme,o.sub_goal=e.getGoalData?e.getGoalData(n.goalData):null,o.sub_cumulative=n.cumulativeMonths||0,o.sub_streak=n.streakMonths||0,o.sub_share_streak=n.shouldShareStreakTenure,o.sub_months=n.months,o.sub_plan=n.methods,e.postMessageToCurrentChannel(n,o)}catch(o){return s.log.capture(o,{extra:n}),f.call(e,n)}};const g=this.ffz_mysteries={},_=this.onSubscriptionGiftEvent;this.onSubscriptionGiftEvent=function(n){try{if(s.chat.context.get("chat.filtering.blocked-types").has("SubGift"))return;const o=`${n.channel}:${n.user.userID}`,a=g[o];if(a){if(!(a.expires<Date.now()))return a.recipients.push({id:n.recipientID,login:n.recipientLogin,displayName:n.recipientName}),a.recipients.length>=a.size&&(g[o]=null),void(a.line&&s.scheduleMystery(a));g[o]=null}n.body="";const u=e.convertMessage({message:n});return u.ffz_type="sub_gift",u.sub_recipient={id:n.recipientID,login:n.recipientLogin,displayName:n.recipientName},u.gift_theme=n.giftTheme,u.sub_goal=e.getGoalData?e.getGoalData(n.goalData):null,u.sub_months=n.giftMonths,u.sub_plan=n.methods,u.sub_total=n.senderCount,e.postMessageToCurrentChannel(n,u)}catch(o){return s.log.capture(o,{extra:n}),_.call(e,n)}};const b=this.onCommunityIntroductionEvent;this.onCommunityIntroductionEvent=function(n){try{if(s.chat.context.get("chat.filtering.blocked-types").has("CommunityIntroduction")){const s=e.convertMessage(n);return e.postMessageToCurrentChannel(n,s)}}catch(e){s.log.capture(e,{extra:n}),s.log.error(e)}return b.call(this,n)};const v=this.onAnonSubscriptionGiftEvent;this.onAnonSubscriptionGiftEvent=function(n){try{if(s.chat.context.get("chat.filtering.blocked-types").has("AnonSubGift"))return;const o=`${n.channel}:ANON`,a=g[o];if(a){if(!(a.expires<Date.now()))return a.recipients.push({id:n.recipientID,login:n.recipientLogin,displayName:n.recipientName}),a.recipients.length>=a.size&&(g[o]=null),void(a.line&&s.scheduleMystery(a));g[o]=null}n.body="";const u=e.convertMessage({message:n});return u.ffz_type="sub_gift",u.gift_theme=n.giftTheme,u.sub_goal=e.getGoalData?e.getGoalData(n.goalData):null,u.sub_anon=!0,u.sub_recipient={id:n.recipientID,login:n.recipientLogin,displayName:n.recipientName},u.sub_months=n.giftMonths,u.sub_plan=n.methods,u.sub_total=n.senderCount,e.postMessageToCurrentChannel(n,u)}catch(o){return s.log.capture(o,{extra:n}),v.call(e,n)}};const k=this.onSubscriptionMysteryGiftEvent;this.onSubscriptionMysteryGiftEvent=function(n){try{if(s.chat.context.get("chat.filtering.blocked-types").has("SubMysteryGift"))return;let o=null;if(n.massGiftCount>s.chat.context.get("chat.subs.merge-gifts")){const e=`${n.channel}:${n.user.userID}`;o=g[e]={recipients:[],size:n.massGiftCount,expires:Date.now()+3e4}}n.body="";const a=e.convertMessage({message:n});return a.ffz_type="sub_mystery",a.gift_theme=n.giftTheme,a.sub_goal=e.getGoalData?e.getGoalData(n.goalData):null,a.mystery=o,a.sub_plan=n.plan,a.sub_count=n.massGiftCount,a.sub_total=n.senderCount,e.postMessageToCurrentChannel(n,a)}catch(o){return s.log.capture(o,{extra:n}),k.call(e,n)}};const x=this.onAnonSubscriptionMysteryGiftEvent;this.onAnonSubscriptionMysteryGiftEvent=function(n){try{if(s.chat.context.get("chat.filtering.blocked-types").has("AnonSubMysteryGift"))return;let o=null;if(n.massGiftCount>s.chat.context.get("chat.subs.merge-gifts")){const e=`${n.channel}:ANON`;o=g[e]={recipients:[],size:n.massGiftCount,expires:Date.now()+3e4}}n.body="";const a=e.convertMessage({message:n});return a.ffz_type="sub_mystery",a.sub_anon=!0,a.mystery=o,a.sub_plan=n.plan,a.sub_count=n.massGiftCount,a.sub_total=n.senderCount,e.postMessageToCurrentChannel(n,a)}catch(o){return s.log.capture(o,{extra:n}),x.call(e,n)}};const C=this.onRitualEvent;this.onRitualEvent=function(n){try{if(s.chat.context.get("chat.filtering.blocked-types").has("Ritual"))return;const o=e.convertMessage(n);return o.ffz_type="ritual",o.ritual=n.type,e.postMessageToCurrentChannel(n,o)}catch(o){return s.log.capture(o,{extra:n}),C.call(e,n)}};const E=this.onChannelPointsRewardEvent;this.onChannelPointsRewardEvent=function(n){try{if(s.chat.context.get("chat.filtering.blocked-types").has("ChannelPointsReward"))return;const o=n.rewardID&&Object(a.get)(n.rewardID,e.props.rewardMap);if(o){const s=e.convertMessage(n);return s.ffz_type="points",s.ffz_reward=o,e.postMessageToCurrentChannel(n,s)}}catch(e){s.log.error(e),s.log.capture(e,{extra:n})}return E.call(e,n)};const z=this.onHostingEvent;this.onHostingEvent=function(n,o){return s.emit("tmi:host",n,o),z.call(e,n,o)};const j=this.onUnhostEvent;this.onUnhostEvent=function(n,o){return s.emit("tmi:unhost",n,o),j.call(e,n,o)};const O=this.addMessage;this.addMessage=function(s){const n=e._wrapped;return n&&!s._ffz_checked?e.postMessageToCurrentChannel(n,s):O.call(e,s)},this._ffz_init=!0}return o.apply(this,...e)},e.prototype.postMessageToCurrentChannel=function(e,n){var o,a;const u=n;if(n._ffz_checked=!0,(n.type===s.chat_types.ChannelPointsReward||n.type===s.chat_types.CommunityIntroduction||(null===(o=n.message)||void 0===o?void 0:o.user)&(null===(a=n.message)||void 0===a?void 0:a.badgeDynamicData))&&(n=n.message),e.channel){let s=n.channel=e.channel.toLowerCase();if(s.startsWith("#")&&(s=s.slice(1)),s!==this.props.channelLogin.toLowerCase())return;n.roomLogin=s}if(e.message){const o=e.message.user,a=e.message.flags;if(o&&(n.emotes=o.emotes),a&&this.getFilterFlagOptions){const e=this.props.isCurrentUserModerator&&s.chat.context.get("chat.automod.run-as-mod");e&&(this.props.isCurrentUserModerator=!1),n.flags=this.getFilterFlagOptions(a),e&&(this.props.isCurrentUserModerator=!0)}n.message&&"string"!=typeof n.message||("string"==typeof e.action?n.message=e.action:n.message=e.message.body)}this.addMessage(u)}}addRoom(e,s){if(s||(s=e.props),!s.channelID)return null;const n=e._ffz_room=this.chat.getRoom(s.channelID,s.channelLogin&&s.channelLogin.toLowerCase(),!1,!0);return n.ref(e),n}removeRoom(e){e._ffz_room&&(e._ffz_room.unref(e),e._ffz_room=null)}chatMounted(e,s){e.chatBuffer&&(e.chatBuffer.ffzController=e),s||(s=e.props),this.addRoom(e,s)&&(this.updateRoomBitsConfig(e,s.bitsConfig),this.settings.updateContext({moderator:s.isCurrentUserModerator,chatHidden:s.isHidden}),(s.isEmbedded||s.isPopout)&&this.settings.updateContext({channel:s.channelLogin&&s.channelLogin.toLowerCase(),channelID:s.channelID}),this.chat.context.updateContext({moderator:s.isCurrentUserModerator,channel:s.channelLogin&&s.channelLogin.toLowerCase(),channelID:s.channelID}))}chatUnmounted(e){e.chatBuffer&&e.chatBuffer.ffzController===this&&(e.chatBuffer.ffzController=null),(e.props.isEmbedded||e.props.isPopout)&&this.settings.updateContext({channel:null,channelID:null}),this.settings.updateContext({moderator:!1,chatHidden:!1}),this.chat.context.updateContext({moderator:!1,channel:null,channelID:null}),this.removeRoom(e)}chatUpdated(e,s){if(e.chatBuffer&&(e.chatBuffer.ffzController=e),!e._ffz_room||s.channelID!=e._ffz_room.id)return this.removeRoom(e),void(e._ffz_mounted&&this.chatMounted(e));s.bitsConfig!==e.props.bitsConfig&&this.updateRoomBitsConfig(e,e.props.bitsConfig);let n=e.props.channelLogin;n&&(n=n.toLowerCase()),(e.props.isEmbedded||e.props.isPopout)&&this.settings.updateContext({channel:n,channelID:e.props.channelID}),this.settings.updateContext({moderator:e.props.isCurrentUserModerator,chatHidden:e.props.isHidden}),this.chat.context.updateContext({moderator:e.props.isCurrentUserModerator,channel:n,channelID:e.props.channelID})}updateRoomBitsConfig(e,s){const n=e._ffz_room;if(!n)return;let o=null;if(s&&Array.isArray(s.orderedActions)){o=new Set;for(const e of s.orderedActions)e&&e.prefix&&o.add(e.prefix)}!this._ffz_old_bits&&!o||Object(a.set_equals)(this._ffz_old_bits,o)||(this._ffz_old_bits=o,n.updateBitsConfig(formatBitsConfig(s)),this.chat_line.updateLineTokens())}connectorMounted(e){const s=e.props.messageBufferAPI;s&&s._ffz_inst&&s._ffz_inst._ffz_connector!==e&&(s._ffz_inst._ffz_connector=e)}connectorUpdated(e,s){const n=s.messageBufferAPI,o=e.props.messageBufferAPI;n!==o&&(n&&n._ffz_inst&&n._ffz_inst._ffz_connector===e&&(n._ffz_inst._ffz_connector=null),o&&o._ffz_inst&&o._ffz_inst._ffz_connector!==e&&(n._ffz_inst._ffz_connector=e))}connectorUnmounted(e){const s=e.props.messageBufferAPI;s&&s._ffz_inst&&s._ffz_inst._ffz_connector===e&&(s._ffz_inst._ffz_connector=null)}get shouldUpdateChannel(){const e=this.router.current_name;return b.a.POPOUT_ROUTES.includes(e)||b.a.SUNLIGHT_ROUTES.includes(e)}containerMounted(e,s){if(s||(s=e.props),this.addRoom(e,s)&&(this.updateRoomBitsConfig(e,s.bitsConfig),s.data)){if(this.shouldUpdateChannel){var n;const e=null===(n=s.data.user)||void 0===n?void 0:n.primaryColorHex;this.resolve("site.channel").updateChannelColor(e),this.settings.updateContext({channel:s.channelLogin,channelID:s.channelID,channelColor:e})}this.chat.badges.updateTwitchBadges(s.data.badges),this.updateRoomBadges(e,s.data.user&&s.data.user.broadcastBadges),this.updateRoomRules(e,s.chatRules)}}containerUnmounted(e){this.shouldUpdateChannel&&(this.resolve("site.channel").updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})),this.removeRoom(e)}containerUpdated(e,s){if(!e._ffz_room||s.channelID!=e._ffz_room.id)return this.removeRoom(e),void(e._ffz_mounted&&this.containerMounted(e,s));if(s.bitsConfig!==e.props.bitsConfig&&this.updateRoomBitsConfig(e,s.bitsConfig),s.data&&b.a.POPOUT_ROUTES.includes(this.router.current_name)){var n;const e=null===(n=s.data.user)||void 0===n?void 0:n.primaryColorHex;this.resolve("site.channel").updateChannelColor(e),this.settings.updateContext({channel:s.channelLogin,channelID:s.channelID,channelColor:e})}const o=s.data||{},a=e.props.data||{},u=o.badges||[],f=a.badges||[],g=o.user&&o.user.broadcastBadges||[],_=a.user&&a.user.broadcastBadges||[];this.chat.badges.getTwitchBadgeCount()===u.length&&u.length===f.length||this.chat.badges.updateTwitchBadges(u),e._ffz_room.badgeCount()===g.length&&g.length===_.length||this.updateRoomBadges(e,g),this.updateRoomRules(e,s.chatRules)}hasRoomBadges(e){const s=e._ffz_room;return!!s&&s.hasBadges()}updateRoomBadges(e,s){const n=e._ffz_room;n&&(n.updateBadges(s),this.chat_line.updateLineBadges())}updateRoomRules(e,s){const n=e._ffz_room;n&&(n.rules=s)}}function formatBitsConfig(e){if(!e)return;const s={},n=e.indexedActions,o={};if(Array.isArray(e.tiers))for(const s of e.tiers)o[s.bits]=s.color;for(const f in n)if(Object(a.has)(n,f)){var u;const a=n[f],g=s[f]={id:a.id,prefix:a.prefix,tiers:[]};if(null!=e&&e.getImage)for(const s of a.orderedTiers){const n={};for(const o of["light","dark"]){const u=n[o]=n[o]||{},f=u.static=u.static||{},g=u.animated=u.animated||{};for(const n of[1,2,4])f[n]=e.getImage(a.prefix,o,"static",s.bits,n,"png"),g[n]=e.getImage(a.prefix,o,"animated",s.bits,n,"gif")}g.tiers.push({amount:s.bits,color:s.color||o[s.bits]||"inherit",id:s.id,images:n})}else if(null!==(u=a.orderedTiers[0])&&void 0!==u&&u.images)for(const e of a.orderedTiers){const s={};for(const n of e.images){const e=s[n.theme]=s[n.theme]||[],o=n.isAnimated?"animated":"static";(e[o]=e[o]||{})[n.dpiScale]=n.url}g.tiers.push({amount:e.bits,color:e.color||o[e.bits]||"inherit",id:e.id,images:s})}}return s}},function(e,s){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_EmoteMenu_SubStatus"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"Cursor"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"criteria"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SubscriptionBenefitCriteriaInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentUser"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"subscriptionBenefits"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"criteria"},value:{kind:"Variable",name:{kind:"Name",value:"criteria"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pageInfo"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasNextPage"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"edges"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"node"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"gift"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isGift"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"purchasedWithPrime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"endsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"renewsAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"product"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"emoteSetID"},arguments:[],directives:[]}]}}]}}]}}]}}]}}]}}],loc:{start:0,end:428}};n.loc.source={body:"query FFZ_EmoteMenu_SubStatus($first: Int, $after: Cursor, $criteria: SubscriptionBenefitCriteriaInput!) {\n\tcurrentUser {\n\t\tid\n\t\tsubscriptionBenefits(first: $first, after: $after, criteria: $criteria) {\n\t\t\tpageInfo {\n\t\t\t\thasNextPage\n\t\t\t}\n\t\t\tedges {\n\t\t\t\tcursor\n\t\t\t\tnode {\n\t\t\t\t\tid\n\t\t\t\t\tgift {\n\t\t\t\t\t\tisGift\n\t\t\t\t\t}\n\t\t\t\t\tpurchasedWithPrime\n\t\t\t\t\tendsAt\n\t\t\t\t\trenewsAt\n\t\t\t\t\tproduct {\n\t\t\t\t\t\tid\n\t\t\t\t\t\temoteSetID\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function collectFragmentReferences(e,s){if("FragmentSpread"===e.kind)s.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&s.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,s)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,s)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,s)}))}var o={};function findOperation(e,s){for(var n=0;n<e.definitions.length;n++){var o=e.definitions[n];if(o.name&&o.name.value==s)return o}}!function extractReferences(){n.definitions.forEach((function(e){if(e.name){var s=new Set;collectFragmentReferences(e,s),o[e.name.value]=s}}))}(),e.exports=n,e.exports.FFZ_EmoteMenu_SubStatus=function oneQuery(e,s){var n={kind:e.kind,definitions:[findOperation(e,s)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var a=o[s]||new Set,u=new Set,f=new Set;for(a.forEach((function(e){f.add(e)}));f.size>0;){var g=f;f=new Set,g.forEach((function(e){u.has(e)||(u.add(e),(o[e]||new Set).forEach((function(e){f.add(e)})))}))}return u.forEach((function(s){var o=findOperation(e,s);o&&n.definitions.push(o)})),n}(n,"FFZ_EmoteMenu_SubStatus")},function(e,s){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"targetID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"disableNotifications"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"disableNotifications"},value:{kind:"Variable",name:{kind:"Name",value:"disableNotifications"}}},{kind:"ObjectField",name:{kind:"Name",value:"targetID"},value:{kind:"Variable",name:{kind:"Name",value:"targetID"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follow"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"disableNotifications"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:230}};n.loc.source={body:"mutation($targetID: ID!, $disableNotifications: Boolean!) {\n  followUser(input: {\n    disableNotifications: $disableNotifications,\n    targetID: $targetID\n  }) {\n    follow {\n      disableNotifications\n      followedAt\n    }\n  }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function collectFragmentReferences(e,s){if("FragmentSpread"===e.kind)s.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&s.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,s)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,s)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,s)}))}var o={};!function extractReferences(){n.definitions.forEach((function(e){if(e.name){var s=new Set;collectFragmentReferences(e,s),o[e.name.value]=s}}))}(),e.exports=n},function(e,s,n){"use strict";var o=n(0);s.a={data:()=>({value:void 0,has_value:!1,profile:null,_unseen:!1,source:null,source_value:void 0}),created(){const e=this.context.context,s=this.item.setting;e._add_user(),this._update_profile(),this._uses_changed(e.uses(s)),this.item.unseen&&(this._unseen=!0,this.item.unseen=0),e.on(`uses_changed:${s}`,this._uses_changed,this)},destroyed(){const e=this.context.context,s=this.item.setting;this.profile&&this.profile.off("changed",this._setting_changed,this),this.source&&this.source.off("changed",this._source_setting_changed,this),e.off(`uses_changed:${s}`,this._uses_changed,this),this.value=void 0,this.has_value=!1,this.profile=null,this.source_value=void 0,this.source=null,e._remove_user()},watch:{"context.currentProfile"(){this._update_profile()}},computed:{data(){const e=this.item.data;return"function"==typeof e?e(this.profile,this.value):e},unseen(){return this._unseen||this.item.unseen>0},default_value(){return"function"==typeof this.item.default?this.item.default(this.context.context):Object(o.deep_copy)(this.item.default)},isInherited(){return!this.has_value&&this.source&&this.sourceOrder>this.profileOrder},isDefault(){return!this.has_value&&!this.source},isOverridden(){return this.source&&this.sourceOrder<this.profileOrder},isValid(){return this.isDefault||this.validate(this.value)},sourceOrder(){return this.source?this.source.order:1/0},profileOrder(){return this.profile?this.profile.order:1/0},sourceTitle(){if(this.source)return this.source.i18n_key?this.t(this.source.i18n_key,this.source.title,this.source):this.source.title},sourceDisplay(){const e={title:this.sourceTitle};return this.isInherited?this.t("setting.inherited-from","Inherited From: {title}",e):this.isOverridden?this.t("setting.overridden-by","Overridden By: {title}",e):void 0}},methods:{_update_profile(){this.profile&&this.profile.off("changed",this._setting_changed,this);const e=this.profile=this.context.currentProfile,s=this.item.setting;e.on("changed",this._setting_changed,this),this.has_value=e.has(s),this.value=this.has_value?Object(o.deep_copy)(e.get(s)):this.isInherited?this.source_value:this.default_value},_setting_changed(e,s,n){e===this.item.setting&&(this.has_value=!0!==n,this.value=this.has_value?Object(o.deep_copy)(s):this.isInherited?this.source_value:this.default_value)},_source_setting_changed(e,s,n){e===this.item.setting&&(this.source_value=Object(o.deep_copy)(s),this.isInherited&&(this.value=n?this.default_value:s))},_uses_changed(e){this._uses_cb&&clearTimeout(this._uses_cb),this._uses_cb=setTimeout((()=>{this.source&&this.source.off("changed",this._source_setting_changed,this),e=e?e[0]:null;const s=this.source=null==e?null:this.context.profile_keys[e],n=this.item.setting;s?(s.on("changed",this._source_setting_changed,this),this.source_value=Object(o.deep_copy)(s.get(n))):this.source_value=void 0,this.has_value=this.profile&&this.profile.has(this.item.setting),this.has_value||(this.value=this.isInherited?this.source_value:this.default_value)}),0)},validate(e){let s=this.item.validator;if(s||"string"!=typeof this.item.process||(s=this.context.getValidator(`process_${this.item.process}`)),s){if("function"!=typeof s&&(s=this.context.getValidator(s)),"function"==typeof s)return s(e,this.item,this);throw new Error(`Invalid Validator for ${this.item.setting}`)}return!0},set(e){let s=this.item.process;if(s){if("function"!=typeof s&&(s=this.context.getProcessor(s)),"function"!=typeof s)throw new Error(`Invalid processor for ${this.item.setting}`);e=s(e,this.default_value,this.item,this)}this.profile.set(this.item.setting,e),this.item.onUIChange&&this.item.onUIChange(e,this)},clear(){this.profile.delete(this.item.setting),this.item.onUIChange&&this.item.onUIChange(this.value,this)}}}},,,,function(e,s,n){"use strict";var o=n(0);s.a={data:()=>({value:void 0,has_value:!1,_unseen:!1}),created(){const e=this.context.provider,s=this.item.setting;e.on("changed",this._providerChange,this),this.has_value=e.has(s),this.has_value?this.value=Object(o.deep_copy)(e.get(s)):this.value=this.default_value,this.item.unseen&&(this._unseen=!0,this.item.unseen=0)},destroyed(){this.context.provider.off("changed",this._providerChange,this),this.value=void 0,this.has_value=!1},computed:{data(){const e=this.item.data;return"function"==typeof e?e(this.value):e},unseen(){return this._unseen||this.item.unseen>0},default_value(){return"function"==typeof this.item.default?this.item.default(this.context):Object(o.deep_copy)(this.item.default)},isValid(){return this.isDefault||this.validate(this.value)},isDefault(){return!this.has_value}},methods:{_providerChange(e,s,n){e===this.item.setting&&(n?(this.has_value=!1,this.value=this.default_value):(this.has_value=!0,this.value=Object(o.deep_copy)(s)))},validate(e){let s=this.item.validator;if(s||"string"!=typeof this.item.process||(s=this.context.getValidator(`process_${this.item.process}`)),s){if("function"!=typeof s&&(s=this.context.getValidator(s)),"function"==typeof s)return s(e,this.item,this);throw new Error(`Invalid Validator for ${this.item.setting}`)}return!0},set(e){const s=this.context.provider,n=this.item.setting;let a=this.item.process;if(a){if("function"!=typeof a&&(a=this.context.getProcessor(a)),"function"!=typeof a)throw new Error(`Invalid processor for ${n}`);e=a(e,this.default_value,this.item,this)}s.set(n,e),this.has_value=!0,this.value=Object(o.deep_copy)(e),this.item.onUIChange&&this.item.onUIChange(this.value,this)},clear(){const e=this.context.provider,s=this.item.setting;e.delete(s),this.value=this.default_value,this.has_value=!1,this.item.onUIChange&&this.item.onUIChange(this.value,this)}}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,s,n){"use strict";n.d(s,"a",(function(){return SocketClient}));var o=n(4),a=n(2),u=n(1);const f={DISCONNECTED:0,CONNECTING:1,CONNECTED:2};class SocketClient extends o.default{constructor(...e){super(...e),this.inject("settings"),this.inject("experiments"),this.settings.addUI("socket.info",{path:'Debugging > Socket >> Info @{"sort": -1000}',force_seen:!0,no_filter:!0,component:"socket-info",getSocket:()=>this}),this.settings.add("socket.use-cluster",{default:"Production",ui:{path:'Debugging @{"expanded": false, "sort": 9999} > Socket >> General',title:"Server Cluster",description:"Which server cluster to connect to. Do not change this unless you are actually doing development work on the socket server backend. Doing so will break all features relying on the socket server, including emote information lookups, link tooltips, and live data updates.",component:"setting-select-box",data:[{value:null,title:"Disabled"}].concat(Object.keys(a.WS_CLUSTERS).map((e=>({value:e,title:e}))))}}),this._want_connected=!1,this._topics=new Map,this._pending=[],this._awaiting=new Map,this._socket=null,this._state=0,this._last_id=1,this._delay=0,this._last_ping=null,this._time_drift=0,this._host_idx=-1,this._host_pool=-1,this.settings.on(":changed:socket.use-cluster",(()=>{this._host=null,this.disconnected?this.connect():this.reconnect()})),this.on(":command:reconnect",this.reconnect,this),this.on(":command:do_authorize",(e=>{const s=this.resolve("site.chat"),n=s&&s.ChatService.first,o=n.client&&n.client.connection;o&&o.send&&o.send(`PRIVMSG #frankerfacezauthorizer :AUTH ${e}`)})),this.enable()}onEnable(){this.experiments.getAssignment("api_links")||this.connect()}onDisable(){this.disconnect()}get connected(){return this._state===f.CONNECTED}get connecting(){return this._state===f.CONNECTING}get disconnected(){return this._state===f.DISCONNECTED}getAPIToken(){return this._cached_token&&this._cached_token.expires>Date.now()+15e3?Promise.resolve(this._cached_token):this._token_waiters?new Promise(((e,s)=>this._token_waiters.push([e,s]))):(this._token_waiters=[],new Promise(((e,s)=>{var n,o;this._token_waiters.push([e,s]);let a=!1,f=null;const fail=e=>{if(a)return;clearTimeout(f),a=!0,this.log.error("Unable to get API token.",e);const s=this._token_waiters;this._token_waiters=null;for(const n of s)n[1](e)},g=null===(n=this.resolve("site"))||void 0===n||null===(o=n.getUser)||void 0===o?void 0:o.call(n);if(!g||!g.id)return fail(new Error("Unable to get current user or not logged in."));const _=new EventSource(`https://api-test.frankerfacez.com/auth/ext_verify/${g.id}`);Object(u.on)(_,"challenge",(e=>{var s,n,o,a;const u=null===(s=this.resolve("site.chat"))||void 0===s||null===(n=s.ChatService)||void 0===n||null===(o=n.first)||void 0===o||null===(a=o.client)||void 0===a?void 0:a.connection;u&&u.send&&u.send(`PRIVMSG #frankerfacezauthorizer :AUTH ${e.data}`)})),Object(u.on)(_,"token",(e=>{if(a)return;clearTimeout(f);let s=null;try{s=JSON.parse(e.data)}catch(e){return void fail(e)}if(!s||!s.token)return void fail(new Error("Received empty token from server."));s.expires=new Date(s.expires).getTime(),this._cached_token=s,a=!0;const n=this._token_waiters;this._token_waiters=null;for(const e of n)e[0](s)})),Object(u.on)(_,"error",(e=>{fail(e)})),Object(u.on)(_,"close",(()=>{_.close(),a||fail(new Error("Connection closed unexpectedly."))})),f=setTimeout((()=>{fail(new Error("timeout"))}),5e3)})))}async getBareAPIToken(){var e;return null===(e=await this.getAPIToken())||void 0===e?void 0:e.token}selectHost(){const e=this.settings.get("socket.use-cluster"),s=a.WS_CLUSTERS[e],n=s&&s.length;if(!n)return null;let o=0,u=n;for(;u-- >0;)o+=s[u][1];let f=Math.random()*o;for(let e=0;e<n;e++)if(f-=s[e][1],f<=0)return s[e][0];return s[n-1][0]}_reconnect(){this._reconnect_timer||(this._delay<6e4?this._delay+=1e3*(Math.floor(15*Math.random())+5):this._delay=1e3*(Math.floor(60*Math.random())+30),this._reconnect_timer=setTimeout((()=>{this.connect()}),this._delay))}reconnect(){this.disconnect(),this._reconnect()}connect(){if(this._want_connected=!0,this._reconnect_timer&&(clearTimeout(this._reconnect_timer),this._reconnect_timer=null),!this.disconnected)return;const e=this._host=this._host||this.selectHost();if(!e)return;let s;this._state=f.CONNECTING,this._last_id=1,this._delay=0,this._last_ping=null,this.log.info(`Using Server: ${e}`);try{s=this._socket=new WebSocket(e)}catch(e){return this._state=f.DISCONNECTED,this._reconnect(),void this.log.error("Unable to create WebSocket.",e)}s.onopen=()=>{if(this._socket!==s)return this.log.warn("A socket connected that is not our primary socket."),s.close();this._state=f.CONNECTED,this._sent_user=!1,this.log.info("Connected."),this._ping_time=performance.now(),this._send("hello",[`ffz_${window.FrankerFaceZ.version_info}`,"683b45e4-f853-4c45-bf96-7d799cc93e34"],((e,s)=>{if(!e)return this.log.warn("Error Saying Hello",s);this._on_pong(!1,e,s[1])}));const e=this.resolve("site"),send_user=()=>{if(this._sent_user||!this.connected)return;const s=e.getUser();s&&s.login?(this._sent_user=!0,this._send("setuser",s.login)):e.enabled||this.once("site:enabled",send_user,this)};send_user();for(const e of this._topics.keys())this._send("sub",e);for(const[e,s,n]of this._pending)this._send(e,s,n);this._pending=[],this._send("ready",this._offline_time||0),this._offline_time=null,this.emit(":connected")},s.onerror=()=>{s===this._socket&&(this._offline_time||(this._offline_time=Date.now()))},s.onclose=e=>{if(s!==this._socket)return;const n=this._state;this.log.info(`Disconnected. (${e.code}:${e.reason})`),this._state=f.DISCONNECTED;for(const[e,s]of this._awaiting){const n=new Error("disconnected");try{"function"==typeof s?s(!1,n):s[1](n)}catch(s){this.log.warn(`Callback Error #${e}`,s)}}this._awaiting.clear(),this._want_connected&&(this._offline_time||(this._offline_time=Date.now()),n!==f.CONNECTED&&(this._host=null),this._reconnect(),this.emit(":closed",e.code,e.reason))},s.onmessage=e=>{if(s!==this._socket)return;const n=e.data,o=n.indexOf(" ");if(-1===o)return this.log.warn("Malformed message from server.",e.data);const u=parseInt(n.slice(0,o),10),f=n.indexOf(" ",o+1),g=n.slice(o+1,-1===f?n.length:f),_=-1===f?void 0:JSON.parse(n.slice(f+1));if(-1===u)this.log.debug(`Received Command: ${g}`,_),this.emit(`:command:${g}`,_);else{const e="ok"===g,s=this._awaiting.get(u);s?(this._awaiting.delete(u),"function"==typeof s?s(e,_):s[e?0:1](_)):e&&!a.DEBUG||this.log.info(`Received Reply #${u}:`,e?"OK":"Error",_)}}}disconnect(){if(this._want_connected=!1,this._reconnect_timer&&(clearTimeout(this._reconnect_timer),this._reconnect_timer=null),!this.disconnected){try{this._socket.close()}catch(e){}this._socket=null,this._state=f.DISCONNECTED,this.emit(":disconnected")}}_on_pong(e,s,n){const o=performance.now();if(s){if(this._ping_time){const s=Date.now(),a=o-this._ping_time,u=this._last_ping=a/2;this._ping_time=null;const f=this._time_drift=s-(n+u);e||(this.log.info("Server Time:",new Date(n).toISOString()),this.log.info(" Local Time:",new Date(s).toISOString()),this.log.info(`  Est. Ping: ${u.toFixed(5)}ms`),this.log.info("Time Offset: "+f/1e3),Math.abs(f)>3e5&&this.log.warn("Local time differs from server time by more than 5 minutes."))}}else this._ping_time=null,e||this.log.warn("Error Pinging Server",n);this.emit(":pong")}ping(e){!this._ping_time&&this.connected&&(this._ping_time=performance.now(),this._send("ping",void 0,((s,n)=>this._on_pong(e,s,n))))}_send(e,s,n){if(!this.connected)return this.log.warn(`Tried sending command "${e}" while disconnected.`);const o=this._last_id++;n&&this._awaiting.set(o,n),this._socket.send(`${o} ${e}${void 0!==s?` ${JSON.stringify(s)}`:""}`)}send(e,...s){1===s.length?s=s[0]:s.length||(s=void 0),this.connected?this._send(e,s):this._pending.push([e,s])}call(e,...s){return 1===s.length?s=s[0]:s.length||(s=void 0),new Promise(((n,o)=>{this.connected?this._send(e,s,[n,o]):this._pending.push([e,s,[n,o]])}))}subscribe(e,...s){const n=this._topics;let o=!1;for(const a of s){n.has(a)||(this.connected&&this._send("sub",a),n.set(a,new Set),o=!0);n.get(a).add(e)}o&&this.emit(":sub-change")}unsubscribe(e,...s){const n=this._topics;let o=!1;for(const a of s){if(!n.has(a))continue;const s=n.get(a);s.delete(e),s.size||(o=!0,n.delete(a),this.connected&&this._send("unsub",a))}o&&this.emit(":sub-change")}get topics(){return Array.from(this._topics.keys())}}SocketClient.State=f},function(e,s,n){"use strict";n.d(s,"a",(function(){return WebMunch}));var o=n(4),a=n(0),u=n(2);const f=Symbol("FFZRequires"),g={};const _=["webpackJsonp","webpackChunktwitch_twilight","webpackChunktwitch_sunlight","webpackJsonp_N_E"],b=[[0,"vendor"],[1,"core"]];let v=0;class WebMunch extends o.default{constructor(...e){super(...e),this._id="_ffz$"+v++,this._rid=0,this._original_loader=null,this._known_rules={},this._require=null,this._chunk_names={},this._mod_cache={},this._checked_module={},this._required_ids=new Set,this._known_ids=new Set,this.Requires=f,this.v4=null,this.hookLoader(),this.hookRequire()}waitForLoader(){if(this._original_loader)return Promise.resolve();const e=this._load_waiters=this._load_waiters||[];return new Promise(((s,n)=>e.push([s,n])))}_resolveLoadWait(e){const s=this._load_waiters;if(this._load_waiters=null,s)for(const n of s)n[e?1:0]()}hookLoader(e=0){if(this._original_loader)return this.log.warn("Attempted to call hookLoader twice.");let s;for(const e of _)if(window[e]){s=e;break}if(!s){if(e>240){this.log.error("Unable to find webpack's loader after one minute.");try{const e=[];for(const s of Object.keys(window))Object(a.has)(window,s)&&"string"==typeof s&&/webpack/i.test(s)&&!/ffz/i.test(s)&&e.push(s);e.length?this.log.info("Possible Matches: ",e.join(", ")):this.log.info("No possible matches found.")}catch(e){}return void this._resolveLoadWait(!0)}return setTimeout(this.hookLoader.bind(this,e+1),250)}const n=window[s];if("function"==typeof n){this.v4=!1,this._original_loader=n;try{window[s]=this.webpackJsonpv3.bind(this)}catch(e){return this.log.warn("Unable to wrap webpackJsonp due to write protection."),void this._resolveLoadWait(!0)}}else{if(!Array.isArray(n))return this.log.error("webpackJsonp is of an unknown value. Unable to wrap."),void this._resolveLoadWait(!0);this.v4=!0,this._original_store=n,this._original_loader=n.push;for(const e of n)e&&e[1]&&this.processModulesV4(e[1],!0);try{n.push=this.webpackJsonpv4.bind(this)}catch(e){return this.log.warn("Unable to wrap webpackJsonp (v4) due to write protection."),void this._resolveLoadWait(!0)}}this._resolveLoadWait(),this.log.info(`Found and wrapped webpack's loader after ${250*(e||0)}ms.`)}webpackJsonpv3(e,s){const n=e.map((e=>this._chunk_names[e]||e)).join(", ");this.log.verbose(`Twitch Chunk Loaded: ${e} (${n})`),this.log.verbose(`Modules: ${Object.keys(s)}`);const o=this._original_loader.apply(window,arguments);return this.emit(":loaded",e,n,s),o}_resolveRequire(e){if(!this._require&&(this._require=e,this._resolve_require)){for(const s of this._resolve_require)s(e);this._resolve_require=null}}processModulesV4(e){const s=this;for(const[n,o]of Object.entries(e))this._known_ids.add(n),e[n]=function(e,a,u,...f){if(!s._require&&"function"==typeof u){s.log.debug(`require() grabbed from invocation of module ${n}`);try{s._resolveRequire(u)}catch(e){s.log.error("An error occurred running require callbacks.",e)}}return o.call(this,e,a,u,...f)},e[n].original=o}webpackJsonpv4(e){const s=e[0],n=e[1],o=Array.isArray(s)&&s.map((e=>this._chunk_names[e]||e));this.log.verbose(`Twitch Chunk Loaded: ${s} (${o.join(", ")})`),this.log.verbose(`Modules: ${Object.keys(n)}`),n&&this.processModulesV4(n,!1),this._checked_module={};const a=this._original_loader.apply(this._original_store,arguments);return this.emit(":loaded",s,o,n),a}known(e,s){if("object"!=typeof e)this._known_rules[e]=s;else for(const s in e)Object(a.has)(e,s)&&this.known(s,e[s])}async findModule(e,s){return this._require||await this.getRequire(),this.getModule(e,s)}findDeep(e,s,n=!0){if(e&&!Array.isArray(e)&&(e=[e]),!this._require||!this.v4||!this._original_store)return new Error("We do not have webpack");const o=[],a=this._chunk_names;for(const[u,f]of this._original_store){if(e){let s=!1;for(const n of u)if(e.includes(n)||e.includes(`${n}`)||a[n]&&e.includes(a[n])){s=!0;break}if(!s)continue}for(const e of Object.keys(f))try{const a=this._require(e);for(const u in a)if(a[u]&&s(a[u])){if(this.log.info(`Found in key "${u}" of module "${e}" (${this.chunkNameForModule(e)})`),!n)return a;o.push(a);break}}catch(e){this.log.warn("Exception while deep scanning webpack.",e)}}return o.length?o:(this.log.info("Unable to find deep scan target."),null)}getModule(e,s){if("function"==typeof e&&(s=e,e=null),e&&this._mod_cache[e])return this._mod_cache[e];const n=this._require;if(!n)return null;if(s||(s=this._known_rules[e]),!s)throw new Error(`no known predicate for locating ${e}`);return n.c?this._oldGetModule(e,s,n):n.m?this._newGetModule(e,s,n):void 0}_chunksForModule(e){if(!this.v4)return null;if(!this._original_store)return null;const s=new Set;for(const[n,o]of this._original_store)if(o[e])for(const e of n)s.add(e);return[...s]}chunkNameForModule(e){const s=this._chunksForModule(e);if(!s)return null;for(const e of s){const s=this._chunk_names[e];if(s)return s}return null}chunkNamesForModule(e){const s=this._chunksForModule(e);return s?s.map((e=>this._chunk_names[e]||e)):null}_oldGetModule(e,s,n){if(!n||!n.c)return null;let o;if(this._original_store&&s.chunks){const e="function"==typeof s.chunks;e||Array.isArray(s.chunks)||(s.chunks=[s.chunks]);const n=s.chunks,a=this._chunk_names;o=[];for(const[s,u]of this._original_store){let f=!1;for(const o of s)if(e?n(a[o],o):n.includes(o)||n.includes(String(o))||a[o]&&n.includes(a[o])){f=!0;break}f&&(o=[...o,...Object.keys(u)])}o=new Set(o)}else o=Object.keys(n.c);let f=0;for(const g of o)if(Object(a.has)(n.c,g)){f++;const o=n.c[g],a=o&&o.exports;if(a){const n=s(a);if(n){this.log.debug(`[Old] Located module "${e}" in module ${g}${u.DEBUG?` (${this.chunkNameForModule(g)})`:""} after ${f} tries`);const o=s.use_result?n:a;return e&&(this._mod_cache[e]=o),o}}}return this.log.debug(`[Old] Unable to locate module "${e}" despite checking ${f} modules`),null}_newGetModule(e,s,n){if(!n)return null;let o=this._known_ids;if(this._original_store&&s.chunks){const e="function"==typeof s.chunks;e||Array.isArray(s.chunks)||(s.chunks=[s.chunks]);const n=s.chunks,a=this._chunk_names;o=[];for(const[s,u]of this._original_store){let f=!1;for(const o of s)if(e?n(a[o],o):n.includes(o)||n.includes(String(o))||a[o]&&n.includes(a[o])){f=!0;break}f&&(o=[...o,...Object.keys(u)])}o=new Set(o)}let a=0;for(const f of o)try{if(a++,!this._required_ids.has(f)){let e=this._checked_module[f];if(null==e&&(e=this._checkModule(f)),e)continue}this._required_ids.add(f),n.m[f]||this.log.warn("Tried requiring module that isn't loaded",f);const o=n(f);if(o){const n=s(o);if(n){this.log.debug(`Located module "${e}" in module ${f}${u.DEBUG?` (${this.chunkNameForModule(f)})`:""} after ${a} tries`);const g=s.use_result?n:o;return e&&(this._mod_cache[e]=g),g}}}catch(e){this.log.warn("Unexpected error trying to find module",e)}return this.log.debug(`Unable to locate module "${e}" despite checking ${a} modules`),null}_checkModule(e){var s,n;const o=null===(s=this._require)||void 0===s||null===(n=s.m)||void 0===n?void 0:n[e];if(o){let s=o[f],n=!1;if(null==s){const a=o.toString(),u=/^function\([^,)]+,[^,)]+,([^,)]+)/.exec(a);if(u){const _=function getRequireRegex(e){return g[e]||(g[e]=new RegExp(`\\b${e}\\(([0-9e_+]+)\\)`,"g")),g[e]}(u[1]);let b;for(s=o[f]=new Set,_.lastIndex=0;b=_.exec(a);){let o=b[1];if("e"!==o){if(/^\d+e\d+$/.test(o)){const e=o.split("e");o=""+parseInt(e[0],10)*10**parseInt(e[1],10)}s.add(o),n||this._require.m[o]||(this.log.verbose(`Unable to load module ${e} due to missing dependency ${o}`),n=!0)}}}else o[f]=!1}else if(s)for(const e of s)this._require.m[e]||(n=!0);return this._checked_module[e]=n}}getRequire(e=0){return this._require?Promise.resolve(this._require):new Promise(((s,n)=>{const o=this._original_loader;if(!o)return e>500&&n(new Error("unable to find webpackJsonp")),setTimeout((()=>this.getRequire(e++).then(s)),250);if(this.v4)this._resolve_require?this._resolve_require.push(s):this._resolve_require=[s];else{const e=`${this._id}$${this._rid++}`;o([],{[e]:(e,n,o)=>{s(this._require=o)}},[e])}}))}async hookRequire(){const e=performance.now(),s=await this.getRequire(),n=performance.now()-e;this.log.info(`require() grabbed in ${n.toFixed(5)}ms.`);const o=s.e&&s.e.toString();let a;if(o&&-1!==o.indexOf("Loading chunk")){const e=this.v4?/assets\/"\+\(({1:.*?})/.exec(o):/({0:.*?})/.exec(o);if(e)try{a=JSON.parse(e[1].replace(/(\d+):/g,'"$1":'))}catch(e){}}else if(s.u){const e=s.u.toString(),n=/assets\/"\+({\d+:.*?})/.exec(e),o=n?n[1].replace(/([\de]+):/g,((e,s)=>{if(/^\d+e\d+$/.test(s)){const e=s.split("e");s=parseInt(e[0],10)*10**parseInt(e[1],10)}return`"${s}":`})):null;if(o)try{a=JSON.parse(o)}catch(e){console.log(o),console.log(e)}}if(a){if(this._original_store)for(const[e,s]of b){var u;const n=null===(u=this._original_store[e])||void 0===u?void 0:u[0];if(Array.isArray(n))for(const e of n)"object"==typeof e||a[e]||(a[e]=s)}this._chunk_names=a,this.log.debug(`Loaded names for ${Object.keys(a).length} chunks from require().`)}else this.log.warn("Unable to find chunk names in require().")}}WebMunch.Requires=f},function(e,s,n){"use strict";n.d(s,"a",(function(){return Elemental}));var o=n(7),a=n(4);class Elemental extends a.default{constructor(...e){super(...e),this._pruneLive=this._pruneLive.bind(this),this._wrappers=new Map,this._observer=null,this._watching=new Set,this._live_watching=null}onDisable(){this._stopWatching()}define(e,s,n,o=null,a=0,u=5e3,f=!0){if(this._wrappers.has(e))return this._wrappers.get(e);if(!s||"string"!=typeof s||!s.length)throw new Error("cannot find definition and no selector provided");const g=new ElementalWrapper(e,s,n,o,a,u,f,this);return this._wrappers.set(e,g),g}route(e){this._route=e,this._timer=Date.now(),this._updateLiveWatching(),this.checkAll(),this.cleanAll()}cleanAll(){this._clean_all&&cancelAnimationFrame(this._clean_all),this._clean_all=requestAnimationFrame((()=>{this._clean_all=null;for(const e of this._wrappers.values())e.clean()}))}checkAll(){if(this._watching)for(const e of this._watching)e.check()}updateTimeout(){this._timer=Date.now(),this._updateLiveWatching(),this.checkAll()}_isActive(e,s){return!(this._route&&e.routes.length&&!e.routes.includes(this._route))&&!(e.timeout>0&&s-this._timer>e.timeout)}_updateLiveWatching(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null);const e=this._live_watching=[],s=Date.now();let n=Number.POSITIVE_INFINITY;if(this._watching)for(const o of this._watching)this._isActive(o,s)&&(o.timeout>0&&o.timeout<n&&(n=o.timeout),e.push(o));isFinite(n)&&(this._timeout=setTimeout(this._pruneLive,n)),e.length?this._observer||this._startWatching():this._stopWatching()}_pruneLive(){this._updateLiveWatching()}_checkWatchers(e){for(const s of this._live_watching)s.checkElements(e)}_startWatching(){!this._observer&&this._live_watching&&this._live_watching.length&&(this.log.info("Installing MutationObserver."),this._observer=new MutationObserver((e=>this._checkWatchers(e.map((e=>e.target))))),this._observer.observe(document.body,{childList:!0,subtree:!0}))}_stopWatching(){this._observer&&(this.log.info("Stopping MutationObserver."),this._observer.disconnect()),this._timeout&&(clearTimeout(this._timeout),this._timeout=null),this._live_watching=null,this._observer=null}listen(e,s=!0){this._watching.has(e)||(s&&(this._timer=Date.now()),this._watching.add(e),this._updateLiveWatching())}unlisten(e){this._watching.has(e)&&(this._watching.delete(e),this._updateLiveWatching())}}let u=0;class ElementalWrapper extends o.EventEmitter{constructor(e,s,n,o,a,f,g,_){super(),this.id=u++,this.param=`_ffz$elemental$${this.id}`,this.remove_param=`_ffz$elemental_remove$${this.id}`,this.mut_param=`_ffz$elemental_mutating${this.id}`,this._schedule=this._schedule.bind(this),this.name=e,this.selector=s,this.routes=n||[],this.opts=o,this.limit=a,this.timeout=f,this.check_removal=g,!this.opts||this.opts.childList||this.opts.attributes||this.opts.characterData||(this.opts.attributes=!0),this.count=0,this.instances=new Set,this.observers=new Map,this.elemental=_,this.check(),this.schedule()}get atLimit(){return this.limit>0&&this.count>=this.limit}clean(){const e=Array.from(this.instances);for(const s of e)document.contains(s)||this.remove(s)}schedule(){this._stimer||(this._stimer=setTimeout(this._schedule,0))}_schedule(){clearTimeout(this._stimer),this._stimer=null,0===this.limit||this.count<this.limit?this.elemental.listen(this):this.elemental.unlisten(this)}check(){const e=document.querySelectorAll(this.selector);for(const s of e)this.add(s)}checkElements(e){if(this.atLimit)return this.schedule();for(const s of e){const e=s.querySelectorAll(this.selector);for(const s of e)this.add(s);if(this.atLimit)return}}get first(){for(const e of this.instances)return e;return null}toArray(){return Array.from(this.instances)}each(e){for(const s of this.instances)e(s)}add(e){if(!this.instances.has(e)){if(this.instances.add(e),this.count++,this.check_removal){const s=new MutationObserver((()=>{requestAnimationFrame((()=>{document.contains(e)||this.remove(e)}))}));s.observe(e.parentNode,{childList:!0}),e[this.remove_param]=s}if(this.opts){const s=new MutationObserver((s=>{document.contains(e)?this.__running.size||this.emit("mutate",e,s):this.remove(e)}));s.observe(e,this.opts),e[this.param]=s}this.schedule(),this.emit("mount",e)}}remove(e){const s=e[this.param];s&&(s.disconnect(),e[this.param]=null);const n=e[this.remove_param];n&&(n.disconnect(),e[this.remove_param]=null),this.instances.has(e)&&(this.instances.delete(e),this.count--,this.schedule(),this.emit("unmount",e))}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return Subpump}));var o=n(4),a=n(7);class PubSubEvent extends a.FFZEvent{constructor(e){super(e),this._obj=void 0,this._changed=!1}markChanged(){this._changed=!0}get topic(){return this.event.topic}get message(){return void 0===this._obj&&(this._obj=JSON.parse(this.event.message)),this._obj}set message(e){this._obj=e,this._changed=!0}}class Subpump extends o.default{constructor(...e){super(...e),this.instance=null}onEnable(e=0){const s=window.__Twitch__pubsubInstances;if(s){for(const e of Object.values(s))if(null!=e&&e._client){if(this.instance){this.log.warn("Multiple PubSub instances detected. Things might act weird.");continue}this.instance=e,this.hookClient(e._client)}this.instance||this.log.warn("Unable to find a PubSub instance.")}else e>10?this.log.warn("Unable to find PubSub."):new Promise((e=>setTimeout(e,50))).then((()=>this.onEnable(e+1)))}hookClient(e){const s=this,n=e._onMessage;e._unbindPrimary(e._primarySocket),e._onMessage=function(e){try{var o;if("MESSAGE"===e.type&&null!==(o=e.data)&&void 0!==o&&o.topic){const n=e.data.topic,o=n.indexOf("."),a=-1===o?n:n.slice(0,o),u=-1===o?"":n.slice(o+1),f=new PubSubEvent({prefix:a,trail:u,event:e.data});if(s.emit(":pubsub-message",f),f.defaultPrevented)return;f._changed&&(e.data.message=JSON.stringify(f._obj))}}catch(e){s.log.error("Error processing PubSub event.",e)}return n.call(this,e)},e._bindPrimary(e._primarySocket);const o=e._listens,a=o.on,u=o.off;o.on=function(e,n,u){var f;const g=!(null===(f=o._events)||void 0===f||!f[e]),_=a.call(this,e,n,u);return g||s.emit(":add-topic",e),_},o.off=function(e,n){var a,f;const g=!(null===(a=o._events)||void 0===a||!a[e]),_=u.call(this,e,n);return!g||null!==(f=o._events)&&void 0!==f&&f[e]||s.emit(":remove-topic",e),_}}inject(e,s){var n,o;const a=null===(n=this.instance)||void 0===n||null===(o=n._client)||void 0===o?void 0:o._listens;if(!a)throw new Error("No PubSub instance available");a._trigger(e,JSON.stringify(s))}get topics(){var e,s;const n=null===(e=this.instance)||void 0===e||null===(s=e._client)||void 0===s?void 0:s._listens._events;return n?Object.keys(n):[]}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return Switchboard}));var o=n(4),a=n(75),u=n.n(a),f=n(0);class Switchboard extends o.default{constructor(...e){super(...e),this.inject("site.web_munch"),this.inject("site.fine"),this.inject("site.router"),this.tried=new Set}awaitRouter(e=0){const s=this.fine.searchTree(null,(e=>e.logger&&"default-root-router"===e.logger.category||e.onHistoryChange&&e.reportInteractive||e.onHistoryChange&&e.props&&e.props.location),100);return s?Promise.resolve(s):e>50?Promise.resolve(null):Object(f.sleep)(50).then((()=>this.awaitRouter(e+1)))}awaitRoutes(e=0){const s=this.fine.searchTree(null,(e=>{var s;return(null===(s=e.props)||void 0===s?void 0:s.component)&&e.props.path}),100,0,!1,!0);return null!=s&&s.size?Promise.resolve(s):e>50?Promise.resolve(null):Object(f.sleep)(50).then((()=>this.awaitRoutes(e+1)))}getSwitches(e){const s=new Set;for(const n of e){const e=this.fine.searchParent(n,(e=>{var s;return null===(s=e.props)||void 0===s?void 0:s.children}));e&&s.add(e)}return s}getPossibleRoutes(e){const s=new Set;for(const a of e){var n;if(Array.isArray(null==a||null===(n=a.props)||void 0===n?void 0:n.children))for(const e of a.props.children){var o;null!=e&&null!==(o=e.props)&&void 0!==o&&o.component&&s.add(e)}}return s}awaitRoute(e=0){const s=this.fine.searchTree(null,(e=>e.props&&e.props.component&&e.props.path),100);return s?Promise.resolve(s):e>50?Promise.resolve(null):Object(f.sleep)(50).then((()=>this.awaitRoute(e+1)))}async onEnable(){if(await this.parent.awaitElement(".twilight-minimal-root,.twilight-root,#root>div"),this.web_munch._require||!1===this.web_munch.v4)return;const e=await this.awaitRoute(),s=e&&this.fine.searchParent(e,(e=>{var s;return null===(s=e.props)||void 0===s?void 0:s.children}));if(!s)return Object(f.sleep)(50).then((()=>this.onEnable()));const n=await this.awaitRouter();this.log.info(`Found Route and Switch with ${s.props.children.length} routes.`),this.possible=s.props.children,this.location=n.props.location.pathname,this.web_munch.waitForLoader().then((()=>{this.web_munch._require||this.loadOne()}))}async startMultiRouter(){this.multi_router=!0;const e=await this.awaitRoutes();if(null==e||!e.size)return this.log.info("Unable to find any <Route/>s for multi-router.");const s=this.getSwitches(e);if(null==s||!s.size)return this.log.info("Unable to find any switches for multi-router.");this.possible=this.getPossibleRoutes(s),this.log.info(`Found ${e.size} Routes with ${s.size} Switches and ${this.possible.size} routes.`),this.loadOne()}loadOne(){this.loadRoute(!1)||this.loadRoute(!0)||(this.multi_router?this.log.info(`There are no routes that can be used to load a chunk. Tried ${this.tried.size} routes.`):this.startMultiRouter())}waitAndSee(){requestAnimationFrame((()=>{this.web_munch._require||(this.log.debug("We still need require(). Trying again."),this.loadOne())}))}loadRoute(e){for(const s of this.possible){if(!s.props||!s.props.component)continue;if(null!==e&&e!==s.props.path.includes(":"))continue;if(this.tried.has(s.props.path))continue;try{const e=u()(s.props.path);if(!e.exec||e.exec(this.location))continue}catch(e){continue}this.tried.add(s.props.path),this.log.debug("Found Non-Matching Route",s.props.path);const n=s.props.component;let o;if(n.Preload){try{o=n.Preload({priority:1})}catch(e){this.log.warn("Error instantiating preloader for forced chunk loading."),this.log.debug("Captured Error",e),o=null}if(!o||!o.props||!o.props.loader)continue;try{o.props.loader().then((()=>{this.log.debug("Successfully loaded route",s.props.path),this.waitAndSee()}))}catch(e){this.log.warn("Unexpected result trying to use component pre-loader.")}}else{try{o=new s.props.component}catch(e){this.log.warn("Error instantiating component for forced chunk loading."),this.log.debug("Captured Error",e),o=null}if(!(o&&o.props&&o.props.children&&o.props.children.props&&o.props.children.props.loader))continue;try{o.props.children.props.loader().then((()=>{this.log.debug("Successfully loaded route",s.props.path),this.waitAndSee()}))}catch(e){this.log.warn("Unexpected result trying to use component loader.")}}return!0}return!1}}},function(e,s,n){e.exports=n.p+"main.15615a9bd5e2dbba9b8cdf486c711957.css"},function(e,s,n){"use strict";n.d(s,"a",(function(){return Scroller}));var o=n(16),a=n(4);const u=["touchmove","scroll","wheel","mousewheel","DOMMouseScroll"];let f=0;class Scroller extends a.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site.fine"),this.inject("site.web_munch"),this.ChatScroller=this.fine.define("chat-scroller",(e=>e.saveScrollRef&&e.handleScrollEvent&&!e.renderLines&&e.resume),o.a.CHAT_ROUTES),this.settings.add("chat.scroller.freeze",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Pause Chat Scrolling",description:"Automatically stop chat from scrolling when moving the mouse over it or holding a key.\n\n**Note:** Scrolling up in chat will always prevent automatic scrolling, regardless of this setting.",component:"setting-select-box",data:[{value:0,title:"Use Twitch Setting"},{value:1,title:"On Hover"},{value:2,title:"When Ctrl is Held"},{value:3,title:"When Meta is Held"},{value:4,title:"When Alt is Held"},{value:5,title:"When Shift is Held"},{value:6,title:"Ctrl or Hover"},{value:7,title:"Meta or Hover"},{value:8,title:"Alt or Hover"},{value:9,title:"Shift or Hover"}]}}),this.settings.add("chat.scroller.freeze-requires-hover",{default:!0,ui:{path:"Chat > Behavior >> Scrolling",title:"Require the mouse to be over chat to freeze with a hotkey.",component:"setting-check-box"}}),this.settings.add("chat.scroller.hover-delay",{default:750,ui:{path:"Chat > Behavior >> Scrolling",title:"Hover Timeout",description:"Chat will only remain frozen due to mouse hovering for this long after the mouse stops moving.",component:"setting-combo-box",data:[{value:250,title:"0.25 Seconds"},{value:500,title:"0.50 Seconds"},{value:750,title:"0.75 Seconds"},{value:1e3,title:"1 Second"},{value:2500,title:"2.5 Seconds"},{value:5e3,title:"5 Seconds"}]}}),this.settings.add("chat.scroller.smooth-scroll",{default:0,ui:{path:"Chat > Behavior >> Scrolling",title:"Smooth Scrolling",description:"**Note:** This may not behave well depending on your browser. Disable this if you encounter issues.\n\nSmoothly slide new chat messages into view. Speed will increase as necessary to keep up with chat.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Slow"},{value:2,title:"Medium"},{value:3,title:"Fast"},{value:4,title:"Very Fast"}]}})}updateUseKeys(){const e=this.use_keys;this.use_keys=!1;for(const e of this.chat.context.get("chat.actions.inline"))if(e&&e.display&&e.display.keys){this.use_keys=!0;break}if(this.use_keys!==e)for(const e of this.ChatScroller.instances)e&&e.ffzUpdateKeys&&e.ffzUpdateKeys()}async onEnable(){this.on("i18n:update",(()=>this.ChatScroller.forceUpdate())),this.chat.context.on("changed:chat.actions.inline",this.updateUseKeys,this),this.updateUseKeys(),this.pause_hover=this.chat.context.get("chat.scroller.freeze-requires-hover"),this.chat.context.on("changed:chat.scroller.freeze-requires-hover",(e=>{this.pause_hover=e;for(const e of this.ChatScroller.instances)e.ffzMaybeUnpause()})),this.pause_delay=this.chat.context.get("chat.scroller.hover-delay"),this.chat.context.on("changed:chat.scroller.hover-delay",(e=>{this.pause_delay=e;for(const e of this.ChatScroller.instances)e.ffzMaybeUnpause()})),this.pause=this.chat.context.get("chat.scroller.freeze"),this.chat.context.on("changed:chat.scroller.freeze",(e=>{this.pause=e;for(const e of this.ChatScroller.instances)e.ffzMaybeUnpause()})),this.smooth_scroll=this.chat.context.get("chat.scroller.smooth-scroll"),this.chat.context.on("changed:chat.scroller.smooth-scroll",(e=>{this.smooth_scroll=e;for(const s of this.ChatScroller.instances)s.ffzSetSmoothScroll(e)}));const e=this,s=await this.web_munch.findModule("react"),n=s&&s.createElement;if(!n)return e.log.warn("Unable to get React.");this.ChatScroller.ready(((s,o)=>{const a=s.prototype.componentDidCatch,g=s.prototype.render;s.prototype.componentDidCatch=function(s,n){const o=this.state.ffz_errors||0;if(o<100&&(this.setState({ffz_errors:o+1,ffz_total_errors:(this.state.ffz_total_errors||0)+1}),e.log.capture(s,{extra:n}),e.log.info("Error within Chat",s,n,o)),a)return a.call(this,s,n)},s.prototype.ffzZeroErrors=function(){this.setState({ffz_errors:0})},s.prototype.render=function(){if(this.state.ffz_errors>0){let e;const s=this.state.ffz_total_errors<10,handler=()=>{clearTimeout(e),this.ffzZeroErrors()};return s&&(e=setTimeout(handler,250)),n?n("div",{className:"tw-border-l tw-c-background-alt-2 tw-c-text-base tw-full-width tw-full-height tw-align-items-center tw-flex tw-flex-column tw-justify-content-center tw-relative"},[n("div",{className:"tw-mg-b-1"},"There was an error displaying chat."),!s&&n("button",{className:"tw-button",onClick:handler},n("span",{className:"tw-button__text"},"Try Again"))]):null}{const n=g.call(this);try{var e,s,o,a;const u=null==n||null===(e=n.props)||void 0===e||null===(s=e.children)||void 0===s||null===(o=s.props)||void 0===o?void 0:o.children,f=null==u?void 0:u[2];"ChatPausedFooter"===(null==f||null===(a=f.type)||void 0===a?void 0:a.displayName)&&(u[2]=this.ffzRenderFooter())}catch(e){}return n}},s.prototype.ffzInstallHandler=function(){var s;if(this._ffz_installed)return;this._ffz_installed=!0;const n=this;n.ffz_oldScrollEvent=n.handleScrollEvent,n.ffz_oldScroll=n.scrollToBottom,n.ffz_acting=!1,n.ffz_outside=!0,n._ffz_accessor="_ffz_contains_"+f++,e.on("tooltips:mousemove",this.ffzTooltipHover,this),e.on("tooltips:leave",this.ffzTooltipLeave,this),n.scrollToBottom=function(){n._ffz_scroll_request||(n._ffz_scroll_request=requestAnimationFrame(n._scrollToBottom))},n._scrollToBottom=function(){n._ffz_scroll_request=null,n.state.isPaused||(n.ffz_smooth_scroll&&!n._ffz_one_fast_scroll?n.ffzSmoothScroll():(n._ffz_one_fast_scroll=!1,n.ffz_oldScroll()))},n.handleScrollEvent=function(e){var s;if(null===(s=n.scrollRef)||void 0===s||!s.scrollContent)return;if(!(e.which>0||"mousewheel"===e.type||"wheel"===e.type||"touchmove"===e.type))return;const o=n.scrollRef.scrollContent,a=o.scrollHeight-o.scrollTop-o.offsetHeight>10;a!==n.state.ffz_scrolled_up&&n.setState({ffz_scrolled_up:a}),n.state.isPaused&&a&&n.setLoadMoreEnabled(!0),n.state.isPaused&&!a?n.ffzMaybeUnpause():!n.state.isPaused&&a&&n.pause()};const o=n.resume;n.ffzFastResume=function(){n._ffz_one_fast_scroll=!0,n.resume()},n.resume=function(){n.setState({ffz_scrolled_up:!1}),o.call(this)};const a=e.web_munch.getModule("mousetrap")||window.Mousetrap;null!=a&&(a.unbind("alt","keydown"),a.unbind("alt","keyup")),n.ffzHandleKey=n.ffzHandleKey.bind(n),window.addEventListener("keydown",n.ffzHandleKey),window.addEventListener("keyup",n.ffzHandleKey),n.hoverPause=n.ffzMouseMove.bind(n),n.hoverResume=n.ffzMouseLeave.bind(n);const g=e.fine.getChildNode(n);g&&g.addEventListener("mousemove",n.hoverPause);const _=null===(s=this.scrollRef)||void 0===s?void 0:s.scrollContent;if(_)for(const e of u)_.removeEventListener(e,n.ffz_oldScrollEvent),_.addEventListener(e,n.handleScrollEvent);n.forceUpdate(),e.emit("site:dom-update","chat-scroller",n)},s.prototype.ffzSmoothScroll=function(){var e;this._ffz_smooth_animation&&cancelAnimationFrame(this._ffz_smooth_animation),this.ffz_is_smooth_scrolling=!0;let s=this.ffz_smooth_scroll,n=performance.now();const o=null===(e=this.scrollRef)||void 0===e?void 0:e.scrollContent;if(!o)return;const a=o.scrollHeight-o.clientHeight-o.scrollTop;a>o.clientHeight?s=a:a>200&&(s+=s*Math.floor(a/200));const smoothAnimation=()=>{if(this.state.isPaused)return this.ffz_is_smooth_scrolling=!1;const e=performance.now(),a=s*((e-n)/10);if(a>=1){const s=o.scrollTop,u=s+a,f=o.scrollHeight-o.clientHeight;n=e,u<f?(o.scrollTop=s+a,this._ffz_smooth_animation=requestAnimationFrame(smoothAnimation)):(o.scrollTop=f,this.ffz_is_smooth_scrolling=!1)}else this._ffz_smooth_animation=requestAnimationFrame(smoothAnimation)};smoothAnimation()},s.prototype.ffzSetSmoothScroll=function(e){this.ffz_smooth_scroll=e,this.ffzMaybeUnpause()},s.prototype.ffzReadKeysFromEvent=function(e){return(e.altKey!==this.ffz_alt||e.shiftKey!==this.ffz_shift||e.ctrlKey!==this.ffz_ctrl||e.metaKey!==this.ffz_meta)&&(this.ffz_alt=e.altKey,this.ffz_shift=e.shiftKey,this.ffz_ctrl=e.ctrlKey,this.ffz_meta=e.metaKey,!0)},s.prototype.ffzHandleKey=function(s){if(!this.ffzReadKeysFromEvent(s))return;if(this.ffzUpdateKeyTags(),e.pause_hover&&this.ffz_outside||this.ffzGetMode()<2)return;const n=this.ffzShouldBePaused();n!==this.state.isPaused&&(n?(this.pause(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},s.prototype.ffzInstallHoverTimer=function(){this._ffz_hover_timer||(this._ffz_hover_timer=setInterval((()=>{this.state.isPaused&&this.ffzShouldBePaused()||this.ffzMaybeUnpause()}),50))},s.prototype.ffzMouseMove=function(e){this.ffz_last_move=Date.now();const s=this.ffz_outside;this.ffz_outside=!1,this._ffz_outside_timer&&(clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=null);const n=this.ffzReadKeysFromEvent(e);if(!n&&e.screenX===this.ffz_sx&&e.screenY===this.ffz_sy)return void(s&&this.ffzUpdateKeyTags());this.ffz_sx=e.screenX,this.ffz_sy=e.screenY,(n||s)&&this.ffzUpdateKeyTags();const o=this.ffzShouldBePaused();o!==this.state.isPaused&&(o?(this.pause(),this.ffzInstallHoverTimer(),this.state.ffz_scrolled_up||this.setLoadMoreEnabled(!1)):this.resume())},s.prototype.ffzMouseLeave=function(){this.ffz_outside=!0,this._ffz_outside_timer&&clearTimeout(this._ffz_outside_timer),this._ffz_outside_timer=setTimeout((()=>this.ffzMaybeUnpause()),64),this.ffzUpdateKeyTags()},s.prototype.ffzTooltipHover=function(e,s,n){if(null==e[this._ffz_accessor]){var o;const s=null===(o=this.scrollRef)||void 0===o?void 0:o.scrollContent;e[this._ffz_accessor]=!!s&&s.contains(e)}e[this._ffz_accessor]&&this.ffzMouseMove(n)},s.prototype.ffzTooltipLeave=function(e){if(!this.ffz_outside){if(null==e[this._ffz_accessor]){var s;const n=null===(s=this.scrollRef)||void 0===s?void 0:s.scrollContent;e[this._ffz_accessor]=!!n&&n.contains(e)}e[this._ffz_accessor]&&this.ffzMouseLeave()}},s.prototype.ffzUpdateActing=function(){this._ffz_key_frame_acting||(this._ffz_key_frame_acting=requestAnimationFrame((()=>this.ffz_updateActing())))},s.prototype.ffz_updateActing=function(){var e;this._ffz_key_frame_acting=null,null!==(e=this.scrollRef)&&void 0!==e&&e.root&&(this.scrollRef.root.dataset.acting=this.ffz_acting)},s.prototype.ffzUpdateKeyTags=function(){this._ffz_key_frame||(this._ffz_key_frame=requestAnimationFrame((()=>this.ffz_updateKeyTags())))},s.prototype.ffz_updateKeyTags=function(){var s;if(this._ffz_key_frame=null,!e.use_keys&&this.ffz_use_keys===e.use_keys)return;if(null===(s=this.scrollRef)||void 0===s||!s.root)return;this.ffz_use_keys=e.use_keys,this.scrollRef.root.classList.toggle("ffz--keys",e.use_keys);const n=this.scrollRef.root.dataset;e.use_keys?(n.alt=!this.ffz_outside&&this.ffz_alt,n.ctrl=!this.ffz_outside&&this.ffz_ctrl,n.shift=!this.ffz_outside&&this.ffz_shift,n.meta=!this.ffz_outside&&this.ffz_meta):(delete n.alt,delete n.ctrl,delete n.shift,delete n.meta)},s.prototype.ffzShouldBePaused=function(s){if(null==s&&(s=Date.now()-this.ffz_last_move),this.state.ffz_scrolled_up)return!0;const n=this.ffzGetMode();return(!e.pause_hover||!this.ffz_outside)&&(this.ffz_acting||this.ffz_ctrl&&(2===n||6===n)||this.ffz_meta&&(3===n||7===n)||this.ffz_alt&&(4===n||8===n)||this.ffz_shift&&(5===n||9===n)||!this.ffz_outside&&s<e.pause_delay&&(1===n||n>5))},s.prototype.ffzGetMode=function(){let s=e.pause;if(0===s&&!this.props.mouseoverPausingDisabled){const e=this.props.pauseSetting;"MOUSEOVER_ALTKEY"===e?s=8:"MOUSEOVER"===e?s=1:"ALTKEY"===e&&(s=4)}return s},s.prototype.ffzMaybeUnpause=function(){this.state.isPaused&&!this._ffz_unpause_frame&&(this._ffz_unpause_frame=requestAnimationFrame((()=>{this._ffz_unpause_frame=null,this.state.isPaused&&!this.ffzShouldBePaused()&&this.resume()})))},s.prototype.ffzRenderFooter=function(){let s,o="";if(this.state.ffz_scrolled_up)s=e.i18n.t("chat.messages-below","Chat Paused Due to Scroll");else{if(!this.state.isPaused)return n("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${o}`},null);{const n=this.ffzGetMode(),a=this.ffz_acting?e.i18n.t("chat.acting","Taking Action"):2===n?e.i18n.t("key.ctrl","Ctrl Key"):3===n?e.i18n.t("key.meta","Meta Key"):4===n?e.i18n.t("key.alt","Alt Key"):5===n?e.i18n.t("key.shift","Shift Key"):6===n?e.i18n.t("key.ctrl_mouse","Ctrl or Mouse"):7===n?e.i18n.t("key.meta_mouse","Meta or Mouse"):8===n?e.i18n.t("key.alt_mouse","Alt or Mouse"):9===n?e.i18n.t("key.shift_mouse","Shift or Mouse"):e.i18n.t("key.mouse","Mouse Movement");s=e.i18n.t("chat.paused","Chat Paused Due to {reason}",{reason:a}),o="ffz--freeze-indicator"}}return n("div",{className:`chat-scroll-footer__placeholder tw-flex tw-justify-content-center tw-relative ${o}`},n("div",{className:"tw-absolute tw-border-radius-medium tw-bottom-0 tw-c-background-overlay tw-c-text-overlay tw-mg-b-1"},n("button",{className:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--overlay ffz-core-button--text tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","data-a-target":"chat-list-footer",onClick:this.ffzFastResume},n("div",{className:"tw-align-items-center ffz-core-button-label tw-flex tw-flex-grow-0"},n("div",{className:"tw-flex-grow-0"},s)))))};for(const e of o)this.onMount(e)})),this.ChatScroller.on("mount",this.onMount,this),this.ChatScroller.on("unmount",this.onUnmount,this)}onMount(e){e.ffzSetSmoothScroll(this.smooth_scroll),e.ffzInstallHandler()}onUnmount(e){this.off("tooltips:mousemove",e.ffzTooltipHover,e),this.off("tooltips:leave",e.ffzTooltipLeave,e),window.removeEventListener("keydown",e.ffzHandleKey),window.removeEventListener("keyup",e.ffzHandleKey)}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return ChatLine}));var o=n(16),a=n(4),u=n(318),f=n(0),g=n(2),_=n(10),b=n(7),v=n(129);const k={1e3:1,2e3:2,3e3:3};class ChatLine extends a.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("site"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject(u.a),this.inject("experiments"),this.inject("chat.actions"),this.inject("chat.overrides"),this.ChatLine=this.fine.define("chat-line",(e=>e.renderMessageBody&&e.props&&!e.onExtensionNameClick&&!Object(f.has)(e.props,"hasModPermissions")),o.a.CHAT_ROUTES),this.ExtensionLine=this.fine.define("extension-line",(e=>e.renderMessageBody&&e.onExtensionNameClick),o.a.CHAT_ROUTES),this.WhisperLine=this.fine.define("whisper-line",(e=>e.props&&e.props.message&&Object(f.has)(e.props,"reportOutgoingWhisperRendered")))}async onEnable(){this.on("chat.overrides:changed",(e=>this.updateLinesByUser(e,null,!1,!1)),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this);for(const e of g.RERENDER_SETTINGS)this.chat.context.on(`changed:${e}`,this.rerenderLines,this);for(const e of g.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${e}`,this.updateLineTokens,this);for(const e of g.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${e}`,this.updateLineBadges,this);this.chat.context.on("changed:tooltip.link-images",this.maybeUpdateLines,this),this.chat.context.on("changed:tooltip.link-nsfw-images",this.maybeUpdateLines,this),this.on("chat:get-tab-commands",(e=>{"control"!==this.experiments.getTwitchAssignmentByName("chat_replies")&&e.commands.push({name:"reply",description:"Reply to a user's last message.",permissionLevel:0,ffz_group:"FrankerFaceZ",commandArgs:[{name:"username",isRequired:!0},{name:"message",isRequired:!1}]})})),this.on("chat:pre-send-message",(e=>{if("control"===this.experiments.getTwitchAssignmentByName("chat_replies"))return;const s=e.message,n=this.parent.chat_types||{};let o,a;if(!/^\/reply ?/i.test(s))return;o=s.slice(7).trim(),e.preventDefault();const u=o.indexOf(" ");if(-1!==u&&(a=o.slice(u+1),o=o.slice(0,u)),o.startsWith("@")&&(o=o.slice(1)),o&&o.length){o=o.toLowerCase();const s=Array.from(this.ChatLine.instances);let n=s.length;for(;n--;){var f,g,_;const u=s[n],b=null==u||null===(f=u.props)||void 0===f?void 0:f.message,v=null==b?void 0:b.user;if(v&&(v.login===o||(null===(g=v.displayName)||void 0===g||null===(_=g.toLowerCase)||void 0===_?void 0:_.call(g))===o))return void(a?e.sendMessage(a,{reply:{parentDeleted:b.deleted||!1,parentDisplayName:v.displayName,parentMessageBody:b.message,parentMsgId:b.id,parentUid:v.id,parentUserLogin:v.login}}):requestAnimationFrame((()=>u.ffzOpenReply())))}}e.addMessage({type:n.Notice,message:this.i18n.t("chat.reply.bad-user","Invalid user or no known message to reply to.")})}));const e=this,s=await this.web_munch.findModule("react");if(!s)return;const n=s.createElement,o=this.rich_content&&this.rich_content.RichContent;this.WhisperLine.ready((s=>{const o=s.prototype.render;s.prototype.render=function(){if(this._ffz_no_scan=!0,!this.props.message||!this.props.message.content||!this.props.message.from)return o.call(this);try{const s=e.chat.standardizeWhisper(this.props.message),o=s.is_action,a=o?e.chat.context.get("chat.me-style"):0,u=a>=2,f=1===a||3===a,g=s.user,_=e.overrides.getColor(g.id)||g.color,b=e.parent.colors.process(_),v=s.ffz_tokens=s.ffz_tokens||e.chat.tokenizeMessage(s,null),k=e.chat.renderTokens(v,n),x=e.overrides.getName(g.id);return n("div",{className:"thread-message__message"},n("div",{className:"tw-pd-x-1 tw-pd-y-05"},[n("span",{className:"thread-message__message--user-name notranslate"+(x?" ffz--name-override":""),style:{color:b}},x||g.displayName),n("span",null,o?" ":": "),n("span",{className:"message"+(u?" chat-line__message-body--italicized":""),style:{color:f&&b}},k)]))}catch(s){return e.log.error(s),e.log.capture(s,{extra:{props:this.props}}),o.call(this)}},setTimeout((()=>this.WhisperLine.forceUpdate()))})),this.ChatLine.ready((s=>{const a=s.prototype.render;s.prototype.shouldComponentUpdate=function(e,s){const n=s&&s.alwaysShowMessage||!e.message.deleted,o=this._ffz_show;return this._ffz_show=n,n!==o||s&&this.state&&s.ffz_expanded!==this.state.ffz_expanded||e.deletedMessageDisplay!==this.props.deletedMessageDisplay||e.deletedCount!==this.props.deletedCount||e.message!==this.props.message||e.isCurrentUserModerator!==this.props.isCurrentUserModerator||e.showModerationIcons!==this.props.showModerationIcons||e.showTimestamps!==this.props.showTimestamps},s.prototype.ffzOpenReply=function(){var s;if(this.props.reply)return void this.setOPCardTray(this.props.reply);const o=this.renderMessageAuthor;this.renderMessageAuthor=()=>this.ffzReplyAuthor();const a=null===(s=this.props.message)||void 0===s?void 0:s.ffz_tokens;a&&(this.setMessageTray(this.props.message,e.chat.renderTokens(a,n)),this.renderMessageAuthor=o)},s.prototype.ffzReplyAuthor=function(){const s=e.chat.standardizeMessage(this.props.message),o=s.user,a=e.overrides.getColor(o.id)||o.color,u=e.parent.colors.process(a);let f=s.roomLogin?s.roomLogin:s.channel?s.channel.slice(1):void 0,g=s.roomId?s.roomId:this.props.channelID;if(!f&&g){const n=e.chat.getRoom(g,null,!0);n&&n.login&&(f=s.roomLogin=n.login)}if(!g&&f){const n=e.chat.getRoom(null,g,!0);n&&n.id&&(g=s.roomId=n.id)}const _=e.chat.formatUser(o,n),b=e.overrides.getName(o.id);return n("span",{"data-room-id":g,"data-room":f,"data-user-id":o.userID,"data-user":o.userLogin&&o.userLogin.toLowerCase()},[n("span",{className:"chat-line__message--badges"},e.chat.badges.render(s,n)),n("span",{className:"chat-line__username notranslate"+(b?" ffz--name-override tw-relative ffz-il-tooltip__container":""),role:"button",style:{color:u},onClick:this.ffz_user_click_handler,onContextMenu:e.actions.handleUserContext},b?[n("span",{className:"chat-author__display-name"},b),n("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},_)]:_)])},s.prototype.ffzDrawLine=function(s,o,a,u,f){const g=2===e.chat.context.get("chat.emotes.animated");return u&&(o=`${o} tw-relative`,a=[n("div",{className:"chat-line__message-highlight tw-absolute tw-border-radius-medium tw-top-0 tw-bottom-0 tw-right-0 tw-left-0","data-test-selector":"chat-message-highlight"}),n("div",{className:"chat-line__message-container tw-relative"},a),n("div",{className:"chat-line__reply-icon tw-absolute tw-border-radius-medium tw-c-background-base tw-elevation-1"},u)]),n("div",{className:`${o}${s.mentioned?" ffz-mentioned":""}${f?" ffz-custom-color":""}`,style:{backgroundColor:f},"data-room-id":s.roomId,"data-room":s.roomLogin,"data-user-id":s.user.userID,"data-user":s.user.userLogin&&s.user.userLogin.toLowerCase(),onMouseOver:g?e.chat.emotes.animHover:null,onMouseOut:g?e.chat.emotes.animLeave:null},a)},s.prototype.render=function(){try{var s,u;this._ffz_no_scan=!0;const a=e.parent.message_types||{},f=this.props.deletedCount,x=e.chat.context.get("chat.replies.style"),C=2===e.chat.context.get("chat.emotes.animated"),E=e.chat.context.get("chat.filtering.display-deleted"),z=e.chat.standardizeMessage(this.props.message),j=2===x||1===x&&this.props.repliesAppearancePreference&&"expanded"!==this.props.repliesAppearancePreference?z.ffz_reply=z.ffz_reply||e.chat.tokenizeReply(this.props.reply):null,O=z.messageType===a.Action,A=O?e.chat.context.get("chat.me-style"):0,T=A>=2,D=1===A||3===A,B=z.user,P=e.overrides.getColor(B.id)||B.color,L=e.parent.colors.process(P);let I,N,R=this.props.deletedMessageDisplay,U=null;const q=e.chat.context.get("chat.points.allow-highlight"),H=q>0&&"points"===z.ffz_type&&z.ffz_reward&&Object(v.c)(z.ffz_reward),G=H&&1==q,V=H&&2==q;if(this.props.isCurrentUserModerator||"DETAILED"!=R||(R="LEGACY"),E&&(R=E),"BRIEF"===R){if(z.deleted)return null==f?null:n("div",{className:"chat-line__status"},e.i18n.t("chat.deleted-messages","{count,plural,\none {One message was deleted by a moderator.}\nother {# messages were deleted by a moderator.}\n}",{count:f}));I=!0,N=!1}else"DETAILED"===R?(I=!0,N=z.deleted):(I=this.state&&this.state.alwaysShowMessage||!z.deleted,N=!1);if(z.deleted){const s=e.chat.context.get("chat.filtering.display-mod-action");if(2===s||1===s&&"DETAILED"===R){const s=z.modActionType;"timeout"===s?U=e.i18n.t("chat.mod-action.timeout","{duration} Timeout",{duration:Object(_.print_duration)(z.duration||1)}):"ban"===s?U=e.i18n.t("chat.mod-action.ban","Banned"):"delete"!==s&&s||(U=e.i18n.t("chat.mod-action.delete","Deleted")),U&&z.modLogin&&(U=e.i18n.t("chat.mod-action.by","{action} by {login}",{login:z.modLogin,action:U})),U&&(U=n("span",{className:"tw-pd-l-05","data-test-selector":"chat-deleted-message-attribution"},`(${U})`))}}let W=z.roomLogin?z.roomLogin:z.channel?z.channel.slice(1):void 0,K=z.roomId?z.roomId:this.props.channelID;if(!W&&K){const s=e.chat.getRoom(K,null,!0);s&&s.login&&(W=z.roomLogin=s.login)}if(!K&&W){const s=e.chat.getRoom(null,W,!0);s&&s.id&&(K=z.roomId=s.id)}const Z=e.site.getUser(),J={id:K,login:W},Y=this.props&&!(!this.props.hasReply&&!this.props.reply&&this.props.replyRestrictedReason),X=Y&&z.message&&!z.deleted&&!this.props.disableReplyClick,Q=X&&Z&&Z.login!==(null===(s=z.user)||void 0===s?void 0:s.login)&&!z.reply,ee=1===x&&X&&(!!z.reply||Q);Z&&(Z.moderator=this.props.isCurrentUserModerator,Z.staff=this.props.isCurrentUserStaff,Z.can_reply=2===x&&Q);const te=z.ffz_tokens=z.ffz_tokens||e.chat.tokenizeMessage(z,Z),ie=o&&e.chat.pluckRichContent(te,z),se=z.mentioned&&z.mention_color?e.parent.inverse_colors.process(z.mention_color):null;this.ffz_open_reply||(this.ffz_open_reply=this.ffzOpenReply.bind(this)),this.ffz_user_click_handler||(this.props.onUsernameClick?this.ffz_user_click_handler=s=>{if(this.isKeyboardEvent(s)&&s.keyCode!==g.KEYS.Space&&s.keyCode!==g.KEYS.Enter)return;const n=s.currentTarget,o=n&&n.dataset;let a=B;if(o&&o.user)try{a=JSON.parse(o.user)}catch(e){}const u=new b.FFZEvent({inst:this,event:s,message:z,user:a,room:J});e.emit("chat:user-click",u),u.defaultPrevented||this.props.onUsernameClick(a.login,"chat_message",z.id,n.getBoundingClientRect().bottom)}:this.ffz_user_click_handler=this.openViewerCard||this.usernameClickHandler);const ne=e.chat.formatUser(B,n),oe=e.overrides.getName(B.id),ae={className:`chat-line__username notranslate${oe?" ffz--name-override tw-relative ffz-il-tooltip__container":""} ${null!==(u=z.ffz_user_class)&&void 0!==u?u:""}`,role:"button",style:{color:L},onClick:this.ffz_user_click_handler,onContextMenu:e.actions.handleUserContext};z.ffz_user_props&&Object.assign(ae,z.ffz_user_props),z.ffz_user_style&&Object.assign(ae.style,z.ffz_user_style);const re=[e.actions.renderInline(z,this.props.showModerationIcons,Z,J,n),n("span",{className:"chat-line__message--badges"},e.chat.badges.render(z,n)),n("span",ae,oe?[n("span",{className:"chat-author__display-name"},oe),n("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},ne)]:ne)];let le,ce=`chat-line__message${N?" ffz--deleted-message":""}${ee?" tw-relative":""}`,ue=te.length||!z.ffz_type?[(this.props.showTimestamps||this.props.isHistorical)&&n("span",{className:"chat-line__timestamp"},e.chat.formatTime(z.timestamp)),re,n("span",{"aria-hidden":!0},O?" ":": "),I&&Y&&j?e.chat.renderTokens(j,n):null,I?n("span",{className:`message ${T?"chat-line__message-body--italicized":""} ${G?"chat-line__message-body--highlighted":""}`,style:D?{color:L}:null},e.chat.renderTokens(te,n,0!==x&&Y?this.props.reply:null)):n("span",{className:"chat-line__message--deleted"},n("a",{href:"",onClick:this.alwaysShowMessage},e.i18n.t("chat.message-deleted","<message deleted>"))),I&&ie&&n(o,ie),U]:null;if(null==ue&&(le=e.chat.context.get("chat.extra-timestamps")),"sub_mystery"===z.ffz_type){const s=z.mystery;s&&(z.mystery.line=this);const o=e.i18n.tList("chat.sub.gift","{user} is gifting {count, plural, one {# Tier {tier} Sub} other {# Tier {tier} Subs}} to {channel}'s community! ",{user:z.sub_anon||"ananonymousgifter"===B.username?e.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):n("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},n("span",{className:"tw-c-text-base tw-strong"},B.displayName)),count:z.sub_count,tier:k[z.sub_plan]||1,channel:z.roomLogin});1===z.sub_total?o.push(e.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):z.sub_total>1&&o.push(e.i18n.t("chat.sub.gift-total","They've gifted {count} Subs in the channel!",{count:z.sub_total})),this.ffz_click_expand||(this.ffz_click_expand=()=>{this.setState({ffz_expanded:!this.state.ffz_expanded})});const a=e.chat.context.get("chat.subs.merge-gifts-visibility")?!this.state.ffz_expanded:this.state.ffz_expanded;let u=null;if(a&&s&&s.recipients&&s.recipients.length>0){const e=[];for(const o of s.recipients)e.length&&e.push(", "),e.push(n("span",{role:"button",className:"ffz--giftee-name",onClick:this.ffz_user_click_handler,"data-user":JSON.stringify(o)},n("span",{className:"tw-c-text-base tw-strong"},o.displayName)));u=n("div",{className:"tw-mg-t-05 tw-border-t tw-pd-t-05 tw-c-text-alt-2"},e)}ce=`ffz-notice-line user-notice-line tw-pd-y-05 ffz--subscribe-line${N?" ffz--deleted-message":""}${ee?" tw-relative":""}`,ue=[n("div",{className:"tw-flex tw-c-text-alt-2",onClick:this.ffz_click_expand},[e.chat.context.get("chat.subs.compact")?null:n("figure",{className:`ffz-i-star${z.sub_anon?"-empty":""} tw-mg-r-05`}),n("div",null,[ue?null:le&&(this.props.showTimestamps||this.props.isHistorical)&&n("span",{className:"chat-line__timestamp"},e.chat.formatTime(z.timestamp)),ue||z.sub_anon?null:e.actions.renderInline(z,this.props.showModerationIcons,Z,J,n),o]),s?n("div",{className:"tw-pd-l-05 tw-font-size-4"},n("figure",{className:`ffz-i-${a?"down":"right"}-dir tw-pd-y-1`})):null]),u,ue&&n("div",{className:"chat-line--inline chat-line__message","data-room-id":K,"data-room":W,"data-user-id":B.userID,"data-user":B.userLogin&&B.userLogin.toLowerCase()},ue)]}else if("sub_gift"===z.ffz_type){const s=z.sub_plan||{},o=z.sub_months||1,a=k[s.plan]||1;let u;const f={months:o,user:z.sub_anon||"ananonymousgifter"===B.username?e.i18n.t("chat.sub.anonymous-gifter","An anonymous gifter"):n("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},n("span",{className:"tw-c-text-base tw-strong"},B.displayName)),plan:"custom"===s.plan?"":e.i18n.t("chat.sub.gift-plan","Tier {tier}",{tier:a}),recipient:n("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler,"data-user":JSON.stringify(z.sub_recipient)},n("span",{className:"tw-c-text-base tw-strong"},z.sub_recipient.displayName))};u=o<=1?e.i18n.tList("chat.sub.mystery","{user} gifted a {plan} Sub to {recipient}! ",f):e.i18n.tList("chat.sub.gift-months","{user} gifted {months, plural, one {# month} other {# months}} of {plan} Sub to {recipient}!",f),1===z.sub_total?u.push(e.i18n.t("chat.sub.gift-first","It's their first time gifting a Sub in the channel!")):z.sub_total>1&&u.push(e.i18n.t("chat.sub.gift-total","They've gifted {count,number} Subs in the channel!",{count:z.sub_total})),ce=`ffz-notice-line user-notice-line tw-pd-y-05 tw-pd-r-2 ffz--subscribe-line${N?" ffz--deleted-message":""}${ee?" tw-relative":""}`,ue=[n("div",{className:"tw-flex tw-c-text-alt-2"},[e.chat.context.get("chat.subs.compact")?null:n("figure",{className:"ffz-i-star tw-mg-r-05"}),n("div",null,[ue?null:le&&(this.props.showTimestamps||this.props.isHistorical)&&n("span",{className:"chat-line__timestamp"},e.chat.formatTime(z.timestamp)),ue||z.sub_anon?null:e.actions.renderInline(z,this.props.showModerationIcons,Z,J,n),u])]),ue&&n("div",{className:"chat-line--inline chat-line__message","data-room-id":K,"data-room":W,"data-user-id":B.userID,"data-user":B.userLogin&&B.userLogin.toLowerCase()},ue)]}else if("resub"===z.ffz_type){const s=z.sub_cumulative||z.sub_months,o=e.chat.context.get("chat.subs.show");if(3===o||1===o&&ue&&s>1||2===o&&s>1){const o=z.sub_plan||{},a=k[o.plan]||1,u=e.i18n.tList("chat.sub.main","{user} subscribed {plan}. ",{user:n("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},n("span",{className:"tw-c-text-base tw-strong"},B.displayName)),plan:o.prime?e.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):e.i18n.t("chat.sub.plan","at Tier {tier}",{tier:a})});z.sub_share_streak&&z.sub_streak>1?u.push(e.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:z.sub_cumulative,streak:z.sub_streak})):s>1&&u.push(e.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:s})),ce=`ffz-notice-line user-notice-line tw-pd-y-05 tw-pd-r-2 ffz--subscribe-line${N?" ffz--deleted-message":""}${ee?" tw-relative":""}`,ue=[n("div",{className:"tw-flex tw-c-text-alt-2"},[e.chat.context.get("chat.subs.compact")?null:n("figure",{className:`ffz-i-${o.prime?"crown":"star"} tw-mg-r-05`}),n("div",null,[ue?null:le&&(this.props.showTimestamps||this.props.isHistorical)&&n("span",{className:"chat-line__timestamp"},e.chat.formatTime(z.timestamp)),ue?null:e.actions.renderInline(z,this.props.showModerationIcons,Z,J,n),u])]),ue&&n("div",{className:"chat-line--inline chat-line__message","data-room-id":K,"data-room":W,"data-user-id":B.userID,"data-user":B.userLogin&&B.userLogin.toLowerCase()},ue)]}}else if("ritual"===z.ffz_type&&e.chat.context.get("chat.rituals.show")){let s;"new_chatter"===z.ritual&&(s=n("div",{className:"tw-c-text-alt-2"},[e.i18n.tList("chat.ritual","{user} is new here. Say hello!",{user:n("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},n("span",{className:"tw-c-text-base tw-strong"},B.displayName))})])),s&&(ce=`ffz-notice-line user-notice-line tw-pd-y-05 tw-pd-r-2 ffz--ritual-line${N?" ffz--deleted-message":""}${ee?" tw-relative":""}`,ue=[ue?null:le&&(this.props.showTimestamps||this.props.isHistorical)&&n("span",{className:"chat-line__timestamp"},e.chat.formatTime(z.timestamp)),s,ue&&n("div",{className:"chat-line--inline chat-line__message","data-room-id":K,"data-room":W,"data-user-id":B.userID,"data-user":B.userLogin&&B.userLogin.toLowerCase()},ue)])}else if("points"===z.ffz_type&&z.ffz_reward){const s=n("span",{className:"ffz--points-reward"},Object(v.b)(z.ffz_reward,e.i18n)),o=n("span",{className:"ffz--points-cost"},[n("span",{className:"ffz--points-icon"}),e.i18n.formatNumber(Object(v.a)(z.ffz_reward))]);ce=`ffz-notice-line ffz--points-line tw-pd-l-1 tw-pd-y-05 tw-pd-r-2${V?" ffz-custom-color ffz--points-highlight":""}${N?" ffz--deleted-message":""}${ee?" tw-relative":""}`,ue=[n("div",{className:"tw-c-text-alt-2"},[ue?null:le&&(this.props.showTimestamps||this.props.isHistorical)&&n("span",{className:"chat-line__timestamp"},e.chat.formatTime(z.timestamp)),ue?null:e.actions.renderInline(z,this.props.showModerationIcons,Z,J,n),ue?e.i18n.tList("chat.points.redeemed","Redeemed {reward} {cost}",{reward:s,cost:o}):e.i18n.tList("chat.points.user-redeemed","{user} redeemed {reward} {cost}",{reward:s,cost:o,user:n("span",{role:"button",className:"chatter-name",onClick:this.ffz_user_click_handler},n("span",{className:"tw-c-text-base tw-strong"},B.displayName))})]),ue&&n("div",{className:"chat-line--inline chat-line__message","data-room-id":K,"data-room":W,"data-user-id":B.userID,"data-user":B.userLogin&&B.userLogin.toLowerCase()},ue)]}else z.bits>0&&e.chat.context.get("chat.bits.cheer-notice")&&(ce=`ffz-notice-line user-notice-line tw-pd-y-05 tw-pd-r-2 ffz--ritual-line${N?" ffz--deleted-message":""}${ee?" tw-relative":""}`,ue=[n("div",{className:"tw-c-text-alt-2"},[ue?null:le&&(this.props.showTimestamps||this.props.isHistorical)&&n("span",{className:"chat-line__timestamp"},e.chat.formatTime(z.timestamp)),ue?null:e.actions.renderInline(z,this.props.showModerationIcons,Z,J,n),e.i18n.tList("chat.bits-message","Cheered {count, plural, one {# Bit} other {# Bits}}",{count:z.bits||0})]),ue&&n("div",{className:"chat-line--inline chat-line__message","data-room-id":K,"data-room":W,"data-user-id":B.userID,"data-user":B.userLogin&&B.userLogin.toLowerCase()},ue)]);if(!ue)return null;if(ee){let s,o;Q?(s=n("figure",{className:"ffz-i-reply"}),o=e.i18n.t("chat.actions.reply","Reply to Message")):(s=n("figure",{className:"ffz-i-threads"}),o=e.i18n.t("chat.actions.reply.thread","Open Thread")),ue=[n("div",{className:"chat-line__message-highlight tw-absolute tw-border-radius-medium tw-top-0 tw-bottom-0 tw-right-0 tw-left-0","data-test-selector":"chat-message-highlight"}),n("div",{className:"chat-line__message-container tw-relative"},[this.props.repliesAppearancePreference&&"expanded"===this.props.repliesAppearancePreference?this.renderReplyLine():null,ue]),n("div",{className:"chat-line__reply-icon tw-absolute tw-border-radius-medium tw-c-background-base tw-elevation-1"},n("button",{className:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ffz-tooltip ffz-tooltip--no-mouse","data-test-selector":"chat-reply-button","aria-label":o,"data-title":o,onClick:this.ffz_open_reply},n("span",{className:"tw-button-icon__icon"},s)))]}return n("div",{className:`${ce}${z.mentioned?" ffz-mentioned":""}${se?" ffz-custom-color":""}`,style:{backgroundColor:se},"data-room-id":K,"data-room":W,"data-user-id":B.userID,"data-user":B.userLogin&&B.userLogin.toLowerCase(),onMouseOver:C?e.chat.emotes.animHover:null,onMouseOut:C?e.chat.emotes.animLeave:null},ue)}catch(s){e.log.info(s),e.log.capture(s,{extra:{props:this.props}});try{return a.call(this)}catch(s){return e.log.error("An error in Twitch rendering.",s),e.log.capture(s,{extra:{props:this.props}}),"An error occurred rendering this chat line."}}},setTimeout((()=>this.ChatLine.forceUpdate()))})),this.ExtensionLine.ready((s=>{const a=s.prototype.render;s.prototype.render=function(){try{if(this._ffz_no_scan=!0,!this.props.installedExtensions)return null;const s=e.chat.standardizeMessage(this.props.message),a=s&&s.extension;if(!a)return null;if(!this.props.installedExtensions.some((e=>{const s=e.extension;return s&&(s.clientId||s.clientID)===(a.clientId||a.clientID)&&s.version===a.version})))return null;const u=e.parent.colors.process(a.chatColor);let f=s.roomLogin?s.roomLogin:s.channel?s.channel.slice(1):void 0;if(!f&&this.props.channelID){const n=e.chat.getRoom(this.props.channelID,null,!0);n&&n.login&&(f=s.roomLogin=n.login)}const g=e.site.getUser(),_={id:this.props.channelID,login:f},b=s.ffz_tokens=s.ffz_tokens||e.chat.tokenizeMessage(s,g),v=o&&e.chat.pluckRichContent(b,s),k=s.mentioned&&s.mention_color?e.parent.inverse_colors.process(s.mention_color):null;return b.length?n("div",{className:`chat-line__message${s.mentioned?" ffz-mentioned":""}${k?" ffz-custom-color":""}`,style:{backgroundColor:k},"data-room-id":_.id,"data-room":_.login,"data-extension":a.clientID},[this.props.showTimestamps&&n("span",{className:"chat-line__timestamp"},e.chat.formatTime(s.timestamp)),n("span",{className:"chat-line__message--badges"},e.chat.badges.render(s,n)),n("span",{className:"chat-line__username notranslate",role:"button",style:{color:u},onClick:this.onExtensionNameClick},n("span",{className:"chat-author__display-name"},a.displayName)),n("span",null,": "),n("span",{className:"message"},e.chat.renderTokens(b,n)),v&&n(o,v)]):null}catch(s){return e.log.info(s),e.log.capture(s,{extra:{props:this.props}}),a.call(this)}},setTimeout((()=>this.ExtensionLine.forceUpdate()))}))}updateLinesByUser(e,s,n=!0,o=!0){for(const a of this.ChatLine.instances){const u=a.props.message,f=null==u?void 0:u.user;f&&(e&&e==f.id||s&&s==f.login)&&(o&&(u.ffz_badges=u.ffz_badge_cache=null),n&&(u.ffz_tokens=null,u.highlights=u.mentioned=u.mention_color=u.color_priority=null),a.forceUpdate())}for(const n of this.WhisperLine.instances){var a;const o=null===(a=n.props.message)||void 0===a?void 0:a._ffz_message,u=null==o?void 0:o.user;u&&(e&&e==u.id||s&&s==u.login)&&(o._ffz_message=null,n.forceUpdate())}}maybeUpdateLines(){this.chat.context.get("chat.rich.all-links")&&this.updateLines()}updateLines(){return this._updateLines()}rerenderLines(){return this._updateLines(!1,!1)}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(e=!0,s=!0){for(const n of this.ChatLine.instances){const o=n.props.message;o&&(s&&(o.ffz_badge_cache=o.ffz_badges=null),e&&(o.ffz_tokens=null,o.highlights=o.mentioned=o.mention_color=o.mention_priority=o.clear_priority=null))}for(const n of this.ExtensionLine.instances){const o=n.props.message;o&&(s&&(o.ffz_badge_cache=o.ffz_badges=null),e&&(o.ffz_tokens=null,o.highlights=o.mentioned=o.mention_color=o.mention_priority=o.clear_priority=null))}for(const e of this.WhisperLine.instances){const s=e.props.message;s&&s._ffz_message&&(s._ffz_message=null)}this.ChatLine.forceUpdate(),this.ExtensionLine.forceUpdate(),this.WhisperLine.forceUpdate(),this.emit("chat:updated-lines")}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return RichContent}));var o=n(4),a=n(0);const u="https://static-cdn.jtvnw.net/emoticons/v1/58765/2.0";class RichContent extends o.default{constructor(...e){super(...e),this.inject("chat"),this.inject("i18n"),this.inject("site.web_munch"),this.RichContent=null,this.has_tokenizer=!1}async loadTokenizer(){if(!this.has_tokenizer)return this.tokenizer=await Promise.all([n.e(0),n.e(158)]).then(n.bind(null,148)),this.has_tokenizer=!0,this.tokenizer}async onEnable(){const e=this,s=await this.web_munch.findModule("react");if(!s)return;const n=s.createElement;this.RichContent=class RichContent extends s.Component{constructor(s){super(s),this.state={loaded:!1,error:!1,has_tokenizer:e.has_tokenizer},e.has_tokenizer||e.loadTokenizer().then((()=>this.setState(Object.assign({},this.state,{has_tokenizer:!0}))))}async load(s=!1){this.clearRefresh();try{let e=this.props.getData(s);if(e instanceof Promise){const s=Object(a.has)(this.props,"timeout")?this.props.timeout:1e3;e=s?await Object(a.timeout)(e,s):await e}if(e||(e={error:{type:"i18n",key:"card.empty",phrase:"No data was returned."}}),e.error&&(e={short:{type:"header",image:{type:"image",url:u},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:e.error}}),e.refresh)try{this.clearRefresh();const s=new Date(e.refresh).getTime()-Date.now();s>0&&(this._refresh_timer=setTimeout((()=>this.load(!0)),s+100*Math.floor(100*Math.random())))}catch(e){}this.setState(Object.assign({loaded:!0,url:this.props.url},e))}catch(s){"timeout"!==s.message&&e.log.capture(s),this.setState({has_tokenizer:e.has_tokenizer,loaded:!0,url:this.props.url,short:{type:"header",image:{type:"image",url:u},title:{type:"i18n",key:"card.error",phrase:"An error occurred."},subtitle:String(s)}})}}clearRefresh(){this._refresh_timer&&(clearTimeout(this._refresh_timer),this._refresh_timer=null)}checkReload(e){(!e||e&&this.props.url===e)&&this.reload()}reload(s=!1){this.clearRefresh(),this.setState({loaded:!1,error:!1,has_tokenizer:e.has_tokenizer},(()=>this.load(s)))}componentDidMount(){e.on("chat:update-link-resolver",this.checkReload,this),this.load()}componentWillUnmount(){e.off("chat:update-link-resolver",this.checkReload,this),this.clearRefresh()}renderCard(){return this.props.renderBody?this.props.renderBody(this.state,this,n):[this.renderUnsafe(),this.renderBody()]}renderUnsafe(){if(!this.state.unsafe)return null;const s=Array.from(new Set(this.state.urls.map((e=>e.flags)).flat())).join(", ").toLowerCase();return n("div",{class:"ffz--corner-flag ffz--corner-flag__warn ffz-tooltip ffz-tooltip--no-mouse","data-title":e.i18n.t("tooltip.link-unsafe","Caution: This URL is has been flagged as potentially harmful by: {reasons}",{reasons:s})},n("figure",{class:"ffz-i-attention"}))}renderBody(){var s;let o=this.props.force_full?this.state.full:this.props.force_mid?this.state.mid:null!==(s=this.props.want_mid?this.state.mid:null)&&void 0!==s?s:this.state.short;return e.has_tokenizer&&this.state.v&&this.state.v>e.tokenizer.VERSION&&(o=null),e.has_tokenizer&&this.state.loaded&&o?n("div",{class:"ffz-card-rich tw-full-width tw-overflow-hidden tw-flex tw-flex-column"},e.tokenizer.renderTokens(o,n,{vue:!1,tList:(...s)=>e.i18n.tList(...s),i18n:e.i18n,fragments:this.state.fragments,allow_media:e.chat.context.get("tooltip.link-images"),allow_unsafe:e.chat.context.get("tooltip.link-nsfw-images")})):this.renderBasic()}renderBasic(){let s,o;return this.state.error?(s=e.i18n.t("card.error","An error occurred."),o=this.state.error):this.state.loaded&&this.state.has_tokenizer?(s=this.state.title,o=this.state.description):o=e.i18n.t("card.loading","Loading..."),s||o||(o=e.i18n.t("card.empty","No data was returned.")),o=o?o.split(/\n+/).slice(0,2).map((e=>n("div",{class:"tw-c-text-alt-2 tw-ellipsis tw-mg-x-05",title:e},e))):[],[n("div",{class:"ffz--header-image"}),n("div",{class:"ffz--card-text tw-full-width tw-overflow-hidden tw-flex tw-flex-column tw-justify-content-center"},s&&n("div",{class:"chat-card__title tw-ellipsis tw-mg-x-05"},n("span",{class:"tw-strong",title:s},s)),o)]}render(){let e=n("div",{class:"tw-flex tw-flex-nowrap tw-pd-05"},this.renderCard());const s=this.props.card_tooltip&&this.state.full&&!this.props.force_full;return this.state.url&&(e=n("a",{class:`${s?"ffz-tooltip ":""}${this.state.accent?"ffz-accent-card ":""}${this.state.error?"":"ffz-interactable--hover-enabled "}tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--default tw-interactive`,"data-tooltip-type":"link","data-url":this.state.url,"data-is-mail":!1,target:"_blank",rel:"noreferrer noopener",href:this.state.url},e)),n("div",{class:"tw-border-radius-medium tw-elevation-1 ffz--chat-card tw-relative"+(this.state.unsafe?" ffz--unsafe":""),style:{"--ffz-color-accent":this.state.accent||null}},n("div",{class:"tw-border-radius-medium tw-c-background-alt tw-flex tw-full-width"},e))}}}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return SettingsMenu}));var o=n(16),a=n(4),u=n(1);class SettingsMenu extends a.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.settings.add("chat.input.hide-identity",{default:!1,ui:{path:"Chat > Input >> Appearance",title:'Display "Chat Identity" in the chat settings menu rather than the input box.',component:"setting-check-box"}}),this.SettingsMenu=this.fine.define("chat-settings",(e=>e.renderUniversalOptions&&e.onBadgesChanged),o.a.CHAT_ROUTES)}async onEnable(){this.on("i18n:update",(()=>this.SettingsMenu.forceUpdate())),this.chat.context.on("changed:chat.scroller.freeze",(()=>this.SettingsMenu.forceUpdate())),this.chat.context.on("changed:chat.input.hide-identity",(e=>{this.css_tweaks.toggle("hide-chat-identity",e),this.SettingsMenu.forceUpdate()})),this.css_tweaks.toggle("hide-chat-identity",this.chat.context.get("chat.input.hide-identity"));const e=this,s=await this.web_munch.findModule("react");if(!s)return;const n=s.createElement;this.SettingsMenu.ready((s=>{const o=s.prototype.render,a=s.prototype.renderUniversalOptions;s.prototype.renderUniversalOptions=function(){const s=a.call(this);return this.ffzSettingsClick||(this.ffzSettingsClick=s=>e.click(this,s)),this.ffzPauseClick||(this.ffzPauseClick=()=>this.setState({ffzPauseMenu:!this.state.ffzPauseMenu})),s.props.children.push(n("div",{class:"tw-full-width tw-relative"},n("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.ffzSettingsClick},n("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},n("div",{class:"tw-flex-grow-1"},e.i18n.t("site.menu_button","FrankerFaceZ Control Center")))),e.cant_window&&n("div",{class:"tw-mg-t-05 tw-c-text-alt-2"},n("span",{class:"ffz-i-attention"},e.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch."))))),s},s.prototype.ffzRenderIdentity=function(){var s,o,a,u;if(!this.state||!this.props||this.state.moderatorMode||this.state.chatAppearance||this.state.chatPause||this.state.followerMode||this.state.recentRaids||this.state.repliesAppearance||this.state.slowMode||this.props.isShowingChatFilterSettings||this.props.isShowingDeletedMessageDisplaySettings||!this.props.isLoggedIn)return null;if(!e.chat.context.get("chat.input.hide-identity"))return null;const f=null===(s=this.props.data)||void 0===s?void 0:s.currentUser,g=null===(o=this.props.data)||void 0===o||null===(a=o.user)||void 0===a||null===(u=a.self)||void 0===u?void 0:u.displayBadges;if(!f||!f.login||!Array.isArray(g))return null;const _=f.login&&f.displayName&&f.displayName.trim().toLowerCase()!==f.login,b=e.parent.colors.process(f.chatColor),v={};for(const e of g)null!=e&&e.setID&&e.version&&(v[e.setID]=e.version);this._ffzIdentityClick||(this._ffzIdentityClick=()=>{document.querySelector('button[data-a-target="chat-badge-carousel-badge-icon"]').click(),this.props.onCloseSettings()});const k={user:f,badges:v,ffz_badges:e.badges.getBadges(f.id,f.login,this.props.channelID,this.props.channelLogin),roomID:this.props.channelID,roomLogin:this.props.channelLogin};return this._ffzIdentityMsg=k,n("div",{class:"ffz-identity"},n("div",{class:"tw-mg-y-05 tw-pd-x-05"},n("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},e.i18n.t("chat.identity-menu","Chat Identity"))),n("div",{class:"tw-full-width tw-relative"},n("button",{class:"tw-block tw-border-radius-medium tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this._ffzIdentityClick},n("div",{class:"tw-align-items-center tw-flex tw-pd-05 tw-relative"},n("div",{class:"tw-flex-grow-1"},n("span",{class:"ffz--editor-name"},n("span",{class:"ffz--editor-badges","data-room-id":this.props.channelID,"data-room":this.props.channelLogin},e.badges.render(k,n,!0,!0)),n("span",{class:"tw-strong notranslate",style:{color:b}},n("span",{class:"name-display__name"},f.displayName||f.login),_&&n("span",{class:"intl-name"}," (",f.login,") ")))),n("div",{class:"tw-align-items-center tw-flex tw-flex-shrink-0 tw-mg-l-05"},n("figure",{class:"ffz-i-right-open"}))))))},s.prototype.render=function(){const s=o.call(this);try{var n,a,u,f,g,_,b,v,k,x;const e=null==s||null===(n=s.props)||void 0===n||null===(a=n.children)||void 0===a||null===(u=a.props)||void 0===u||null===(f=u.children)||void 0===f||null===(g=f.props)||void 0===g||null===(_=g.children)||void 0===_||null===(b=_[1])||void 0===b||null===(v=b.props)||void 0===v||null===(k=v.children)||void 0===k||null===(x=k.props)||void 0===x?void 0:x.children;if(Array.isArray(e)){const s=this.ffzRenderIdentity();s&&e.unshift(s)}}catch(s){e.log.error("Error rendering chat settings menu.",s)}return s},this.SettingsMenu.forceUpdate()})),this.SettingsMenu.on("update",this.updateSettingsMenu,this),this.SettingsMenu.on("unmount",(e=>{e.ffzSettingsClick=null}))}updateSettingsMenu(e){var s,n,o,a,f,g,_;const b=this.fine.getChildNode(e);if(!b||!document.contains(b))return;let v;if(null!==(s=e.props)&&void 0!==s&&s.editAppearance){this.registerBadgePicker();const e=b.querySelector('span[data-a-target="edit-display-name"]');v=e&&e.closest(".tw-mg-t-1")}else v=b.querySelector('.name-display > div:not([data-test-selector="edit-appearance-button"])');if(!v||!b.contains(v))return;const k=null===(n=e.props)||void 0===n||null===(o=n.data)||void 0===o?void 0:o.currentUser,x=null===(a=e.props)||void 0===a||null===(f=a.data)||void 0===f||null===(g=f.user)||void 0===g||null===(_=g.self)||void 0===_?void 0:_.displayBadges;if(!k||!k.login||!Array.isArray(x))return;const C=k.login&&k.displayName&&k.displayName.trim().toLowerCase()!==k.login,E=this.parent.colors.process(k.chatColor),z={};for(const e of v.children)null!=e&&e.classList&&(e.classList.contains("ffz--editor-name")?e.remove():e.classList.add("tw-hide"));for(const e of x)null!=e&&e.setID&&e.version&&(z[e.setID]=e.version);v.appendChild(Object(u.createElement)("span",{className:"ffz--editor-name"},[Object(u.createElement)("span",{className:"ffz--editor-badges","data-room-id":e.props.channelID,"data-room-login":e.props.channelLogin},this.badges.render({user:k,badges:z,ffz_badges:this.badges.getBadges(k.id,k.login,e.props.channelID,e.props.channelLogin),roomID:e.props.channelID,roomLogin:e.props.channelLogin},u.createElement,!0,!0)),Object(u.createElement)("span",{class:"tw-strong notranslate",style:{color:E}},Object(u.createElement)("span",{class:"name-display__name"},k.displayName||k.login),C&&Object(u.createElement)("span",{class:"intl-name"}," (",k.login,")"))]))}registerBadgePicker(){this.BadgePicker||(this.BadgePicker=this.fine.define("badge-picker",(e=>e.onGlobalBadgeClicked&&e.onGlobalBadgeKeyPress),o.a.CHAT_ROUTES),this.BadgePicker.on("mount",this.updateBadgePicker,this),this.BadgePicker.on("update",this.updateBadgePicker,this),this.BadgePicker.ready(((e,s)=>{for(const e of s)this.updateBadgePicker(e)})))}updateBadgePicker(e){var s;const n=this.fine.getChildNode(e);var o,a;if(!n)return void(!1!==(null===(o=e.props)||void 0===o||null===(a=o.data)||void 0===a?void 0:a.loading)||e._ffz_try_again||(e._ffz_try_again=requestAnimationFrame((()=>this.updateBadgePicker(e)))));const f=n.querySelector(".tw-flex-column");if(!f)return;const g=this.badges.getBadges(e.props.userID,e.props.userLogin);let _;for(const e of g){const s=this.badges.badges[null==e?void 0:e.id];s&&!s.addon&&(_=s)}const b=f.querySelector(".ffz--badge-selector");if(b)return void(_||b.remove());if(!_)return;const v=Object(u.createElement)("div",{class:"ffz--badge-selector tw-border-b tw-mg-b-1"},Object(u.createElement)("div",{class:"tw-mg-y-05 tw-pd-x-05"},Object(u.createElement)("p",{class:"tw-c-text-alt-2 tw-font-size-6 tw-strong tw-upcase"},this.i18n.t("chat.ffz-badge.title","FrankerFaceZ Badge"))),Object(u.createElement)("div",null,Object(u.createElement)("p",{class:"tw-mg-b-05 tw-pd-x-05"},this.i18n.tList("chat.ffz-badge.about","This badge appears globally for users with FrankerFaceZ. Please visit the {website} to change this badge.",{website:Object(u.createElement)("a",{href:"https://www.frankerfacez.com/donate",class:"ffz-link",rel:"noopener noreferrer",target:"_blank"},this.i18n.t("chat.ffz-badge.site-link","FrankerFaceZ website"))}))),Object(u.createElement)("div",{role:"radiogroup",class:"tw-align-items-center tw-flex tw-flex-wrap tw-mg-b-05 tw-mg-t-05 tw-pd-x-05"},Object(u.createElement)("div",{class:"tw-mg-r-1 tw-mg-y-05"},Object(u.createElement)("div",{class:"tw-inline-flex"},Object(u.createElement)("div",{class:"edit-appearance__badge-chooser edit-appearance__badge-chooser--selected tw-border-radius-small"},Object(u.createElement)("img",{alt:_.title,src:_.urls[2],srcset:`${_.urls[2]} 1x, ${_.urls[4]} 2x`,style:{backgroundColor:_.color||"transparent"},role:"radio","aria-checked":"true",class:"tw-full-height tw-full-width"})))))),k=null===(s=f.querySelector('[data-test-selector="global-badges-test-selector"]'))||void 0===s?void 0:s.nextElementSibling;k?f.insertBefore(v,k):f.appendChild(v)}closeMenu(e){const s=this.fine.searchParent(e,(e=>e.setChatInputRef&&e.setAutocompleteInputRef),100),n=s&&this.fine.searchTree(s,(e=>e.props&&e.props.isSettingsOpen&&e.onClickSettings));n&&n.onClickSettings()}click(e,s){const n=this.resolve("site.layout");if(n&&n.is_minimal||s&&(s.ctrlKey||s.shiftKey)){const e=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-settings","_blank","resizable=yes,scrollbars=yes,width=850,height=600");if(!e)return this.cant_window=!0,void this.SettingsMenu.forceUpdate();e.focus()}else{const e=s.currentTarget,n=e&&e.dataset&&e.dataset.page,o=this.resolve("main_menu");if(o&&(n&&o.requestPage(n),o.showing))return;this.emit("site.menu_button:clicked")}this.closeMenu(e)}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return EmoteMenu}));var o,a,u=n(0),f=n(2),g=n(49),_=n(1),b=n(16),v=n(4),k=n(143),x=n.n(k);const C={1e3:"Tier 1",2e3:"Tier 2",3e3:"Tier 3"},E=["the_horns","raised_back_of_hand","ok_hand","+1","clap","fist","pinched_fingers","wave","pinch","victory","love_you_gesture"];function maybe_date(e){if(!e)return e;try{return new Date(e)}catch(e){return null}}const z=(null===(o=window)||void 0===o||null===(a=o.Intl)||void 0===a?void 0:a.Collator)&&new Intl.Collator(void 0,{numeric:!0}),j=[function id_asc(e,s){return z?z.compare(e.id,s.id):e.id<s.id?-1:e.id>s.id?1:0},function id_desc(e,s){return z?z.compare(s.id,e.id):e.id>s.id?-1:e.id<s.id?1:0},function name_asc(e,s){const n=e.name.toLowerCase(),o=s.name.toLowerCase();return n<o?-1:n>o?1:z?z.compare(e.id,s.id):e.id<s.id?-1:e.id>s.id?1:0},function name_desc(e,s){const n=e.name.toLowerCase(),o=s.name.toLowerCase();return n>o?-1:n<o?1:z?z.compare(s.id,e.id):e.id>s.id?-1:e.id<s.id?1:0},function native_asc(e,s){if(null!=e.order||null!=s.order){if(e.order&&null==s.order)return-1;if(s.order&&null==e.order)return 1;if(e.order<s.order)return-1;if(e.order>s.order)return 1}return z?z.compare(e.id,s.id):e.id<s.id?-1:e.id>s.id?1:0},function native_desc(e,s){if(null!=e.order||null!=s.order){if(e.order&&null==s.order)return 1;if(s.order&&null==e.order)return-1;if(e.order<s.order)return 1;if(e.order>s.order)return-1}return z?z.compare(e.id,s.id):e.id<s.id?1:e.id>s.id?-1:0}];function sort_sets(e,s){const n=e.sort_key,o=s.sort_key;if(n<o)return-1;if(o<n)return 1;const a=e.title.toLowerCase(),u=s.title.toLowerCase();return a<u?-1:u<a?1:0}class EmoteMenu extends v.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("chat"),this.inject("chat.badges"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("site.web_munch"),this.inject("site.css_tweaks"),this.SUB_STATUS=x.a,this.settings.add("chat.emote-menu.shortcut",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Use Ctrl+E to open the Emote Menu.",description:"When enabled and you press Ctrl+E with the chat input focused, the emote menu will open.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.modifiers",{default:0,ui:{path:"Chat > Emote Menu >> General",title:"Emote Modifiers",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"In-Line"}]}}),this.settings.add("chat.emote-menu.enabled",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Use the FrankerFaceZ Emote Menu.",description:"The FFZ emote menu replaces the built-in Twitch emote menu and provides enhanced functionality.",component:"setting-check-box"},changed:()=>this.EmoteMenu.forceUpdate()}),this.settings.add("chat.emote-menu.icon",{requires:["chat.emote-menu.enabled","context.bttv.emote_menu"],default:!1,process:(e,s)=>!!e.get("chat.emote-menu.enabled")&&(e.get("context.bttv.emote_menu")||s),ui:{path:"Chat > Emote Menu >> Appearance",title:"Replace the emote menu icon with the FFZ icon for that classic feel.",description:"**Note:** This setting may be forcibly enabled if other emote menus are detected, to ensure you can visually identify the FFZ Emote Menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-quick-nav",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show a quick navigation bar along the side of the menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.tall",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use extra height for the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.show-heading",{default:1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show Headers",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Not Searching"}]}}),this.settings.add("chat.emote-menu.show-search",{default:!0,ui:{path:"Chat > Emote Menu >> Appearance",title:"Show the search box.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.reduced-padding",{default:!1,ui:{path:"Chat > Emote Menu >> Appearance",title:"Use reduced padding.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.default-tab",{default:"channel",ui:{path:"Chat > Emote Menu >> General",title:"Default Tab",component:"setting-select-box",data:[{value:"fav",title:"Favorites"},{value:"channel",title:"Channel"},{value:"all",title:"My Emotes"},{value:"emoji",title:"Emoji"}]}}),this.settings.add("chat.emote-menu.show-emoji",{default:!0,ui:{path:"Chat > Emote Menu >> General",title:"Display emoji in the emote menu.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.combine-tabs",{default:!1,ui:{path:"Chat > Emote Menu >> General",title:"Display all emotes on one tab.",component:"setting-check-box"}}),this.settings.add("chat.emote-menu.stay-loaded",{requires:["chat.emote-menu.combine-tabs"],default:null,process:(e,s)=>(null==s&&(s=e.get("chat.emote-menu.combine-tabs")),s),ui:{path:"Chat > Emote Menu >> General",title:"Stay loaded after opening.",component:"setting-check-box",description:"This causes the emote menu to stay in the DOM even when it's not visible. Enabling this may help the site perform better when opening the menu if it's slow. By default, this setting is enabled when using `Display all emotes on one tab.`"}}),this.settings.add("chat.emote-menu.sort-emotes",{default:4,ui:{path:"Chat > Emote Menu >> Sorting",title:"Sort Emotes By",component:"setting-select-box",data:[{value:4,title:"Native Order, Ascending"},{value:5,title:"Native Order, Descending"},{value:0,title:"Order Added (ID), Ascending"},{value:1,title:"Order Added (ID), Descending"},{value:2,title:"Name, Ascending"},{value:3,title:"Name, Descending"}]}}),this.settings.add("chat.emote-menu.sort-tiers-last",{default:!0,ui:{path:"Chat > Emote Menu >> Sorting",title:"List emotes from higher sub tiers last.",component:"setting-check-box"}}),this.EmoteMenu=this.fine.define("chat-emote-menu",(e=>{var s;return e.getAllEmoteSets&&e.getSortedChannelEmotes&&(null===(s=e.props)||void 0===s?void 0:s.emotePickerSource)}),b.a.CHAT_ROUTES),this.MenuWrapper=this.fine.wrap("ffz-emote-menu")}async onEnable(){this.on("i18n:update",(()=>this.EmoteMenu.forceUpdate())),this.on("chat.emotes:update-default-sets",this.maybeUpdate,this),this.on("chat.emotes:update-user-sets",this.maybeUpdate,this),this.on("chat.emotes:update-room-sets",this.maybeUpdate,this),this.on("chat.emotes:change-favorite",this.maybeUpdate,this),this.on("chat.emotes:change-hidden",this.maybeUpdate,this),this.on("chat.emoji:populated",this.maybeUpdate,this),this.chat.context.on("changed:chat.emote-menu.enabled",(()=>this.EmoteMenu.forceUpdate()));const rebuild=()=>{for(const e of this.MenuWrapper.instances)e.rebuildData()};this.chat.context.on("changed:chat.emotes.enabled",rebuild),this.chat.context.on("changed:chat.emote-menu.modifiers",rebuild),this.chat.context.on("changed:chat.emote-menu.show-emoji",rebuild),this.chat.context.on("changed:chat.fix-bad-emotes",rebuild),this.chat.context.on("changed:chat.emote-menu.sort-emotes",rebuild),this.chat.context.on("changed:chat.emote-menu.sort-tiers-last",rebuild),this.chat.context.on("changed:chat.emoji.style",this.updateEmojiVariables,this),this.chat.context.getChanges("chat.emote-menu.icon",(e=>this.css_tweaks.toggle("emote-menu",e))),this.updateEmojiVariables(),this.css_tweaks.setVariable("emoji-menu--sheet","//cdn.frankerfacez.com/static/emoji/images/sheet-twemoji-36.png"),this.css_tweaks.setVariable("emoji-menu--count",58),this.css_tweaks.setVariable("emoji-menu--size",36);const e=this,s=await this.web_munch.findModule("react"),n=s&&s.createElement;if(!n)return e.log.warn("Unable to get React.");this.defineClasses(),this.EmoteMenu.ready((s=>{const o=s.prototype.render;s.prototype.render=function(){var s,a,f,g;return this._ffz_no_scan=!1,this.props&&Object(u.has)(this.props,"channelID")&&e.chat.context.get("chat.emote-menu.enabled")?n(e.MenuErrorWrapper,{visible:this.props.visible},n(e.MenuComponent,{source:this.props.emotePickerSource,visible:this.props.visible,toggleVisibility:this.props.toggleVisibility,channel_data:this.props.channelData,emote_data:this.props.emoteSetsData,user_id:this.props.currentUserID,channel_id:this.props.channelID,loading:(null===(s=this.props.channelData)||void 0===s?void 0:s.loading)||(null===(a=this.props.emoteSetsData)||void 0===a?void 0:a.loading),error:(null===(f=this.props.channelData)||void 0===f?void 0:f.error)||(null===(g=this.props.emoteSetsData)||void 0===g?void 0:g.error),onClickToken:this.props.onClickToken})):o.call(this)},this.EmoteMenu.forceUpdate()}))}updateEmojiVariables(){const e=this.chat.context.get("chat.emoji.style")||"twitter",s=`//cdn.frankerfacez.com/static/emoji/images/sheet-${g.d[e]||"twemoji"}-`,n=this.emoji_size=36,o=this.emoji_sheet_count=58,a=this.emoji_sheet_size=o*(n+2),u=this.emoji_sheet_pct=100*a/n;this.emoji_sheet_remain=a-n,this.css_tweaks.set("emoji-menu",`.ffz--emoji-tone-picker__emoji,.emote-picker__emoji .emote-picker__emote-figure {\n\tbackground-size: ${u}% ${u}%;\n\tbackground-image: url("${s}36.png");\n\tbackground-image: ${f.WEBKIT_CSS}image-set(\n\t\turl("${s}18.png") 0.5x,\n\t\turl("${s}36.png") 1x,\n\t\turl("${s}72.png") 2x\n\t);\n}`)}maybeUpdate(){if(this.chat.context.get("chat.emote-menu.enabled"))for(const e of this.MenuWrapper.instances)e.rebuildData()}defineClasses(){const e=this,s=this.settings.provider,n=this.web_munch.getModule("react"),o=n&&n.createElement;this.EmojiTonePicker=class FFZEmojiTonePicker extends n.Component{constructor(e){super(e),this.onClick=()=>this.setState({open:!this.state.open}),this.onMouseEnter=()=>this.state.open||this.setState({emoji:this.pickRandomEmoji()}),this.onClickOutside=()=>this.state.open&&this.setState({open:!1}),this.clickTone=e=>{this.props.pickTone(e.currentTarget.dataset.tone),this.setState({open:!1})},this.element=null,this.saveRef=e=>this.element=e,this.state={open:!1,emoji:this.pickRandomEmoji(),tone:null}}componentDidMount(){this.element&&(this._clicker=new _.ClickOutside(this.element,this.onClickOutside))}componentWillUnmount(){this._clicker&&(this._clicker.destroy(),this._clicker=null)}pickRandomEmoji(){const e=this.props.choices;return e[Math.floor(Math.random()*e.length)]}renderTone(e,s){return e?o("button",{key:e.code,"data-tone":s,class:"tw-interactive tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive tw-pd-y-05 tw-pd-x-2",onClick:this.clickTone},this.renderEmoji(e)):null}renderToneMenu(){if(!this.state.open)return null;const e=this.state.emoji;if(!e||!e.variants)return null;const s=Object.entries(e.variants).map((([e,s])=>this.renderTone(s,e)));return o("div",{class:"tw-absolute ffz-balloon ffz-il-tooltip--up ffz-il-tooltip--align-right ffz-balloon tw-block"},o("div",{class:"tw-border-b tw-border-l tw-border-r tw-border-t tw-border-radius-medium tw-c-background-base tw-elevation-1"},this.renderTone(e,null),s))}renderEmoji(s){if(!s)return null;const n=s.sheet_x*(e.emoji_size+2)+1,a=s.sheet_y*(e.emoji_size+2)+1,u=100*n/e.emoji_sheet_remain,f=100*a/e.emoji_sheet_remain;return o("figure",{class:"ffz--emoji-tone-picker__emoji",style:{backgroundPosition:`${u}% ${f}%`}})}render(){const e=this.state.emoji,s=this.props.tone,n=s&&e.variants[s];return o("div",{ref:this.saveRef,class:"ffz--emoji-tone-picker tw-relative tw-mg-l-1"},o("button",{class:"tw-interactive tw-button tw-button--dropmenu ffz-button--hollow",onClick:this.onClick,onMouseEnter:this.onMouseEnter},o("span",{class:"tw-button__text"},this.renderEmoji(n||e)),o("span",{class:"tw-button__icon tw-button__icon--right"},o("figure",{class:"ffz-i-down-dir"}))),this.renderToneMenu())}},this.MenuSection=class FFZMenuSection extends n.Component{constructor(e){super(e),this.ref=null,this.saveRef=e=>{this.ref&&this.props.stopObserving(this.ref),this.ref=e,e&&this.props.startObserving(this.ref,this)};const n=s.get("emote-menu.collapsed"),o=s.get("emote-menu.hidden-sets");this.state={active:!1,activeEmote:-1,hidden:o&&e.data&&o.includes(e.data.hide_key||e.data.key),collapsed:n&&e.data&&n.includes(e.data.key),intersecting:!window.IntersectionObserver},this.keyHeading=this.keyHeading.bind(this),this.clickHeading=this.clickHeading.bind(this),this.clickEmote=this.clickEmote.bind(this),this.mouseEnter=()=>this.state.intersecting||this.setState({intersecting:!0}),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this)}componentDidMount(){this.props.addSection(this),this.ref&&this.props.startObserving(this.ref,this)}componentWillUnmount(){this.props.removeSection(this),this.ref&&this.props.stopObserving(this.ref)}keyInteract(e){}clickEmote(s){if(this.props.visibility_control){const n=s.currentTarget.dataset;let o,a=n.id;if("twitch"===n.provider)o="twitch";else{if("ffz"!==n.provider)return;{const s=e.emotes.emote_sets[n.set],u=s&&s.emotes[a];if(!u)return;o=s.source||"ffz",a=u.id}}e.emotes.toggleHidden(o,a)}else e.emotes.handleClick(s)||this.props.onClickToken(s.currentTarget.dataset.name)}keyHeading(e){e.keyCode!==f.KEYS.Enter&&e.keyCode!==f.KEYS.Space||this.clickHeading()}clickHeading(){if(this.props.visibility_control){const n=s.get("emote-menu.hidden-sets")||[],o=this.props.data.hide_key||this.props.data.key,a=n.indexOf(o);if("twitch-current-channel"===o)return;return-1===a?(n.push(o),this.setState({hidden:!0})):(n.splice(a,1),this.setState({hidden:!1})),s.set("emote-menu.hidden-sets",n),void e.emit("chat.emotes:change-set-hidden",o)}if(this.props.filtered)return;const n=s.get("emote-menu.collapsed")||[],o=!this.state.collapsed,a=this.props.data.key,u=n.indexOf(a);if(this.setState({collapsed:o}),o&&-1===u)n.push(a);else{if(o||-1===u)return;n.splice(u,1)}s.set("emote-menu.collapsed",n)}onMouseEnter(e){const s=e.currentTarget.dataset.setId;this.setState({unlocked:s})}onMouseLeave(){this.setState({unlocked:null})}render(){const s=this.props.data,n=this.props.filtered,a=this.props.visibility_control;let u=!(s.is_favorites&&!this.props.combineTabs)&&this.props.showHeading;u=2===u?!n:!!u,a&&(u=!0);const f=!!a&&this.state.hidden,g=a?f:u&&!n&&this.state.collapsed;if(!s)return null;let _,b;_=s.image?o("img",{class:"ffz--menu-badge"+(s.image_large?" ffz--menu-badge__large":""),src:s.image,srcSet:s.image_set}):o("figure",{class:`ffz--menu-badge ffz-i-${s.icon||"zreknarf"}`});const v=s.renews&&s.renews.getTime(),k=s.ends&&s.ends.getTime();v>0?b={icon:"calendar",message:e.i18n.t("emote-menu.sub-renews","This sub renews in {seconds,humantime}.",{seconds:v})}:k&&(b=s.prime?{icon:"crown",message:e.i18n.t("emote-menu.sub-prime","This is your free sub with Prime Gaming.\nIt ends in {seconds,humantime}.",{seconds:k})}:s.gift?{icon:"gift",message:e.i18n.t("emote-menu.sub-gift-ends","This gifted sub ends in {seconds,humantime}.",{seconds:k})}:{icon:"calendar-empty",message:e.i18n.t("emote-menu.sub-ends","This sub ends in {seconds,humantime}.",{seconds:k})});let x=s.source_i18n?e.i18n.t(s.source_i18n,s.source):s.source;return null==x&&(x="FrankerFaceZ"),o("section",{ref:this.saveRef,"data-key":s.key,class:n?"filtered":"",onMouseEnter:this.mouseEnter},u?o("heading",{tabindex:"0",class:"tw-pd-1 tw-border-b tw-flex tw-flex-nowrap",onKeyDown:this.keyHeading,onClick:this.clickHeading},_,o("div",{class:"tw-pd-l-05"},(s.i18n?e.i18n.t(s.i18n,s.title):s.title)||e.i18n.t("emote-menu.unknown","Unknown Source"),!a&&b&&o("span",{class:`tw-mg-x-05 ffz--expiry-info ffz-tooltip ffz-i-${b.icon}`,"data-tooltip-type":"html","data-title":b.message})),o("div",{class:"tw-flex-grow-1"}),a?f?e.i18n.t("emote-menu.visibility.hidden","Hidden"):e.i18n.t("emote-menu.visibility.visible","Visible"):x,!a&&n?"":o("figure",{class:`tw-pd-l-05 ffz-i-${g?"left":"down"}-dir`})):null,g||this.renderBody(u))}renderBody(s){const n=this.props.data,a=this.props.filtered,u=n.locks&&n.locks[this.state.unlocked],f=n.filtered_emotes&&n.filtered_emotes.map((o=>{if(a&&o.locked)return;const f=o.locked&&(!u||!u.emotes.has(o.id)),g=f&&n.locks&&n.locks[o.set_id];let _="";return g&&(_="cheer"===g.id?e.i18n.t("emote-menu.emote-cheer","Cheer an additional {bits_remaining, plural, one {# bit} other {# bits}} to unlock this emote.",g):"follower"===g.id?e.i18n.t("emote-menu.emote-follower","Follow {user} to unlock this emote in their channel.",g):n.all_locked?e.i18n.t("emote-menu.emote-sub","Subscribe for {price} to unlock this emote.",g):e.i18n.t("emote-menu.emote-up","Upgrade your sub to {price} to unlock this emote.",g)),this.renderEmote(o,f,s,_)}));return o("div",{class:"tw-pd-1 tw-border-b tw-c-background-alt tw-align-center"},f,!this.props.visibility_control&&!a&&this.renderSellout())}renderEmote(e,s,n,a){if(!this.state.intersecting)return o("span",{key:e.id,class:"emote-picker__placeholder",style:{width:`${e.width||28}px`,height:`${e.height||28}px`}});const u=this.props.visibility_control,f=this.props.emote_modifiers[e.id],g=Array.isArray(f)&&f.length>0,_=this.props.animated,b=u&&e.hidden;let v,k;return _&&e.animSrc?(v=e.animSrc,k=e.animSrcSet):(v=e.src,k=e.srcSet),o("button",{key:e.id,class:`ffz-tooltip emote-picker__emote-link${!u&&s?" locked":""}${b?" emote-hidden":""}`,"data-tooltip-type":"emote","data-provider":e.provider,"data-id":e.id,"data-set":e.set_id,"data-code":e.code,"data-modifiers":f,"data-variant":e.variant,"data-no-source":n,"data-name":e.name,"aria-label":e.name,"data-locked":e.locked,"data-sellout":a,onClick:(this.props.visibility_control||!e.locked)&&this.clickEmote},o("figure",{class:"emote-picker__emote-figure"},o("img",{class:"emote-picker__emote-image"+(e.emoji?" ffz-emoji":""),src:v,srcSet:k,alt:e.name,height:e.height?`${e.height}px`:null,width:e.width?`${e.width}px`:null})),!u&&g&&o("div",{class:"emote-button__options"}),!u&&e.favorite&&o("figure",{class:"ffz--favorite ffz-i-star"}),!u&&s&&o("figure",{class:`ffz-i-${e.lock_icon||"lock"}`}),b&&o("figure",{class:"ffz-i-eye-off"}))}renderSellout(){const s=this.props.data;if(!s.all_locked||!s.locks)return null;const n=s.locks[this.state.unlocked],a=Object.values(s.locks).filter((e=>"cheer"!==e.id));return a.length?o("div",{class:"tw-mg-1 tw-border-t tw-pd-t-1 tw-mg-b-0"},n?e.i18n.t("emote-menu.sub-unlock","Subscribe for {price} to unlock {count, plural, one {# emote} other {# emotes}}",{price:n.price,count:n.emotes.size}):e.i18n.t("emote-menu.sub-basic","Subscribe to unlock some emotes"),o("div",{class:"ffz--sub-buttons tw-mg-t-05"},a.map((e=>e.hide_button?null:o("a",{key:e.price,class:"tw-button tw-border-radius-none",href:e.url,target:"_blank",rel:"noopener noreferrer","data-set-id":e.set_id,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},o("span",{class:"tw-button__text"},e.price)))))):null}},this.fine.wrap("ffz-menu-section",this.MenuSection),this.EmojiSection=class FFZMenuEmojiSection extends this.MenuSection{renderEmote(s,n,a,u){const f=s.x*(e.emoji_size+2)+1,g=s.y*(e.emoji_size+2)+1,_=100*f/e.emoji_sheet_remain,b=100*g/e.emoji_sheet_remain;return o("button",{key:s.id,class:`ffz-tooltip emote-picker__emote-link${n?" locked":""}${s.emoji?" emote-picker__emoji":""}`,"data-tooltip-type":"emote","data-provider":s.provider,"data-id":s.id,"data-set":s.set_id,"data-code":s.code,"data-variant":s.variant,"data-no-source":a,"data-name":s.name,"aria-label":s.name,"data-locked":s.locked,"data-sellout":u,onClick:!s.locked&&this.clickEmote},o("figure",{class:"emote-picker__emote-figure",style:{backgroundPosition:`${_}% ${b}%`}}),s.favorite&&o("figure",{class:"ffz--favorite ffz-i-star"}),n&&o("figure",{class:`ffz-i-${s.lock_icon||"lock"}`}))}};const doClear=()=>requestAnimationFrame((()=>this.emit("tooltips:cleanup"))),clearTooltips=()=>{clearTimeout(undefined),setTimeout(doClear,100)};this.MenuErrorWrapper=class FFZEmoteMenuErrorWrapper extends n.Component{constructor(e){super(e),this.state={errored:!1,error:null}}static getDerivedStateFromError(e){return{errored:!0,error:e}}componentDidCatch(s){e.log.capture(s),e.log.error("Error rendering the FFZ Emote Menu."),this.setState({errored:!0,error:s})}render(){if(this.state.errored){if(!this.props.visible)return null;const s=e.chat.context.get("chat.emote-menu.reduced-padding");return o("div",{class:"ffz-balloon ffz-balloon--md ffz-il-tooltip--up ffz-il-tooltip--align-right tw-block tw-absolute ffz--emote-picker"+(s?" reduced-padding":""),"data-a-target":"emote-picker"},o("div",{class:"tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base"},o("div",{class:"emote-picker__tab-content scrollable-area","data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},o("div",{class:"tw-align-center tw-pd-1"},o("div",{class:"tw-mg-b-1"},o("div",{class:"tw-mg-2"},o("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),e.i18n.t("emote-menu.error","There was an error rendering this menu."),o("br",null),e.settings.get("reports.error.enable")?e.i18n.t("emote-menu.error-report","An error report has been automatically submitted."):"",o("div",{class:"tw-mg-t-05 tw-border-t-1 tw-pd-t-05"},e.i18n.t("emote-menu.disable","As a temporary workaround, try disabling the FFZ Emote Menu in the FFZ Control Center.")))))))}return this.props.children}},this.MenuComponent=class FFZEmoteMenuComponent extends n.Component{constructor(s){super(s),this.nav_ref=null,this.saveNavRef=e=>{this.nav_ref=e},this.ref=null,this.saveScrollRef=e=>{this.ref=e,this.createObserver()},this.sections=[],this.activeSection=-1,this.state={tab:null,active_nav:null,stayLoaded:e.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:e.chat.context.get("chat.emote-menu.show-quick-nav"),animated:e.chat.context.get("chat.emotes.animated"),showHeading:e.chat.context.get("chat.emote-menu.show-heading"),tall:e.chat.context.get("chat.emote-menu.tall"),reducedPadding:e.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:e.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:e.chat.context.get("chat.emote-menu.show-search"),tone:e.settings.provider.get("emoji-tone",null)},s.visible&&this.loadData(),this.rebuildData(),this.observing=new Map,this.addSection=e=>{this.sections.includes(e)||this.sections.push(e)},this.removeSection=e=>{const s=this.sections.indexOf(e);-1!==s&&(this.sections.splice(s),s===this.activeSection?this.activeSection=-1:s<this.activeSection&&this.activeSection--)},this.startObserving=this.startObserving.bind(this),this.stopObserving=this.stopObserving.bind(this),this.handleObserve=this.handleObserve.bind(this),this.pickTone=this.pickTone.bind(this),this.clickTab=this.clickTab.bind(this),this.clickSideNav=this.clickSideNav.bind(this),this.handleFilterChange=this.handleFilterChange.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.toggleVisibilityControl=this.toggleVisibilityControl.bind(this)}createObserver(){if(this.observer){if(this._observed===this.ref)return;this.observer.disconnect(),this.observer=this._observed=null}if(this.ref&&window.IntersectionObserver){this._observed=this.ref,this.observer=new IntersectionObserver(this.handleObserve,{root:this.ref,rootMargin:"50px 0px",threshold:.01});for(const e of this.observing.keys())this.observer.observe(e);this.observeSoon()}}observeSoon(){requestAnimationFrame((()=>{this.observer&&this.handleObserve(this.observer.takeRecords())}))}destroyObserver(){this.observer&&(this.observer.disconnect(),this.observer=this._observed=null)}scrollNavIntoView(){requestAnimationFrame((()=>{var e,s;const n=null===(e=this.nav_ref)||void 0===e||null===(s=e.querySelector)||void 0===s?void 0:s.call(e,`button[data-key="${this.state.active_nav}"]`);n&&n.scrollIntoView({block:"nearest"})}))}handleObserve(e){let s=!1,n=this.state.active_nav;for(const u of e){var o,a;const e=this.observing.get(u.target),f=u.isIntersecting;e&&e.state.intersecting!==f&&(s=!0,e.setState({intersecting:f}),f&&(n=null===(o=e.props)||void 0===o||null===(a=o.data)||void 0===a?void 0:a.key))}s&&(requestAnimationFrame(clearTooltips),this.lock_active||n===this.state.active_nav||this.setState({active_nav:n},(()=>this.scrollNavIntoView())))}startObserving(e,s){const n=this.observing.get(e);s!==n&&(n&&this.stopObserving(e),this.observing.set(e,s),this.observer&&this.observer.observe(e),this.observeSoon())}stopObserving(e){this.observing.has(e)&&(this.observing.delete(e),this.observer&&this.observer.unobserve(e))}componentDidMount(){this.ref&&this.createObserver(),e.chat.context.on("changed:chat.emotes.animated",this.updateSettingState,this),e.chat.context.on("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),e.chat.context.on("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),e.chat.context.on("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),e.chat.context.on("changed:chat.emote-menu.show-heading",this.updateSettingState,this),e.chat.context.on("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),e.chat.context.on("changed:chat.emote-menu.show-search",this.updateSettingState,this),e.chat.context.on("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu=this}componentWillUnmount(){this.destroyObserver(),e.chat.context.off("changed:chat.emotes.animated",this.updateSettingState,this),e.chat.context.off("changed:chat.emote-menu.stay-loaded",this.updateSettingState,this),e.chat.context.off("changed:chat.emote-menu.show-quick-nav",this.updateSettingState,this),e.chat.context.off("changed:chat.emote-menu.show-heading",this.updateSettingState,this),e.chat.context.off("changed:chat.emote-menu.reduced-padding",this.updateSettingState,this),e.chat.context.off("changed:chat.emote-menu.combine-tabs",this.updateSettingState,this),e.chat.context.off("changed:chat.emote-menu.show-search",this.updateSettingState,this),e.chat.context.off("changed:chat.emote-menu.tall",this.updateSettingState,this),window.ffz_menu===this&&(window.ffz_menu=null)}updateSettingState(){this.setState({stayLoaded:e.chat.context.get("chat.emote-menu.stay-loaded"),quickNav:e.chat.context.get("chat.emote-menu.show-quick-nav"),animated:e.chat.context.get("chat.emotes.animated"),showHeading:e.chat.context.get("chat.emote-menu.show-heading"),reducedPadding:e.chat.context.get("chat.emote-menu.reduced-padding"),combineTabs:e.chat.context.get("chat.emote-menu.combine-tabs"),showSearch:e.chat.context.get("chat.emote-menu.show-search"),tall:e.chat.context.get("chat.emote-menu.tall")})}pickTone(s){s=s||null,e.settings.provider.set("emoji-tone",s),this.setState(this.filterState(this.state.filter,this.buildEmoji(Object.assign({},this.state,{tone:s}))))}clickSideNav(e){var s,n;const o=e.currentTarget.dataset.key,a=null===(s=this.ref)||void 0===s||null===(n=s.querySelector)||void 0===n?void 0:n.call(s,`section[data-key="${o}"]`);a&&(this.lock_active=!0,a.scrollIntoView(),this.setState({active_nav:o}),setTimeout((()=>this.lock_active=!1),250))}clickTab(e){const s=e.currentTarget.dataset.tab;if(this.state.combineTabs){var n,o;let e;switch(s){case"fav":e=this.state.filtered_fav_sets;break;case"channel":e=this.state.filtered_channel_sets;break;case"emoji":e=this.state.filtered_emoji_sets;break;default:e=this.state.filtered_all_sets}const a=e&&e[0],u=a&&(null===(n=this.ref)||void 0===n||null===(o=n.querySelector)||void 0===o?void 0:o.call(n,`section[data-key="${a.key}"]`));u&&u.scrollIntoView()}else this.setState({tab:s})}clickSettings(s){const n=e.resolve("site.layout");if(n&&n.is_minimal||s&&(s.ctrlKey||s.shiftKey)){const e=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-settings","_blank","resizable=yes,scrollbars=yes,width=850,height=600");e&&e.focus()}else{const s=e.resolve("main_menu");if(s&&(s.requestPage("chat.emote_menu"),s.showing))return;e.emit("site.menu_button:clicked")}}toggleVisibilityControl(){this.setState(this.filterState(this.state.filter,this.state,!this.state.visibility_control))}handleFilterChange(e){this.setState(this.filterState(e.target.value,this.state))}handleKeyDown(e){e.keyCode===f.KEYS.Escape&&(this.props.toggleVisibility(),e.preventDefault())}loadData(s=!1,n,o){if(!(o=o||this.state))return!1;const a=(n=n||this.props).emote_data&&n.emote_data.emoteSets,f=Array.isArray(a)?new Set(a.map((e=>e.id))):new Set;return s=s||o.set_data&&!Object(u.set_equals)(o.set_sets,f),!(o.set_data&&!s)&&(this.setState({loading:!0},(()=>{e.getData(f,s).then((e=>{this.setState(this.filterState(this.state.filter,this.buildState(this.props,Object.assign({},this.state,{set_sets:f,set_data:e,loading:!1}))))}))})),!0)}filterState(e,s,n){const o=Object.assign({},s);return null!=n?o.visibility_control=n:n=o.visibility_control,o.filter=e,o.filtered=e&&e.length>0&&":"!==e||!1,o.filtered_channel_sets=this.filterSets(e,o.channel_sets,n),o.filtered_all_sets=this.filterSets(e,o.all_sets,n),o.filtered_fav_sets=this.filterSets(e,o.fav_sets,n),o.filtered_emoji_sets=this.filterSets(e,o.emoji_sets,n),o}filterSets(e,n,o){const a=[];if(!n||!n.length)return a;const u=e&&e.length>0&&":"!==e,f=s.get("emote-menu.hidden-sets")||[];for(const s of n){if(!o&&f.includes(s.key))continue;(s.filtered_emotes=s.emotes.filter((s=>!(!o&&s.hidden)&&(!u||!s.locked&&this.doesEmoteMatch(e,s))))).length&&a.push(s)}return a}doesEmoteMatch(e,s){if(!e||!e.length)return!0;const n=s.search||s.name,o=n.toLowerCase(),a=e.toLowerCase(),u=e.startsWith(":"),f=a.slice(1);if(Array.isArray(s.extra)){let e=s.extra.length;for(;e--;){if(!u&&s.extra[e].includes(a))return!0;if(u&&s.extra[e].startsWith(f))return!0}}if(!u)return o.includes(a);if(o.startsWith(f))return!0;const g=n.indexOf(e.charAt(1).toUpperCase());return-1!==g&&o.slice(g+1).startsWith(a.slice(2))}buildEmoji(s){const n=Object.assign({},s),o=n.emoji_sets=[],a=e.emotes.getFavorites("emoji"),u=n.favorites=(n.favorites||[]).filter((e=>!e.emoji)),f=n.tone=n.tone||null,_=n.tone_emoji=[],b={};if(e.chat.context.get("chat.emote-menu.show-emoji")){let s=e.chat.context.get("chat.emoji.style")||"twitter";g.d[s]||(s="twitter");for(const n of Object.values(e.emoji.emoji)){if(!n||!n.has[s]||g.c.includes(n.category))continue;if(n.variants)for(const e of n.names)if(E.includes(e)){_.push(n);break}const v=a.includes(n.code),k=n.variants&&n.variants[f],x=k&&k.has[s],C=x?k:n;let z=b[n.category];z||(z=b[n.category]=[],o.push({key:`emoji-${n.category}`,sort_key:g.b.indexOf(n.category),emoji:!0,image:e.emoji.getFullImage(C.image),i18n:`emoji.category.${n.category.toSnakeCase()}`,title:g.a[n.category]||n.category,src:"emoji",source:"Emoji",source_i18n:"emote-menu.emoji",emotes:z}));const j={provider:"emoji",id:n.sort,emoji:!0,code:n.code,name:C.raw,variant:x&&f,hidden:n.hidden,search:n.names[0],extra:n.names.length>1?n.names.map((e=>e.toLowerCase())):null,height:18,width:18,x:C.sheet_x,y:C.sheet_y,favorite:v,src:e.emoji.getFullImage(C.image),srcSet:e.emoji.getFullImageSet(C.image)};z.push(j),v&&u.push(j)}}return n.has_emoji_tab=o.length>0,n.fav_sets=[{key:"favorites",title:"Favorites",i18n:"emote-menu.favorites",icon:"star",source:"",is_favorites:!0,emotes:u}],u.sort(this.getSorter()),o.sort(sort_sets),n}getSorter(){return j[e.chat.context.get("chat.emote-menu.sort-emotes")]||j[0]||(()=>0)}buildState(s,n){var o,a,g,_;const b=Object.assign({},n),v=b.set_data||{},k=(b.emote_modifiers={},b.channel_sets=[]),x=b.all_sets=[],E=b.favorites=[];if(s.loading||s.error||b.loading)return b;if(b.set_data&&this.loadData(!1,s,b))return b;const j=this.getSorter(),O=e.chat.context.get("chat.emote-menu.sort-tiers-last"),sort_emotes=(e,s)=>{if(e.misc||s.misc)return j(e,s);if(!e.locked&&s.locked)return-1;if(e.locked&&!s.locked)return 1;if(O||e.locked||s.locked)if(e.bits||s.bits){if(!s.bits)return 1;if(!e.bits)return-1;const n=e.bit_value||0,o=s.bit_value||0;if(z){const e=z.compare(n,o);if(0!=e)return e}else{if(n<o)return-1;if(n>o)return 1}}else if(z){const n=z.compare(e.set_id,s.set_id);if(0!=n)return n}else{if(e.set_id<s.set_id)return-1;if(e.set_id>s.set_id)return 1}return j(e,s)},A=s.channel_data&&s.channel_data.user,T=A&&A.subscriptionProducts,D=A&&(null===(o=s.channel_data)||void 0===o||null===(a=o.channel)||void 0===a?void 0:a.localEmoteSets),B=!(A&&null!=(null===(g=A.self)||void 0===g?void 0:g.follower))&&s.user_id&&(null==A?void 0:A.id)!=s.user_id,P=null==A||null===(_=A.cheer)||void 0===_?void 0:_.badgeTierEmotes,L=new Set;if(Array.isArray(D))for(const e of D)null!=e&&e.id&&L.add(e.id);const I=s.emote_data&&s.emote_data.emoteSets,N=s.emote_data&&s.emote_data.emoteMap,R=e.emotes.getFavorites("twitch"),U=e.emotes.getHidden("twitch"),q=new Set,H=[],G={},V=new Set;if(Array.isArray(I))for(const s of I){if(!s||!Array.isArray(s.emotes))continue;const n=s.id,o=parseInt(n,10),a=s.owner,g=L.has(n),_=!g&&o>5e8,b=f.TWITCH_POINTS_SETS.includes(o)||"channel_points"===(null==a?void 0:a.login),k=g?A:b?null:a,C=v[n],z=_&&a&&a.id==(null==A?void 0:A.id);V.add(n);let j,O,T=`twitch-set-${n}`,D=0,B="twitch",P=k&&(k.displayName||k.login);if(P?(T=`twitch-${null==k?void 0:k.id}`,g?e.emotes.setTwitchSetChannel(n,{id:n,type:f.EmoteTypes.Follower,owner:{id:k.id,login:k.login,displayName:k.displayName}}):_?e.emotes.setTwitchSetChannel(n,{id:n,type:f.EmoteTypes.BitsTier,owner:{id:k.id,login:k.login,displayName:k.displayName}}):e.emotes.setTwitchSetChannel(n,{id:n,type:f.EmoteTypes.Subscription,owner:{id:k.id,login:k.login,displayName:k.displayName}})):k?P=e.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:n}):b?(P=e.i18n.t("emote-menu.points","Unlocked with Points"),T="twitch-points",B="channel-points",D=45):f.TWITCH_GLOBAL_SETS.includes(o)?(P=e.i18n.t("emote-menu.global","Global Emotes"),T="twitch-global",D=100,e.emotes.setTwitchSetChannel(n,{id:n,type:f.EmoteTypes.Global,owner:null})):f.TWITCH_PRIME_SETS.includes(o)?(P=e.i18n.t("emote_menu.prime","Prime"),T="twitch-prime",B="crown",D=75,e.emotes.setTwitchSetChannel(n,{id:n,type:f.EmoteTypes.Prime,owner:null})):(P=e.i18n.t("emote-menu.misc","Miscellaneous"),T="twitch-misc",B="inventory",D=50),g)continue;G[T]?(j=G[T],O=j.emotes,C&&j.bad&&(j.bad=!1,j.renews=C.renews,j.ends=C.ends,j.prime=C.prime,j.gift=C.gift)):(O=[],j=G[T]={sort_key:D,key:T,image:null==k?void 0:k.profileImageURL,image_large:!0,icon:B,title:P,source:e.i18n.t("emote-menu.twitch","Twitch"),emotes:O,renews:null==C?void 0:C.renews,ends:null==C?void 0:C.ends,prime:null==C?void 0:C.prime,gift:null==C?void 0:C.gift},C||(j.bad=!0));let I=0;for(const o of s.emotes){if(!o||!o.id||!o.token)continue;const s=o.id,a=f.KNOWN_CODES[o.token]||o.token,g=N&&N[a];b||e.emotes.setTwitchEmoteSet(s,n);const v=[""];if(Array.isArray(o.modifiers)&&o.modifiers.length&&1===e.chat.context.get("chat.emote-menu.modifiers"))for(const e of o.modifiers)v.push(`_${e.code}`);for(const o of v){const b=`${s}${o}`,v=`${a}${o}`,x=R.includes(b),C=g&&g.id!=b,j=f.REPLACEMENTS[b];let A,T,D,B;j&&e.chat.context.get("chat.fix-bad-emotes")?A=`${f.REPLACEMENT_BASE}${j}`:(A=Object(u.getTwitchEmoteURL)(b,1,!1),T=Object(u.getTwitchEmoteSrcSet)(b,!1),D=Object(u.getTwitchEmoteURL)(b,1,!0),B=Object(u.getTwitchEmoteSrcSet)(b,!0));const P={provider:"twitch",id:b,set_id:n,name:v,src:A,srcSet:T,animSrc:D,animSrcSet:B,order:I++,overridden:C?g.id:null,misc:!k,bits:_,hidden:U.includes(b),favorite:x};O.push(P),z&&H.push(P),x&&!q.has(b)&&E.push(P),q.add(b)}}O.length&&(O.sort(sort_emotes),x.includes(j)||x.push(j))}if(Array.isArray(D)||Array.isArray(T)||Array.isArray(P)){const s=e.badges.getTwitchBadge("subscriber","0",A.id,A.login),n=[],o=new Set,a={},g={sort_key:-10,key:"twitch-current-channel",hide_key:`twitch-${A.id}`,image:s&&s.image1x,image_set:s&&`${s.image1x} 1x, ${s.image2x} 2x, ${s.image4x} 4x`,icon:"twitch",title:e.i18n.t("emote-menu.main-set","Channel Emotes"),source:e.i18n.t("emote-menu.twitch","Twitch"),emotes:n,locks:a,all_locked:!0};if(Array.isArray(D))for(const e of D){if(!e||!Array.isArray(e.emotes))continue;const s=e.id;let o;B?a[s]={set_id:s,id:"follower",user:(null==A?void 0:A.displayName)||(null==A?void 0:A.login),hide_button:!0,emotes:o=new Set}:g.all_locked=!1;let _=0;for(const a of e.emotes){if(!a||!a.id||!a.token)continue;const e=a.id,g=f.KNOWN_CODES[a.token]||a.token,b=q.has(e),v=R.includes(e),k={provider:"twitch",id:e,set_id:s,name:g,order:_++,src:Object(u.getTwitchEmoteURL)(e,1,!1),srcSet:Object(u.getTwitchEmoteSrcSet)(e,!1),animSrc:Object(u.getTwitchEmoteURL)(e,1,!0),animSrcSet:Object(u.getTwitchEmoteSrcSet)(e,!0),favorite:v,hidden:U.includes(e),locked:B,lock_icon:"heart"};n.push(k),v&&!b&&E.push(k),q.add(e),o&&o.add(e)}}if(Array.isArray(T))for(const e of T){if(!e||!Array.isArray(e.emotes))continue;const s=e.emoteSetID,_=v[s],b=!V.has(s);let k;_&&(g.renews=_.renews,g.ends=_.ends,g.prime=_.prime,g.gift=_.gift&&_.gift.isGift),b?a[s]={set_id:s,id:e.id,price:e.price||C[e.tier],url:e.url,emotes:k=new Set(o)}:g.all_locked=!1;let x=0;for(const a of e.emotes){if(!a||!a.id||!a.token)continue;const e=a.id,g=f.KNOWN_CODES[a.token]||a.token,_=q.has(e),v=R.includes(e),C={provider:"twitch",id:e,set_id:s,name:g,order:x++,locked:b&&!_,src:Object(u.getTwitchEmoteURL)(e,1,!1),srcSet:Object(u.getTwitchEmoteSrcSet)(e,!1),animSrc:Object(u.getTwitchEmoteURL)(e,1,!0),animSrcSet:Object(u.getTwitchEmoteSrcSet)(e,!0),favorite:v,hidden:U.includes(e)};n.push(C),b||!v||_||E.push(C),q.add(e),k&&(o.add(e),k.add(e))}}const _=new Set;if(Array.isArray(P)){let e;for(const s of P){var W,K,Z;if(!s||!s.id||!s.bitsBadgeTierSummary)continue;const o=s.id,f=s.setID,g=s.bitsBadgeTierSummary,b=!(q.has(o)||null!==(W=g.self)&&void 0!==W&&W.isUnlocked);b&&(a[f]={set_id:f,id:"cheer",price:null,bits:g.threshold,bits_remaining:null!==(K=null===(Z=g.self)||void 0===Z?void 0:Z.numberOfBitsUntilUnlock)&&void 0!==K?K:g.threshold,emotes:new Set([s.id])});const v=R.includes(o),k={provider:"twitch",id:o,set_id:f,name:s.token,locked:b,order:e++,src:Object(u.getTwitchEmoteURL)(o,1,!1),srcSet:Object(u.getTwitchEmoteSrcSet)(o,!1),animSrc:Object(u.getTwitchEmoteURL)(o,1,!0),animSrcSet:Object(u.getTwitchEmoteSrcSet)(o,!0),bits:!0,bit_value:g.threshold,favorite:v,hidden:U.includes(o)};n.push(k),b||!v||q.has(o)||E.push(k),_.add(o),q.add(o)}}if(H.length)for(const e of H)_.has(e.id)||n.push(e);n.length&&(n.sort(sort_emotes),k.push(g))}if(e.chat.context.get("chat.emotes.enabled")>1){const n=e.site.getUser();if(n){const o=e.emotes.getRoomSetsWithSources(n.id,n.login,s.channel_id,null),a=e.emotes.getGlobalSetsWithSources(n.id,n.login),f={};let g={};for(const[e,s]of o){const n=this.processFFZSet(e,s,E,f,g);n&&(n.emotes.sort(sort_emotes),k.includes(n)||k.push(n))}g={};for(const[e,o]of a){const a=this.processFFZSet(e,o,E,f,g);a&&(a.emotes.sort(sort_emotes),x.includes(a)||x.push(a),!k.includes(a)&&Object(u.maybe_call)(a.force_global,this,e,s.channel_data&&s.channel_data.user,n)&&k.push(a))}}}return k.sort(sort_sets),x.sort(sort_sets),b.has_channel_tab=k.length>0,this.buildEmoji(b)}processFFZSet(s,n,o,a,u){if(!s||!s.emotes)return null;const f=s.source||"ffz",g=e.emotes.getFavorites(f),_=e.emotes.getHidden(f),b=a[f]=a[f]||new Set,v=`${s.merge_source||f}-${s.merge_id||s.id}`,k=e.emotes.providers.get(n),x=k&&k.name?k.i18n_key?e.i18n.t(k.i18n_key,k.name,k):k.name:s.source||"FrankerFaceZ",C="main"===n?e.i18n.t("emote-menu.main-set","Channel Emotes"):s.title||e.i18n.t("emote-menu.unknown-set","Set #{set_id}",{set_id:s.id});let E,z,j=k&&k.sort_key||s.sort;null==j&&(j=s.title.toLowerCase().includes("global")?100:0),u[v]?(E=u[v],z=E.emotes,v===`${f}-${s.id}`&&Object.assign(E,{sort_key:j,image:s.icon,title:C,source:x,force_global:s.force_global})):(z=[],E=u[v]={sort_key:j,key:v,image:s.icon,icon:"zreknarf",title:C,source:x,emotes:z,force_global:s.force_global});for(const e of Object.values(s.emotes))if(!e.hidden){const n=g.includes(e.id),a={provider:"ffz",id:e.id,set_id:s.id,src:e.src,srcSet:e.srcSet,animSrc:e.animSrc,animSrcSet:e.animSrcSet,name:e.name,favorite:n,hidden:_.includes(e.id),height:e.height,width:e.width};z.push(a),n&&!b.has(e.id)&&(o.push(a),b.add(e.id))}return z.length?E:void 0}rebuildData(){const e=this.buildState(this.props,this.state);this.setState(this.filterState(e.filter,e))}componentDidUpdate(s){if(this.props.visible&&!s.visible)return void this.loadData();const n=this.props.channel_data,o=s.channel_data,a=(null==n?void 0:n.user)!==(null==o?void 0:o.user)||(null==n?void 0:n.channel)!==(null==o?void 0:o.channel),f=this.props.emote_data,g=s.emote_data,_=!Object(u.deep_equals)(null==f?void 0:f.emoteSets,null==g?void 0:g.emoteSets)||!Object(u.deep_equals)(null==f?void 0:f.emoteMap,null==g?void 0:g.emoteMap);(a||_||this.props.user_id!==s.user_id||this.props.channel_id!==s.channel_id||this.props.loading!==s.loading||this.props.error!==s.error)&&(e.log.debug("Updating emote menu data. cd",a,", ed",_),this.rebuildData())}renderError(){return o("div",{class:"tw-align-center tw-pd-1"},o("div",{class:"tw-mg-b-1"},o("div",{class:"tw-mg-2"},o("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),e.i18n.t("emote-menu.error","There was an error rendering this menu.")),o("button",{class:"tw-button",onClick:this.forceUpdate},o("span",{class:"tw-button__text"},e.i18n.t("error.try-again","Try Again"))))}renderEmpty(){return o("div",{class:"tw-align-center tw-pd-1"},o("div",{class:"tw-mg-2"},o("img",{src:"//cdn.frankerfacez.com/emoticon/26608/2",srcSet:"//cdn.frankerfacez.com/emoticon/26608/2 1x, //cdn.frankerfacez.com/emoticon/26608/4 2x"})),this.state.filtered?e.i18n.t("emote-menu.empty-search","There are no matching emotes."):"fav"===this.state.tab?e.i18n.t("emote-menu.empty-favs","You don't have any favorite emotes. To favorite an emote, find it and {hotkey}-Click it.",{hotkey:f.IS_OSX?"⌘":"Ctrl"}):e.i18n.t("emote-menu.empty","There's nothing here."))}renderLoading(){return o("div",{class:"tw-align-center tw-pd-1"},o("h1",{class:"tw-mg-5 ffz-i-zreknarf loading"}),e.i18n.t("emote-menu.loading","Loading..."))}render(){if(!(this.props.visible||this.state.stayLoaded&&this.loadedOnce))return null;const s=this.state.loading||this.props.loading,n=this.state.reducedPadding,a=this.state.combineTabs;let u,f,g,_;if(s||(this.loadedOnce=!0),a)f=[this.state.filtered_fav_sets,this.state.filtered_channel_sets,this.state.filtered_all_sets,this.state.filtered_emoji_sets].flat();else switch(u=this.state.tab||e.chat.context.get("chat.emote-menu.default-tab"),("channel"===u&&!this.state.has_channel_tab||"emoji"===u&&!this.state.has_emoji_tab)&&(u="all"),g="emoji"===u,_="fav"===u,u){case"fav":f=this.state.filtered_fav_sets;break;case"channel":f=this.state.filtered_channel_sets;break;case"emoji":f=this.state.filtered_emoji_sets;break;default:f=this.state.filtered_all_sets}const b=this.state.visibility_control,v="whisper"===this.props.source;return o("div",{class:"tw-block"+(this.props.visible?"":" tw-hide"),style:{display:this.props.visible?null:"none !important"}},o("div",{class:"tw-absolute ffz-attached ffz-attached--right ffz-attached--up"},o("div",{class:`ffz-balloon ffz-balloon--auto tw-inline-block tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-2 ffz--emote-picker${this.state.tall?" ffz--emote-picker__tall":""}${n?" reduced-padding":""}`,"data-a-target":"emote-picker",role:"dialog"},o("div",{class:"emote-picker"+(v?"__whisper":"")},o("div",{class:"tw-flex"},o("div",{class:`emote-picker__tab-content${v?"-whisper":""} tw-full-width scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},o("div",{ref:this.saveScrollRef,class:"simplebar-scroll-content"},o("div",{class:"simplebar-content"},s&&this.renderLoading(),!s&&f&&f.map(((s,n)=>s&&(!b||!s.emoji&&!s.is_favorites)&&o(s.emoji?e.EmojiSection:e.MenuSection,{key:s.key,idx:n,data:s,emote_modifiers:this.state.emote_modifiers,animated:this.state.animated,combineTabs:this.state.combineTabs,showHeading:this.state.showHeading,filtered:this.state.filtered,visibility_control:b,onClickToken:this.props.onClickToken,addSection:this.addSection,removeSection:this.removeSection,startObserving:this.startObserving,stopObserving:this.stopObserving}))),!s&&(!f||!f.length)&&this.renderEmpty()))),!s&&this.state.quickNav&&!_&&o("div",{class:`emote-picker__nav_content${v?"-whisper":""} tw-block tw-border-radius-none tw-c-background-alt-2`},o("div",{class:`emote-picker__nav-content-overflow${v?"-whisper":""} scrollable-area scrollable-area--suppress-scroll-x`,"data-test-selector":"scrollable-area-wrapper","data-simplebar":!0},o("div",{ref:this.saveNavRef,class:"simplebar-scroll-content"},o("div",{class:"simplebar-content"},!s&&f&&f.map((s=>{if(!s||b&&(s.is_favorites||s.emoji))return null;const a=this.state.active_nav===s.key;return o("button",{key:s.key,class:`${a?"emote-picker-tab-item-wrapper__active ":""}${n?"tw-mg-y-05":"tw-mg-y-1"} tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse`,"data-key":s.key,"data-title":`${s.i18n?e.i18n.t(s.i18n,s.title):s.title}\n${s.source_i18n?e.i18n.t(s.source_i18n,s.source):s.source}`,"data-tooltip-side":"left",onClick:this.clickSideNav},o("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${n?"":"tw-pd-x-05 "}tw-pd-y-05${a?" emote-picker-tab-item-avatar__active tw-c-text-link":""}`},s.image?o("figure",{class:"ffz-avatar ffz-avatar--size-20"},o("img",{class:"tw-block tw-border-radius-rounded tw-img tw-image-avatar",src:s.image,srcSet:s.image_set})):o("figure",{class:`ffz-emote-picker--nav-icon ffz-i-${s.icon||"zreknarf"}`})))})),a&&o("div",{class:"tw-mg-y-1 tw-mg-x-05 tw-border-t"}),a&&o("button",{class:"tw-mg-y-1 tw-c-text-inherit tw-interactable ffz-interactive ffz-interactable--hover-enabled ffz-interactable--default tw-block tw-full-width ffz-tooltip ffz-tooltip--no-mouse","data-title":e.i18n.t("emote-menu.settings","Open Settings"),"data-tooltip-side":"left",onClick:this.clickSettings},o("div",{class:`tw-align-items-center tw-flex tw-justify-content-center ${n?"":"tw-pd-x-05 "}tw-pd-y-05`},o("figure",{class:"ffz-emote-picker--nav-icon ffz-i-cog"})))))))),o("div",{class:"emote-picker__controls-container tw-relative"},(g||this.state.showSearch)&&o("div",{class:"tw-border-t tw-pd-1"},o("div",{class:"tw-flex"},o("input",{type:"text",class:"tw-block tw-border-radius-medium tw-font-size-6 tw-full-width ffz-input tw-pd-x-1 tw-pd-y-05",placeholder:g?e.i18n.t("emote-menu.search-emoji","Search for Emoji"):e.i18n.t("emote-menu.search","Search for Emotes"),value:this.state.filter,autoFocus:!0,autoCapitalize:"off",autoCorrect:"off",onChange:this.handleFilterChange,onKeyDown:this.handleKeyDown}),(a||g)&&!b&&this.state.has_emoji_tab&&o(e.EmojiTonePicker,{tone:this.state.tone,choices:this.state.tone_emoji,pickTone:this.pickTone}),(a||!g)&&o("div",{class:"tw-relative ffz-il-tooltip__container tw-mg-l-1"},o("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon--primary ffz-core-button tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative"+(this.state.visibility_control?" ffz-core-button--primary":" tw-button-icon"),onClick:this.toggleVisibilityControl},o("span",{class:"tw-button-icon__icon tw-mg-x-05"},o("figure",{class:this.state.visibility_control?"ffz-i-eye-off":"ffz-i-eye"}))),o("div",{class:"ffz-il-tooltip ffz-il-tooltip--up ffz-il-tooltip--align-right"},this.state.visibility_control?e.i18n.t("emote-menu.toggle-hide.on","Exit Emote Visibility Control"):e.i18n.t("emote-menu.toggle-hide.off","Emote Visibility Control"),o("div",{class:"tw-mg-t-1 ffz--tooltip-explain"},e.i18n.t("emote-menu.toggle-hide.info","Emote Visibility Control allows you to hide emotes from your emote menu, either individually or by set. With Emote Visibility Control enabled, just click an emote to hide or unhide it. Please note that you will still see the emotes in chat if someone uses them, but they won't appear in your emote menu.")))))),a&&this.state.quickNav?null:o("div",{class:"emote-picker__tab-nav-container tw-flex tw-border-t tw-c-background-alt"},!b&&o("div",{class:`emote-picker-tab-item${"fav"===u?" emote-picker-tab-item--active":""} tw-relative`},o("button",{class:"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive"+("fav"===u?" ffz-interactable--selected":""),id:"emote-picker__fav","data-tab":"fav","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.favorites","Favorites"),onClick:this.clickTab},o("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},o("figure",{class:"ffz-i-star"})))),this.state.has_channel_tab&&o("div",{class:`emote-picker-tab-item${"channel"===u?" emote-picker-tab-item--active":""} tw-relative`},o("button",{class:"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive"+("channel"===u?" ffz-interactable--selected":""),id:"emote-picker__channel","data-tab":"channel","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.channel","Channel"),onClick:this.clickTab},o("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},o("figure",{class:"ffz-i-camera"})))),o("div",{class:`emote-picker-tab-item${"all"===u?" emote-picker-tab-item--active":""} tw-relative`},o("button",{class:"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive"+("all"===u?" ffz-interactable--selected":""),id:"emote-picker__all","data-tab":"all","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.my-emotes","My Emotes"),onClick:this.clickTab},o("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},o("figure",{class:"ffz-i-channels"})))),!b&&this.state.has_emoji_tab&&o("div",{class:`emote-picker-tab-item${"emoji"===u?" emote-picker-tab-item--active":""} tw-relative`},o("button",{class:"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive"+("emoji"===u?" ffz-interactable--selected":""),id:"emote-picker__emoji","data-tab":"emoji","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.emoji","Emoji"),onClick:this.clickTab},o("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},o("figure",{class:"ffz-i-smile"})))),o("div",{class:"tw-flex-grow-1"}),o("div",{class:"emote-picker-tab-item tw-relative"},o("button",{class:"ffz-tooltip tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive","data-tooltip-type":"html","data-title":e.i18n.t("emote-menu.settings","Open Settings"),onClick:this.clickSettings},o("div",{class:"tw-inline-flex tw-pd-x-1 tw-pd-y-05 tw-font-size-4"},o("figure",{class:"ffz-i-cog"}))))))))))}},this.fine.wrap("ffz-emote-menu",this.MenuComponent)}async getData(e,s,n=null,o=[]){if(this._data){if(!s&&Object(u.set_equals)(e,this._data_sets))return this._data;this._data=null,this._data_sets=null}let a;try{a=await this.apollo.client.query({query:x.a,variables:{first:75,after:n,criteria:{filter:"ALL"}},fetchPolicy:s?"network-only":"cache-first"})}catch(e){return this.log.warn("Error fetching additional emote menu data.",e),this._data=null}const f={},g=Object(u.get)("data.currentUser.subscriptionBenefits.edges.@each.node",a),_=Object(u.get)("data.currentUser.subscriptionBenefits.pageInfo.hasNextPage",a),b=Object(u.get)("data.currentUser.subscriptionBenefits.edges.@last.cursor",a);if(o=o.concat(g),_)return this.getData(e,s,b,o);if(o&&o.length)for(const e of o){var v;const s=e&&e.product,n=s&&s.emoteSetID;n&&(f[n]={ends:maybe_date(e.endsAt),renews:maybe_date(e.renewsAt),prime:e.purchasedWithPrime,set_id:n,type:s.type,gift:null===(v=e.gift)||void 0===v?void 0:v.isGift})}return this._data_sets=e,this._data=f}}EmoteMenu.getData=Object(u.once)(EmoteMenu.getData)},function(e,s,n){"use strict";n.d(s,"a",(function(){return Input}));var o=n(4),a=n(1),u=n(7),f=n(0),g=n(2),_=n(16);const b=Intl.Collator(),v=Intl.Collator(void 0,{sensitivity:"accent"});function getNodeText(e){return e?"emote"===e.type?e.emoteName:"text"===e.type?e.text:Array.isArray(e.children)?e.children.map(getNodeText).join(""):"":""}function getNodeOffset(e,s){let n=0,o=0,a=e;for(;o<s.length;){var u;const e=s[o];for(let s=0;s<e;s++)n+=getNodeText(a[s]).length;a=Array.isArray(a[e])?a[e]:null===(u=a[e])||void 0===u?void 0:u.children,o++}return n}class Input extends o.default{constructor(...e){super(...e),this.inject("chat"),this.inject("chat.actions"),this.inject("chat.emotes"),this.inject("chat.emoji"),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.web_munch"),this.settings.add("chat.mru.enabled",{default:!0,ui:{path:"Chat > Input >> Recent Messages",title:"Allow pressing up and down to recall previously sent chat messages.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.ffz-emotes",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of FrankerFaceZ emotes.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emoji",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emoji.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.emotes-without-colon",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Allow tab-completion of emotes without typing a colon. (:)",description:"This will prevent the tab-completion of usernames without the @ prefix.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.limit-results",{default:!0,ui:{path:"Chat > Input >> Tab Completion",title:"Limit tab-completion results to 25.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-favorites",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize favorite emotes at the top.",component:"setting-check-box"}}),this.settings.add("chat.tab-complete.prioritize-prefix-matches",{default:!1,ui:{path:"Chat > Input >> Tab Completion",title:"Prioritize emotes that start with user input.",component:"setting-check-box"}}),this.ChatInput=this.fine.define("chat-input",(e=>e&&e.setLocalChatInputRef&&e.setLocalAutocompleteInputRef),_.a.CHAT_ROUTES),this.EmoteSuggestions=this.fine.define("tab-emote-suggestions",(e=>e&&e.getMatchedEmotes),_.a.CHAT_ROUTES),this.MentionSuggestions=this.fine.define("tab-mention-suggestions",(e=>e&&e.getMentions&&e.renderMention),_.a.CHAT_ROUTES),this.CommandSuggestions=this.fine.define("tab-cmd-suggestions",(e=>e&&e.getMatches&&e.doesCommandMatchTerm),_.a.CHAT_ROUTES),this.EmoteUsageCount={TriHard:196568036,Kappa:192158118,"4Head":155758710,PogChamp:151485090,cmonBruh:146352878,BibleThump:56472964,WutFace:45069031,Kreygasm:41387580,DansGame:38097659,SMOrc:34734484,KappaPride:34262839,VoHiYo:27886434,SwiftRage:24561900,ResidentSleeper:24438298,EleGiggle:19891526,FailFish:19118343,NotLikeThis:18802905,Keepo:18351415,BabyRage:18220906,MingLee:18026207,HeyGuys:14851569,ANELE:14648986,PJSalt:14438861}}async onEnable(){this.chat.context.on("changed:chat.actions.room",(()=>this.ChatInput.forceUpdate())),this.chat.context.on("changed:chat.actions.room-above",(()=>this.ChatInput.forceUpdate())),this.chat.context.on("changed:chat.tab-complete.emotes-without-colon",(e=>{for(const s of this.EmoteSuggestions.instances)s.canBeTriggeredByTab=e;for(const s of this.MentionSuggestions.instances)s.canBeTriggeredByTab=!e}));const e=await this.web_munch.findModule("react"),s=e&&e.createElement;if(!s)return this.log.warn("Unable to get React.");const n=this;this.ChatInput.ready(((e,o)=>{const u=e.prototype.render;e.prototype.render=function(){const e=u.call(this);try{const o=n.chat.context.get("chat.actions.room-above"),u=n.chat.context.get("context.chat_state")||{},f=o?e:Object(a.findReactFragment)(e,(e=>e.props&&"chat-input__buttons-container"===e.props.className));if(!f||!f.props||!f.props.children)return e;const g=this.props;if(!g||!g.channelID)return e;const _=g.sessionUser?{id:g.sessionUser.id,login:g.sessionUser.login,displayName:g.sessionUser.displayName,mod:g.isCurrentUserModerator,staff:g.isStaff}:null,b={id:g.channelID,login:g.channelLogin,displayName:g.channelDisplayName,emoteOnly:g.emoteOnlyMode,slowMode:g.slowMode,slowDuration:g.slowModeDuration,subsMode:g.subsOnlyMode,r9kMode:u.r9k,followersOnly:u.followersOnly,followersDuration:u.followersOnlyRequirement},v=n.actions.renderRoom(n.chat.context.get("context.chat.showModIcons"),_,b,o,s);o?f.props.children.unshift(v||null):f.props.children.splice(1,0,v||null)}catch(e){n.log.error(e),n.log.capture(e)}return e};for(const e of o)e.forceUpdate(),this.emit("site:dom-update","chat-input",e),this.updateEmoteCompletion(e),this.overrideChatInput(e)})),this.EmoteSuggestions.ready(((e,s)=>{for(const e of s)this.overrideEmoteMatcher(e)})),this.MentionSuggestions.ready(((e,s)=>{for(const e of s)this.overrideMentionMatcher(e)})),this.CommandSuggestions.ready(((e,s)=>{for(const e of s)this.overrideCommandMatcher(e)})),this.ChatInput.on("update",this.updateEmoteCompletion,this),this.ChatInput.on("mount",this.overrideChatInput,this),this.EmoteSuggestions.on("mount",this.overrideEmoteMatcher,this),this.MentionSuggestions.on("mount",this.overrideMentionMatcher,this),this.CommandSuggestions.on("mount",this.overrideCommandMatcher,this),this.chat.context.on("changed:chat.emotes.animated",this.uncacheTabCompletion,this),this.chat.context.on("changed:chat.emotes.enabled",this.uncacheTabCompletion,this),this.on("chat.emotes:change-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-set-hidden",this.uncacheTabCompletion,this),this.on("chat.emotes:change-favorite",this.uncacheTabCompletion,this),this.on("chat.emotes:update-default-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-user-sets",this.uncacheTabCompletion,this),this.on("chat.emotes:update-room-sets",this.uncacheTabCompletion,this),this.on("site.css_tweaks:update-chat-css",this.resizeInput,this)}uncacheTabCompletion(){for(const e of this.EmoteSuggestions.instances)e.ffz_ffz_cache=null,e.ffz_twitch_cache=null}updateInput(){for(const e of this.ChatInput.instances)e&&(e.forceUpdate(),this.emit("site:dom-update","chat-input",e))}resizeInput(){this._resize_waiter&&cancelAnimationFrame(this._resize_waiter),this._resize_waiter=requestAnimationFrame((()=>this._resizeInput()))}_resizeInput(){this._resize_waiter=null;for(const e of this.ChatInput.instances)e.resizeInput()}updateEmoteCompletion(e,s){s||(s=this.fine.searchTree(e,"tab-emote-suggestions",50)),s&&(s._ffz_user=e.props.sessionUser,s._ffz_channel_id=e.props.channelID,s._ffz_channel_login=e.props.channelLogin)}overrideChatInput(e){if(e._ffz_override)return;const s=this,n=e.onKeyDown,o=e.onMessageSend,a=e.resizeInput;e.resizeInput=function(n,...o){try{if(n){if(e.chatInputRef instanceof Element){const s=getComputedStyle(e.chatInputRef),n=s&&parseFloat(s.lineHeight||18)||18,o=1*n+20.5,a=Math.ceil((e.chatInputRef.scrollHeight-o)/n),u=Math.min(1+a,4);e.setState({numInputRows:u})}}else e.setState({numInputRows:1})}catch(e){return s.log.error("Error in resizeInput",e),a.call(this,n,...o)}},e.messageHistory=[],e.tempInput="",e.messageHistoryPos=-1,e.ffzGetValue=function(){return e.chatInputRef&&"string"==typeof e.chatInputRef.value?e.chatInputRef.value:e.state.value&&"string"==typeof e.state.value?e.state.value:""},e.ffzGetSelection=function(){var s,n,o;if("number"==typeof(null===(s=e.chatInputRef)||void 0===s?void 0:s.selectionEnd))return[e.chatInputRef.selectionStart,e.chatInputRef.selectionEnd];if(null!==(n=e.chatInputRef)&&void 0!==n&&null!==(o=n.state)&&void 0!==o&&o.slateEditor){var a,u;const s=e.chatInputRef.state.slateEditor,n=s.selection,o=s.children;if(null==n||null===(a=n.anchor)||void 0===a||!a.path||null==n||null===(u=n.focus)||void 0===u||!u.path)return[0,0];const f=getNodeOffset(o,n.anchor.path)+n.anchor.offset,g=getNodeOffset(o,n.focus.path)+n.focus.offset;return f<g?[f,g]:[g,f]}return[0,0]},e.ffzSetSelection=function(s,n){var o;null!==(o=e.chatInputRef)&&void 0!==o&&o.setSelectionRange&&e.chatInputRef.setSelectionRange(s,n)},e.onKeyDown=function(o){try{const n=o.charCode||o.keyCode;if(e.onEmotePickerToggle&&s.chat.context.get("chat.emote-menu.shortcut")&&"e"===o.key&&o.ctrlKey&&!o.altKey&&!o.shiftKey)return e.onEmotePickerToggle(),void o.preventDefault();const a=e.ffzGetValue();if(e.autocompleteInputRef&&e.chatInputRef&&s.chat.context.get("chat.mru.enabled")&&!o.shiftKey&&!o.ctrlKey&&!o.altKey){const s=e.ffzGetSelection();if(38===n&&0===s[0]&&0===s[1]){if(!e.messageHistory.length)return;return a&&-1===e.messageHistoryPos&&(e.tempInput=a),void(e.messageHistoryPos<e.messageHistory.length-1&&(e.messageHistoryPos++,e.autocompleteInputRef.setValue(e.messageHistory[e.messageHistoryPos]),e.ffzSetSelection(0)))}if(40===n&&s[0]>=a.length&&s[1]===s[0]){if(!e.messageHistory.length)return;return void(e.messageHistoryPos>0?(e.messageHistoryPos--,e.autocompleteInputRef.setValue(e.messageHistory[e.messageHistoryPos]),e.ffzSetSelection(e.messageHistory[e.messageHistoryPos].length)):0===e.messageHistoryPos&&(e.autocompleteInputRef.setValue(e.tempInput),e.ffzSetSelection(e.tempInput.length),e.messageHistoryPos=-1))}}n!==g.KEYS.Escape||o.shiftKey||o.ctrlKey||o.altKey||(e.props.isShowingEmotePicker?e.props.closeEmotePicker():!e.props.tray||e.state.value&&e.state.value.length||e.closeTray())}catch(e){s.log.capture(e),s.log.error(e)}n.call(this,o)},e.onMessageSend=function(n){try{if(s.chat.context.get("chat.mru.enabled")){const s=e.ffzGetValue();s&&s.length&&(e.messageHistory.length&&e.messageHistory[0]===s||(e.messageHistory.unshift(s),e.messageHistory=e.messageHistory.slice(0,20))),e.messageHistoryPos=-1,e.tempInput=""}}catch(e){s.log.capture(e),s.log.error(e)}o.call(this,n)}}overrideMentionMatcher(e){e.canBeTriggeredByTab=!this.chat.context.get("chat.tab-complete.emotes-without-colon")}overrideCommandMatcher(e){if(e._ffz_override)return;e._ffz_override=!0,e.oldCommands=e.getCommands;const s=this;e.getCommands=function(n){try{const a=e.props.getCommands(e.props.permissionLevel,{isEditor:e.props.isCurrentUserEditor}),f=new u.FFZEvent({input:n,permissionLevel:e.props.permissionLevel,isEditor:e.props.isCurrentUserEditor,commands:a});if(s.emit("chat:get-tab-commands",f),!a||!a.length)return null;const g=n.slice(1),_=a.filter((s=>e.doesCommandMatchTerm(s,g))).sort(e.sortCommands),b=[];for(const a of _){var o;const u=null===(o=a.commandArgs)||void 0===o?void 0:o[0];let f;null!=u&&u.isRequired&&(f=`[${u.name}]`),b.push({current:n,replacement:e.determineReplacement(a),element:e.renderCommandSuggestion(a,g),group:a.ffz_group?Array.isArray(a.ffz_group)?s.i18n.t(...a.ffz_group):a.ffz_group:e.determineGroup(a),selection:f})}return b}catch(s){return console.error(s),e.oldCommands(n)}}}overrideEmoteMatcher(e){if(e._ffz_override)return;const s=this;e.canBeTriggeredByTab=this.chat.context.get("chat.tab-complete.emotes-without-colon"),e.getMatches=function(s,n){return n?s.length<2?null:e.getMatchedEmotes(s):s.startsWith(":")?s.length<3?null:e.getMatchedEmotes(s):null},e.doesEmoteMatchTerm=function(e,s){const n=e.name||e.token;if(!n)return 0;if(n.startsWith(s))return 3;let o=e.tokenLower;o||(o=n.toLowerCase());const a=s.toLowerCase();if(o.startsWith(a))return 2;const u=n.indexOf(s.charAt(0).toUpperCase());return-1!==u&&o.slice(u+1).startsWith(a.slice(1))?1:0},e.getMatchedEmotes=function(e){const n=s.chat.context.get("chat.emotes.enabled"),o=s.chat.context.get("chat.tab-complete.limit-results");let a=n?s.getTwitchEmoteSuggestions(e,this):[];if(n>1&&s.chat.context.get("chat.tab-complete.ffz-emotes")){const n=s.getEmoteSuggestions(e,this);Array.isArray(n)&&n.length&&(a=a.concat(n))}if(s.chat.context.get("chat.tab-complete.emoji")){const n=s.getEmojiSuggestions(e,this);Array.isArray(n)&&n.length&&(a=Array.isArray(a)?a.concat(n):n)}return a=s.sortEmotes(a),o&&a.length>25?a.slice(0,25):a};const n=this.web_munch.getModule("react"),o=n&&n.createElement;e.renderFFZEmojiSuggestion=function(e){return o(n.Fragment,null,o("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:e.token,favorite:e.favorite},o("img",{class:"emote-autocomplete-provider__image ffz-emoji",src:e.src,srcSet:e.srcset}),e.favorite&&o("figure",{class:"ffz--favorite ffz-i-star"})),o("div",{class:"tw-ellipsis",title:e.token},e.token))},e.renderEmoteSuggestion=function(e){return o(n.Fragment,null,o("div",{class:"tw-relative tw-flex-shrink-0 tw-pd-05",title:e.token,favorite:e.favorite},o("img",{class:"emote-autocomplete-provider__image",srcSet:e.srcSet}),e.favorite&&o("figure",{class:"ffz--favorite ffz-i-star"})),o("div",{class:"tw-ellipsis",title:e.token},e.token))}}sortEmotes(e){const s=this.chat.context.get("chat.tab-complete.prioritize-favorites"),n=this.chat.context.get("chat.tab-complete.emotes-without-colon"),o=this.chat.context.get("chat.tab-complete.prioritize-prefix-matches");return e.sort(((e,a)=>{const u=e.matched||e.replacement,f=a.matched||a.replacement;if(s&&e.favorite^a.favorite)return 0-e.favorite+a.favorite;if(o){const s=!!e.matched,o=!!a.matched;if(s^o)return n?0-s+o:0-o+s;const g=3===e.match_type,_=3===a.match_type;if(g&&_)return b.compare(u,f);if(g)return-1;if(_)return 1;const k=2===e.match_type,x=2===a.match_type;return k&&x?v.compare(u,f):k?-1:x?1:b.compare(u,f)}return 0}))}buildTwitchCache(e){if(!Array.isArray(e))return{emotes:[],length:0};const s=[],n=this.chat.context.get("chat.emotes.animated")>0,o=this.settings.provider.get("emote-menu.hidden-sets"),a=Array.isArray(o)&&o.length>0,u=this.emotes.getHidden("twitch"),_=this.emotes.getFavorites("twitch");for(const b of e){const e=parseInt(b.id,10),v=b.owner,k=g.TWITCH_POINTS_SETS.includes(e)||"channel_points"===(null==v?void 0:v.login),x=k?null:v;let C=`twitch-set-${b.id}`,E=null;if(null!=x&&x.login?(C=`twitch-${x.id}`,E=x.displayName||x.login):C=k?"twitch-points":g.TWITCH_GLOBAL_SETS.includes(e)?"twitch-global":g.TWITCH_PRIME_SETS.includes(e)?"twitch-prime":"twitch-misc",!a||!o.includes(C))for(const e of b.emotes){if(!e||!e.id||u.includes(e.id))continue;const o=e.id,a=g.KNOWN_CODES[e.token]||e.token;if(!a)continue;const v=g.REPLACEMENTS[o];let k;k=v&&this.chat.context.get("chat.fix-bad-emotes")?`${g.REPLACEMENT_BASE}${v} 1x`:Object(f.getTwitchEmoteSrcSet)(o,n),s.push({id:o,source:C,extra:E,setID:b.id,token:a,tokenLower:a.toLowerCase(),srcSet:k,favorite:_.includes(o)})}}return{emotes:s,length:e.length}}getTwitchEmoteSuggestions(e,s){var n,o;(null===(n=s.ffz_twitch_cache)||void 0===n?void 0:n.length)!==(null===(o=s.props.emotes)||void 0===o?void 0:o.length)&&(s.ffz_twitch_cache=this.buildTwitchCache(s.props.emotes));const a=s.ffz_twitch_cache.emotes;if(!a.length)return[];const u=[],f=[],g=[],_=e.startsWith(":")?e.slice(1):e;for(const n of a){const o=s.doesEmoteMatchTerm(n,_);if(0!==o){const a={current:e,emote:n,replacement:n.token,element:s.renderEmoteSuggestion(n),favorite:n.favorite,count:this.EmoteUsageCount[n.token]||0,match_type:o};a.count>0?u.push(a):o>1?f.push(a):g.push(a)}}return u.sort(((e,s)=>s.count-e.count)),f.sort(((e,s)=>b.compare(e.replacement,s.replacement))),g.sort(((e,s)=>b.compare(e.replacement,s.replacement))),u.concat(f).concat(g)}getEmojiSuggestions(e,s){if(!e.startsWith(":"))return[];let n=e.slice(1).toLowerCase();const o=this.chat.context.get("chat.emoji.style"),a=this.settings.provider.get("emoji-tone",null),u=this.emotes.getFavorites("emoji"),f=[],g=n.endsWith(":");g&&(n=n.slice(0,-1));const _=new Set;for(const b in this.emoji.names)if(g?b===n:b.startsWith(n)){const n=this.emoji.emoji[this.emoji.names[b]],g=n.variants&&n.variants[a]||n;if(n&&(0===o||g.has[o])&&!_.has(g.raw)){_.add(g.raw);const a=this.emoji.getFullImageSet(g.image,o),v=`:${b}:`,k=u.includes(n.code);f.push({current:e,emoji:g,matched:v,srcSet:a,replacement:g.raw,element:s.renderFFZEmojiSuggestion({token:v,id:`emoji-${n.code}`,src:this.emoji.getFullImage(g.image,o),srcSet:a,favorite:k}),favorite:k})}}return f}buildFFZCache(e,s,n,o){const a=this.emotes.getSets(e,s,n,o);if(!a||!a.length)return{emotes:[],length:0,user_id:e,user_login:s,channel_id:n,channel_login:o};const u=[],f=this.chat.context.get("chat.emotes.animated")>0,g=this.settings.provider.get("emote-menu.hidden-sets"),_=Array.isArray(g)&&g.length>0,b=new Set;for(const e of a){if(!e||!e.emotes)continue;const s=e.source||"ffz",n=e.source_line||`${e.source||"FFZ"} ${e.title||"Global"}`,o=`${e.merge_source||s}-${e.merge_id||e.id}`;if(_&&g.includes(o))continue;const a=this.emotes.getHidden(s),v=this.emotes.getFavorites(s);for(const o of Object.values(e.emotes))!o||!o.id||o.hidden||a.includes(o.id)||b.has(o.name)||o.name&&(b.add(o.name),u.push({id:`${s}-${o.id}`,source:s,extra:n,token:o.name,tokenLower:o.name.toLowerCase(),srcSet:f&&o.animSrcSet||o.srcSet,favorite:v.includes(o.id)}))}return{emotes:u,length:a.length}}getEmoteSuggestions(e,s){const n=s._ffz_user,o=s._ffz_channel_id,a=s._ffz_channel_login;if(!a){const e=this.fine.searchParent(s,"chat-input",50);if(e&&this.updateEmoteCompletion(e,s),!a)return[]}let u=s.ffz_ffz_cache;u&&u.user_id===(null==n?void 0:n.id)&&u.user_login===(null==n?void 0:n.login)&&u.channel_id===o&&u.channel_login===a||(u=s.ffz_ffz_cache=this.buildFFZCache(null==n?void 0:n.id,null==n?void 0:n.login,o,a));const f=u.emotes;if(!f.length)return[];const g=e.startsWith(":")?e.slice(1):e,_=[];for(const n of f){const o=s.doesEmoteMatchTerm(n,g);0!==o&&_.push({current:e,emote:n,replacement:n.token,element:s.renderEmoteSuggestion(n),favorite:n.favorite,count:0,match_type:o})}return _}pasteMessage(e,s){for(const u of this.ChatInput.instances){var n,o,a;if((null==u||null===(n=u.props)||void 0===n?void 0:n.channelLogin)===e){if(!u.autocompleteInputRef||!u.state)return;u.state.value&&(s=`${u.state.value} ${s}`),u.autocompleteInputRef.setValue(s),null===(o=u.autocompleteInputRef.componentRef)||void 0===o||null===(a=o.focus)||void 0===a||a.call(o)}}}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return ViewerCards}));var o=n(4);class ViewerCards extends o.default{constructor(...e){super(...e),this.inject("chat"),this.inject("settings"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.last_login=null,this.settings.add("chat.viewer-cards.highlight-chat",{default:!1,ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight messages from users with open viewer cards.",component:"setting-check-box"}}),this.settings.add("chat.viewer-cards.color",{default:"",ui:{path:"Chat > Viewer Cards >> Appearance",title:"Highlight Color",component:"setting-color-box"}}),this.settings.add("chat.viewer-cards.use-color",{requires:["chat.viewer-cards.highlight-chat","chat.viewer-cards.color"],process(e){if(e.get("chat.viewer-cards.highlight-chat"))return e.get("chat.viewer-cards.color")}}),this.ViewerCard=this.fine.define("chat-viewer-card",(e=>{var s,n;return(null===(s=e.props)||void 0===s?void 0:s.targetLogin)&&(null===(n=e.props)||void 0===n?void 0:n.hideViewerCard)}))}onEnable(){this.chat.context.on("changed:chat.viewer-cards.highlight-chat",this.refreshStyle,this),this.chat.context.on("changed:chat.viewer-cards.color",this.refreshStyle,this),this.on("..:update-colors",this.refreshStyle,this),this.ViewerCard.on("mount",this.updateCard,this),this.ViewerCard.on("update",this.updateCard,this),this.ViewerCard.on("unmount",this.unmountCard,this)}refreshStyle(){this.updateStyle(this.last_login)}updateStyle(e){if("string"==typeof e&&(e=e.toLowerCase()),this.last_login=e,e&&this.chat.context.get("chat.viewer-cards.highlight-chat")){let s=this.chat.context.get("chat.viewer-cards.color");s=s&&s.length?this.parent.inverse_colors.process(s):this.chat.context.get("theme.is-dark")?"rgba(0,80,255,0.2)":"rgba(128,170,255,0.2)",this.css_tweaks.set("viewer-card-highlight",`body .chat-room .chat-line__message:not(.chat-line--inline):nth-child(1n+0)[data-user="${e}"] {\n\tbackground-color: ${s} !important;\n}`)}else this.css_tweaks.delete("viewer-card-highlight")}updateCard(e){this.updateStyle(e.props&&e.props.targetLogin)}unmountCard(){this.updateStyle()}}},function(e,s,n){"use strict";n.d(s,"a",(function(){return Game}));var o=n(4),a=n(1),u=n(0);class Game extends o.SiteModule{constructor(...e){super(...e),this.inject("site.fine"),this.inject("site.apollo"),this.inject("i18n"),this.inject("settings"),this.GameHeader=this.fine.define("game-header",(e=>e.props&&e.props.data&&e.getBannerImage&&e.getDirectoryCountAndTags),["dir-game-index","dir-community","dir-game-videos","dir-game-clips","dir-game-details"]),this.settings.addUI("directory.game.blocked-games",{path:'Directory > Categories @{"description": "Please note that due to limitations in Twitch\'s website, names here must be formatted exactly as displayed in your client. For best results, you can block or unblock categories directly from directory pages."} >> Blocked',component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()}),this.settings.addUI("directory.game.hidden-thumbnails",{path:"Directory > Categories >> Hidden Thumbnails",component:"game-list-editor",default:[],onUIChange:()=>this.parent.updateCards()})}onEnable(){this.GameHeader.on("mount",this.updateGameHeader,this),this.GameHeader.on("update",this.updateGameHeader,this),this.GameHeader.on("unmount",(()=>{this.settings.updateContext({category:null,categoryID:null})})),this.settings.provider.on("changed",(e=>{if("directory.game.blocked-games"===e||"directory.game.hidden-thumbnails"===e||"directory.game.blocked-tags"===e){this.parent.updateCards();for(const e of this.GameHeader.instances)this.updateGameHeader(e)}})),this.GameHeader.ready(((e,s)=>{for(const e of s)this.updateGameHeader(e)})),this.on("site.router:route",(e=>{e&&"dir-game-index"===e.name&&this.updateGameHeader()}))}updateGameHeader(e){var s,n;if(void 0===e){for(const e of this.GameHeader.instances)this.updateGameHeader(e);return}this.updateButtons(e);const o=null==e||null===(s=e.props)||void 0===s||null===(n=s.data)||void 0===n?void 0:n.game;this.settings.updateContext({category:null==o?void 0:o.name,categoryID:null==o?void 0:o.id})}updateButtons(e){const s=this.fine.getChildNode(e);if(null==Object(u.get)("data.game",e.props)||!s||!s.querySelector)return;const n=s.querySelector(".ffz-directory-buttons");n&&n.remove();const o=s.querySelector(".directory-header-new__info > div > div + div");if(!o)return;let f,g,_,b;const v=Object(u.get)("data.game.name",e.props)||e.props.directoryName,update_block=()=>{const e=this.settings.provider.get("directory.game.blocked-games",[]).includes(v);f.classList.toggle("active",e),g.textContent=e?this.i18n.t("directory.unblock","Unblock"):this.i18n.t("directory.block","Block")},update_hidden=()=>{const e=this.settings.provider.get("directory.game.hidden-thumbnails",[]).includes(v);_.classList.toggle("active",e),b.textContent=e?this.i18n.t("directory.show-thumbnails","Show Thumbnails"):this.i18n.t("directory.hide-thumbnails","Hide Thumbnails")};f=Object(a.createElement)("button",{class:"tw-mg-r-1 tw-button ffz-directory-toggle-block",onClick:this.generateClickHandler("directory.game.blocked-games",v,update_block)},g=Object(a.createElement)("span",{class:"tw-button__text"})),update_block(),_=Object(a.createElement)("button",{class:"tw-button ffz-directory-toggle-thumbnail",onClick:this.generateClickHandler("directory.game.hidden-thumbnails",v,update_hidden)},b=Object(a.createElement)("span",{class:"tw-button__text"})),update_hidden(),o.appendChild(Object(a.createElement)("div",{class:"tw-mg-t-1 ffz-directory-buttons"},f,_))}generateClickHandler(e,s,n){return o=>{o.preventDefault();const a=this.settings.provider.get(e)||[],u=a.indexOf(s);-1===u?a.push(s):a.splice(u,1),this.settings.provider.set(e,a),this.parent.updateCards(),n()}}}},function(e,s){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FFZ_FollowsList"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"logins"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"logins"},value:{kind:"Variable",name:{kind:"Name",value:"logins"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"login"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"profileImageURL"},arguments:[{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"IntValue",value:"50"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"self"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follower"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"disableNotifications"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:280}};n.loc.source={body:"query FFZ_FollowsList($logins: [String!]) {\n    users(logins: $logins) {\n        id\n\t\tlogin\n        displayName\n        profileImageURL(width: 50)\n        self {\n            follower {\n                disableNotifications\n                followedAt\n            }\n        }\n    }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function collectFragmentReferences(e,s){if("FragmentSpread"===e.kind)s.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&s.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,s)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,s)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,s)}))}var o={};function findOperation(e,s){for(var n=0;n<e.definitions.length;n++){var o=e.definitions[n];if(o.name&&o.name.value==s)return o}}!function extractReferences(){n.definitions.forEach((function(e){if(e.name){var s=new Set;collectFragmentReferences(e,s),o[e.name.value]=s}}))}(),e.exports=n,e.exports.FFZ_FollowsList=function oneQuery(e,s){var n={kind:e.kind,definitions:[findOperation(e,s)]};e.hasOwnProperty("loc")&&(n.loc=e.loc);var a=o[s]||new Set,u=new Set,f=new Set;for(a.forEach((function(e){f.add(e)}));f.size>0;){var g=f;f=new Set,g.forEach((function(e){u.has(e)||(u.add(e),(o[e]||new Set).forEach((function(e){f.add(e)})))}))}return u.forEach((function(s){var o=findOperation(e,s);o&&n.definitions.push(o)})),n}(n,"FFZ_FollowsList")},function(e,s){var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"targetID"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unfollowUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"targetID"},value:{kind:"Variable",name:{kind:"Name",value:"targetID"}}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"follow"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"followedAt"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:123}};n.loc.source={body:"mutation($targetID: ID!) {\n  unfollowUser(input: {\n    targetID: $targetID\n  }) {\n    follow {\n      followedAt\n    }\n  }\n}",name:"GraphQL request",locationOffset:{line:1,column:1}};function collectFragmentReferences(e,s){if("FragmentSpread"===e.kind)s.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&s.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){collectFragmentReferences(e,s)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){collectFragmentReferences(e,s)})),e.definitions&&e.definitions.forEach((function(e){collectFragmentReferences(e,s)}))}var o={};!function extractReferences(){n.definitions.forEach((function(e){if(e.name){var s=new Set;collectFragmentReferences(e,s),o[e.name.value]=s}}))}(),e.exports=n},function(e,s,n){e.exports=n.p+"color_normalizer.9cdaadee36fc4e061aa25e1e28c82067.css"},function(e,s,n){"use strict";var o=n(4),a=n(0);n(2);class Vue extends o.default{constructor(...e){super(...e),this._components={},this.inject("i18n")}async onLoad(){const e=window.ffzVue=this.Vue=(await n.e(162).then(n.bind(null,414))).default,s=this._components,[o,u,f]=await Promise.all([n.e(162).then(n.bind(null,415)),n.e(162).then(n.t.bind(null,416,7)),n.e(162).then(n.bind(null,418))]);this.component(f.default),e.use(o),e.mixin(u.mixin);for(const n in s)Object(a.has)(s,n)&&e.component(n,s[n]);this._components=null,e.use(this)}component(e,s){if("function"==typeof e)for(const s of e.keys())this.component(s.slice(2,s.length-4),e(s).default);else if("object"==typeof e)for(const s in e)Object(a.has)(e,s)&&this.component(s,e[s]);else this.Vue?this.Vue.component(e,s):this._components[e]=s}install(e){const s=this;this._vue_i18n||(this._vue_i18n=new this.Vue({data:()=>({locale:s.i18n.locale,phrases:{}}),methods:{tNumber_(e,n){return this.locale,s.i18n.formatNumber(e,n)},tDate_(e,n){return this.locale,s.i18n.formatDate(e,n)},tTime_(e,n){return this.locale,s.i18n.formatTime(e,n)},tDateTime_(e,n){return this.locale,s.i18n.formatDateTime(e,n)},t_(e,n,o){return this.locale&&this.phrases[e],s.i18n.t(e,n,o)},tList_(e,n,o){return this.locale&&this.phrases[e],s.i18n.tList(e,n,o)},tNode_(e,n){return this.locale,s.i18n.formatNode(e,n)},setLocale(e){s.i18n.locale=e}}}),this.on("i18n:transform",(()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}})),this.on("i18n:changed",(()=>{this._vue_i18n.locale=this.i18n.locale,this._vue_i18n.phrases={}})),this.on("i18n:loaded",(e=>{const s=this._vue_i18n,n=s.phrases;for(const o of e)s.$set(n,o,(n[o]||0)+1)})),e.prototype.$i18n=this._vue_i18n),e.component("t-list",{props:{tag:{required:!1},phrase:{type:String,required:!0},default:{type:String,required:!0},data:{type:Object,required:!1}},render(e){return e(this.tag||"span",this.$i18n.tList_(this.phrase,this.default,Object.assign({},this.data,this.$scopedSlots)).map((e=>"function"==typeof e?e():e)))}}),e.mixin({methods:{reactNavigate(e,n,o){const a=s.resolve("site.router");a&&a.history&&(n&&(n.preventDefault(),n.stopPropagation()),a.history.push(e,null!=o?o:void 0))},getReactURL:(e,n,o,...a)=>s.resolve("site.router").getURL(e,n,o,...a),getI18n:()=>s.i18n,t(e,s,n){return this.$i18n.t_(e,s,n)},tList(e,s,n){return this.$i18n.tList_(e,s,n)},tNode(e,s){return this.$i18n.tNode_(e,s)},tNumber(e,s){return this.$i18n.tNumber_(e,s)},tDate(e,s){return this.$i18n.tDate_(e,s)},tTime(e,s){return this.$i18n.tTime_(e,s)},tDateTime(e,s){return this.$i18n.tDateTime_(e,s)}}})}}s.a=Vue},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,s,n){"use strict";n.r(s);var o,a=n(20),u=n.n(a),f=n(46),g=n(4),_=n(0),b=n(2),v=n(61),k=n(82),x=n(83),C=n(67),E=n(310),z=n(16),j=n(327);class FrankerFaceZ extends g.default{constructor(){super();const e=performance.now();FrankerFaceZ.instance=this,this.host="twitch",this.flavor="main",this.name="frankerfacez",this.__state=0,this.__modules.core=this,this.__time("instance"),this.log=new f.default(null,null,null),this.log.init=!0,this.core_log=this.log.get("core"),this.log.hi(this),this.inject("settings",v.b),this.inject("experiments",x.a),this.inject("i18n",C.a),this.inject("socket",E.a),this.inject("site",z.a),this.inject("addons",k.a),this.register("vue",j.a),this.discoverModules().then((()=>this.enable())).then((()=>this.enableInitialModules())).then((()=>{const s=performance.now()-e;this.core_log.info(`Initialization complete in ${s.toFixed(5)}ms.`),this.log.init=!1})).catch((e=>{this.core_log.error("An error occurred during initialization.",e),this.log.init=!1}))}static get(){return FrankerFaceZ.instance}async generateLog(){const e=[];for(const s in this.__modules){const n=this.__modules[s];n instanceof g.default&&n.generateLog&&n!=this&&e.push((async()=>{try{return[s,await Object(_.timeout)(Promise.resolve(n.generateLog()),5e3)]}catch(e){return[s,`Error: ${e}`]}})())}const s=await Promise.all(e);if(this.log.captured_init&&this.log.captured_init.length>0){const e=[];for(const s of this.log.captured_init){const n=u()(s.time).locale("en").format("H:mm:ss");e.push(`[${n}] ${s.level} | ${s.category||"core"}: ${s.message}`)}s.unshift(["initialization",e.join("\n")])}return s.map((e=>`${e[0]}\n-------------------------------------------------------------------------------\n${"string"==typeof e[1]?e[1]:JSON.stringify(e[1],null,4)}`)).join("\n\n")}async discoverModules(){const e=await n(396),s=this.populate(e,this.core_log);this.core_log.info(`Loaded descriptions of ${Object.keys(s).length} modules.`)}async enableInitialModules(){const e=[];for(const s in this.__modules){const n=this.__modules[s];n instanceof g.default&&n.should_enable&&e.push(n.enable())}await Promise.all(e)}}FrankerFaceZ.Logger=f.default;const O=FrankerFaceZ.version_info={major:4,minor:32,revision:5,extra:(null===(o=Object({}))||void 0===o?void 0:o.length)&&Object({})[0],commit:"084a3ee5e06cd8d24b0b635853c7e24379889203",build:n.h,toString:()=>`${O.major}.${O.minor}.${O.revision}${O.extra||""}${b.DEBUG?"-dev":""}`};FrankerFaceZ.utilities={addon:n(115),color:n(11),constants:n(2),dialog:n(108),dom:n(1),events:n(7),fontAwesome:n(104),graphql:n(109),logging:n(46),module:n(4),object:n(0),time:n(10),tooltip:n(27),i18n:n(69),dayjs:n(20),filtering:n(17),popper:n(81)},window.FrankerFaceZ=FrankerFaceZ,window.ffz=new FrankerFaceZ},function(e,s,n){var o={"./bits_button.js":380,"./bttv_compat.js":381,"./channel.jsx":382,"./chat/index.js":142,"./compat_emote_menu.js":383,"./css_tweaks/index.js":384,"./dashboard.js":385,"./directory/index.jsx":386,"./featured_follow.js":387,"./host_button/index.js":388,"./layout.js":389,"./menu_button.jsx":390,"./mod-view.jsx":391,"./player.jsx":392,"./sub_button.jsx":393,"./theme/index.js":394,"./video_chat/index.jsx":395};function webpackContext(e){var s=webpackContextResolve(e);return n(s)}function webpackContextResolve(e){if(!n.o(o,e)){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}return o[e]}webpackContext.keys=function webpackContextKeys(){return Object.keys(o)},webpackContext.resolve=webpackContextResolve,e.exports=webpackContext,webpackContext.id=379},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return BitsButton}));var o=n(4);class BitsButton extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.settings.add("layout.display-bits-button",{requires:["chat.bits.show"],default:null,process:(e,s)=>null!=s?s:e.get("chat.bits.show"),ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the Get Bits button.",description:"By default, this inherits its value from [Chat > Bits and Cheering > Display Bits](~chat.bits_and_cheering)",component:"setting-check-box"},changed:()=>this.BitsButton.forceUpdate()}),this.BitsButton=this.fine.define("bits-button",(e=>e.toggleBalloon&&e.toggleShowTutorial))}onEnable(){this.BitsButton.ready((e=>{const s=this,n=e.prototype.render;e.prototype.render=function(){return s.settings.get("layout.display-bits-button")?n.call(this):null},this.BitsButton.forceUpdate()}))}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return BTTVCompat}));var o=n(0),a=n(4);const u=["chat-input"];class BTTVCompat extends a.default{constructor(...e){super(...e),this.inject("settings"),this.should_enable=!0}onEnable(){this.on("core:dom-update",this.handleDomUpdate,this),this.hookSettings()}awaitSettings(e=0){var s;return null!==(s=window.BetterTTV)&&void 0!==s&&s.settings?window.BetterTTV.settings:e>100?Promise.reject():Object(o.sleep)(50).then((()=>this.awaitSettings(e+1)))}async hookSettings(){const e=await this.awaitSettings(),waiter=()=>this.updateContext(e);if(e.on("changed.clickTwitchEmotes",waiter),e.on("changed.bttvGIFEmotes",waiter),waiter(),e.get("ffzEmotes")){if(this.settings.provider.get("bttv-ffz-notice"))return;const e=this.resolve("site.menu_button");e&&(e.addToast({icon:"ffz-i-zreknarf",text_i18n:"compat.bttv.emotes-on",text:'You have "FrankerFaceZ Emotes" turned on in BetterTTV\'s settings, but you also have FrankerFaceZ installed. Please disable "FrankerFaceZ Emotes" in BetterTTV\'s settings. It isn\'t necessary.'}),this.settings.provider.set("bttv-ffz-notice",!0))}}updateContext(e){this.settings.updateContext({bttv:{loaded:!0,emote_menu:e.get("clickTwitchEmotes"),gifs:e.get("bttvGIFEmotes")}})}handleDomUpdate(e){var s,n;if(null!==(s=window.BetterTTV)&&void 0!==s&&null!==(n=s.watcher)&&void 0!==n&&n.emitLoad&&u.includes(e)){this.log.info("Sending chat reload event to BetterTTV.");try{window.BetterTTV.watcher.emitLoad("chat")}catch(e){this.log.error("An error occurred with BetterTTV:",e)}}}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return Channel}));var o=n(4),a=n(11),u=n(0),f=n(1);const g=["user","user-home","user-about","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"];class Channel extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.apollo"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.inject("site.subpump"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.settings.add("channel.panel-tips",{default:!1,ui:{path:"Channel > Behavior >> Panels",title:"Display rich tool-tips for links in channel panels.",component:"setting-check-box"},changed:e=>{this.updatePanelTips(),this.css_tweaks.toggle("panel-links",e)}}),this.settings.add("channel.auto-skip-trailer",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically skip channel trailers.",component:"setting-check-box"},changed:e=>{e&&this.ChannelTrailer.each((e=>this.maybeSkipTrailer(e)))}}),this.settings.add("channel.auto-click-chat",{default:!1,ui:{path:"Channel > Behavior >> General",title:"Automatically open chat when opening an offline channel page.",component:"setting-check-box"}}),this.settings.add("channel.extra-links",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Add extra links to live channel pages, next to the streamer's name.",component:"setting-check-box"},changed:()=>this.updateLinks()}),this.settings.add("channel.hosting.enable",{default:!0,ui:{path:"Channel > Behavior >> Hosting",title:"Enable Channel Hosting",component:"setting-check-box"},changed:e=>!e&&this.InfoBar.each((e=>this.updateBar(e)))}),this.ChannelPanels=this.fine.define("channel-panels",(e=>e.layoutMasonry&&e.updatePanelOrder&&e.onExtensionPoppedOut),g),this.ChannelTrailer=this.elemental.define("channel-trailer",".channel-trailer-player__wrapper",g,{attributes:!0},1),this.ChannelRoot=this.elemental.define("channel-root",".channel-root",g,{attributes:!0},1),this.InfoBar=this.elemental.define("channel-info-bar",".channel-info-content",g,{childNodes:!0,subtree:!0},1);const strip_host=e=>{var s,n;if(this.settings.get("channel.hosting.enable"))return;const o=null==e||null===(s=e.data)||void 0===s?void 0:s.user;o&&(o.hosting=null);const a=null==e||null===(n=e.data)||void 0===n?void 0:n.userOrError;a&&(a.hosting=null)};this.apollo.registerModifier("UseHosting",strip_host,!1),this.apollo.registerModifier("PlayerTrackingContextQuery",strip_host,!1)}onEnable(){this.updateChannelColor(),this.css_tweaks.toggle("panel-links",this.settings.get("channel.panel-tips")),this.on("i18n:update",this.updateLinks,this),this.ChannelTrailer.on("mount",this.maybeSkipTrailer,this),this.ChannelTrailer.on("update",this.maybeSkipTrailer,this),this.ChannelTrailer.each((e=>this.maybeSkipTrailer(e))),this.ChannelPanels.on("mount",this.updatePanelTips,this),this.ChannelPanels.on("update",this.updatePanelTips,this),this.ChannelPanels.on("unmount",this.removePanelTips,this),this.ChannelPanels.ready(((e,s)=>{for(const e of s)this.updatePanelTips(e)})),this.ChannelRoot.on("mount",this.updateRoot,this),this.ChannelRoot.on("mutate",this.updateRoot,this),this.ChannelRoot.on("unmount",this.removeRoot,this),this.ChannelRoot.each((e=>this.updateRoot(e))),this.InfoBar.on("mount",this.updateBar,this),this.InfoBar.on("mutate",this.updateBar,this),this.InfoBar.on("unmount",this.removeBar,this),this.InfoBar.each((e=>this.updateBar(e))),this.subpump.on(":pubsub-message",this.onPubSub,this),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}maybeSkipTrailer(e){if(!this.settings.get("channel.auto-skip-trailer"))return;const s=this.fine.searchParent(e,(e=>e.props&&e.props.onDismiss));s&&(this.log.info("Automatically skipping channel trailer."),s.props.onDismiss())}updatePanelTips(e){if(!e){for(const e of this.ChannelPanels.instances)e&&this.updatePanelTips(e);return}const s=this.fine.getChildNode(e);if(!s||!this.settings.get("channel.panel-tips"))return this.removePanelTips(e);if(e._ffz_tips&&e._ffz_tip_el!==s&&this.removePanelTips(e),!e._ffz_tips){const n=this.resolve("tooltips");n&&(e._ffz_tips=n._createInstance(s,"ffz-link","link",n.getRoot()),e._ffz_tip_el=s)}}removePanelTips(e){null!=e&&e._ffz_tips&&(e._ffz_tips.destroy(),e._ffz_tips=null,e._ffz_tip_el=null)}checkNavigation(){this.settings.get("channel.auto-click-chat")&&"user-home"===this.router.current_name&&this.router.old_location!==this.router.location&&this.router.history.replace(this.router.location,{channelView:"Watch"})}updateLinks(){for(const e of this.InfoBar.instances)e._ffz_link_login=null,this.updateBar(e)}setHost(e,s,n,o){const a=`stream-chat-room-v1.${e}`;this.subpump.inject(a,{type:"host_target_change",data:{channel_id:e,channel_login:s,target_channel_id:n||null,target_channel_login:o||null,previous_target_channel_id:null,num_viewers:0}}),this.subpump.inject(a,{type:"host_target_change_v2",data:{channel_id:e,channel_login:s,target_channel_id:n||null,target_channel_login:o||null,previous_target_channel_id:null,num_viewers:0}})}onPubSub(e){if("stream-chat-room-v1"!==e.prefix||this.settings.get("channel.hosting.enable"))return;const s=e.message.type;"host_target_change"!==s&&"host_target_change_v2"!==s||(this.log.info("Nulling Host Target Change",s),e.message.data.target_channel_id=null,e.message.data.target_channel_login=null,e.message.data.previous_target_channel_id=null,e.message.data.num_viewers=0,e.markChanged())}updateSubscription(e){this._subbed_login!==e&&(this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),e&&(this.socket.subscribe(this,`channel.${e}`),this._subbed_login=e))}updateBar(e){e._ffz_update||(e._ffz_update=Object(u.debounce)((()=>requestAnimationFrame((()=>this._updateBar(e)))),1e3,2)),e._ffz_update()}_updateBar(e){var s,n,o,a,u,g,_,b,v,k,x;e._ffz_cont&&!document.contains(e._ffz_cont)&&(e._ffz_cont.classList.remove("ffz--meta-tray"),e._ffz_cont=null);const C=this.settings.get("channel.extra-links");if(!e._ffz_links||document.contains(e._ffz_links)&&C||(e._ffz_links.remove(),e._ffz_links=null,e._ffz_link_login=null),!e._ffz_cont){const s=e.querySelector('.report-button,button[data-test-selector="video-options-button"],button[data-test-selector="clip-options-button"],button[data-a-target="report-button-more-button"]');let n=s&&(s.closest(".tw-flex-wrap.tw-justify-content-end")||s.closest(".tw-justify-content-end"));var E,z;if(!n&&s)n=null===(E=s.parentElement)||void 0===E?void 0:E.parentElement,n&&2===(null===(z=n.parentElement)||void 0===z?void 0:z.childElementCount)&&"report-button-more-button"!==s.dataset.aTarget&&(n=n.parentElement.firstElementChild);n&&e.contains(n)?(e._ffz_cont=n,n.classList.add("ffz--meta-tray")):e._ffz_cont=null}if(!e._ffz_links&&C){const s=e.querySelector("a .tw-title"),n=s&&s.closest("a"),o=n&&n.closest("div");o&&e.contains(o)&&(e._ffz_links=Object(f.createElement)("div",{class:"ffz--links tw-mg-l-1"}),o.appendChild(e._ffz_links))}const j=this.fine.getReactInstance(e);let O=null==j||null===(s=j.child)||void 0===s?void 0:s.memoizedProps;null!==(n=O)&&void 0!==n&&n.channelLogin||(O=null===(o=O)||void 0===o||null===(a=o.children)||void 0===a?void 0:a.props);const A=null===(u=O)||void 0===u||null===(g=u.watchPartyProps)||void 0===g?void 0:g.isShowingWatchPartyInMain;if(this.settings.updateContext({isWatchParty:A}),!e._ffz_cont||null===(_=O)||void 0===_||!_.channelID)return void this.updateSubscription(null);if(e._ffz_links&&O.channelLogin!==e._ffz_link_login){const s=e._ffz_link_login=O.channelLogin;if(s){const make_link=(e,s)=>{const n=Object(f.createElement)("a",{href:e,class:"tw-c-text-alt-2 tw-interactive tw-pd-x-1 tw-font-size-5"},s);return n.addEventListener("click",(s=>{if(s.ctrlKey||s.shiftKey||s.altKey)return;const n=this.router.history;n&&(s.preventDefault(),n.push(e))})),n};e._ffz_links.closest(".home-header-sticky")?e._ffz_links.innerHTML="":Object(f.setChildren)(e._ffz_links,[make_link(`/${s}/schedule`,this.i18n.t("channel.links.schedule","Schedule")),make_link(`/${s}/videos`,this.i18n.t("channel.links.videos","Videos")),make_link(`/${s}/clips`,this.i18n.t("channel.links.clips","Clips"))])}else e._ffz_links.innerHTML=""}let T=null;this.fine.searchNode(j,(e=>{let s=null==e?void 0:e.memoizedState,n=0;for(;null!=s&&null==T&&n<50;){var o,a,u,f,g,_,b,v,k;s=null===(o=s)||void 0===o?void 0:o.next,T=null===(a=s)||void 0===a||null===(u=a.memoizedState)||void 0===u||null===(f=u.current)||void 0===f||null===(g=f.previous)||void 0===g||null===(_=g.result)||void 0===_||null===(b=_.data)||void 0===b?void 0:b.user,null!==(v=T)&&void 0!==v&&null!==(k=v.lastBroadcast)&&void 0!==k&&k.game||(T=null),n++}return null!=T}));const D=null===(b=T)||void 0===b||null===(v=b.lastBroadcast)||void 0===v?void 0:v.game,B=null===(k=T)||void 0===k||null===(x=k.lastBroadcast)||void 0===x?void 0:x.title;(null==D?void 0:D.id)===e._ffz_game_cache&&B===e._ffz_title_cache||this.settings.updateContext({category:null==D?void 0:D.displayName,categoryID:null==D?void 0:D.id,title:B}),!this.settings.get("channel.hosting.enable")&&O.hostLogin&&this.setHost(O.channelID,O.channelLogin,null,null),this.updateSubscription(O.channelLogin),this.updateMetadata(e)}removeBar(e){if(this.updateSubscription(null),e._ffz_cont&&e._ffz_cont.classList.remove("ffz--meta-tray"),e._ffz_cont=null,e._ffz_meta_timers){for(const s of Object.values(e._ffz_meta_timers))clearTimeout(s);e._ffz_meta_timers=null}e._ffz_update=null}updateMetadata(e,s){var n,o,a;const u=e._ffz_cont,f=this.fine.getReactInstance(e);let g=null==f||null===(n=f.memoizedProps)||void 0===n||null===(o=n.children)||void 0===o?void 0:o.props;if(g&&!g.channelID&&(g=null===(a=g.children)||void 0===a?void 0:a.props),!(u&&document.contains(u)&&g&&g.channelID))return;s?Array.isArray(s)||(s=[s]):s=this.metadata.keys;const _=e._ffz_meta_timers=e._ffz_meta_timers||{},refresh_fn=s=>this.updateMetadata(e,s),b={channel:{id:g.channelID,login:g.channelLogin,display_name:g.displayName,live:g.isLive&&!g.videoID&&!g.clipSlug,video:!(!g.videoID&&!g.clipSlug),live_since:g.liveSince},props:g,hosted:{login:g.hostLogin,display_name:g.hostDisplayName},el:e,getViewerCount:()=>{var e;const s=u.querySelector('p[data-a-target="animated-channel-viewers-count"]'),n=s&&this.fine.getReactInstance(s),o=null==n||null===(e=n.memoizedProps)||void 0===e?void 0:e.children;if("string"==typeof o&&/^[0-9,.]+$/.test(o))try{const e=parseInt(o.replace(/,/,""),10);if(!isNaN(e)&&isFinite(e)&&e>0)return e}catch(e){}const a=null==o?void 0:o.props;return a&&null!=a.value?a.value:0},getUserSelfImmediate:s=>{const n=this.getUserSelf(e,g.channelID,!0);return n&&n.then?(n.then(s),null):n},getUserSelf:()=>this.getUserSelf(e,g.channelID),getBroadcastID:()=>this.getBroadcastID(e,g.channelID)};for(const e of s)this.metadata.renderLegacy(e,b,u,_,refresh_fn)}updateRoot(e){let s=null,n=this.fine.getReactInstance(e),o=0,a=0;for(;null!=n&&null==s&&o<10;){var u,f;let e=null===(u=n)||void 0===u?void 0:u.memoizedState;for(a=0;null!=e&&null==s&&a<50;){var g,_,b,v,k,x,C,E,z,j,O,A,T;e=null===(g=e)||void 0===g?void 0:g.next,s=null===(_=e)||void 0===_||null===(b=_.memoizedState)||void 0===b||null===(v=b.current)||void 0===v||null===(k=v.currentObservable)||void 0===k||null===(x=k.lastResult)||void 0===x||null===(C=x.data)||void 0===C?void 0:C.userOrError,s||(s=null===(E=e)||void 0===E||null===(z=E.memoizedState)||void 0===z||null===(j=z.current)||void 0===j||null===(O=j.previous)||void 0===O||null===(A=O.result)||void 0===A||null===(T=A.previousData)||void 0===T?void 0:T.userOrError),a++}n=null===(f=n)||void 0===f?void 0:f.return,o++}s&&s.id?(this.updateChannelColor(s.primaryColorHex),this.settings.updateContext({channel:s.login,channelID:s.id,channelColor:s.primaryColorHex})):this.removeRoot()}removeRoot(){this.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateChannelColor(e){let s=e&&a.Color.RGBA.fromHex(e);s||(s=a.Color.RGBA.fromHex("9147FF")),s?(this.css_tweaks.setVariable("channel-color",s.toCSS()),this.css_tweaks.setVariable("channel-color-20",s._a(.2).toCSS()),this.css_tweaks.setVariable("channel-color-30",s._a(.3).toCSS())):(this.css_tweaks.deleteVariable("channel-color"),this.css_tweaks.deleteVariable("channel-color-20"),this.css_tweaks.deleteVariable("channel-color-30"))}getUserSelf(e,s,n){const o=e._ffz_self_cache=e._ffz_self_cache||{};return s===o.channel_id&&Date.now()-o.saved<6e4?n?o.data:Promise.resolve(o.data):new Promise((async(e,n)=>{if(o.updating)return void o.updating.push([e,n]);let a,u;o.channel_id=s,o.updating=[[e,n]];try{a=await this.twitch_data.getUserSelf(s)}catch(e){a=null,u=e}const f=o.updating;if(o.updating=null,o.channel_id===s){o.data=a,o.saved=Date.now();for(const e of f)u?e[1](u):e[0](a)}else{u=new Error("Outdated"),o.channel_id=null,o.data=null,o.saved=0;for(const e of f)e[1](u)}}))}getBroadcastID(e,s){const n=e._ffz_bcast_cache=e._ffz_bcast_cache||{};return s===n.channel_id&&Date.now()-n.saved<6e4?Promise.resolve(n.broadcast_id):new Promise((async(e,o)=>{if(n.updating)return void n.updating.push([e,o]);let a,u;n.channel_id=s,n.updating=[[e,o]];try{a=await this.twitch_data.getBroadcastID(s)}catch(e){a=null,u=e}const f=n.updating;if(n.updating=null,n.channel_id===s){n.broadcast_id=a,n.saved=Date.now();for(const e of f)u?e[1](u):e[0](a)}else{u=new Error("Outdated"),n.channel_id=null,n.broadcast_id=null,n.saved=0;for(const e of f)e[1](u)}}))}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return CompatEmoteMenu}));var o=n(4),a=n(0);class CompatEmoteMenu extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("site.chat"),this.inject("chat.emotes")}onEnable(){this.hookEmoteMenu()}async hookEmoteMenu(){const e=await this.findEmoteMenu();if(!e)return this.log.info("Emote Menu for Twitch was not found after 60 seconds.");e.registerEmoteGetter("FrankerFaceZ",(()=>{var e,s;const n=this.chat.ChatContainer.first,o=n&&n.props;if(!o)return;const u=this.emotes.getSets(o.userID,o.currentUserLogin,o.channelID,o.channelLogin),f=this.resolve("chat"),g=(null===(e=(null==f?void 0:f.context)||this.settings)||void 0===e||null===(s=e.get)||void 0===s?void 0:s.call(e,"chat.emotes.animated"))>0,_=[];for(const e of u)if(e&&e.emotes)for(const s in e.emotes)if(Object(a.has)(e.emotes,s)){var b;const n=e.emotes[s];if(n.hidden)continue;_.push({text:n.name,url:g&&(null===(b=n.animated)||void 0===b?void 0:b[1])||n.urls[1],channel:`${e.source||"FrankerFaceZ"} ${e.title}`,badge:e.icon||"//cdn.frankerfacez.com/script/devicon.png"})}return _}))}async findEmoteMenu(e=0){return window.emoteMenu&&emoteMenu.registerEmoteGetter?emoteMenu:e>=6e4?null:(await Object(a.sleep)(100),this.findEmoteMenu(e+100))}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return CSSTweaks}));var o=n(4),a=n(1),u=n(0),f=n(29);const g=document.createElement("span"),_={"top-discover":'.navigation-link[data-a-target="discover-link"]',"side-nav":".side-nav,#sideNav","side-nav-viewers":".side-nav-card__live-status","side-rec-channels":".side-nav .recommended-channels,.side-nav .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-friends":".side-nav .online-friends","side-closed-friends":".side-nav--collapsed .online-friends","side-closed-rec-channels":".side-nav--collapsed .recommended-channels,.side-nav--collapsed .side-nav-section + .side-nav-section:not(.online-friends):not(.bd--shelf)","side-offline-channels":".ffz--side-nav-card-offline","side-rerun-channels":".side-nav .ffz--side-nav-card-rerun","modview-hide-info":".modview-player-widget__hide-stream-info","community-highlights":".community-highlight-stack__card","prime-offers":".top-nav__prime","discover-luna":'.top-nav__external-link[data-a-target="try-presto-link"]',"player-gain-volume":'.video-player__container[data-compressed="true"] .volume-slider__slider-container:not(.ffz--player-gain)',"player-ext":".video-player .extension-taskbar,.video-player .extension-container,.video-player .extensions-dock__layout,.video-player .extensions-notifications,.video-player .extensions-video-overlay-size-container,.video-player .extensions-dock__layout","player-ext-hover":'.video-player__container[data-controls="false"] .extension-taskbar,.video-player__container[data-controls="false"] .extension-container,.video-player__container[data-controls="false"] .extensions-dock__layout,.video-player__container[data-controls="false"] .extensions-notifications,.video-player__container[data-controls="false"] .extensions-video-overlay-size-container',"player-event-bar":".channel-root .live-event-banner-ui__header","player-rerun-bar":'.channel-root__player-container div.tw-c-text-overlay:not([data-a-target="hosting-ui-header"])',"pinned-cheer":".pinned-cheer,.pinned-cheer-v2,.channel-leaderboard",whispers:'body .whispers-open-threads,.tw-core-button[data-a-target="whisper-box-button"],.whispers__pill',"dir-live-ind":'.live-channel-card[data-ffz-type="live"] .tw-channel-status-text-indicator, article[data-ffz-type="live"] .tw-channel-status-text-indicator',"profile-hover":".preview-card .tw-relative:hover .ffz-channel-avatar","not-live-bar":'div[data-test-selector="non-live-video-banner-layout"]',"channel-live-ind":".channel-header__user .tw-channel-status-text-indicator,.channel-info-content .tw-halo__indicator",celebration:"body .celebration__overlay","mod-view":'.chat-input__buttons-container a[href*="/moderator"]'};class CSSTweaks extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.style=new a.ManagedStyle,this.chunks={},this.chunks_loaded=!1,this.settings.add("metadata.modview.hide-info",{default:!1,ui:{path:"Channel > Metadata >> Mod View",title:'Hide "Hide Stream Info Stripe" button.',component:"setting-check-box"},changed:e=>this.toggleHide("modview-hide-info",e)}),this.settings.add("metadata.viewers.no-native",{requires:["metadata.viewers"],default:null,process:(e,s)=>null==s?e.get("metadata.viewers"):s,changed:e=>this.toggle("hide-native-viewers",e),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Viewer Count.",description:"By default, this is enabled whenever FFZ's own Viewer Count display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("metadata.uptime.no-native",{requires:["metadata.uptime"],default:null,process:(e,s)=>null==s?0!==e.get("metadata.uptime"):s,changed:e=>this.toggle("hide-native-uptime",e),ui:{path:"Channel > Metadata >> Player",title:"Hide Twitch's native Stream Uptime.",description:"By default, this is enabled whenever FFZ's own Stream Uptime display is enabled to avoid redundant information.",component:"setting-check-box"}}),this.settings.add("layout.use-chat-fix",{requires:["context.force_chat_fix","layout.swap-sidebars","layout.use-portrait","chat.use-width","context.isWatchParty"],process:e=>!e.get("context.isWatchParty")&&(e.get("context.force_chat_fix")||e.get("layout.swap-sidebars")||e.get("layout.use-portrait")||e.get("chat.use-width")),changed:e=>{e?this.toggle("chat-no-animate",!0):e||this._no_anim_timer||(this._no_anim_timer=requestAnimationFrame((()=>{this._no_anim_timer=null,this.settings.get("layout.use-chat-fix")||this.toggle("chat-no-animate",!1)}))),this.toggle("chat-fix",e),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.show",{default:1,requires:["layout.use-portrait"],process:(e,s)=>2===s?!e.get("layout.use-portrait"):s,ui:{sort:-1,path:"Appearance > Layout >> Side Navigation",title:"Display Side Navigation",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"Hide in Portrait"}]},changed:e=>{this.toggle("hide-side-nav",!e),this.emit("site.layout:resize")}}),this.settings.add("layout.side-nav.hide-viewers",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Channel View Counts",component:"setting-check-box"},changed:e=>this.toggleHide("side-nav-viewers",e)}),this.settings.add("layout.side-nav.show-avatars",{default:!0,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Channel Avatars",component:"setting-check-box"},changed:e=>this.toggle("hide-side-nav-avatars",!e)}),this.settings.add("layout.side-nav.show-rec-channels",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Recommended / Popular Channels",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:e=>{this.toggleHide("side-rec-channels",0===e),this.toggleHide("side-closed-rec-channels",2===e)}}),this.settings.add("layout.side-nav.show-friends",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Online Friends",component:"setting-select-box",data:[{value:0,title:"Never"},{value:1,title:"Always"},{value:2,title:"When Side Navigation is Open"}]},changed:e=>{this.toggleHide("side-friends",0===e),this.toggleHide("side-closed-friends",2===e)}}),this.settings.add("layout.side-nav.hide-offline",{default:!1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Hide Offline Channels",component:"setting-check-box"},changed:e=>this.toggleHide("side-offline-channels",e)}),this.settings.add("layout.side-nav.rerun-style",{default:1,ui:{path:"Appearance > Layout >> Side Navigation",title:"Display Reruns",component:"setting-select-box",data:[{value:0,title:"Do Not Display"},{value:1,title:"Normally"},{value:2,title:"Faded (33% Opacity)"}]},changed:e=>{this.toggleHide("side-rerun-channels",0===e),this.toggle("side-rerun-opacity",2===e)}}),this.settings.add("layout.swap-sidebars",{default:!1,requires:["context.isWatchParty"],process:(e,s)=>!e.get("context.isWatchParty")&&s,ui:{path:"Appearance > Layout >> Side Navigation",title:"Swap Sidebars",description:"Swap navigation and chat to the opposite sides of the window.",component:"setting-check-box"},changed:e=>{this.toggle("swap-sidebars",e),this.emit("site.layout:resize")}}),this.settings.add("layout.minimal-navigation",{requires:["layout.theatre-navigation","context.isWatchParty"],default:!1,process:(e,s)=>!e.get("context.isWatchParty")&&(!!e.get("layout.theatre-navigation")||s),ui:{path:"Appearance > Layout >> Top Navigation",title:"Minimize Navigation",description:"Slide the site navigation bar up out of view when it isn't in use.",component:"setting-check-box"},changed:e=>{this.toggle("minimal-navigation",e),this.emit("site.layout:resize")}}),this.settings.add("layout.theatre-navigation",{requires:["context.ui.theatreModeEnabled"],default:!1,process:(e,s)=>!!e.get("context.ui.theatreModeEnabled")&&s,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show the minimized navigation bar when in theatre mode.",component:"setting-check-box"},changed:e=>{this.toggle("theatre-nav",e),this.emit("site.layout:resize")}}),this.settings.add("layout.discover",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show Discover link.",component:"setting-check-box"},changed:e=>{this.toggleHide("top-discover",!e),this.updateTopNav()}}),this.settings.add("layout.prime-offers",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Show Prime Gaming Loot.",component:"setting-check-box"},changed:e=>this.toggleHide("prime-offers",!e)}),this.settings.add("layout.hide-discover-luna",{default:!1,ui:{path:"Appearance > Layout >> Top Navigation",title:'Hide the "Discover Luna" link.',component:"setting-check-box"},changed:e=>this.toggleHide("discover-luna",e)}),this.settings.add("whispers.show",{default:!0,ui:{path:"Chat > Whispers >> General",title:"Display Whispers",component:"setting-check-box"},changed:e=>{this.toggleHide("whispers",!e),this.emit("site.layout:resize")}}),this.settings.add("chat.bits.show",{default:!0,ui:{order:-1,path:"Chat > Bits and Cheering >> Appearance",title:"Display Bits",description:"Display UI associated with bits. Note: This will not hide cheering in chat messages.",component:"setting-check-box"},changed:e=>this.toggle("hide-bits",!e)}),this.settings.add("channel.show-celebrations",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow Celebrations to appear.",description:"Celebrations are animations that cover the entire Twitch page.",component:"setting-check-box"},changed:e=>this.toggleHide("celebration",!e)}),this.settings.add("layout.theme.global-font",{default:"",ui:{path:"Appearance > Theme >> Fonts",title:"Font Family",description:'Override the font used for the entire Twitch website. The old default font was: `"Helvetica Neue",Helvetica,Arial,sans-serif`\n\nAny font available via [Google Fonts](https://fonts.google.com/) can be loaded by prefixing the font name with `google:`.',component:"setting-combo-box",data:()=>Object(f.a)()},changed:()=>this.updateFont()}),this.settings.add("channel.hide-unfollow",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Unfollow button.",component:"setting-check-box"},changed:e=>this.toggle("hide-unfollow-button",e)}),this.settings.add("channel.hide-live-indicator",{requires:["context.route.name"],process:(e,s)=>("user"===e.get("context.route.name")||"user-home"===e.get("context.route.name"))&&s,default:!1,ui:{path:"Channel > Appearance >> General",title:'Hide the "LIVE" indicator on live channel pages.',component:"setting-check-box"},changed:e=>this.toggleHide("channel-live-ind",e)}),this.settings.add("channel.round-avatars",{default:!0,ui:{path:"Channel > Appearance >> General",title:"Allow avatar images to be rounded.",component:"setting-check-box"},changed:e=>this.toggle("square-avatars",!e)})}onEnable(){this.toggleHide("modview-hide-info",this.settings.get("metadata.modview.hide-info")),this.toggleHide("side-nav-viewers",this.settings.get("layout.side-nav.hide-viewers")),this.toggle("hide-native-uptime",this.settings.get("metadata.uptime.no-native")),this.toggle("hide-native-viewers",this.settings.get("metadata.viewers.no-native")),this.toggle("chat-fix",this.settings.get("layout.use-chat-fix")),this.toggle("swap-sidebars",this.settings.get("layout.swap-sidebars")),this.toggle("minimal-navigation",this.settings.get("layout.minimal-navigation")),this.toggle("theatre-nav",this.settings.get("layout.theatre-navigation")),this.toggle("hide-side-nav-avatars",!this.settings.get("layout.side-nav.show-avatars")),this.toggle("hide-side-nav",!this.settings.get("layout.side-nav.show")),this.toggleHide("side-offline-channels",this.settings.get("layout.side-nav.hide-offline")),this.toggleHide("discover-luna",this.settings.get("layout.hide-discover-luna")),this.toggleHide("prime-offers",!this.settings.get("layout.prime-offers")),this.toggleHide("top-discover",!this.settings.get("layout.discover")),this.toggle("hide-unfollow-button",this.settings.get("channel.hide-unfollow")),this.toggle("square-avatars",!this.settings.get("channel.round-avatars")),this.toggleHide("channel-live-ind",this.settings.get("channel.hide-live-indicator"));const e=this.settings.get("layout.side-nav.rerun-style");this.toggleHide("side-rerun-channels",0===e),this.toggle("side-rerun-opacity",2===e);const s=this.settings.get("layout.side-nav.show-rec-channels");this.toggleHide("side-rec-channels",0===s),this.toggleHide("side-closed-rec-channels",2===s);const n=this.settings.get("layout.side-nav.show-friends");this.toggleHide("side-friends",0===n),this.toggleHide("side-closed-friends",2===n),this.toggleHide("whispers",!this.settings.get("whispers.show")),this.toggleHide("celebration",!this.settings.get("channel.show-celebrations")),this.updateFont(),this.updateTopNav(),this.emit("site.player:fix-player"),this.emit("site.layout:resize")}updateTopNav(){requestAnimationFrame((()=>this.emit("site.layout:update-nav")))}updateFont(){let e=this.settings.get("layout.theme.global-font");if(e&&e.length){const[s,n]=Object(f.b)(e);if(e=s,this._font_unloader&&this._font_unloader(),this._font_unloader=n,-1!==e.indexOf(" ")&&-1===e.indexOf(",")&&-1===e.indexOf('"')&&-1===e.indexOf("'")&&(e=`"${e}"`),g.style.fontFamily="",g.style.fontFamily=e,g.style.fontFamily)return this.setVariable("global-font",e),void this.toggle("global-font",!0)}this.toggle("global-font",!1),this.deleteVariable("global-font")}toggleHide(e,s){const n=`hide--${e}`;if(s){if(!Object(u.has)(_,e))throw new Error(`cannot find class for "${e}"`);this.style.set(n,`${_[e]} { display: none !important }`)}else this.style.delete(n)}async toggle(e,s){if(s){if(this.chunks_loaded||await this.populate(),!Object(u.has)(this.chunks,e))throw new Error(`cannot find chunk "${e}"`);this.style.set(e,this.chunks[e])}else this.style.delete(e)}set(e,s){return this.style.set(e,s)}delete(e){return this.style.delete(e)}setVariable(e,s,n="body"){this.style.set(`var--${e}`,`${n} { --ffz-${e}: ${s}; }`)}deleteVariable(e){this.style.delete(`var--${e}`)}populate(){if(!this.chunks_loaded)return new Promise((async e=>{const s=(await n.e(159).then(n.bind(null,407))).default;for(const e of s.keys()){const n=e.slice(2,e.length-(e.endsWith(".scss")?5:4));this.chunks[n]=s(e).default}this.emit("site.layout:resize"),this.chunks_loaded=!0,e()}))}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return Dashboard}));var o=n(4),a=n(0),u=n(16);class Dashboard extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.channel"),this.SunlightBroadcast=this.fine.define("sunlight-bcast",(e=>{var s;return e.getGame&&e.getTitle&&(null===(s=e.props)||void 0===s?void 0:s.data)}),u.a.SUNLIGHT_ROUTES),this.SunlightManager=this.fine.define("sunlight-manager",(e=>{var s;return(null===(s=e.props)||void 0===s?void 0:s.channelID)&&e.props.channelLogin&&Object(a.has)(e.props,"hostedChannel")}),u.a.SUNLIGHT_ROUTES)}onEnable(){this.SunlightManager.on("mount",this.updateSunlight,this),this.SunlightManager.on("update",this.updateSunlight,this),this.SunlightManager.on("unmount",this.removeSunlight,this),this.SunlightManager.ready(((e,s)=>{for(const e of s)this.updateSunlight(e)})),this.SunlightBroadcast.on("mount",this.updateBroadcast,this),this.SunlightBroadcast.on("update",this.updateBroadcast,this),this.SunlightBroadcast.on("unmount",this.removeBroadcast,this),this.SunlightBroadcast.ready(((e,s)=>{for(const e of s)this.updateBroadcast(e)}))}updateSunlight(e){var s,n;this.settings.updateContext({channel:Object(a.get)("props.channelLogin",e),channelID:Object(a.get)("props.channelID",e),hosting:!(null===(s=e.props)||void 0===s||null===(n=s.hostedChannel)||void 0===n||!n.id)})}removeSunlight(){this.settings.updateContext({channel:null,channelID:null,hosting:!1})}updateBroadcast(e){var s,n,o;const a=null===(s=e.props)||void 0===s||null===(n=s.data)||void 0===n||null===(o=n.user)||void 0===o?void 0:o.broadcastSettings,u=null==a?void 0:a.game;this.settings.updateContext({category:null==u?void 0:u.name,categoryID:null==u?void 0:u.id,title:null==a?void 0:a.title})}removeBroadcast(){this.settings.updateContext({category:null,categoryID:null,title:null})}}},function(e,s,n){"use strict";n.r(s),n.d(s,"CARD_CONTEXTS",(function(){return _})),n.d(s,"default",(function(){return Directory}));var o=n(4),a=n(10),u=n(1),f=n(0),g=n(323);const _=((e={})=>(e[e.SingleGameList=1]="SingleGameList",e[e.SingleChannelList=2]="SingleChannelList",e[e.MixedGameAndChannelList=3]="MixedGameAndChannelList",e))(),b=["front-page","dir","dir-community","dir-community-index","dir-creative","dir-following","dir-game-index","dir-game-clips","dir-game-videos","dir-all","dir-category","user-videos","user-clips"];class Directory extends o.SiteModule{constructor(...e){super(...e),this.should_enable=!0,this.inject("site.elemental"),this.inject("site.fine"),this.inject("site.router"),this.inject("site.css_tweaks"),this.inject("site.twitch_data"),this.inject("i18n"),this.inject("settings"),this.inject(g.a),this.DirectoryCard=this.elemental.define("directory-card",'article[data-a-target^="followed-vod-"],article[data-a-target^="card-"],div[data-a-target^="video-tower-card-"] article,div[data-a-target^="clips-card-"] article,.shelf-card__impression-wrapper article,.tw-tower div article',b,null,0,0),this.DirectoryGameCard=this.elemental.define("directory-game-card",".game-card[data-a-id]",b,null,0,0),this.DirectoryShelf=this.fine.define("directory-shelf",(e=>e.shouldRenderNode&&e.props&&e.props.shelf),b),this.settings.add("directory.hidden.style",{default:2,ui:{path:'Directory > Categories >> Hidden Thumbnail Style @{"sort": 100}',title:"Hidden Style",component:"setting-select-box",sort:100,data:[{value:0,title:"Replace Image"},{value:1,title:"Replace Image and Blur Title"},{value:2,title:"Blur Image"},{value:3,title:"Blur Image and Title"}]},changed:e=>{this.css_tweaks.toggle("dir-no-blur",e<2),this.css_tweaks.toggle("dir-blur-title",1===e||3===e)}}),this.settings.add("directory.hidden.reveal",{default:!1,ui:{path:"Directory > Categories >> Hidden Thumbnail Style",title:"Reveal hidden entries on mouse hover.",component:"setting-check-box",sort:101},changed:e=>this.css_tweaks.toggle("dir-reveal",e)}),this.settings.add("directory.uptime",{default:1,ui:{path:"Directory > Channels >> Appearance",title:"Stream Uptime",description:"Display the stream uptime on the channel cards.",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.updateCards()}),this.settings.add("directory.hide-live",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show the Live indicator on channels that are live.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggleHide("dir-live-ind",e)}),this.settings.add("directory.hide-promoted",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show Promoted streams in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-vodcasts",{default:!1,ui:{path:"Directory > Channels >> Appearance",title:"Do not show reruns in the directory.",component:"setting-check-box"},changed:()=>this.updateCards()}),this.settings.add("directory.hide-recommended",{default:!1,ui:{path:"Directory > Following >> Categories",title:"Do not show `Recommended Live Channels` in the Following Directory.",component:"setting-check-box"},changed:()=>this.DirectoryShelf.forceUpdate()}),this.routeClick=this.routeClick.bind(this)}onEnable(){this.css_tweaks.toggleHide("profile-hover",2===this.settings.get("directory.show-channel-avatars")),this.css_tweaks.toggleHide("dir-live-ind",this.settings.get("directory.hide-live")),this.css_tweaks.toggle("dir-reveal",this.settings.get("directory.hidden.reveal"));const e=this.settings.get("directory.hidden.style");this.css_tweaks.toggle("dir-no-blur",e<2),this.css_tweaks.toggle("dir-blur-title",1===e||3===e),this.on("i18n:update",(()=>this.updateCards())),this.DirectoryCard.on("mount",this.updateCard,this),this.DirectoryCard.on("mutate",this.updateCard,this),this.DirectoryCard.on("unmount",this.clearCard,this),this.DirectoryCard.each((e=>this.updateCard(e))),this.DirectoryGameCard.on("mount",this.updateGameCard,this),this.DirectoryGameCard.on("mutate",this.updateGameCard,this),this.DirectoryGameCard.each((e=>this.updateGameCard(e)));const s=this;this.DirectoryShelf.ready((e=>{const n=e.prototype.shouldRenderNode;e.prototype.shouldRenderNode=function(e,...o){try{let n;if("Game"===e.__typename?n=e.name:e.game&&(n=e.game.name),n&&s.settings.provider.get("directory.game.blocked-games",[]).includes(n))return!1}catch(e){s.log.capture(e),s.log.error(e)}return n.call(this,e,...o)};const o=e.prototype.render;e.prototype.render=function(){try{if(s.settings.get("directory.hide-recommended")){if("live_recs_following"===Object(f.get)("props.shelf.title.key",this))return null}}catch(e){s.log.capture(e)}return o.call(this)},this.DirectoryShelf.forceUpdate()}))}updateGameCard(e){var s,n,o;const a=this.fine.getReactInstance(e);if(!a)return;const u=null===(s=a.return)||void 0===s?void 0:s.memoizedProps;if(null==u||null===(n=u.trackingProps)||void 0===n||!n.category)return;const f=u.trackingProps.category,g=null===(o=u.tagListProps)||void 0===o?void 0:o.tags;let _=!1;if(Array.isArray(g)){const e=this.settings.provider.get("directory.game.blocked-tags",[]);if(e.length)for(const s of g)if(null!=s&&s.id&&e.includes(s.id)){_=!0;break}}const b=_||this.settings.provider.get("directory.game.blocked-games",[]).includes(f);let v=e.closest(".tw-tower > div");v||(v=e),v.querySelectorAll('a[data-a-target="tw-box-art-card-link"]').length<2&&v.classList.toggle("tw-hide",b)}updateCard(e){var s,n,o,a,u,f,g,b,v,k,x,C,E,z;const j=this.fine.getReactInstance(e);if(!j)return;let O=null===(s=j.child)||void 0===s?void 0:s.memoizedProps;if(null!==(n=O)&&void 0!==n&&n.channelLogin||(O=null===(o=j.return)||void 0===o||null===(a=o.stateNode)||void 0===a?void 0:a.props),null!==(u=O)&&void 0!==u&&u.channelLogin||(O=null===(f=j.return)||void 0===f||null===(g=f.return)||void 0===g||null===(b=g.return)||void 0===b?void 0:b.memoizedProps),null===(v=O)||void 0===v||!v.channelLogin)return;const A=O.gameTitle||(null===(k=O.trackingProps)||void 0===k?void 0:k.categoryName)||(null===(x=O.trackingProps)||void 0===x?void 0:x.category)||(null===(C=O.contextualCardActionProps)||void 0===C||null===(E=C.props)||void 0===E?void 0:E.categoryName),T=null===(z=O.tagListProps)||void 0===z?void 0:z.tags;let D=!1;if(e.classList.toggle("ffz-hide-thumbnail",this.settings.provider.get("directory.game.hidden-thumbnails",[]).includes(A)),e.dataset.ffzType=O.streamType,Array.isArray(T)){const e=this.settings.provider.get("directory.game.blocked-tags",[]);if(e.length)for(const s of T)if(null!=s&&s.id&&e.includes(s.id)){D=!0;break}}const B=D||"rerun"===O.streamType&&this.settings.get("directory.hide-vodcasts")||null!=O.context&&O.context!==_.SingleGameList&&this.settings.provider.get("directory.game.blocked-games",[]).includes(A)||(O.isPromotion||"COMMUNITY_BOOST"===O.sourceType||"PROMOTION"===O.sourceType||"SPONSORED"===O.sourceType)&&this.settings.get("directory.hide-promoted");let P=e.closest(".tw-tower > div");P||(P=e),P.querySelectorAll('a[data-a-target="preview-card-image-link"]').length<2&&P.classList.toggle("tw-hide",B),this.updateUptime(e,O)}updateCards(){this.DirectoryCard.each((e=>this.updateCard(e))),this.DirectoryGameCard.each((e=>this.updateGameCard(e))),this.DirectoryShelf.forceUpdate(),this.emit(":update-cards")}clearCard(e){this.clearUptime(e)}updateUptime(e,s){if(!document.contains(e))return this.clearUptime(e);const n=e.querySelector('a[data-a-target="preview-card-image-link"] > div'),o=this.settings.get("directory.uptime");if(!n||0===o||s.viewCount||s.animatedImageProps)return this.clearUptime(e);let f=s.createdAt;var g;f||(void 0===e.ffz_stream_meta&&(e.ffz_stream_meta=null,this.twitch_data.getStreamMeta(null,s.channelLogin).then((n=>{e.ffz_stream_meta=n,this.updateUptime(e,s)}))),f=null===(g=e.ffz_stream_meta)||void 0===g?void 0:g.createdAt);const _=f&&new Date(f),b=_&&Math.floor((Date.now()-_)/1e3)||0;if(b<1)return this.clearUptime(e);const v=Object(a.duration_to_string)(b,!1,!1,!1,1===o);return e.ffz_uptime_el||(e.ffz_uptime_el=n.querySelector(".ffz-uptime-element"),e.ffz_uptime_el||n.appendChild(e.ffz_uptime_el=Object(u.createElement)("div",{class:"ffz-uptime-element tw-absolute tw-right-0 tw-top-0 tw-mg-1"},Object(u.createElement)("div",{class:"tw-relative ffz-il-tooltip__container"},Object(u.createElement)("div",{class:"tw-border-radius-small tw-c-background-overlay tw-c-text-overlay tw-flex tw-pd-x-05"},Object(u.createElement)("div",{class:"tw-flex tw-c-text-live"},Object(u.createElement)("figure",{class:"ffz-i-clock"})),e.ffz_uptime_span=Object(u.createElement)("p",null)),Object(u.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-right"},this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),e.ffz_uptime_tt=Object(u.createElement)("div",{class:"tw-pd-t-05"})))))),e.ffz_uptime_span||(e.ffz_uptime_span=e.ffz_uptime_el.querySelector("p")),e.ffz_uptime_span?(e.ffz_uptime_tt||(e.ffz_uptime_tt=e.ffz_uptime_el.querySelector(".ffz-il-tooltip > div")),e.ffz_uptime_tt?(e.ffz_update_timer||(e.ffz_update_timer=setInterval(this.updateUptime.bind(this,e,s),1e3)),e.ffz_uptime_span.textContent=v,void(e.ffz_last_created_at!==f&&(e.ffz_uptime_tt.textContent=this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:_}),e.ffz_last_created_at=f))):this.clearUptime(e)):this.clearUptime(e)}clearUptime(e){e.ffz_update_timer&&(clearInterval(e.ffz_update_timer),e.ffz_update_timer=null),e.ffz_uptime_el&&(e.ffz_uptime_el.remove(),e.ffz_uptime_el=null,e.ffz_uptime_span=null,e.ffz_uptime_tt=null,e.ffz_last_created_at=null)}routeClick(e,s){if(e.preventDefault(),e.stopPropagation(),!s){const n=e.currentTarget;if(n){const e=n.dataset;e&&e.href?s=e.href:n.href&&(s=n.href)}}s&&this.router.history.push(s)}hijackUserClick(e,s,n=null){e.preventDefault(),e.stopPropagation(),n&&n(e,s),this.router.navigate("user",{userName:s})}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return FeaturedFollow}));var o=n(4),a=n(1),u=n(0),f=n(324),g=n.n(f),_=n(144),b=n.n(_),v=n(325),k=n.n(v);class FeaturedFollow extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("site"),this.inject("site.fine"),this.inject("site.apollo"),this.inject("i18n"),this.inject("metadata"),this.inject("settings"),this.inject("socket"),this.inject("site.router"),this.inject("chat"),this.settings.add("metadata.featured-follow",{default:!0,ui:{path:"Channel > Metadata >> Player",title:"Featured Follow",description:"Show a featured follow button with the currently featured users.",component:"setting-check-box"},changed:()=>{this.metadata.updateMetadata("following")}}),this.follow_data={},this.socket.on(":command:follow_buttons",(e=>{for(const s in e)Object(u.has)(e,s)&&(this.follow_data[s]=e[s]);this.vueFeaturedFollow&&(this.vueFeaturedFollow.data.hasUpdate=!0),this.metadata.updateMetadata("following")}))}onEnable(){this.metadata.definitions.following={order:150,button:!0,modview:!0,popup:async(e,s,o,a)=>{const u=this.resolve("vue"),f=n.e(6).then(n.bind(null,408)),g=this.getFollowsForLogin(e.channel.login),[,_,b]=await Promise.all([u.enable(),f,g]);return this._featured_follow_tip=s,s.element.classList.remove("tw-pd-1"),s.element.classList.add("ffz-balloon--lg"),u.component("featured-follow",_.default),this.buildFeaturedFollowMenu(u,e.channel.login,b,a)},label:e=>{if(!(this.settings.get("metadata.featured-follow")&&e&&e.channel&&e.channel.login))return null;const s=this.follow_data[e.channel.login];return s&&Object.keys(s).length||this.vueFeaturedFollow&&this.vueFeaturedFollow.data.hasUpdate?this.i18n.t("metadata.featured-follow.button.featured","Featured"):null},icon:"ffz-i-heart"},this.metadata.updateMetadata("following")}async getFollowsForLogin(e){const s=this.follow_data&&this.follow_data[e];if(!s||!s.length)return[];const n=await this.apollo.client.query({query:g.a,variables:{logins:s}}),o={};for(const e of n.data.users){var a,u;e&&e.id&&(o[e.id]={loading:!1,error:!1,id:e.id,login:e.login,displayName:e.displayName,avatar:e.profileImageURL,following:null!=(null===(a=e.self.follower)||void 0===a?void 0:a.followedAt),disableNotifications:null===(u=e.self.follower)||void 0===u?void 0:u.disableNotifications})}return o}buildFeaturedFollowMenu(e,s,n,o){const u=new e.Vue({el:Object(a.createElement)("div"),render:e=>this.vueFeaturedFollow=e("featured-follow",{login:s,follows:n,hasUpdate:!1,followUser:e=>this.followUser(n,e),unfollowUser:e=>this.unfollowUser(n,e),updateNotificationStatus:(e,s)=>this.updateNotificationStatus(n,e,s),refresh:async()=>{this.vueFeaturedFollow&&this.vueFeaturedFollow.data.hasUpdate&&(this.vueFeaturedFollow.data.follows=await this.getFollowsForLogin(s),this.vueFeaturedFollow.data.hasUpdate=!1,this._featured_follow_tip.update(),0===this.vueFeaturedFollow.data.follows.length&&this.metadata.updateMetadata("following"))},route:e=>this.route(e)})});return o((()=>{this.vueFeaturedFollow=null})),u.$el}async followUser(e,s){const n=e[s];n.loading=!0;try{const e=(await this.apollo.client.mutate({mutation:b.a,variables:{targetID:s,disableNotifications:!1}})).data.followUser.follow;n.loading=!1,n.following=null!=e.followedAt,n.disableNotifications=e.disableNotifications}catch(e){this.log.warn("There was a problem following.",e),n.error=!0}}async updateNotificationStatus(e,s,n){const o=e[s];o.loading=!0,o.disableNotifications=!n;try{const e=(await this.apollo.client.mutate({mutation:b.a,variables:{targetID:s,disableNotifications:!n}})).data.followUser.follow;o.loading=!1,o.following=null!=e.followedAt,o.disableNotifications=e.disableNotifications}catch(e){this.log.warn("There was a problem updating notification status.",e),o.error=!0}}async unfollowUser(e,s){const n=e[s];n.loading=!0;try{await this.apollo.client.mutate({mutation:k.a,variables:{targetID:s}}),n.loading=!1,n.following=!1,n.disableNotifications=!1}catch(e){this.log.warn("There was a problem unfollowing.",e),n.error=!0}}route(e){this.router.navigate("user",{userName:e})}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return HostButton}));var o=n(4),a=n(0),u=n(1);const f={key:"command-execution",text:"There was an error executing the host command. Please try again later."},g={key:"chat-connection",text:"There was an issue connecting to chat. Please try again later."};class HostButton extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("site"),this.inject("site.fine"),this.inject("site.chat"),this.inject("site.twitch_data"),this.inject("i18n"),this.inject("metadata"),this.inject("settings"),this.settings.add("metadata.host-button",{default:!0,ui:{path:"Channel > Metadata >> Player",title:"Host Button",description:"Show a host button with the current hosted channel in the tooltip.",component:"setting-check-box"},changed:()=>{const e=this.site.getUser(),s=e&&e.login;s&&this.joinChannel(s),this.metadata.updateMetadata("host")}})}isChannelHosted(e){return this._last_hosted_channel===e}sendHostUnhostCommand(e){if(!this._chat_con)return this._host_error=g,void(this._host_updating=!1);const s=this.site.getUser(),n={channel:s&&s.login,username:e};this._host_updating=!0,this.metadata.updateMetadata("host"),this._host_feedback=setTimeout((()=>{null===this._last_hosted_channel&&(this._host_error=f,this._host_updating=!1,this.metadata.updateMetadata("host"))}),3e3),this.isChannelHosted(e)?this._chat_con.commands.unhost.execute(n):this._chat_con.commands.host.execute(n)}joinChannel(e){this._chat_con&&this.settings.get("metadata.host-button")&&!this._chat_con.session.channelstate[`#${e}`]&&this._chat_con.joinChannel(e)}hookIntoChatConnection(e){const s=e.props.currentUserLogin;if(this._chat_con)return void this.joinChannel(s);this.on("tmi:host",(e=>{e.channel.substring(1)===s&&(clearTimeout(this._host_feedback),this._host_error=!1,this._last_hosted_channel=e.target,this._host_updating=!1,this.metadata.updateMetadata("host"))})),this.on("tmi:unhost",(e=>{e.channel.substring(1)===s&&(clearTimeout(this._host_feedback),this._host_error=!1,this._last_hosted_channel=null,this._host_updating=!1,this.metadata.updateMetadata("host"))}));const n=e.client;this._chat_con=n,this.settings.get("metadata.host-button")&&this.joinChannel(s)}onEnable(){this.on("i18n:update",(()=>this.metadata.updateMetadata("host"))),this.metadata.definitions.host={order:150,border:!0,button:!0,fade_in:!0,modview:!0,disabled:()=>this._host_updating||this._host_error,click:e=>{e.channel&&this.sendHostUnhostCommand(e.channel.login)},popup:async(e,s)=>{const o=this.resolve("vue"),a=n.e(7).then(n.bind(null,409)),u=this.fetchAutoHosts(),f=this.fetchAutoHostSettings(),[,g,_,b]=await Promise.all([o.enable(),a,u,f]);return this._auto_host_tip=s,s.element.classList.remove("tw-pd-1"),s.element.classList.add("ffz-balloon--lg"),o.component("host-options",g.default),this.buildAutoHostMenu(o,_,b,e.channel)},label:e=>{const s=this.site.getUser();if(this.settings.get("metadata.host-button")&&s&&e.channel&&e.channel.login!==s.login&&(!e.channel.video||this.isChannelHosted(e.channel.login)))return this._host_updating?this.i18n.t("metadata.host-button.updating","Updating..."):this._last_hosted_channel&&this.isChannelHosted(e.channel&&e.channel.login)?this.i18n.t("metadata.host-button.unhost","Unhost"):this.i18n.t("metadata.host-button.host","Host")},tooltip:()=>this._host_error?this.i18n.t(`metadata.host-button.tooltip.error.${this._host_error.key}`,this._host_error.text):this.i18n.t("metadata.host-button.tooltip","Currently hosting: {channel}",{channel:this._last_hosted_channel||this.i18n.t("metadata.host-button.tooltip.none","None")})},this.metadata.updateMetadata("host"),this.chat.ChatService.ready(((e,s)=>{for(const e of s)this.hookIntoChatConnection(e)})),this.chat.ChatService.on("mount",this.hookIntoChatConnection,this)}buildAutoHostMenu(e,s,n,o){this._current_channel_id=o.id,this.activeTab=this.activeTab||"auto-host";return new e.Vue({el:Object(u.createElement)("div"),render:e=>this.vueHostMenu=e("host-options",{hosts:s,autoHostSettings:n,activeTab:this.activeTab,addedToHosts:this.currentRoomInHosts(),addToAutoHosts:()=>this.addCurrentRoomToHosts(),rearrangeHosts:e=>this.rearrangeHosts(e.oldIndex,e.newIndex),removeFromHosts:e=>this.removeUserFromHosts(e),setActiveTab:e=>{this.vueHostMenu.data.activeTab=this.activeTab=e},updatePopper:()=>{this._auto_host_tip&&this._auto_host_tip.update()},updateCheckbox:e=>{const s=e.target;let n=s.dataset.setting,o=s.checked;"enabled"===n?n="isEnabled":"teamHost"===n?n="willAutohostTeam":"strategy"===n?o=o?"RANDOM":"ORDERED":"deprioritizeVodcast"===n&&(n="willPrioritizeAutohost"),this.updateAutoHostSetting(n,o)}})}).$el}async fetchAutoHosts(){const e=this.site.getUser();if(!e)return;const s=await this.twitch_data.queryApollo(await n.e(7).then(n.t.bind(null,410,7)),{id:e.id},{fetchPolicy:"network-only"});return this.autoHosts=Object(a.get)("data.user.autohostChannels.nodes",s)}async fetchAutoHostSettings(){const e=this.site.getUser();if(!e)return;const s=await this.twitch_data.queryApollo(await n.e(7).then(n.t.bind(null,411,7)),{id:e.id},{fetchPolicy:"network-only"});return this.autoHostSettings=Object(a.get)("data.user.autohostSettings",s)}queueHostUpdate(){this._host_update_timer&&clearTimeout(this._host_update_timer),this._host_update_timer=setTimeout((()=>{this._host_update_timer=void 0,this.updateAutoHosts(this.autoHosts)}),1e3)}rearrangeHosts(e,s){const n=this.autoHosts.splice(e,1)[0];this.autoHosts.splice(s,0,n),this.queueHostUpdate()}currentRoomInHosts(){return this.getAutoHostIDs(this.autoHosts).includes(this._current_channel_id)}addCurrentRoomToHosts(){const e=this.autoHosts.slice(0);e.push({id:this._current_channel_id}),this.updateAutoHosts(e)}removeUserFromHosts(e){const s=e.target.closest(".ffz--host-user").dataset.id,n=[];for(let e=0;e<this.autoHosts.length;e++)this.autoHosts[e].id!=s&&n.push(this.autoHosts[e]);this.updateAutoHosts(n)}getAutoHostIDs(e){const s=[];if(e)for(let n=0;n<e.length;n++)s.push(e[n].id);return s}async updateAutoHosts(e){const s=this.site.getUser();if(!s)return;const o=this.getAutoHostIDs(e),u=await this.twitch_data.mutate({mutation:await n.e(7).then(n.t.bind(null,412,7)),variables:{userID:s.id,channelIDs:o}});this.autoHosts=Object(a.get)("data.setAutohostChannels.user.autohostChannels.nodes",u),this.vueHostMenu&&(this.vueHostMenu.data.hosts=this.autoHosts,this.vueHostMenu.data.addedToHosts=this.currentRoomInHosts())}async updateAutoHostSetting(e,s){const o=this.site.getUser();if(!o)return;const u=await this.twitch_data.mutate({mutation:await n.e(7).then(n.t.bind(null,413,7)),variables:{userID:o.id,[e]:s}});this.autoHostSettings=Object(a.get)("data.updateAutohostSettings.user.autohostSettings",u),this.vueHostMenu&&(this.vueHostMenu.data.autoHostSettings=this.autoHostSettings)}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return Layout}));var o=n(2),a=n(4),u=n(0);const f=["user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following"],g=["popout","embed-chat","dash-chat"];class Layout extends a.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("settings"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.elemental"),this.ResizeDetector=this.fine.define("resize-detector",(e=>e.maybeDebounceOnScroll&&e.setGrowDivRef&&e.props.onResize)),this.SideBar=this.elemental.define("sidebar",".side-bar-contents",null,{childNodes:!0,subtree:!0},1),this.settings.add("clips.layout.big",{default:!1,ui:{path:"Appearance > Layout >> Clips",title:"Allow the player to get larger on `clips.twitch.tv` pages.",description:"This only affects windows at least 1,200 pixels wide and attempts to make the player and chat replay as large as possible.",component:"setting-check-box"}}),this.settings.add("layout.portrait",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"Enable Portrait Mode",description:"In Portrait Mode, chat will be displayed beneath the player when the window is taller than it is wide.",component:"setting-check-box"}}),this.settings.add("layout.portrait-invert",{default:!1,ui:{path:"Appearance > Layout >> Channel",title:"When in portrait mode, place chat at the top.",component:"setting-check-box"},changed:e=>document.body.classList.toggle("ffz--portrait-invert",e)}),this.settings.add("layout.portrait-threshold",{default:1.25,ui:{path:"Appearance > Layout >> Channel",title:"Portrait Mode Threshold",description:"This is the Width to Height ratio at which point Portrait Mode will begin to activate.",component:"setting-text-box",process:e=>(e=parseFloat(e,10),isNaN(e)||!isFinite(e)||e<=0?1.25:e)}}),this.settings.add("layout.portrait-min-chat",{default:!1,requires:["layout.use-portrait"],process:(e,s)=>!!e.get("layout.use-portrait")&&s,ui:{path:"Appearance > Layout >> Channel",title:"Use compact chat in Portrait Mode.",description:"When enabled, this minimizes the chat header and places the chat input box in line with the chat buttons in order to present a more compact chat able to display more lines with limited vertical space.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("portrait-chat",e)}),this.settings.add("layout.use-portrait",{requires:["layout.portrait","layout.portrait-threshold","context.route.name","context.size","context.isWatchParty"],process(e){if(e.get("context.isWatchParty"))return!1;const s=e.get("context.size");if(!s||!e.get("layout.portrait")||!f.includes(e.get("context.route.name")))return!1;return s.width/s.height<=e.get("layout.portrait-threshold")},changed:()=>this.updatePortraitMode()}),this.settings.add("layout.inject-portrait",{requires:["layout.use-portrait","context.ui.rightColumnExpanded"],process:e=>e.get("layout.use-portrait")&&e.get("context.ui.rightColumnExpanded"),changed:e=>this.css_tweaks.toggle("portrait",e)}),this.settings.add("layout.use-portrait-swapped",{requires:["layout.inject-portrait","layout.swap-sidebars"],process:e=>e.get("layout.inject-portrait")&&e.get("layout.swap-sidebars"),changed:e=>this.css_tweaks.toggle("portrait-swapped",e)}),this.settings.add("layout.use-portrait-meta",{requires:["layout.inject-portrait","player.theatre.metadata"],process:e=>e.get("layout.inject-portrait")&&e.get("player.theatre.metadata"),changed:e=>this.css_tweaks.toggle("portrait-metadata",e)}),this.settings.add("layout.use-portrait-meta-top",{requires:["layout.use-portrait-meta","layout.portrait-invert"],process:e=>e.get("layout.use-portrait-meta")&&!e.get("layout.portrait-invert"),changed:e=>this.css_tweaks.toggle("portrait-metadata-top",e)}),this.settings.add("layout.show-portrait-chat",{requires:["layout.use-portrait","layout.portrait-extra-height","layout.portrait-extra-width"],process:()=>!0,changed:()=>this.updatePortraitMode()}),this.settings.add("layout.portrait-extra-height",{requires:["context.new_channel","context.squad_bar","context.hosting","context.ui.theatreModeEnabled","player.theatre.no-whispers","whispers.show","layout.minimal-navigation"],process(e){let s=0;return e.get("context.ui.theatreModeEnabled")?(e.get("layout.minimal-navigation")&&(s+=1),e.get("whispers.show")&&!e.get("player.theatre.no-whispers")&&(s+=4)):(s=e.get("layout.minimal-navigation")?1:5,e.get("whispers.show")&&(s+=4),e.get("context.squad_bar")&&(s+=6),s+=e.get("context.new_channel")?1:5,e.get("context.hosting")&&(s+=4)),s},changed:e=>this.css_tweaks.setVariable("portrait-extra-height",`${e}rem`)}),this.settings.add("layout.portrait-extra-width",{require:["layout.side-nav.show","context.ui.theatreModeEnabled","context.ui.sideNavExpanded"],process:e=>!e.get("layout.side-nav.show")||e.get("context.ui.theatreModeEnabled")?0:e.get("context.ui.sideNavExpanded")?24:5,changed:e=>this.css_tweaks.setVariable("portrait-extra-width",`${e}rem`)}),this.settings.add("layout.is-minimal",{require:["context.route.name"],process:e=>g.includes(e.get("context.route.name"))})}onEnable(){document.body.classList.toggle("ffz--portrait-invert",this.settings.get("layout.portrait-invert")),this.on(":update-nav",this.updateNavLinks,this),this.on(":resize",this.handleResize,this),this.css_tweaks.toggle("portrait-chat",this.settings.get("layout.portrait-min-chat")),this.css_tweaks.toggle("portrait",this.settings.get("layout.inject-portrait")),this.css_tweaks.toggle("portrait-swapped",this.settings.get("layout.use-portrait-swapped")),this.css_tweaks.toggle("portrait-metadata",this.settings.get("layout.use-portrait-meta")),this.css_tweaks.toggle("portrait-metadata-top",this.settings.get("layout.use-portrait-meta-top")),this.css_tweaks.setVariable("portrait-extra-width",`${this.settings.get("layout.portrait-extra-width")}rem`),this.css_tweaks.setVariable("portrait-extra-height",`${this.settings.get("layout.portrait-extra-height")}rem`),this.on("site.directory:update-cards",(()=>{this.SideBar.each((e=>this._updateSidebar(e)))})),this.ResizeDetector.ready((()=>{this._needs_resize&&(this._needs_resize=!1,this.handleResize())})),this.SideBar.on("mount",this.updateSidebar,this),this.SideBar.on("mutate",this.updateSidebar,this),this.SideBar.each((e=>this.updateSidebar(e)))}handleResize(){this._resize_timer||(this._resize_timer=setTimeout((()=>this._handleResize()),o.IS_FIREFOX?500:100))}_handleResize(){if(clearTimeout(this._resize_timer),this._resize_timer=null,this.ResizeDetector.instances.size){for(const s of this.ResizeDetector.instances){var e;null==s||null===(e=s.onScroll)||void 0===e||e.call(s)}this.emit("site.player:fix-player")}else this._needs_resize=!0}get is_minimal(){return this.settings.get("layout.is-minimal")}updateSidebar(e){e&&(e._ffz_update||(e._ffz_update=Object(u.debounce)((()=>requestAnimationFrame((()=>this._updateSidebar(e)))),1e3,2)),e._ffz_update())}_updateSidebar(e){if(!e)return;const s=e.querySelectorAll(".side-nav-card"),n=this.settings.provider.get("directory.game.blocked-games",[]);for(const e of s){var o,a,u,f,g,_,b;const s=this.fine.getReactInstance(e),v=null==s||null===(o=s.return)||void 0===o||null===(a=o.return)||void 0===a?void 0:a.memoizedProps,k=null==v||null===(u=v.metadataRight)||void 0===u||null===(f=u.props)||void 0===f?void 0:f.stream,x=null!==(g="rerun"===(null==k?void 0:k.type))&&void 0!==g&&g,C=null==k||null===(_=k.game)||void 0===_?void 0:_.displayName,E=null!==(b=null==v?void 0:v.offline)&&void 0!==b&&b;e.classList.toggle("ffz--side-nav-card-rerun",x),e.classList.toggle("ffz--side-nav-card-offline",E),e.classList.toggle("tw-hide",!!C&&n.includes(C))}}updateNavLinks(){}updatePortraitMode(){}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return MenuButton}));var o=n(2),a=n(4),u=n(1),f=n(16),g=n(51);class MenuButton extends a.SiteModule{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.inject("site.elemental"),this.pauseToasts=this.pauseToasts.bind(this),this.unpauseToasts=this.unpauseToasts.bind(this),this.should_enable=!0,this._pill_content=null,this._has_update=!1,this._important_update=!1,this._new_settings=0,this._loading=!1,this.toasts=[],this.settings.add("ffz.show-new-settings",{default:!0,ui:{path:"Appearance > Layout >> Top Navigation",title:"Display an indicator on the FFZ Control Center button whenever there are new settings added to FrankerFaceZ.",component:"setting-check-box"},changed:()=>this.update()}),this.ModBar=this.fine.define("mod-view-bar",(e=>e.actions&&e.updateRoot&&e.childContext),["mod-view"]),this.SunlightNav=this.elemental.define("sunlight-nav",".sunlight-top-nav > div > div > div:last-child > div",f.a.SUNLIGHT_ROUTES,{attributes:!0},1),this.NavBar=this.fine.define("nav-bar",(e=>e.renderOnsiteNotifications&&e.renderTwitchPrimeCrown)),this.SquadBar=this.fine.define("squad-nav-bar",(e=>e.exitSquadMode&&e.props&&e.props.squadID),["squad"]),this.MultiController=this.fine.define("multi-controller",(e=>e.handleAddStream&&e.handleRemoveStream&&e.getInitialStreamLayout),["command-center"])}get loading(){return this._loading}set loading(e){e!==this._loading&&(this._loading=e,this.update())}get new_settings(){return this._new_settings}set new_settings(e){e!==this._new_settings&&(this._new_settings=e,this.update())}get has_new(){return this.settings.get("ffz.show-new-settings")&&this._new_settings>0}get important_update(){return this._important_update}set important_update(e){this._important_update=!1,this.update()}get has_update(){return this._has_update}get has_strings(){return this.i18n.new_strings>0||this.i18n.changed_strings>0}set has_update(e){e&&!this._has_update&&(this._important_update=!0),this._has_update=e,this.update()}get pill(){return this._pill_content}set pill(e){this._pill_content=e,this.update()}formatPill(){const e=this._pill_content;return"number"==typeof e?this.i18n.formatNumber(e):null==e&&this.has_new?this.i18n.formatNumber(this._new_settings):e}formatExtraPill(){if(this.has_update)return null;if(this.settings.disable_profiles)return Object(u.createElement)("figure",{class:"ffz-i-cog"});if(this.has_strings)return this.i18n.formatNumber(this.i18n.new_strings+this.i18n.changed_strings);const e=this.resolve("addons");return o.DEBUG&&e.has_dev?this.i18n.t("site.menu_button.dev","dev"):o.DEBUG&&!e.has_dev?this.i18n.t("site.menu_button.main-dev","m-dev"):!o.DEBUG&&e.has_dev?this.i18n.t("site.menu_button.addon-dev","a-dev"):null}updateToasts(){requestAnimationFrame((()=>this._updateToasts()))}_updateToasts(){for(const e of this.NavBar.instances)this.updateButtonToast(e);for(const e of this.SquadBar.instances)this.updateButtonToast(e);for(const e of this.MultiController.instances)this.updateButtonToast(e);for(const e of this.SunlightNav.instances)this.updateButtonToast(null,e,!0);for(const e of this.ModBar.instances)this.updateButtonToast(e)}update(){requestAnimationFrame((()=>this._update()))}_update(){for(const e of this.NavBar.instances)this.updateButton(e);for(const e of this.SquadBar.instances)this.updateButton(e);for(const e of this.MultiController.instances)this.updateButton(e);for(const e of this.SunlightNav.instances)this.updateButton(null,e,!0);for(const e of this.ModBar.instances)this.updateButton(e)}onEnable(){this.NavBar.ready((()=>this.update())),this.NavBar.on("mount",this.updateButton,this),this.NavBar.on("update",this.updateButton,this),this.SquadBar.ready((()=>this.update())),this.SquadBar.on("mount",this.updateButton,this),this.SquadBar.on("update",this.updateButton,this),this.MultiController.ready((()=>this.update())),this.MultiController.on("mount",this.updateButton,this),this.MultiController.on("update",this.updateButton,this),this.SunlightNav.on("mount",(e=>this.updateButton(null,e,!0))),this.SunlightNav.on("mutate",(e=>this.updateButton(null,e,!0))),this.SunlightNav.each((e=>this.updateButton(null,e,!0))),this.ModBar.ready((()=>this.update())),this.ModBar.on("mount",this.updateButton,this),this.ModBar.on("update",this.updateButton,this),this.on(":clicked",(()=>this.important_update=!1)),this.once(":clicked",this.loadMenu),this.on("i18n:new-strings",this.update),this.on("i18n:changed-strings",this.update),this.on("i18n:update",this.update),this.on("addons:data-loaded",this.update),this.once("settings:quota-exceeded",(()=>{this.addError("site.menu_button.quota-exceeded","Your local storage space for this website is full, and settings cannot be saved. Please backup your settings and switch to a higher capacity provider in [Data Management > Storage >> Provider](~data_management.storage.tabs.provider).","ffz-i-attention",!0),this.update()})),this.on("settings:change-provider",(()=>{this.addError("site.menu_button.changed","The FrankerFaceZ settings provider has changed. Please refresh this tab to avoid strange behavior."),this.update()}))}addError(e,s,n="ffz-i-attention",o=!1){this.addToast({icon:n,text_i18n:e,text:s,markdown:o})}addToast(e){if(e.markdown){if(!Object(g.b)())return Object(g.a)().then((()=>this.addToast(e)))}this.toasts.push(e),this.toasts.length>5||this.updateToasts()}pauseToasts(){const e=Math.min(5,this.toasts.length),s=performance.now();this._toasts_paused=!0;for(let n=0;n<e;n++){const e=this.toasts[n];if(!e||!e.started)continue;e._timer&&(clearTimeout(e._timer),e._timer=null);const o=s-e.started,a=e.timeout-o;e.remaining=a,e.percentage=100*a/e.timeout,e.el&&e.el.replaceWith(this.renderToast(e))}}unpauseToasts(){const e=Math.min(5,this.toasts.length),s=performance.now();this._toasts_paused=!1;for(let n=0;n<e;n++){const e=this.toasts[n];if(e&&e.started){if(e.remaining){const n=e.timeout-e.remaining;e.started=s-n}e.el&&e.el.replaceWith(this.renderToast(e))}}}renderToasts(){const e=Math.min(5,this.toasts.length);if(!e)return null;const s=[];for(let n=0;n<e;n++)s.push(this.renderToast(this.toasts[n]));return s}renderToast(e){e._remove||(e._remove=()=>{e._timer&&(clearTimeout(e._timer),e._timer=null),e.el=null;const s=this.toasts.indexOf(e);-1!==s&&(this.toasts.splice(s,1),this.toasts.length||(this._toasts_paused=!1),this.updateToasts())});let s=null;const n=e.markdown?Object(g.b)():null;if(e.markdown&&!n)return null;if(e.timeout){const n=performance.now();e.started||(e.started=n);const o=n-e.started,a=e.timeout-o;let f;this._toasts_paused?f=e.percentage:e._timer||(e._timer=setTimeout(e._remove,a)),null==f&&(f=e.percentage=100*a/e.timeout),s=Object(u.createElement)("div",{class:"ffz-toast--progress tw-absolute tw-overflow-hidden tw-z-below"},Object(u.createElement)("div",{class:"tw-border-radius-rounded ffz-progress-bar ffz-progress-bar--countdown ffz-progress-bar--default ffz-progress-bar--mask",role:"progressbar","aria-valuenow":f,"aria-valuemin":"0","aria-valuemax":"100"},Object(u.createElement)("div",{class:"tw-block tw-border-bottom-left-radius-rounded tw-border-top-left-radius-rounded ffz-progress-bar__fill","data-a-target":"tw-progress-bar-animation",style:{width:`${f}%`,"animation-duration":a/1e3+"s"}})))}return e.el=Object(u.createElement)("div",{class:"ffz-toast ffz-balloon ffz-balloon--lg tw-mg-y-1"+(this._toasts_paused?" ffz-toast--paused":"")},Object(u.createElement)("div",{class:"tw-pd-1 tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-relative"},Object(u.createElement)("div",{class:"tw-flex tw-align-items-start"},e.icon&&("string"==typeof e.icon?Object(u.createElement)("figure",{class:`tw-font-size-3 tw-pd-r-1 ${e.icon}`}):e.icon),e.render?e.render.call(this,e):null,e.title||e.text?Object(u.createElement)("div",{class:"tw-flex-grow-1"},e.title?Object(u.createElement)("header",{class:"tw-semibold tw-font-size-3 tw-pd-b-05"},e.title_i18n?this.i18n.tList(e.title_i18n,e.title,e):e.title):null,e.text?Object(u.createElement)("span",{class:""+(e.lines?"ffz--line-clamp":""),style:{"--ffz-lines":e.lines}},e.markdown?Object(u.createElement)("span",{dangerouslySetInnerHTML:{__html:Object(g.b)().render(e.text_i18n?this.i18n.t(e.text_i18n,e.text,e):e.text)}}):null,e.markdown?null:e.text_i18n?this.i18n.tList(e.text_i18n,e.text,e):e.text):null):null,!e.unclosable&&Object(u.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:e._remove},Object(u.createElement)("span",{class:"tw-button-icon__icon"},Object(u.createElement)("figure",{class:"ffz-i-cancel"})))),s)),e.el}updateButtonToast(e,s,n){const o=(e||s)._ffz_toast_el;if(o)return o.innerHTML="",void Object(u.setChildren)(o,this.renderToasts(),!1,!0);this.updateButton(e,s,n)}updateButton(e,s,n){const a=this.fine.getChildNode(e);let f=!1,g=!1;if(s||(s=a&&a.querySelector(".top-nav__menu")),s||(s=a&&a.classList.contains("squad-stream-top-bar__container")?a:a&&a.querySelector(".squad-stream-top-bar__container"))&&(f=!0),!s&&e.handleAddStream&&(s=this.fine.searchTree(e,(e=>e.classList&&e.classList.contains("multiview-stream-page__header"))))&&(f=!0),!s&&e.getIsAdsEnabled&&(s=a&&a.querySelector(".sunlight-top-nav > .tw-flex > .tw-flex > .tw-justify-content-end > .tw-flex"))&&(n=!0),!s&&e.childContext&&(s=a&&a.querySelector(".modview-dock > div:last-child"))&&(g=!0),!s)return;if(!f&&!g&&!n){let e=null;try{e=s.querySelector(":scope > .tw-justify-content-end:last-child")}catch(e){}s=e||s.lastElementChild}let _,b=s.querySelector(".ffz-top-nav");b&&b.remove();const v=this.resolve("addons"),k=this.renderToasts(),x=this.formatPill(),C=this.formatExtraPill();if(b=Object(u.createElement)("div",{class:"ffz-top-nav "+(g?"ffz-mod-view-button tw-relative tw-mg-b-1":"tw-align-self-center tw-flex-grow-0 tw-flex-nowrap tw-flex-shrink-0 tw-relative "+(n?"tw-mg-l-05 tw-mg-r-2":"tw-mg-x-05"))},Object(u.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},_=Object(u.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative"+(this.loading?" loading":""),onClick:e=>this.handleClick(e,_),onContextMenu:e=>this.renderContext(e,_)},Object(u.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(u.createElement)("span",{class:"tw-button-icon__icon"},Object(u.createElement)("figure",{class:"ffz-i-zreknarf"})))),this.has_error&&Object(u.createElement)("div",{class:"tw-absolute ffz-balloon ffz-balloon--lg tw-block "+(g?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right")},Object(u.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4 tw-pd-1"},Object(u.createElement)("div",{class:"tw-flex tw-align-items-center"},Object(u.createElement)("div",{class:"tw-flex-grow-1"},this.error.i18n?this.i18n.t(this.error.i18n,this.error.text):this.error.text),this.error.permanent?null:Object(u.createElement)("button",{class:"tw-button-icon tw-mg-l-05 tw-relative ffz-il-tooltip__container",onClick:()=>this.error=null},Object(u.createElement)("span",{class:"tw-button-icon__icon"},Object(u.createElement)("figure",{class:"ffz-i-cancel"})))))),Object(u.createElement)("div",{class:"ffz-il-tooltip "+(g?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right")},this.i18n.t("site.menu_button","FrankerFaceZ Control Center"),this.has_update&&Object(u.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.update-desc","There is an update available. Please refresh your page.")),this.settings.disable_profiles&&Object(u.createElement)("div",{class:"tw-mg-t-1"},this.i18n.tList("site.menu_button.no-settings",'Settings are disabled in this tab due to the inclusion of "{param}" in the URL.',{param:Object(u.createElement)("code",{class:"ffz-monospace"},"?ffz-no-settings")})),this._new_settings>0&&Object(u.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.new-desc","There {count,plural,one {is one new setting} other {are # new settings}}.",{count:this._new_settings})),this.has_strings&&Object(u.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.strings","There {added,plural,one {is # new string} other {are # new strings}} and {changed,plural,one {# changed string} other {# changed strings}}.",{added:this.i18n.new_strings,changed:this.i18n.changed_strings})),o.DEBUG&&Object(u.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.main-dev-desc","You are running a developer build of FrankerFaceZ.")),v.has_dev&&Object(u.createElement)("div",{class:"tw-mg-t-1"},this.i18n.t("site.menu_button.addon-dev-desc","You have loaded add-on data from a local development server.")))),(e||s)._ffz_toast_el=Object(u.createElement)("div",{class:"ffz-toast--container tw-absolute tw-block "+(g?"ffz-il-tooltip--up ffz-il-tooltip--align-left":"ffz-il-tooltip--down ffz-il-tooltip--align-right"),onmouseenter:this.pauseToasts,onmouseleave:this.unpauseToasts},k),this.has_update&&Object(u.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},Object(u.createElement)("div",{class:"tw-pill "+(this.important_update?"tw-pill--notification":"")},Object(u.createElement)("figure",{class:"ffz-i-arrows-cw"}))),C&&Object(u.createElement)("div",{class:"ffz-menu__extra-pill tw-absolute"},Object(u.createElement)("div",{class:"tw-pill"},C)),x&&Object(u.createElement)("div",{class:"ffz-menu__pill tw-absolute"},Object(u.createElement)("div",{class:"tw-pill"},x))),g)s.insertBefore(b,s.firstElementChild);else{let e=s.lastElementChild;e&&e.classList.contains("resize-detector")&&(e=e.previousElementSibling),e?s.insertBefore(b,e):s.appendChild(b)}this._ctx_open&&this.renderContext(null,_)}handleClick(e,s){if(e.shiftKey)return o.DEBUG&&e.ctrlKey?requestAnimationFrame((()=>this.i18n.openUI())):this.resolve("main_menu").openPopout();this.emit(":clicked",e,s)}renderButtonIcon(e){const s=this.settings.main_context.hasProfile(e);return Object(u.createElement)("figure",{class:"ffz--profile__icon "+(s?"ffz-i-ok":e.toggled?"ffz-i-minus":"ffz-i-cancel")})}renderButtonTip(e){return e.toggled?this.settings.main_context.hasProfile(e)?this.i18n.t("setting.profiles.active","This profile is enabled and active."):this.i18n.t("setting.profiles.disabled.rules","This profile is enabled, but inactive due to its rules."):this.i18n.t("setting.profiles.disabled","This profile is disabled.")}renderContext(e,s){if(e){if(e.shiftKey||e.ctrlKey)return;e.preventDefault()}const n=s.parentElement.parentElement,o=n.classList.contains("ffz-mod-view-button");let a=n.querySelector(".ffz--menu-context");if(a){if(!a._ffz_destroy)return;a._ffz_destroy()}const destroy=()=>{this._ctx_open=!1,a._ffz_outside&&a._ffz_outside.destroy(),a.remove()},f=[];for(const e of this.settings.__profiles){const s=Object(u.createElement)("button",{class:"tw-flex-shrink-0 tw-mg-r-1 tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-relative ffz-tooltip ffz-tooltip--no-mouse","data-title":this.renderButtonTip(e),onClick:n=>{var o;e.toggled=!e.toggled,Object(u.setChildren)(s,this.renderButtonIcon(e)),s.dataset.title=this.renderButtonTip(e),null!==(o=s._ffz_tooltip)&&void 0!==o&&o.rerender&&s._ffz_tooltip.rerender(),this.emit("tooltips:cleanup"),n.preventDefault(),n.stopPropagation()}},this.renderButtonIcon(e)),n=e.desc_i18n_key||e.i18n_key&&`${e.i18n_key}.description`;f.push(Object(u.createElement)("div",{class:"tw-relative tw-border-b tw-pd-y-05 tw-pd-x-1 tw-flex"},s,Object(u.createElement)("div",null,Object(u.createElement)("h4",null,e.i18n_key?this.i18n.t(e.i18n_key,e.name,e):e.name),e.description&&Object(u.createElement)("div",{class:"description"},n?this.i18n.t(n,e.description,e):e.description))))}a=Object(u.createElement)("div",{class:"tw-absolute ffz-attached "+(o?"ffz-attached--up ffz-attached--left":"ffz-attached--down ffz-attached--right")},Object(u.createElement)("div",{class:"ffz-balloon ffz-balloon--lg tw-block ffz--menu-context"},Object(u.createElement)("div",{class:"tw-border-radius-large tw-c-background-base tw-c-text-inherit tw-elevation-4"},Object(u.createElement)("div",{class:"tw-c-text-base tw-elevation-1 tw-flex tw-flex-shrink-0 tw-pd-x-1 tw-pd-y-05 tw-popover-header"},Object(u.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--left"},Object(u.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},Object(u.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onDblClick:()=>{this.emit("site.player:reset"),destroy()}},Object(u.createElement)("span",{class:"tw-button-icon__icon"},Object(u.createElement)("figure",{class:"ffz-i-t-reset"}))),Object(u.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-left"},this.i18n.t("player.reset_button.all","Reset All Players (Double-Click)")))),Object(u.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-column tw-flex-grow-1 tw-justify-content-center"},Object(u.createElement)("h5",{class:"tw-align-center tw-c-text-alt tw-semibold"},this.i18n.t("site.menu_button.profiles","Profiles"))),Object(u.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},Object(u.createElement)("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},Object(u.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden",onClick:e=>{this.openSettings(e,s),destroy()}},Object(u.createElement)("span",{class:"tw-button-icon__icon"},Object(u.createElement)("figure",{class:"ffz-i-cog"}))),Object(u.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},this.i18n.t("setting.profiles.configure","Configure")))),Object(u.createElement)("div",{class:"tw-flex tw-flex-column tw-justify-content-center tw-mg-l-05 tw-popover-header__icon-slot--right"},Object(u.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-radius-medium tw-button-icon tw-button-icon--secondary ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative",onClick:destroy},Object(u.createElement)("span",{class:"tw-button-icon__icon"},Object(u.createElement)("figure",{class:"ffz-i-cancel"}))))),Object(u.createElement)("div",{class:"center-window__long-scrollable-area scrollable-area scrollable-area--suppress-scroll-x","data-simplebar":!0},f)))),a._ffz_destroy=destroy,a._ffz_outside=new u.ClickOutside(a,destroy),n.appendChild(a),this._ctx_open=!0}openSettings(e,s){const n=this.resolve("main_menu");n&&(n.requestPage("data_management.profiles"),n.showing||this.emit(":clicked",e,s))}loadMenu(e,s,n){const o=this.resolve("main_menu");o&&(n&&o.requestPage(n),o.showing||(this.loading=!0,o.enable(e).then((()=>{this.loading=!1})).catch((e=>{this.log.capture(e),this.log.error("Error enabling main menu.",e),this.addError("site.menu_button.error","There was an error loading the FFZ Control Center. Please refresh and try again."),this.loading=!1,this.once(":clicked",this.loadMenu)}))))}onDisable(){this.off("i18n:update",this.update),this.off(":clicked",this.loadMenu)}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return ModView}));var o=n(4),a=n(0);class ModView extends o.default{constructor(...e){super(...e),this.inject("i18n"),this.inject("settings"),this.inject("site.channel"),this.inject("site.css_tweaks"),this.inject("site.fine"),this.inject("site.elemental"),this.inject("site.router"),this.inject("site.twitch_data"),this.inject("metadata"),this.inject("socket"),this.should_enable=!0,this._cached_color=null,this._cached_channel=null,this._cached_id=null,this.Root=this.elemental.define("mod-view-root",".moderation-view-page",["mod-view"],{attributes:!0},1),this.ModInfoBar=this.elemental.define("mod-info-bar",".modview-player-widget__stream-info .simplebar-content",["mod-view"],{childNodes:!0,subtree:!0},1,3e4,!1),this.checkRoot=Object(a.debounce)(this.checkRoot,250),this.checkBar=Object(a.debounce)(this.checkBar,250)}onEnable(){this.Root.on("mount",this.updateRoot,this),this.Root.on("mutate",this.updateRoot,this),this.Root.on("unmount",this.removeRoot,this),this.Root.each((e=>this.updateRoot(e))),this.ModInfoBar.on("mount",this.updateBar,this),this.ModInfoBar.on("mutate",this.updateBar,this),this.ModInfoBar.on("unmount",this.removeBar,this),this.ModInfoBar.each((e=>this.updateBar(e))),this.router.on(":route",this.checkNavigation,this),this.checkNavigation()}updateSubscription(e){this._subbed_login!==e&&(this._subbed_login&&(this.socket.unsubscribe(this,`channel.${this._subbed_login}`),this._subbed_login=null),e&&(this.socket.subscribe(this,`channel.${e}`),this._subbed_login=e))}checkNavigation(){"mod-view"===this.router.current_name&&(this.channel.updateChannelColor(this._cached_color),this.checkRoot())}checkBar(){this.ModInfoBar.clean()}checkRoot(){this.Root.each((e=>this.updateRoot(e)))}updateRoot(e){var s;const n=this.fine.getReactInstance(e);let o,a=null,u=n,f=0;for(;null!=u&&null==a&&f<10;){var g;let e=u.memoizedState;for(o=0;null!=e&&null==a&&o<50;){var _,b,v,k,x,C,E,z,j,O,A,T,D;e=null===(_=e)||void 0===_?void 0:_.next,a=null===(b=e)||void 0===b||null===(v=b.memoizedState)||void 0===v||null===(k=v.current)||void 0===k||null===(x=k.currentObservable)||void 0===x||null===(C=x.lastResult)||void 0===C||null===(E=C.data)||void 0===E?void 0:E.user,a||(a=null===(z=e)||void 0===z||null===(j=z.memoizedState)||void 0===j||null===(O=j.current)||void 0===O||null===(A=O.previous)||void 0===A||null===(T=A.result)||void 0===T||null===(D=T.previousData)||void 0===D?void 0:D.user),o++}u=null===(g=u)||void 0===g?void 0:g.child,f++}null!==(s=a)&&void 0!==s&&s.id?this._cached_id!=a.id&&(this._cached_id=a.id,this._cached_channel=a,this._cached_color=null,this.updateSubscription(a.login),this.getChannelColor(e,a.id).then((e=>{this._cached_id==a.id&&(this._cached_color=e,this.channel.updateChannelColor(e),this.settings.updateContext({channelColor:e}))})).catch((()=>{this._cached_id==a.id&&(this._cached_color=null,this.channel.updateChannelColor(),this.settings.updateContext({channelColor:null}))})),this.settings.updateContext({channel:a.login,channelID:a.id})):this.removeRoot()}getChannelColor(e,s,n){const o=e._ffz_color_cache=e._ffz_color_cache||{};return s===o.channel_id&&Date.now()-o.saved<6e4?n?o.data:Promise.resolve(o.data):new Promise((async(e,n)=>{if(o.updating)return void o.updating.push([e,n]);let a,u;o.channel_id=s,o.updating=[[e,n]];try{a=await this.twitch_data.getChannelColor(s)}catch(e){a=null,u=e}const f=o.updating;if(o.updating=null,o.channel_id===s){o.data=a,o.saved=Date.now();for(const e of f)u?e[1](u):e[0](a)}else{u=new Error("Outdated"),o.channel_id=null,o.data=null,o.saved=0;for(const e of f)e[1](u)}}))}removeRoot(){this._cached_id=null,this._cached_channel=null,this._cached_color=null,this.updateSubscription(),this.channel.updateChannelColor(),this.settings.updateContext({channel:null,channelID:null,channelColor:null})}updateBar(e){var s,n;const o=e.closest(".modview-player-widget__stream-info"),a=o&&this.fine.getReactInstance(o);let u=null,f=null==a||null===(s=a.return)||void 0===s?void 0:s.memoizedState,g=0;for(;null!=f&&null==u&&g<50;){var _,b,v,k,x,C,E;f=null===(_=f)||void 0===_?void 0:_.next,u=null===(b=f)||void 0===b||null===(v=b.memoizedState)||void 0===v||null===(k=v.current)||void 0===k||null===(x=k.previous)||void 0===x||null===(C=x.result)||void 0===C||null===(E=C.data)||void 0===E?void 0:E.channel,g++}const z=null===(n=u)||void 0===n?void 0:n.lastBroadcast,j=null==z?void 0:z.title,O=null==z?void 0:z.game;if(j==e._cached_title&&(null==O?void 0:O.id)==e._cached_game||(e._cached_title=j,e._cached_game=null==O?void 0:O.id,this.settings.updateContext({category:null==O?void 0:O.name,categoryID:null==O?void 0:O.id,title:j})),o){if(!o._ffz_cont){const e=o._ffz_cont=o.querySelector(".modview-player-widget__viewcount");e&&e.classList.add("ffz--mod-tray")}this.updateMetadata(o)}}removeBar(e){this.settings.updateContext({category:null,categoryID:null,title:null});const s=e.closest(".modview-player-widget__stream-info");if(s){if(s._ffz_cont&&s._ffz_cont.classList.remove("ffz--mod-tray"),s._ffz_cont=null,s._ffz_meta_timers){for(const e of Object.values(s._ffz_meta_timers))clearTimeout(e);s._ffz_meta_timers=null}s._ffz_update=null}}updateMetadata(e,s){const n=e._ffz_cont,o=this._cached_channel;if(!n||!document.contains(n))return void this.checkBar();if(null==o||!o.id)return;s?Array.isArray(s)||(s=[s]):s=this.metadata.keys;const a=e._ffz_meta_timers=e._ffz_meta_timers||{},refresh_fn=s=>this.updateMetadata(e,s),u={channel:{id:o.id,login:o.login,display_name:o.displayName},el:e,getViewerCount:()=>0,getUserSelfImmediate:()=>null,getUserSelf:()=>null,getBroadcastID:()=>null};for(const e of s)this.metadata.definitions[e].modview&&this.metadata.renderLegacy(e,u,n,a,refresh_fn)}}},function(e,s,n){"use strict";n.r(s),n.d(s,"PLAYER_ROUTES",(function(){return a})),n.d(s,"default",(function(){return Player}));var o=n(89);const a=["front-page","user","video","user-video","user-clip","user-videos","user-clips","user-collections","user-events","user-followers","user-following","dash","squad","command-center","dash-stream-manager","mod-view","user-home"];class Player extends o.a{constructor(...e){super(...e),this.should_enable=!0,this.inject("site.router"),this.inject("metadata"),this.Player=this.fine.define("highwind-player",(e=>{var s,n;return e.setPlayerActive&&(null===(s=e.props)||void 0===s?void 0:s.playerEvents)&&(null===(n=e.props)||void 0===n?void 0:n.mediaPlayerInstance)}),a),this.TheatreHost=this.fine.define("theatre-host",(e=>e.toggleTheatreMode&&e.props&&e.props.onTheatreModeEnabled),["user","user-home","video","user-video","user-clip"]),this.PlayerSource=this.fine.define("player-source",(e=>e.setSrc&&e.setInitialPlaybackSettings),a)}repositionPlayer(){if(!this._mover){const e=document.querySelector(".channel-root__player");this._mover=this.fine.searchNode(e,(e=>{var s;return null===(s=e.memoizedProps)||void 0===s?void 0:s.triggerPlayerReposition}),50)}this._mover&&this._mover.memoizedProps.triggerPlayerReposition()}registerSettings(){super.registerSettings(),this.settings.add("player.home.autoplay",{default:!0,ui:{path:"Player > General >> Playback",title:"Auto-play featured broadcasters on the front page.",component:"setting-check-box"}}),this.settings.add("player.theatre.no-whispers",{default:!1,requires:["whispers.show"],process:(e,s)=>!e.get("whispers.show")||s,ui:{path:"Player > General >> Theatre Mode",title:"Hide whispers when Theatre Mode is enabled.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("theatre-no-whispers",e)}),this.settings.add("player.theatre.metadata",{default:!1,requires:["context.route.name"],process:(e,s)=>"video"!==e.get("context.route.name")&&s,ui:{path:"Player > General >> Theatre Mode",title:"Show metadata when mousing over the player.",component:"setting-check-box"},changed:e=>this.css_tweaks.toggle("theatre-metadata",e)}),this.settings.add("player.theatre.auto-enter",{default:!1,ui:{path:"Player > General >> Theatre Mode",title:"Automatically open Theatre Mode when visiting a channel.",component:"setting-check-box"}}),this.settings.add("player.hide-event-bar",{default:!1,ui:{path:"Channel > Appearance >> General",title:"Hide the Event Bar",description:"Hide the Event Bar which appears above the player when there is an ongoing event for the current channel.",component:"setting-check-box"},changed:e=>{this.css_tweaks.toggleHide("player-event-bar",e),this.repositionPlayer()}})}async onEnable(){await super.onEnable(),this.css_tweaks.toggle("theatre-no-whispers",this.settings.get("player.theatre.no-whispers")),this.css_tweaks.toggle("theatre-metadata",this.settings.get("player.theatre.metadata")),this.css_tweaks.toggleHide("player-event-bar",this.settings.get("player.hide-event-bar")),this.on(":fix-player",this.repositionPlayer,this),this.TheatreHost.on("mount",(e=>{e._ffz_theater_start=Date.now(),this.tryTheatreMode(e)})),this.TheatreHost.on("update",this.tryTheatreMode,this),this.TheatreHost.ready(((e,s)=>{const n=Date.now();for(const e of s)e._ffz_theater_start=n,this.tryTheatreMode(e)})),this.PlayerSource.on("mount",this.checkCarousel,this),this.PlayerSource.on("update",this.checkCarousel,this)}shouldStopAutoplay(){var e;return this.settings.get("player.no-autoplay")||!this.settings.get("player.home.autoplay")&&"front-page"===(null===(e=this.router.current)||void 0===e?void 0:e.name)}checkCarousel(e){var s;if(!this.settings.get("channel.hosting.enable")&&"channel_home_carousel"===(null===(s=e.props)||void 0===s?void 0:s.playerType)){var n,o;if((null===(n=e.props.content)||void 0===n?void 0:n.hostChannel)===e._ffz_cached_login)return;if(e._ffz_cached_login=null===(o=e.props.content)||void 0===o?void 0:o.hostChannel,!e._ffz_cached_login)return;const s=e.props.mediaPlayerInstance,a=e.props.playerEvents;this.stopPlayer(s,a,e)}}tryTheatreMode(e){e._ffz_theater_timer||(e._ffz_theater_timer=setTimeout((()=>{e._ffz_theater_timer=null,this.settings.get("player.theatre.auto-enter")&&e._ffz_mounted&&"user"===this.router.current_name&&(e.props.channelHomeLive||e.props.channelHomeCarousel||e.props.theatreModeEnabled||Date.now()-(e._ffz_theater_start||0)>2e3||e.props.onTheatreModeEnabled&&e.props.onTheatreModeEnabled())}),250))}repositionPlayer(){}updateSquadContext(){this.settings.updateContext({squad_bar:this.hasSquadBar})}get hasSquadBar(){return!1}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return SubButton}));var o=n(4),a=n(1);class SubButton extends o.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site.fine"),this.settings.add("sub-button.prime-notice",{default:!0,ui:{path:"Channel > Metadata >> Subscription",title:"Show Prime Reminder",description:"Display a crown on subscription buttons when your free channel sub with Prime is available.",component:"setting-check-box"},changed:()=>this.SubButton.forceUpdate()}),this.SubButton=this.fine.define("sub-button",(e=>e.handleSubMenuAction&&e.openSubModal),["user","user-home","user-video","user-clip","video","user-videos","user-clips","user-collections","user-events","user-followers","user-following"])}onEnable(){this.settings.on(":changed:layout.swap-sidebars",(()=>this.SubButton.forceUpdate())),this.SubButton.ready(((e,s)=>{const n=this,o=e.prototype.render;e.prototype.render=function(){try{const e=this.props.balloonDirection;if(void 0!==e){const s=n.settings.get("layout.swap-sidebars"),o=e.includes("--left");s&&!o?this.props.balloonDirection=e.replace("--right","--left"):!s&&o&&(this.props.balloonDirection=e.replace("--left","--right"))}}catch(e){}return o.call(this)};for(const e of s)this.updateSubButton(e);this.SubButton.forceUpdate()})),this.SubButton.on("mount",this.updateSubButton,this),this.SubButton.on("update",this.updateSubButton,this)}updateSubButton(e){const s=this.fine.getChildNode(e),n=s&&s.querySelector('button[data-a-target="subscribe-button"]');if(!n)return;const o=e.props,u=o.data&&o.data.user,f=u&&u.self,g=this.settings.get("sub-button.prime-notice")&&f&&f.canPrimeSubscribe&&!f.subscriptionBenefit,_=n.querySelector(".ffz--can-prime");if(g&&!_)n.insertBefore(Object(a.createElement)("span",{class:"tw-button__icon tw-button__icon--left ffz--can-prime"},Object(a.createElement)("figure",{class:"ffz-i-crown ffz-tooltip","data-title":this.i18n.t("sub-button.prime","Your free channel sub with Prime is available.")})),n.firstElementChild),n.appendChild(Object(a.createElement)("span",{class:"ffz--post-prime"}));else if(!g&&_){_.remove();const e=n.querySelector(".ffz--post-prime");e&&e.remove()}}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return ThemeEngine}));var o=n(4),a=n(1),u=n(11),f=n(326),g=n.n(f);const _=["product","prime","turbo"],b=[-.62,-.578,-.539,-.469,-.4,-.32,-.21,-.098,0,.08,.151,.212,.271,.31,.351],v={dark:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":2,"background-graph-fill":8,"background-input-checkbox-checked":10,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":9,"background-progress-status":9,"background-range-fill":10,"background-subscriber-stream-tag-active":4,"background-subscriber-stream-tag-default":4,"background-subscriber-stream-tag-hover":3,"background-toggle-checked":9,"background-top-nav":6,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":10,"border-input-checkbox-focus":10,"border-input-focus":10,"border-interactable-selected":10,"border-range-handle":10,"border-subscriber-stream-tag":5,"border-tab-active":11,"border-tab-focus":11,"border-tab-hover":11,"border-toggle-checked":10,"border-toggle-focus":10,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":10,"text-link-active":10,"text-link-focus":10,"text-link-hover":10,"text-link-visited":10,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":11,"text-toggle-checked-icon":10,"text-tooltip":1,"text-button-text":10},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[8," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 0",""],"tab-focus":[11," 0 4px 6px -4px",""]}},light:{c:{"background-accent":8,"background-accent-alt":7,"background-accent-alt-2":6,"background-button":7,"background-button-active":7,"background-button-focus":8,"background-button-hover":8,"background-button-primary-active":7,"background-button-primary-default":9,"background-button-primary-hover":8,"background-chat":1,"background-chat-alt":3,"background-chat-header":2,"background-graph":15,"background-graph-fill":9,"background-input-checkbox-checked":9,"background-input-checked":8,"background-interactable-selected":9,"background-modal":3,"background-progress-countdown-status":8,"background-progress-status":8,"background-range-fill":9,"background-subscriber-stream-tag-active":13,"background-subscriber-stream-tag-default":13,"background-subscriber-stream-tag-hover":14,"background-toggle-checked":9,"background-top-nav":7,"border-brand":9,"border-button":7,"border-button-active":8,"border-button-focus":9,"border-button-hover":8,"border-input-checkbox-checked":9,"border-input-checkbox-focus":9,"border-input-focus":9,"border-interactable-selected":9,"border-range-handle":9,"border-subscriber-stream-tag":10,"border-tab-active":8,"border-tab-focus":8,"border-tab-hover":8,"border-toggle-checked":9,"border-toggle-focus":9,"border-whisper-incoming":10,"fill-brand":9,"text-button-text-active":"o2","text-link":8,"text-link-active":9,"text-link-focus":9,"text-link-hover":9,"text-link-visited":9,"text-overlay-link-active":13,"text-overlay-link-focus":13,"text-overlay-link-hover":13,"text-tab-active":8,"text-toggle-checked-icon":9,"text-tooltip":1,"text-button-text":8,"background-tooltip":1,"text-button-text-focus":"o1","text-button-text-hover":"o1"},s:{"button-active":[8," 0 0 6px 0",""],"button-focus":[8," 0 0 6px 0",""],input:[5," inset 0 0 0 1px",""],"input-focus":[10," 0 0 10px -2px",""],"interactable-focus":[8," 0 0 6px 1px",""],"tab-focus":[8," 0 4px 6px -4px",""]}},accent_dark:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}},accent_light:{c:{"accent-hover":10,accent:9,"accent-primary-1":1,"accent-primary-2":5,"accent-primary-3":6,"accent-primary-4":7,"accent-primary-5":8},s:{}}};class ThemeEngine extends o.default{constructor(...e){super(...e),this.inject("settings"),this.inject("site"),this.inject("site.fine"),this.inject("site.css_tweaks"),this.inject("site.router"),this.should_enable=!0,this.settings.add("theme.disable-auto-dark",{default:!1,ui:{path:'Appearance > Theme >> Tweaks @{"sort": 10}',title:"Disable Auto Dark Theme",component:"setting-check-box",description:"Enabling this will attempt to disable a browser's built-in automatic dark theme conversion for websites, which is unnecessary on Twitch and can cause display issues. This may not apply depending on your web browser and settings."},changed:()=>this.updateCSS()}),this.settings.add("theme.font.size",{default:13,process(e,s){if("number"!=typeof s)try{s=parseFloat(s)}catch(e){s=null}return(!s||s<1||isNaN(s)||!isFinite(s)||s>25)&&(s=13),s},ui:{path:'Appearance > Theme >> Fonts @{"sort": 2}',title:"Font Size",description:"**Minimum:** `1`, **Maximum:** `25`, *Old Default:* `12`\n\nHow large should normal text be, in pixels. This may be affected by your browser's zoom and font settings.",component:"setting-text-box",type:"number"},changed:()=>this.updateFont()}),this.settings.add("theme.color.background",{default:"",ui:{path:'Appearance > Theme >> Colors @{"sort": 0, "description": "This is a quick preview of a new system coming soon to FrankerFaceZ. Expect heavy changes here, including separate Basic and Advanced modes, and better color selection."}',title:"Background",description:"Try `#0E0C13` for something close to the old dark theme, or `#0E0E0E` for a nice dark gray. Transparent colors not allowed.",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.accent",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.background",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Background",description:"If not set, the tooltip settings will be automatically adjusted based on the brightness of the background.",component:"setting-color-box",alpha:!0,sort:10},changed:()=>this.updateCSS()}),this.settings.add("theme.color.tooltip.text",{default:"",ui:{path:"Appearance > Theme >> Colors",title:"Tooltip Text",component:"setting-color-box",sort:11},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-background",{default:"",ui:{path:'Appearance > Theme >> Chat Colors @{"sort":1}',title:"Background",component:"setting-color-box",sort:0,alpha:!1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-text",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Text",description:"If not set, this will automatically be set to white or black based on the brightness of the background.",component:"setting-color-box",sort:1},changed:()=>this.updateCSS()}),this.settings.add("theme.color.chat-accent",{default:"",ui:{path:"Appearance > Theme >> Chat Colors",title:"Accent",description:"The accent color is used for buttons, links, etc.",component:"setting-color-box",alpha:!1,sort:2},changed:()=>this.updateCSS()}),this.settings.add("theme.can-dark",{requires:["context.route.name"],process:e=>!_.includes(e.get("context.route.name"))}),this.settings.add("theme.is-dark",{requires:["context.force-dark","theme.can-dark","context.ui.theme","context.ui.theatreModeEnabled","context.route.name","context.location.search"],process(e){const s=e.get("context.force-theme");return null!=s?s:"embed-chat"===e.get("context.route.name")?(e.get("context.location.search")||"").includes("dark"):e.get("context.ui.theatreModeEnabled")||e.get("theme.can-dark")&&1===e.get("context.ui.theme")},changed:()=>this.updateCSS()}),this.settings.add("theme.tooltips-dark",{requires:["theme.is-dark"],process:e=>!e.get("theme.is-dark")}),this._style=null,this._normalizer=null}updateFont(){let e=this.settings.get("theme.font.size");"string"==typeof e&&/^[0-9.]+$/.test(e)?e=parseFloat(e):"number"!=typeof e&&(e=null),!e||isNaN(e)||!isFinite(e)||e<1||13===e?this.css_tweaks.delete("font-size"):(e/=10,this.css_tweaks.set("font-size",`html body {\n\t--font-size-1: ${54/13*e}rem;\n\t--font-size-2: ${36/13*e}rem;\n\t--font-size-3: ${24/13*e}rem;\n\t--font-size-4: ${18/13*e}rem;\n\t--font-size-5: ${14/13*e}rem;\n\t--font-size-6: ${e}rem;\n\t--font-size-7: ${12/13*e}rem;\n\t--font-size-8: ${12/13*e}rem;\n\t--font-size-base: ${e}rem;\n}\n`))}generateBackgroundTextBlob(e){const s=e.toHSLA().l<.5;return this.generateBackgroundBlob(e)+this.generateTextBlob(u.Color.RGBA.fromCSS(s?"#FFF":"#000"))}generateBackgroundBlob(e){const s=e.toHSLA(),n=s.l,o=n<.5;return[`--color-background-body:${e.toCSS()};`,`--color-background-input-focus:${e.toCSS()};`,`--color-background-base:${s._l(n+(o?.05:-.05)).toCSS()};`,`--color-background-alt:${s._l(n+(o?.1:-.1)).toCSS()};`,`--color-background-alt-2:${s._l(n+(o?.15:-.15)).toCSS()};`].join("")}generateTextBlob(e){e.a<.4&&(e=e._a(.4));const s=e.a;return[`--color-text-base:${e.toCSS()};`,`--color-text-input:${e.toCSS()};`,`--color-text-label:${e.toCSS()};`,`--color-text-label-optional:${e._a(s-.4).toCSS()};`,`--color-text-alt:${e._a(s-.2).toCSS()};`,`--color-text-alt-2:${e._a(s-.4).toCSS()};`].join("")}generateAccentBlob(e,s){e.a<1&&(e=e._a(1));const n=e.toHSLA(),o=n.l,a=b.map((s=>0===s?e.toCSS():n._l(o+s).toCSS())),u=[],f=[];for(let e=0;e<a.length;e++)u.push(`--ffz-color-accent-${e+1}:${a[e]};`);let g=s?v.dark:v.light;for(const[e,s]of Object.entries(g.c))"number"==typeof s&&u.push(`--color-${e}:${a[s-1]};`);g=s?v.accent_dark:v.accent_light;for(const[e,s]of Object.entries(g.c))"number"==typeof s&&f.push(`--color-${e}:${a[s-1]} !important;`);return[u.join(""),f.join("")]}updateCSS(){if(this.settings.get("theme.disable-auto-dark")?this.css_tweaks.set("nodark",":root{color-scheme: only light}"):this.css_tweaks.delete("nodark"),this.css_tweaks.setVariable("border-color","var(--color-border-base)"),!this.settings.get("theme.can-dark"))return this.toggleNormalizer(!1),this.toggleAccentNormal(!0),void this.css_tweaks.delete("colors");let e=this.settings.get("theme.is-dark");const s=[],n=[],o=u.Color.RGBA.fromCSS(this.settings.get("theme.color.background"));if(o){o.a=1;const n=o.toHSLA();e=n.l<.5;try{const s=this.resolve("site").store,n=s.getState().ui.theme,o=e?1:0;n!==o&&s.dispatch({type:"core.ui.THEME_CHANGED",theme:o})}catch(e){this.log.warning("Unable to automatically set the Twitch Dark Theme state.",e)}s.push(this.generateBackgroundBlob(n))}let a=u.Color.RGBA.fromCSS(this.settings.get("theme.color.text"));!a&&o&&(a=u.Color.RGBA.fromCSS(e?"#FFF":"#000")),a&&s.push(this.generateTextBlob(a));const f=u.Color.RGBA.fromCSS(this.settings.get("theme.color.accent"));if(this.toggleAccentNormal(!f),f){const o=this.generateAccentBlob(f,e);s.push(o[0]),n.push(o[1])}let g,_=u.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.background"));if(!_&&o&&(_=u.Color.RGBA.fromCSS(e?"#FFF":"#000")),_){s.push(`--color-background-tooltip: ${_.toCSS()};`);g=_.toHSLA().l<.5}else g=!e;let b=u.Color.RGBA.fromCSS(this.settings.get("theme.color.tooltip.text"));const v=b||_;if(b||(b=u.Color.RGBA.fromCSS(g?"#FFF":"#000")),b){v&&s.push(`--color-text-tooltip: ${b.toCSS()};`);const e=b.toHSLA(),n=e.a;s.push(`--color-text-tooltip-alt: ${e._a(n-.2).toCSS()};`),s.push(`--color-text-tooltip-alt-2: ${e._a(n-.4).toCSS()};`)}const k=[],x=u.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-background"));let C=e;if(x){x.a=1;const e=x.toHSLA();C=e.l<.5,k.push(this.generateBackgroundBlob(e))}let E=u.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-text"));!E&&x&&(E=u.Color.RGBA.fromCSS(C?"#FFF":"#000")),E&&k.push(this.generateTextBlob(E));const z=u.Color.RGBA.fromCSS(this.settings.get("theme.color.chat-accent")),j=[];if(z){const e=this.generateAccentBlob(z,C);k.push(e[0]),j.push(e[1])}k.length?this.css_tweaks.set("chat-colors",`.moderation-view-page-widget .stream-chat,.chat-shell {${k.join("\n")}}.moderation-view-page-widget .stream-chat .tw-accent-region,.chat-shell .tw-accent-region{${j.join("\n")}}`):this.css_tweaks.delete("chat-colors"),this.toggleNormalizer(k.length||s.length);const O=e?"":":not(.settings-menu-button-component--forced-dark-theme)";s.length?this.css_tweaks.set("colors",`body,body .tw-root--theme-light,body .tw-root--theme-dark${O} {${s.join("\n")}}.channel-info-content .tw-accent-region,.channel-info-content div[class^="ScAccentRegion"]{${n.join("\n")}}`):this.css_tweaks.delete("colors")}toggleAccentNormal(e){if(e){const e=[];for(let s=0;s<15;s++)e.push(`--ffz-color-accent-${s+1}:var(--color-twitch-purple-${s+1});`);this.css_tweaks.set("accent-normal",`body {${e.join("\n")}}`)}else this.css_tweaks.delete("accent-normal")}toggleNormalizer(e){if(this._normalizer){if(!e)return void this._normalizer.remove()}else{if(!e)return;this._normalizer=Object(a.createElement)("link",{rel:"stylesheet",type:"text/css",href:g.a})}document.head.contains(this._normalizer)||document.head.appendChild(this._normalizer)}onEnable(){this.updateCSS(),this.updateFont()}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return VideoChatHook}));var o=n(0),a=n(10),u=n(142),f=n(4),g=n(2);const _=/^([^\s]+) subscribed ([^.]+)\. They've subscribed for (\d+) months(?:[^!]+streak)?!/,b={1e3:1,2e3:2,3e3:3};function parseParamInt(e){try{/^[\d-]+$/.test(e)&&(e=parseInt(e,10))}catch(e){}return"number"==typeof e&&!isNaN(e)&&isFinite(e)||(e=0),e}class VideoChatHook extends f.default{constructor(...e){super(...e),this.should_enable=!0,this.inject("i18n"),this.inject("settings"),this.inject("site"),this.inject("site.router"),this.inject("site.fine"),this.inject("site.web_munch"),this.inject("chat"),this.inject("chat.overrides"),this.injectAs("site_chat","site.chat"),this.inject("site.chat.chat_line.rich_content"),this.VideoChatController=this.fine.define("video-chat-controller",(e=>e.onMessageScrollAreaMount&&e.createReply),["user-video","user-clip","video"]),this.VideoChatMenu=this.fine.define("video-chat-menu",(e=>e.onToggleMenu&&e.getContent&&e.props&&Object(o.has)(e.props,"isExpandedLayout")),["user-video","user-clip","video"]),this.VideoChatLine=this.fine.define("video-chat-line",(e=>e.onReplyClickHandler&&e.shouldFocusMessage),["user-video","user-clip","video"]),this.settings.add("chat.video-chat.timestamps",{default:!0,ui:{path:"Chat > Chat on Videos >> Appearance",title:"Display timestamps alongside chat messages.",component:"setting-check-box"}}),this.settings.add("chat.video-chat.enabled",{default:!0,ui:{path:'Chat > Chat on Videos @{"description": "This feature is currently in beta. As such, you may experience issues when using FFZ features with Chat on Videos."} >> General',title:"Enable FrankerFaceZ features for Chat on Videos.",description:"Display FFZ badges, emotes, and other features in Chat on Videos. Moderation features may be unavailable when this is enabled.",component:"setting-check-box"}})}async onEnable(){this.chat.context.on("changed:chat.video-chat.enabled",this.rerenderLines,this),this.chat.context.on("changed:chat.video-chat.timestamps",this.rerenderLines,this),this.on("chat.overrides:changed",(e=>this.updateLinesByUser(e,null,!1,!1)),this),this.on("chat:update-lines-by-user",this.updateLinesByUser,this),this.on("chat:update-lines",this.updateLines,this),this.on("chat:rerender-lines",this.rerenderLines,this),this.on("chat:update-line-tokens",this.updateLineTokens,this),this.on("chat:update-line-badges",this.updateLineBadges,this),this.on("i18n:update",this.rerenderLines,this);for(const e of g.RERENDER_SETTINGS)this.chat.context.on(`changed:${e}`,this.rerenderLines,this);for(const e of g.UPDATE_TOKEN_SETTINGS)this.chat.context.on(`changed:${e}`,this.updateLineTokens,this);for(const e of g.UPDATE_BADGE_SETTINGS)this.chat.context.on(`changed:${e}`,this.updateLineBadges,this);this.VideoChatController.on("mount",this.chatMounted,this),this.VideoChatController.on("unmount",this.chatUnmounted,this),this.VideoChatController.on("receive-props",this.chatUpdated,this),this.VideoChatController.ready(((e,s)=>{for(const e of s)this.chatMounted(e)}));const e=this,s=await this.web_munch.findModule("react");if(!s)return;const n=s.createElement,o=this.rich_content&&this.rich_content.RichContent;this.MenuContainer=class FFZMenuContainer extends s.Component{constructor(e){super(e),this.onBanUser=()=>{this.props.onBanUserClick({bannedUser:this.props.context.comment.commenter,targetChannel:this.props.context.comment.channelId,comment:this.props.context.comment})},this.onDeleteComment=()=>{this.props.onDeleteCommentClick(this.props.context.comment)},this.onOpen=()=>{this.props.onDisableSync(),this.setState({force:!0})},this.onClose=()=>{this.setState({force:!1})},this.state={force:!1}}render(){return e.VideoChatMenu._class?n("div",{class:"tw-flex-shrink-0 video-chat__message-menu"+(this.state.force?" video-chat__message-menu--force-visible":"")},n(e.VideoChatMenu._class,{context:this.props.context,isCurrentUserModerator:this.props.isCurrentUserModerator,isExpandedLayout:this.props.isExpandedLayout,onBanUserClick:this.onBanUser,onClose:this.onClose,onDeleteCommentClick:this.onDeleteComment,onOpen:this.onOpen,onReplyClick:this.props.onReplyClick})):null}},this.VideoChatLine.ready((s=>{const u=s.prototype.render;s.prototype.ffzRenderMessage=function(s,a){var u;const f=s.is_action,g=f?e.chat.context.get("chat.me-style"):0,_=g>=2,v=1===g||3===g,k=s.user,x=e.overrides.getColor(k.id)||k.color,C=e.site_chat.colors.process(x),E=e.site.getUser();let z;if(E&&(E.moderator=this.props.isCurrentUserModerator,E.staff=E.roles&&E.roles.isStaff),!0===s.system_msg){const o=s.params||{};if("resub"===o["msg-id"]){const s=e.chat.context.get("chat.subs.show"),a=parseParamInt(o["msg-param-months"]),u=parseParamInt(o["msg-param-cumulative-months"]),f=u||a;if(e.log.info("resub-notice setting:",s,"months:",f,"cumulative:",u,"raw:",a),e.log.info("-> params:",o),3===s||f>1&&s>0){const s=1===parseParamInt(o["msg-param-should-share-streak"]),g=o["msg-param-sub-plan"],_="Prime"===g,v=b[g]||1;e.log.info("-> share:",s,"plan:",g,"tier:",v),z=e.i18n.tList("chat.sub.main","{user} subscribed {plan}. ",{user:n("span",{class:"tw-c-text-base tw-strong"},k.displayName),plan:_?e.i18n.t("chat.sub.twitch-prime","with Prime Gaming"):e.i18n.t("chat.sub.plan","at Tier {tier}",{tier:v})}),s&&a>1?z.push(e.i18n.t("chat.sub.cumulative-months","They've subscribed for {cumulative,number} months, currently on a {streak,number} month streak!",{cumulative:u,streak:a})):f>1&&z.push(e.i18n.t("chat.sub.months","They've subscribed for {count,number} months!",{count:f}))}}}else s.system_msg&&(z=s.system_msg);const j=s.ffz_tokens=s.ffz_tokens||e.chat.tokenizeMessage(s,E),O=o&&e.chat.pluckRichContent(j,s),A=e.chat.formatUser(k,n),T=e.overrides.getName(k.id),D={className:`video-chat__message-author notranslate${T?" ffz--name-override tw-relative ffz-il-tooltip__container":""} ${null!==(u=s.ffz_user_class)&&void 0!==u?u:""}`,"data-test-selector":"comment-author-selector",href:`/${k.login}`,rel:"noopener noreferrer",target:"_blank",style:{color:C}};s.ffz_user_props&&Object.assign(D,s.ffz_user_props),s.ffz_user_style&&Object.assign(D.style,s.ffz_user_style);const B=n("a",D,T?[n("span",{className:"chat-author__display-name"},T),n("div",{className:"ffz-il-tooltip ffz-il-tooltip--down ffz-il-tooltip--align-center"},A)]:A);let P=n("div",{class:"tw-flex-grow-1","data-room-id":s.roomID,"data-room":s.roomLogin,"data-user-id":k.id,"data-user":k.login},n("span",{class:"chat-line__message--badges"},e.chat.badges.render(s,n)),B,n("div",{"data-test-selector":"comment-message-selector",class:"tw-inline video-chat__message"},n("span",null,f?" ":": "),n("span",{class:"message "+(_?"chat-line__message-body--italicized":""),style:{color:v?C:null}},e.chat.renderTokens(j,n)),O&&n(o,O)));return z&&(P=n("div",{class:"tw-flex-grow-1"},n("div",{class:"tw-flex tw-c-text-alt-2"},n("div",null,z)),P)),n("div",{class:"tw-align-items-start tw-flex tw-flex-nowrap tw-c-text-base"},P,a?n(e.MenuContainer,{context:a,isCurrentUserModerator:this.props.isCurrentUserModerator,isExpandedLayout:this.props.isExpandedLayout,onBanUserClick:this.props.onBanUserClick,onDeleteCommentClick:this.props.onDeleteCommentClick,onDisableSync:this.props.onDisableSync,onReplyClick:this.onReplyClickHandler}):null)},s.prototype.ffzRenderExpanded=function(s){return s._reply_handler||(s._reply_handler=()=>this.onReplyClickHandler(s.user.login)),n("div",{class:"tw-align-items-center tw-flex tw-pd-t-05"},n("button",{class:"tw-button tw-button--text","data-test-selector":"parent-reply-button",onClick:s._reply_handler},n("span",{class:"tw-button__text tw-pd-0"},e.i18n.t("video-chat.reply","Reply"))),n("span",{class:"tw-c-text-alt-2 tw-font-size-7 tw-mg-l-05 tw-relative ffz-il-tooltip__container"},"• ",e.i18n.t("video-chat.time","{time,humantime} ago",{time:s.timestamp}),n("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-center ffz-il-tooltip--up",role:"tooltip"},e.i18n.formatDateTime(s.timestamp,"full"))))},s.prototype.render=function(){try{if(this._ffz_no_scan=!0,this.state.showReplyForm||!e.chat.context.get("chat.video-chat.enabled"))return u.call(this);const s=this.props.messageContext,o=e.standardizeMessage(s.comment,s.author),f=this.ffzRenderMessage(o,s),g=this.props.hideTimestamp||!e.chat.context.get("chat.video-chat.timestamps"),_=o.mentioned&&o.mention_color?e.site_chat.inverse_colors.process(o.mention_color):null;if(o.ffz_removed)return null;const b=!_&&o.highlight&&e.chat.context.get("chat.points.allow-highlight");return n("div",{"data-test-selector":"message-layout",class:`tw-align-items-start tw-flex tw-flex-nowrap tw-full-width tw-pd-l-05 tw-pd-y-05 vod-message${o.is_sub?" ffz-notice-line ffz--subscribe-line":""}${o.highlight?" ffz-notice-line ffz--points-line":""}${b?" ffz--points-highlight ffz-custom-color":""}${o.mentioned?" ffz-mentioned":""}${_?" ffz-custom-color":""}`,style:{backgroundColor:_}},g||n("div",{"data-test-selector":"message-timestamp",class:"tw-align-right tw-flex tw-flex-shrink-0 vod-message__header"},n("div",{class:"tw-mg-r-05"},n("div",{class:"tw-inline-flex tw-relative ffz-il-tooltip__container"},n("button",{class:"tw-block tw-full-width ffz-interactable ffz-interactable--hover-enabled ffz-interactable--default tw-interactive",onClick:this.onTimestampClickHandler},n("div",{class:"tw-pd-x-05"},n("p",{class:"tw-font-size-7"},Object(a.print_duration)(s.comment.contentOffset)))),n("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-left ffz-il-tooltip--up",role:"tooltip"},e.i18n.t("video-chat.jump","Jump to Video"))))),n("div",{class:"tw-full-width"},f,this.props.isExpandedLayout&&this.ffzRenderExpanded(o),s.replies.length>0&&n("div",{class:"qa-vod-chat-reply tw-mg-l-05 tw-mg-y-05 vod-message__reply"},s.comment.moreReplies&&n("div",{class:"tw-inline-block vod-message__show-more-replies"},n("button",{class:"tw-interactive tw-button tw-button--text",onClick:this.onLoadMoreRepliesClickHandler},n("span",{class:"tw-button__text","data-a-target":"tw-button-text"},e.i18n.t("video-chat.show-more","Show more replies...")))),n("ul",null,s.replies.map((s=>n("li",{key:s.comment&&s.comment.id,class:"tw-mg-l-05"},this.ffzRenderMessage(e.standardizeMessage(s.comment,s.author),s),this.props.isExpandedLayout&&this.ffzRenderExpanded(o))))))))}catch(s){return e.log.error("Problem rendering Chat",s),u.call(this)}},setTimeout((()=>this.VideoChatLine.forceUpdate()))}))}updateLines(){return this._updateLines()}rerenderLines(){this.VideoChatLine.forceUpdate()}updateLineTokens(){return this._updateLines(!0,!1)}updateLineBadges(){return this._updateLines(!1,!0)}_updateLines(e=!0,s=!0){for(const e of this.VideoChatLine.instances){const s=e.props.messageContext;if(s.comment&&(s.comment._ffz_message=null,Array.isArray(s.replies)))for(const e of s.replies)e.comment&&(e.comment._ffz_message=null)}this.VideoChatLine.forceUpdate()}updateLinesByUser(e,s){for(const n of this.VideoChatLine.instances){const o=n.props.messageContext;if(!o.comment)continue;const a=o.author;a&&(e&&e==a.id||s&&s==a.name)&&(o.comment._ffz_message=null,n.forceUpdate())}}standardizeMessage(e,s){if(e._ffz_message)return e._ffz_message;const n=this.chat.getRoom(e.channelId,null,!0,!0),o=e.message.userNoticeParams,a=o&&o["msg-id"],u=e._ffz_message={user:{color:e.message.userColor,id:s.id,login:s.name,displayName:s.displayName,isIntl:s.name&&s.displayName&&s.displayName.trim().toLowerCase()!==s.name,type:s.type},roomLogin:n&&n.login,roomID:n&&n.id,ffz_badges:this.chat.badges.getBadges(s.id,s.login,null==n?void 0:n.id,null==n?void 0:n.login),badges:e.userBadges,messageParts:e.message.tokens,is_action:e.message.isAction,more_replies:e.moreReplies,timestamp:e.createdAt,ffz_context:"video",is_sub:"sub"===a||"resub"===a,highlight:"highlighted-message"===a,params:o};if(Array.isArray(u.messageParts)&&u.messageParts.length&&"resub"===a){let e=u.messageParts[0].content;if("string"==typeof e){const s=_.exec(e);s&&(e=e.slice(s[0].length).trimLeft(),e.length&&(u.messageParts[0].ffz_content=e,u.system_msg=!0))}}return this.chat.detokenizeMessage(u),u}addRoom(e,s){s||(s=e.props);const n=Object(o.get)("data.video.owner",s);if(!n||!n.id)return null;const a=e._ffz_room=this.chat.getRoom(n.id,n.login&&n.login.toLowerCase(),!1,!0);return a.ref(e),a}removeRoom(e){e._ffz_room&&(e._ffz_room.unref(e),e._ffz_room=null)}chatMounted(e,s){s||(s=e.props),this.addRoom(e,s)&&(this.chat.badges.updateTwitchBadges(Object(o.get)("data.badges",s)),this.updateRoomBadges(e,Object(o.get)("data.video.owner.broadcastBadges",s)),this.updateRoomBitsConfig(e,s.bitsConfig))}chatUpdated(e,s){if(Object(o.get)("data.video.owner.id",s)!==Object(o.get)("data.video.owner.id",e.props))return this.removeRoom(e),void this.chatMounted(e,s);const n=Object(o.get)("data.badges",s),a=Object(o.get)("data.badges",e.props),u=Object(o.get)("data.video.owner.broadcastBadges",s),f=Object(o.get)("data.video.owner.broadcastBadges",e.props);n!==a&&this.chat.badges.updateTwitchBadges(n),u!==f&&this.updateRoomBadges(e,u),s.bitsConfig!==e.props.bitsConfig&&this.updateRoomBitsConfig(e,s.bitsConfig);const g=Object(o.get)("data.video.owner",s);this.settings.updateContext({moderator:s.isCurrentUserModerator}),this.chat.context.updateContext({moderator:s.isCurrentUserModerator,channel:g?g.login:null,channelID:g?g.id:null})}chatUnmounted(e){this.removeRoom(e)}updateRoomBadges(e,s){const n=e._ffz_room;n&&n.updateBadges(s)}updateRoomBitsConfig(e,s){const n=e._ffz_room;n&&n.updateBitsConfig(Object(u.formatBitsConfig)(s))}}},function(e,s,n){var o={"./chat/actions/index.jsx":112,"./chat/index.js":128,"./main_menu/index.js":397,"./metadata.jsx":398,"./tooltips.js":106,"./translation_ui/index.js":399};function webpackContext(e){var s=webpackContextResolve(e);return n(s)}function webpackContextResolve(e){if(!n.o(o,e)){var s=new Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}return o[e]}webpackContext.keys=function webpackContextKeys(){return Object.keys(o)},webpackContext.resolve=webpackContextResolve,e.exports=webpackContext,webpackContext.id=396},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return MainMenu}));var o=n(4),a=n(1),u=n(0),f=n(108),g=n(145),_=n(149),b=n(61);function format_term(e){return"string"!=typeof e?e:e.replace(/<[^>]*>/g,"").toLocaleLowerCase()}class MainMenu extends o.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("vue"),this.load_requires=["vue"],this.Mixin=this.SettingMixin=g.a,this.ProviderMixin=_.a,this.exclusive=!1,this.new_seen=!1,this._settings_tree=null,this._settings_count=0,this.dialog=new f.default((()=>this.buildDialog())),this.has_update=!1,this.opened=!1,this.showing=!1,this.context=this.settings.context(),this.settings.addUI("profiles",{path:'Data Management @{"sort": 1000, "profile_warning": false} > Profiles @{"profile_warning": false}',component:"profile-manager"}),this.settings.addUI("backup",{path:'Data Management > Backup and Restore @{"profile_warning": false}',component:"backup-restore",getFFZ:()=>this.resolve("core")}),this.settings.addUI("clear",{path:'Data Management > Storage @{"profile_warning": false} >> tabs ~> Clear',component:"clear-settings",force_seen:!0}),this.settings.addUI("provider",{path:"Data Management > Storage >> tabs ~> Provider",component:"provider",force_seen:!0}),this.settings.addUI("home",{path:'Home @{"sort": -1000, "profile_warning": false}',component:"home-page",requestPage:e=>this.requestPage(e),getUnseen:()=>{var e;if(null===(e=this.unseen)||void 0===e||!e.size)return null;const s={},n=[];let o=0;for(const e of this.unseen){var a;const u=this.settings.definitions.get(e)||this.settings.ui_structures.get(e);if(!u||!u.ui||!u.ui.path_tokens)continue;const f=u.ui.path,g=u.ui.title;if(o++,o>20)break;if(!s[f]){const e=u.ui.path_tokens.map((e=>e.key)).join("."),o=[];let a=this._settings_tree[e];for(;a;)o.unshift({i18n:a.i18n_key,title:a.title}),a.parent&&(a.page||a.tab?o.unshift({title:">>"}):o.unshift({title:">"})),a=this._settings_tree[a.parent];n.push(s[f]={key:e,tokens:o,entries:[]})}f&&g&&s[f].entries.push({key:e,i18n:null!==(a=u.ui.i18n_key)&&void 0!==a?a:`setting.entry.${e}`,title:g})}return n.length?n:null}}),this.settings.addUI("faq",{path:'Home > FAQ @{"profile_warning": false}',component:"md-page",key:"faq"}),this.settings.addUI("chat.filtering.syntax-help",{path:'Chat > Filtering > Syntax Help @{"profile_warning": false}',component:"md-page",key:"term-syntax",force_seen:!0}),this.settings.addUI("feedback",{path:'Home > Feedback @{"profile_warning": false}',component:"md-page",key:"feedback"}),this.settings.addUI("feedback.log",{path:'Home > Feedback >> Log @{"sort": 1000}',component:"async-text",watch:["reports.error.include-user","reports.error.include-settings"],data:()=>this.resolve("core").generateLog()}),this.settings.addUI("changelog",{path:'Home > Changelog @{"profile_warning": false}',component:"changelog"}),this.settings.addUI("addon-changelog",{path:'Add-Ons > Changelog @{"sort": -1000, "profile_warning": false}',component:"changelog",force_seen:!0,addons:!0}),this.settings.addUI("legal",{path:'Home > Legal @{"sort": 1000}',component:"md-page",key:"legal",force_seen:!0}),this.settings.add("ffz.search.matches-only",{default:!0,ui:{path:"Appearance > Control Center >> Search",title:"Hide items that do not match completely when searching.",component:"setting-check-box"}}),this.on("settings:added-definition",((e,s)=>{this._addDefinitionToTree(e,s),this.scheduleUpdate()})),this.on("socket:command:new_version",(e=>{if(e===window.FrankerFaceZ.version_info.commit)return;this.log.info("New Version:",e),this.has_update=!0;const s=this.resolve("site.menu_button");s&&(s.has_update=!0),this._vue&&(this._vue.$children[0].context.has_update=!0)})),this.scheduleUpdate()}openPopout(e){const s=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-settings"+(e?`=${encodeURIComponent(e)}`:""),"_blank","resizable=yes,scrollbars=yes,width=850,height=600");return s?(s.focus(),!0):(this.log.warn("Unable to open popout settings window."),!1)}async onLoad(){this.vue.component((await Promise.all([n.e(1),n.e(149)]).then(n.bind(null,419))).default)}async onEnable(){await this.site.awaitElement(f.default.EXCLUSIVE),await this.i18n.loadChunk("settings"),this.on("addons:added",this.scheduleUpdate,this),this.on("experiments:enabled",this.scheduleUpdate,this),this.on("i18n:update",this.scheduleUpdate,this),this.dialog.on("show",(()=>{this.dialog.maximized&&this.runFix(1),this.showing=!0,this.opened=!0,this.updateButtonUnseen(),this.emit("show")})),this.dialog.on("hide",(()=>{this.dialog.maximized&&this.runFix(-1),this.showing=!1,this.emit("hide"),this.destroyDialog()})),this.dialog.on("resize",(()=>{this.dialog.visible&&this.runFix(this.dialog.maximized?1:-1),this._vue&&(this._vue.$children[0].maximized=this.dialog.maximized)})),this.on("site.menu_button:clicked",this.dialog.toggleVisible,this.dialog),this.dialog.show()}onDisable(){this.dialog.hide(),this.off("site.menu_button:clicked",this.dialog.toggleVisible,this.dialog)}mdNavigate(e){var s;const n=null==e||null===(s=e.dataset)||void 0===s?void 0:s.settingsLink;n&&(this.requestPage(n),this.showing||this.emit("site.menu_button:clicked"))}updateContext(e){var s,n;(e||(e=this._context),this._context=e,this.use_context)?(this.context._updateContext||(this.context._updateContext=this.context.updateContext,this.context.updateContext=function(e){const s={};for(const n of b.a)Object(u.has)(e,n)&&(s[n]=e[n]);this._updateContext(s)}),this.context._context={},this.context._updateContext(Object.assign({},e,{can_proxy:(null===(s=e)||void 0===s?void 0:s.proxied)||!1}))):(this.context._updateContext&&(this.context.updateContext=this.context._updateContext,this.context._updateContext=null),this.context.setContext({can_proxy:(null===(n=e)||void 0===n?void 0:n.proxied)||!1}))}openExclusive(){window.addEventListener("message",(e=>{var s;const n=null===(s=e.data)||void 0===s?void 0:s.ffz_type;"context-update"===n?this.updateContext(Object.assign({},e.data.ctx,{proxied:!0})):"context-gone"===n&&(this.log.info("Context proxy gone."),this.updateContext({proxied:!1}))}));try{window.opener.postMessage({ffz_type:"request-context"},"*")}catch(e){this.log.info("Unable to request settings context from opener.")}this.exclusive=!0,this.dialog.exclusive=!0,this.enable().then((()=>this.dialog.show()))}runFix(e){this.settings.updateContext({force_chat_fix:(this.settings.get("context.force_chat_fix")||0)+e})}requestPage(e){const s=Object(u.get)("_vue.$children.0",this);s&&s.navigate?s.navigate(e):this._wanted_page=e}getUnseen(){const e=this.getSettingsTree();if(!Array.isArray(e))return 0;let s=0;for(const n of e)n&&(s+=n.unseen||0);return s}buildDialog(){return this._menu?this._menu:(this._vue=new this.vue.Vue({el:Object(a.createElement)("div"),render:e=>e("main-menu",this.getData())}),this._menu=this._vue.$el)}destroyDialog(){this._vue&&this._vue.$destroy(),this._menu=this._vue=null}scheduleUpdate(){this._update_timer||(this._update_timer=setTimeout((()=>{this.i18n.enable().then((()=>this.updateLiveMenu()))}),250))}updateButtonUnseen(){const e=this.resolve("site.menu_button");e&&(e.new_settings=this.opened?0:this.getUnseen())}updateLiveMenu(){if(clearTimeout(this._update_timer),this._update_timer=null,this.updateButtonUnseen(),!this._vue||!this._vue.$children||!this._vue.$children[0])return;const e=this._vue.$children[0],s=e.currentItem,n=s&&s.full_key,o=!e.restoredItem,a=window.history.state,u=this.getSettingsTree();e.nav=u,e.navKeys=u.keys;let f,g=!0;if(this._wanted_page&&(f=u.keys[this._wanted_page]),!f&&o){if(null!=a&&a.ffzcc&&(f=u.keys[a.ffzcc]),!f){var _;const e=new URL(window.location).searchParams,s=null==e||null===(_=e.get)||void 0===_?void 0:_.call(e,"ffz-settings");f=s&&u.keys[s]}f||(g=!1)}f||(f=u.keys[n]),f||(f=this.has_update?u.keys["home.changelog"]:u.keys.home),e.currentItem=f,e.restoredItem=g,this._wanted_page=null}rebuildSettingsTree(){this._settings_tree={},this._settings_count=0;for(const[e,s]of this.settings.definitions)this._addDefinitionToTree(e,s);for(const[e,s]of this.settings.ui_structures)this._addDefinitionToTree(e,s)}_addDefinitionToTree(e,s){if(!s.ui||!this._settings_tree)return;if(!s.ui.path_tokens){if(!s.ui.path)return;s.ui.path_tokens=Object(b.c)(s.ui.path)}if(!s.ui||!s.ui.path_tokens||!this._settings_tree)return;const n=this._settings_tree,o=s.ui.path_tokens,a=o.length;let u,f=null;for(let e=0;e<a;e++){const s=o[e],a=f?`${f}.${s.key}`:s.key;u=n[a],u||(u=n[a]={full_key:a,sort:0,parent:f,expanded:null==f,i18n_key:`setting.${a}`,desc_i18n_key:`setting.${a}.description`}),Object.assign(u,s),f=a}u.settings=u.settings||[],u.settings.push([e,s]),this._settings_count++}getSettingsTree(){const e=performance.now();this._settings_tree||this.rebuildSettingsTree();const s=this._settings_tree,n=this.new_seen?null:this.settings.provider.get("cfg-seen"),o=n?new Set:null,a=n?null:[],f=this.settings.provider.get("cfg-collapsed"),g={},_={},b=new Set,v=new Set,k="en"!==this.i18n.locale;a&&(this.new_seen=!0);for(const e in s){if(!Object(u.has)(s,e))continue;const x=_[e]=_[e]||Object.assign({},s[e]),C=x.parent,E=C?_[C]=_[C]||Object.assign({},s[C]):g;if(x.parent=C?E:null,x.page=x.page||E.page,f&&(x.expanded=!f.includes(x.full_key)),x.page&&!x.component&&v.add(x),x.settings){const e=x.contents=x.contents||[];for(const[s,f]of x.settings)if(f.ui){const g=f.ui.i18n_key?f.ui.i18n_key:s?`setting.entry.${s}`:f.ui.key?`${x.i18n_key}.${f.ui.key}`:x.i18n_key,_=Object.assign({i18n_key:g,desc_i18n_key:`${g}.description`,sort:0},f.ui,{full_key:`setting:${s}`,setting:s,path_tokens:void 0,parent:x});if(Object(u.has)(f,"default")&&!Object(u.has)(_,"default")){const e=typeof f.default;_.default="object"===e?Object(u.deep_copy)(f.default):f.default}let b=[s];if(_.title&&(b.push(_.i18n_key?this.i18n.t(_.i18n_key,_.title,null,!0):_.title),k&&_.i18n_key&&this.i18n.has(_.i18n_key)&&b.push(this.i18n.t(_.i18n_key,_.title,null))),_.description&&(b.push(_.desc_i18n_key?this.i18n.t(_.desc_i18n_key,_.description,null,!0):_.description),k&&_.desc_i18n_key&&this.i18n.has(_.desc_i18n_key)&&b.push(this.i18n.t(_.desc_i18n_key,_.description,null))),_.getExtraTerms&&(b=b.concat(_.getExtraTerms())),_.search_terms=b.map(format_term).join("\n"),n){if(!n.includes(s)&&!_.force_seen){o.add(s);let e=_;for(;e;)e.unseen=(e.unseen||0)+1,e=e.parent}}else a&&a.push(s);e.push(_)}x.settings=void 0,e.length>1&&b.add(e)}if(!x.search_terms){const e=x.title&&(x.i18n_key?this.i18n.t(x.i18n_key,x.title,null,!0):x.title);let s=[x.key];e&&e.localeCompare(x.key,void 0,{sensitivity:"base"})&&s.push(e),k&&x.i18n_key&&this.i18n.has(x.i18n_key)&&s.push(this.i18n.t(x.i18n_key,x.title,null)),x.description&&(s.push(x.desc_i18n_key?this.i18n.t(x.desc_i18n_key,x.description,null,!0):x.description),k&&x.desc_i18n_key&&this.i18n.has(x.desc_i18n_key)&&s.push(this.i18n.t(x.desc_i18n_key,x.description,null))),s=s.map(format_term);for(const e of["tabs","contents","items"])if(x[e])for(const n of x[e])n.search_terms&&s.push(n.search_terms);s=x.search_terms=s.join("\n");let n=E;for(;n&&n.search_terms;)n.search_terms+=`\n${s}`,n=n.parent}const z=x.tab?"tabs":x.page?"contents":"items",j=E[z]=E[z]||[];j.push(x),j.length>1&&b.add(j)}for(const e of v)e.component=e.tabs?"tab-container":e.contents?"menu-container":"setting-check-box";for(const e of b)e.sort(((e,s)=>e.sort<s.sort?-1:e.sort>s.sort?1:e.key&&e.key.localeCompare(s.key)));const x=g.items||[];if(x.keys=_,a&&this.settings.provider.set("cfg-seen",a),!f){const e=[];for(const s of Object.keys(_)){const n=_[s];n&&n.items&&n.parent&&e.push(s)}this.settings.provider.set("cfg-collapsed",e)}return Object(u.set_equals)(o,this.unseen)||(this.unseen=o,this.emit(":update-unseen")),this.log.info(`Built Tree in ${(performance.now()-e).toFixed(5)}ms with ${Object.keys(s).length} structure nodes and ${this._settings_count} settings nodes.`),x}getProfiles(e){const s=[],n={};e=e||this.context;for(const o of this.settings.__profiles)s.push(n[o.id]=this.getProfileProxy(o,e));return[s,n]}getProfileProxy(e,s){return{id:e.id,order:s.manager.__profiles.indexOf(e),live:s.__profiles.includes(e),toggled:e.toggled,title:e.name,i18n_key:e.i18n_key,description:e.description,desc_i18n_key:e.desc_i18n_key||e.i18n_key&&`${e.i18n_key}.description`,hotkey:e.hotkey,url:e.url,pause_updates:e.pause_updates,move:n=>s.manager.moveProfile(e.id,n),save:()=>e.save(),update:s=>{e.data=Object(u.deep_copy)(s),e.save()},toggle:()=>e.toggled=!e.toggled,getBackup:()=>Object(u.deep_copy)(e.getBackup()),context:Object(u.deep_copy)(e.context),get:s=>e.get(s),set:(s,n)=>e.set(s,n),delete:s=>e.delete(s),has:s=>e.has(s),on:(...s)=>e.on(...s),off:(...s)=>e.off(...s)}}getContext(){const e=this,s=this.vue.Vue,n=this.settings,o=n.provider,a=this.context,[f,g]=this.getProfiles(),_=window.history.state,b=null==_?void 0:_.ffzccp;let v=g[0];if(null!=b&&(v=g[b]),!v){for(let e=f.length-1;e>=0;e--)if(f[e].live){v=f[e];break}v||(v=f[0])}const k={profiles:f,profile_keys:g,currentProfile:v,exclusive:this.exclusive,can_proxy:a._context.can_proxy,proxied:a._context.proxied,has_update:this.has_update,matches_only:n.get("ffz.search.matches-only"),mod_icons:a.get("context.chat.showModIcons"),setProxied:e=>{this.use_context=e,this.updateContext()},createProfile:s=>{const o=n.createProfile(s);return e.getProfileProxy(o,a)},deleteProfile:e=>n.deleteProfile(e),getProcessor:e=>n.getProcessor(e),getValidator:e=>n.getValidator(e),getFFZ:()=>e.resolve("core"),provider:{unwrap:()=>o,get:(...e)=>o.get(...e),set:(...e)=>o.set(...e),delete:(...e)=>o.delete(...e),has:(...e)=>o.has(...e),on:(...e)=>o.on(...e),off:(...e)=>o.off(...e)},context:{_users:0,profiles:a.__profiles.map((e=>e.id)),get:e=>a.get(e),uses:e=>a.uses(e),on:(...e)=>a.on(...e),off:(...e)=>a.off(...e),order:e=>a.order.indexOf(e),context:Object(u.deep_copy)(a._context),_update_profiles(e){const n=[],o=a.manager.__profiles;for(let e=0;e<o.length;e++){const s=g[o[e].id];s&&(s.order=e,n.push(s))}s.set(k,"profiles",n),e&&e.id===k.currentProfile.id&&(k.currentProfile=g[e.id])},_profile_created(n){s.set(g,n.id,e.getProfileProxy(n,a)),this._update_profiles()},_profile_changed(n){s.set(g,n.id,e.getProfileProxy(n,a)),this._update_profiles(n)},_profile_toggled(e,n){s.set(g[e.id],"toggled",n),this._update_profiles(e)},_profile_deleted(e){if(s.delete(g,e.id),this._update_profiles(),k.currentProfile.id===e.id&&(k.currentProfile=g[0],!k.currentProfile)){for(let e=k.profiles.length-1;e>=0;e--)if(k.profiles[e].live){k.currentProfile=k.profiles[e];break}k.currentProfile||(k.currentProfile=k.profiles[0])}},_context_changed(){this.context=Object(u.deep_copy)(a.__context);const e=a.manager.__profiles,s=this.profiles=a.__profiles.map((e=>e.id));k.proxied=this.context.proxied,k.can_proxy=this.context.can_proxy,k.mod_icons=a.get("context.chat.showModIcons");for(let n=0;n<e.length;n++){const o=e[n].id;g[o].live=s.includes(o)}},_update_settings(){k.matches_only=n.get("ffz.search.matches-only")},_add_user(){this._users++,1===this._users&&(n.on(":changed:ffz.search.matches-only",this._update_settings,this),n.on(":profile-toggled",this._profile_toggled,this),n.on(":profile-created",this._profile_created,this),n.on(":profile-changed",this._profile_changed,this),n.on(":profile-deleted",this._profile_deleted,this),n.on(":profiles-reordered",this._update_profiles,this),a.on("context_changed",this._context_changed,this),a.on("profiles_changed",this._context_changed,this),this.profiles=a.__profiles.map((e=>e.id)))},_remove_user(){this._users--,0===this._users&&(n.off(":changed:ffz.search.matches-only",this._update_settings,this),n.off(":profile-toggled",this._profile_toggled,this),n.off(":profile-created",this._profile_created,this),n.off(":profile-changed",this._profile_changed,this),n.off(":profile-deleted",this._profile_deleted,this),n.off(":profiles-reordered",this._update_profiles,this),a.off("context_changed",this._context_changed,this),a.off("profiles_changed",this._context_changed,this))}}};return k}markSeen(e,s){let n=!0,o=!1;if(s||(n=!1,s=this.settings.provider.get("cfg-seen",[])),Array.isArray(e.contents))for(const n of e.contents)o=n&&this.markSeen(n,s)||o;if(e.setting&&(this.unseen&&this.unseen.delete(e.setting),!s.includes(e.setting))){o=!0,s.push(e.setting);let n=e.parent;for(;n;)n.unseen=(n.unseen||1)-1,n=n.parent}return!n&&o&&(this.settings.provider.set("cfg-seen",s),this.emit(":update-unseen")),o}markAllSeen(e,s){let n=!0;if(s||(n=!1,s=this.settings.provider.get("cfg-seen",[])),Array.isArray(e))for(const n of e)n&&this.markAllSeen(n,s);if(Array.isArray(e.items))for(const n of e.items)this.markAllSeen(n,s);if(Array.isArray(e.contents))for(const n of e.contents)this.markAllSeen(n,s);if(Array.isArray(e.tabs))for(const n of e.tabs)this.markAllSeen(n,s);if(Array.isArray(e.settings))for(const n of e.settings)n&&this.markAllSeen(n[1],s);e.setting&&!s.includes(e.setting)&&s.push(e.setting),e.unseen&&(e.unseen=0),n||(this.settings.provider.set("cfg-seen",s),this.unseen=null,this.emit(":update-unseen"))}getData(){const e=this.getSettingsTree(),s=this.getContext(),n=window.history.state;let o,a=!0;if(this._wanted_page&&(o=e.keys[this._wanted_page]),!o&&null!=n&&n.ffzcc&&(o=e.keys[n.ffzcc],o||(a=!1)),!o){var u;const s=new URL(window.location).searchParams,n=null==s||null===(u=s.get)||void 0===u?void 0:u.call(s,"ffz-settings");o=n&&e.keys[n],o||(a=!1)}o||(o=this.has_update?e.keys["home.changelog"]:e.keys.home),this._wanted_page=null,this.markSeen(o);let f=!1;for(const s of e)if(s&&s.unseen){f=!0;break}const g={context:s,query:"",faded:!1,nav:e,currentItem:o,restoredItem:!0,navKeys:e.keys,has_unseen:f,maximized:this.dialog.maximized,exclusive:this.dialog.exclusive,markAllSeen:e=>this.markAllSeen(e),markSeen:e=>this.markSeen(e),markExpanded:e=>{const s=this.settings.provider.get("cfg-collapsed",[]),n=s.indexOf(e.full_key);if(e.expanded&&-1!==n)s.splice(n,1);else{if(e.expanded||-1!==n)return;s.push(e.full_key)}this.settings.provider.set("cfg-collapsed",s)},resize:e=>{var s,n,o,a;this.dialog.exclusive||"squad"===(null===(s=this.site)||void 0===s||null===(n=s.router)||void 0===n?void 0:n.current_name)||"command-center"===(null===(o=this.site)||void 0===o||null===(a=o.router)||void 0===a?void 0:a.current_name)||this.settings.get("context.ui.theatreModeEnabled")||this.dialog.toggleSize(e)},close:e=>!this.dialog.exclusive&&this.dialog.toggleVisible(e),version:window.FrankerFaceZ.version_info};return g.popout=e=>{var s;this.dialog.exclusive||(this.dialog.toggleVisible(e),this.openPopout(null===(s=g.currentItem)||void 0===s?void 0:s.full_key)||alert(this.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.")))},g}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return Metadata}));var o=n(1),a=n(0),u=n(10),f=n(27),g=n(4);const _=/^https:\/\/[^/]+\.(?:twitch\.tv|twitchcdn\.net)\/.+?\.mp4(?:\?.*)?$/;class Metadata extends g.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("tooltips"),this.should_enable=!0,this.definitions={},this.settings.add("metadata.clip-download",{default:!0,ui:{path:"Channel > Metadata >> Clips",title:"Add a Download button for editors to clip pages.",description:"This adds a download button beneath the player on clip pages (the main site, not on `clips.twitch.tv`) for broadcasters and their editors.",component:"setting-check-box"},changed:()=>this.updateMetadata("clip-download")}),this.settings.add("metadata.player-stats",{default:!1,ui:{path:"Channel > Metadata >> Player",title:"Playback Statistics",description:"Show the current stream delay, with playback rate and dropped frames in the tooltip.",component:"setting-check-box",getExtraTerms:()=>["latency","bitrate"]},changed:()=>this.updateMetadata("player-stats")}),this.settings.add("metadata.stream-delay-warning",{default:0,ui:{path:"Channel > Metadata >> Player",title:"Stream Delay Warning",description:"When the current stream delay exceeds this number of seconds, display the stream delay in a warning color to draw attention to the large delay. Set to zero to disable.",component:"setting-text-box",process:"to_float",bounds:[0,!0]}}),this.settings.add("metadata.uptime",{default:2,ui:{path:"Channel > Metadata >> Player",title:"Stream Uptime",component:"setting-select-box",data:[{value:0,title:"Disabled"},{value:1,title:"Enabled"},{value:2,title:"Enabled (with Seconds)"}]},changed:()=>this.updateMetadata("uptime")}),this.settings.add("metadata.viewers",{default:!1,ui:{path:"Channel > Metadata >> Player",title:"Alternative Viewer Count",description:"This displays the current channel's viewer count without an animation when it changes.",component:"setting-check-box"},changed:()=>this.updateMetadata("viewers")}),this.definitions.viewers={refresh(){return this.settings.get("metadata.viewers")},setup(e){var s,n;return{live:(null===(s=e.channel)||void 0===s?void 0:s.live)&&null!=(null===(n=e.channel)||void 0===n?void 0:n.live_since),count:e.getViewerCount()}},order:1,icon:"ffz-i-viewers",label(e){return this.settings.get("metadata.viewers")&&e.live?this.i18n.formatNumber(e.count):null},tooltip(){return this.i18n.t("metadata.viewers","Viewer Count")},color:"var(--color-text-live)"},this.definitions.uptime={inherit:!0,no_arrow:!0,player:!0,refresh(){return this.settings.get("metadata.uptime")>0},setup(e){var s;const n=this.resolve("socket");let o=null==e||null===(s=e.channel)||void 0===s?void 0:s.live_since;if(!o){var a;const s=null==e||null===(a=e.meta)||void 0===a?void 0:a.createdAt;if(!s)return{};o=s}o instanceof Date||(o=new Date(o));const u=Date.now()-n._time_drift;return{created:o,uptime:o?Math.floor((u-o.getTime())/1e3):-1,getBroadcastID:e.getBroadcastID}},order:2,icon:"ffz-i-clock",label(e){const s=this.settings.get("metadata.uptime");return s&&e.created?Object(u.duration_to_string)(e.uptime,!1,!1,!1,2!==s):null},subtitle:()=>this.i18n.t("metadata.uptime.subtitle","Uptime"),tooltip(e){return e.created?[this.i18n.t("metadata.uptime.tooltip","Stream Uptime"),Object(o.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("metadata.uptime.since","(since {since,datetime})",{since:e.created}))]:null},async popup(e,s){var n,a,f;const[g,_]=await Promise.all([null===(n=navigator)||void 0===n||null===(a=n.permissions)||void 0===a||null===(f=a.query)||void 0===f?void 0:f.call(a,{name:"clipboard-write"}).then((e=>null==e?void 0:e.state)).catch((()=>null)),e.getBroadcastID()]);if(!_)return Object(o.createElement)("div",null,this.i18n.t("metadata.uptime-no-id","Sorry, we couldn't find an archived video for the current broadcast."));const b=`https://www.twitch.tv/videos/${_}${e.uptime>0?`?t=${Object(u.durationForURL)(e.uptime)}`:""}`,v="granted"===g||"prompt"===g,k=v?e=>(navigator.clipboard.writeText(b),e.preventDefault(),!1):null;return s.element.classList.add("ffz-balloon--lg"),Object(o.createElement)("div",null,Object(o.createElement)("div",{class:"tw-pd-b-1 tw-mg-b-1 tw-border-b tw-semibold"},this.i18n.t("metadata.uptime.link-to","Link to {time}",{time:Object(u.duration_to_string)(e.uptime,!1,!1,!1,!1)})),Object(o.createElement)("div",{class:"tw-flex tw-align-items-center"},Object(o.createElement)("input",{class:"tw-border-radius-medium tw-font-size-6 tw-pd-x-1 tw-pd-y-05 ffz-input tw-full-width",type:"text",value:b,onFocus:e=>e.target.select()}),v&&Object(o.createElement)("div",{class:"tw-relative ffz-il-tooltip__container tw-mg-l-1"},Object(o.createElement)("button",{class:"tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-left-radius-medium tw-border-top-right-radius-medium tw-button-icon ffz-core-button ffz-core-button--border tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative","aria-label":this.i18n.t("metadata.uptime.copy","Copy to Clipboard"),onClick:k},Object(o.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0"},Object(o.createElement)("span",{class:"tw-button-icon__icon"},Object(o.createElement)("figure",{class:"ffz-i-docs"})))),Object(o.createElement)("div",{class:"ffz-il-tooltip ffz-il-tooltip--align-right ffz-il-tooltip--up"},this.i18n.t("metadata.uptime.copy","Copy to Clipboard")))))}},this.definitions["clip-download"]={button:!0,inherit:!0,setup(e){var s,n,o,a,u;if(!this.settings.get("metadata.clip-download"))return;const f=this.resolve("site.player").current;if(!f)return;const g=f.mediaSinkManager||(null===(s=f.core)||void 0===s?void 0:s.mediaSinkManager),b=null==g||null===(n=g.video)||void 0===n?void 0:n.src;if(!b||!_.test(b))return;if(this.settings.get("metadata.clip-download.force"))return b;const v=null===(o=(a=this.resolve("site")).getUser)||void 0===o?void 0:o.call(a);return(null==v?void 0:v.id)==e.channel.id||null!==(u=e.getUserSelfImmediate(e.refresh))&&void 0!==u&&u.isEditor?b:void 0},label(e){if(e)return this.i18n.t("metadata.clip-download","Download")},icon:"ffz-i-download",click(e){const s=this.settings.get("context.title").replace(/[\\/:"*?<>|]+/,"_")+".mp4",n=Object(o.createElement)("a",{target:"_blank",download:s,href:e,style:{display:"none"}});document.body.appendChild(n),n.click(),n.remove()}},this.definitions["player-stats"]={button:!0,inherit:!0,modview:!0,player:!0,refresh(){return this.settings.get("metadata.player-stats")},setup(){const e=this.resolve("site.player"),s=this.resolve("socket"),n=e.current;let o;if(n)if("function"==typeof n.getPlaybackStats)o=n.getPlaybackStats();else if("function"==typeof n.getVideoInfo){const e=n.getVideoInfo();o={backendVersion:Object(a.maybe_call)(n.getVersion,n),bufferSize:e.video_buffer_size,displayResolution:`${e.vid_display_width}x${e.vid_display_height}`,fps:e.current_fps,hlsLatencyBroadcaster:e.hls_latency_broadcaster/1e3,hlsLatencyEncoder:e.hls_latency_encoder/1e3,memoryUsage:`${e.totalMemoryNumber} MB`,rate:Object(a.maybe_call)(n.getPlaybackRate,n)||1,playbackRate:e.current_bitrate,skippedFrames:e.dropped_frames,videoResolution:`${e.vid_width}x${e.vid_height}`}}else{const e=Object(a.maybe_call)(n.getVideoHeight,n)||0,s=Object(a.maybe_call)(n.getVideoWidth,n)||0,u=Object(a.maybe_call)(n.getDisplayHeight,n)||0,f=Object(a.maybe_call)(n.getDisplayWidth,n)||0;o={backendVersion:Object(a.maybe_call)(n.getVersion,n),bufferSize:Object(a.maybe_call)(n.getBufferDuration,n),displayResolution:`${f}x${u}`,videoResolution:`${s}x${e}`,videoHeight:e,videoWidth:s,displayHeight:u,displayWidth:f,rate:Object(a.maybe_call)(n.getPlaybackRate,n),fps:Math.floor(Object(a.maybe_call)(n.getVideoFrameRate,n)||0),hlsLatencyBroadcaster:Object(a.maybe_call)(n.getLiveLatency,n)||0,playbackRate:Math.floor((Object(a.maybe_call)(n.getVideoBitRate,n)||0)/1e3),skippedFrames:Object(a.maybe_call)(n.getDroppedFrames,n)}}else o=null;let u=!1;try{const e=n.core.state.path;if(e.includes("/api/channel/hls/")){const s=JSON.parse(new URL(e).searchParams.get("token"));u=!(!s||!s.player_type||"site"===s.player_type)&&s.player_type}}catch(e){}if(!o||o.hlsLatencyBroadcaster<-100)return{stats:o};let f=0;return s&&s.connected&&(f=s._time_drift),{stats:o,drift:f,rate:null==o.rate?1:o.rate,delay:o.hlsLatencyBroadcaster,old:o.hlsLatencyBroadcaster>180,tampered:u}},order:3,icon:e=>e.rate>1?"ffz-i-fast-fw":"ffz-i-gauge",subtitle:()=>this.i18n.t("metadata.player-stats.subtitle","Latency"),label(e){if(!this.settings.get("metadata.player-stats")||!e.delay)return null;if(e.old)return null;const s=e.drift>5e3?"(!) ":"";return e.old?`${s}${e.delay.toFixed(2)}s old`:`${s}${e.delay.toFixed(2)}s`},click(){var e;const s=this.resolve("site.player"),n=this.resolve("site.fine"),o=null===(e=s.Player)||void 0===e?void 0:e.first,a=n&&o&&n.searchTree(o,(e=>{var s;return null===(s=e.props)||void 0===s?void 0:s.setStatsOverlay}),200),u=a&&n.getChildNode(o),f=u&&u.querySelector('[data-a-target="player-overlay-video-stats"]');a&&a.props.setStatsOverlay(f?0:1)},color(e){const s=this.settings.get("metadata.stream-delay-warning");if(0!==s&&e.delay&&!e.old)return e.delay>2*s?e.is_player?"#f9b6b6":"#ec1313":e.delay>s?e.is_player?"#fcb896":"#fc7835":void 0},tooltip(e){const s=e.tampered?Object(o.createElement)("div",{class:"tw-border-t tw-mg-t-05 tw-pd-t-05"},this.i18n.t("metadata.player-stats.tampered","Your player has an unexpected player type ({type}), which may affect your viewing experience.",{type:e.tampered})):null,n=e.drift>5e3&&Object(o.createElement)("div",{class:"tw-border-b tw-mg-b-05 tw-pd-b-05"},this.i18n.t("metadata.player-stats.delay-warning","Your local clock seems to be off by roughly {count,number} seconds, which could make this inaccurate.",Math.round(e.drift/10)/100)),a=e.rate>1&&Object(o.createElement)("div",{class:"tw-border-b tw-mg-b-05 tw-pd-b-05"},this.i18n.t("metadata.player-stats.rate-warning","Playing at {rate,number}x speed to reduce delay.",{rate:e.rate.toFixed(2)}));if(!e.stats||!e.delay)return[n,a,this.i18n.t("metadata.player-stats.latency-tip","Stream Latency"),s];const u=e.stats,f=this.i18n.t("metadata.player-stats.video-info","Video: {videoResolution}p{fps}\nPlayback Rate: {playbackRate, number} Kbps\nDropped Frames: {skippedFrames, number}",u);return e.old?[n,this.i18n.t("metadata.player-stats.video-tip","Video Information"),Object(o.createElement)("div",{class:"tw-pd-t-05"},this.i18n.t("metadata.player-stats.broadcast-ago","Broadcast {count,number}s Ago",e.delay)),Object(o.createElement)("div",{class:"tw-pd-t-05"},f),s]:[n,a,this.i18n.t("metadata.player-stats.latency-tip","Stream Latency"),Object(o.createElement)("div",{class:"tw-pd-t-05"},f),s]}}}onEnable(){const e=this.tooltips.types.metadata=e=>{let s=e;if(s._ffz_stat?s=s._ffz_stat:s.classList.contains("ffz-stat")||(s=e.closest(".ffz-stat"),e._ffz_stat=s),!s)return;const n=s.dataset.key,o=this.definitions[n];return Object(a.maybe_call)(o.tooltip,this,s._ffz_data)};e.onShow=(e,s)=>{(e._ffz_stat||e).tip=s},e.onHide=e=>{const s=e._ffz_stat||e;s.tip=null,s.tip_content=null},e.popperConfig=(e,s,n)=>(n.placement="bottom",n.modifiers.flip={behavior:["bottom","top"]},n)}get keys(){return Object.keys(this.definitions)}define(e,s){this.definitions[e]=s,this.updateMetadata(e)}updateMetadata(e){const s=this.resolve("site.channel");if(s)for(const n of s.InfoBar.instances)s.updateMetadata(n,e);const n=this.resolve("site.player");if(n)for(const s of n.Player.instances)n.updateMetadata(s,e)}async renderLegacy(e,s,n,u,g){u[e]&&clearTimeout(u[e]);let _=n.querySelector(`.ffz-stat[data-key="${e}"]`);const b=this.definitions[e],destroy=()=>{_&&(_.tooltip&&_.tooltip.destroy(),_.popper&&_.popper.destroy(),_._ffz_destroy&&_._ffz_destroy(),_._ffz_destroy=_.tooltip=_.popper=null,_.remove())};if(!b||(s._mt||"channel")!==(b.type||"channel"))return destroy();try{const ref_fn=()=>g(e);s=Object.assign({},s,{is_player:!1,refresh:ref_fn}),b.setup&&(s=await b.setup.call(this,s));const v=Object(a.maybe_call)(b.refresh,this,s);let k,x,C;v&&(u[e]=setTimeout(ref_fn,"number"==typeof v?v:1e3)),_=n.querySelector(`.ffz-stat[data-key="${e}"]`);const E=Object(a.maybe_call)(b.label,this,s);if(!E)return destroy();const z=Object(a.maybe_call)(b.order,this,s),j=Object(a.maybe_call)(b.color,this,s)||"";if(_){if(k=_.querySelector(".ffz-stat-text"),!k)return destroy();if(C=_.dataset.icon||"",x=_.dataset.color||"",_._ffz_order!==z&&(_.style.order=_._ffz_order=z),_.tip){const e=Object(a.maybe_call)(b.tooltip,this,s);_.tip_content!==e&&(_.tip_content=e,Object(o.setChildren)(_.tip.element,e))}}else{let u=C=Object(a.maybe_call)(b.icon,this,s),v=!1;if(!1!==b.button&&(b.popup||b.click)){let n,x;v=!0;const C=Object(a.maybe_call)(b.border,this,s),E=Object(a.maybe_call)(b.inherit,this,s);"string"==typeof u&&(u=Object(o.createElement)("span",{class:"tw-mg-r-05"},Object(o.createElement)("figure",{class:u}))),b.popup&&b.click?_=Object(o.createElement)("div",{class:"tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat ffz-stat--fix-padding "+(C?"tw-mg-r-1":"tw-mg-r-05 ffz-mg-l--05"),"data-key":e,tip_content:null},n=Object(o.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium ffz-core-button ffz-core-button--padded ffz-core-button--text ${E?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${C?"tw-border-l tw-border-t tw-border-b":"tw-font-size-5 tw-regular"}${b.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata"},Object(o.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center tw-pd-x-1"},u,k=Object(o.createElement)("span",{class:"ffz-stat-text"}))),x=Object(o.createElement)("button",{class:`tw-align-items-center tw-align-middle tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--text ${E?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative ${C?"tw-border":"tw-font-size-5 tw-regular"}${b.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata"},Object(o.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center"},Object(o.createElement)("span",null,Object(o.createElement)("figure",{class:"ffz-i-down-dir"}))))):n=x=_=Object(o.createElement)("button",{class:`ffz-stat tw-align-items-center tw-align-middle tw-border-bottom-left-radius-medium tw-border-top-left-radius-medium tw-border-bottom-right-radius-medium tw-border-top-right-radius-medium ffz-core-button ffz-core-button--text ${E?"ffz-c-text-inherit":"tw-c-text-base"} tw-inline-flex tw-interactive tw-justify-content-center tw-overflow-hidden tw-relative tw-pd-x-05 ffz-stat--fix-padding ${C?"tw-border tw-mg-r-1":"tw-font-size-5 tw-regular tw-mg-r-05 ffz-mg-l--05"}${b.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""}`,"data-tooltip-type":"metadata","data-key":e,tip_content:null},Object(o.createElement)("div",{class:"tw-align-items-center tw-flex tw-flex-grow-0 tw-justify-center"},u,k=Object(o.createElement)("span",{class:"ffz-stat-text"}),b.popup&&!b.no_arrow&&Object(o.createElement)("span",{class:"tw-mg-l-05"},Object(o.createElement)("figure",{class:"ffz-i-down-dir"})))),b.click&&n.addEventListener("click",(s=>{if(_._ffz_fading||n.disabled||n.classList.contains("disabled")||_.disabled||_.classList.contains("disabled"))return!1;b.click.call(this,_._ffz_data,s,(()=>g(e)))})),b.popup&&x.addEventListener("click",(()=>{if(x.disabled||x.classList.contains("disabled")||_.disabled||_.classList.contains("disabled"))return!1;if(_._ffz_popup)return _._ffz_destroy();const s=[],add_close_listener=e=>s.push(e),n=_._ffz_destroy=()=>{for(const n of s)try{n()}catch(s){this.log.capture(s,{tags:{metadata:e}}),this.log.error("Error when running a callback for pop-up destruction for metadata:",e,s)}if(_._ffz_outside&&_._ffz_outside.destroy(),_._ffz_popup){const e=_._ffz_popup;_._ffz_popup=null,e.destroy()}_._ffz_destroy=_._ffz_outside=null},a=document.fullscreenElement||document.body.querySelector("#root>div")||document.body;(_._ffz_popup=new f.default(a,_,{logger:this.log,i18n:this.i18n,manual:!0,live:!1,html:!0,tooltipClass:"ffz-metadata-balloon ffz-balloon tw-block tw-border tw-elevation-1 tw-border-radius-small tw-c-background-base",arrowClass:"ffz-balloon__tail tw-overflow-hidden tw-absolute",arrowInner:"ffz-balloon__tail-symbol tw-border-t tw-border-r tw-border-b tw-border-l tw-border-radius-small tw-c-background-base tw-absolute",innerClass:"tw-pd-1",popper:{placement:"top-end",modifiers:{preventOverflow:{boundariesElement:a},flip:{behavior:["top","bottom","left","right"]}}},content:(s,n)=>b.popup.call(this,_._ffz_data,n,(()=>g(e)),add_close_listener),onShow:(e,s)=>setTimeout((()=>{_._ffz_outside=new o.ClickOutside(s.outer,n)})),onHide:n}))._enter(_)}))}else"string"==typeof u&&(u=Object(o.createElement)("span",{class:"tw-stat__icon"},Object(o.createElement)("figure",{class:u}))),_=Object(o.createElement)("div",{class:"tw-align-items-center tw-inline-flex tw-relative ffz-il-tooltip__container ffz-stat tw-stat tw-mg-r-1"+(b.tooltip?" ffz-tooltip ffz-tooltip--no-mouse":""),"data-tooltip-type":"metadata","data-key":e,tip_content:null},u,k=Object(o.createElement)("span",{class:(u?"tw-mg-l-05 ":"")+"ffz-stat-text tw-stat__value"})),b.click&&_.addEventListener("click",(s=>{if(_._ffz_fading||_.disabled||_.classList.contains("disabled"))return!1;b.click.call(this,_._ffz_data,s,(()=>g(e)))}));_._ffz_order=z,null!=z&&(_.style.order=z),n.appendChild(_)}if("function"==typeof b.icon){const e=Object(a.maybe_call)(b.icon,this,s);if("string"==typeof e&&e!==C){_.dataset.icon=e;const s=_.querySelector("figure");s&&(s.className=e)}}x!==j&&(_.dataset.color=j,_.style.setProperty("color",j,"important")),_._ffz_data=s,k.innerHTML=E,void 0!==b.disabled&&(_.disabled=Object(a.maybe_call)(b.disabled,this,s))}catch(s){return this.log.capture(s,{tags:{metadata:e}}),this.log.error(`Error rendering metadata for ${e}`,s),destroy()}}}},function(e,s,n){"use strict";n.r(s),n.d(s,"default",(function(){return TranslationUI}));var o=n(4),a=n(108),u=n(1);class TranslationUI extends o.default{constructor(...e){super(...e),this.inject("settings"),this.inject("i18n"),this.inject("site"),this.inject("vue"),this.load_requires=["vue"],this.dialog=new a.default((()=>this.buildDialog()))}openPopout(){const e=window.open("https://twitch.tv/popout/frankerfacez/chat?ffz-translate","_blank","resizable=yes,scrollbars=yes,width=850,height=600");return e?(e.focus(),!0):(this.log.warn("Unable to open popout translation window."),!1)}async onLoad(){this.vue.component((await n.e(161).then(n.bind(null,420))).default)}async onEnable(){await this.site.awaitElement(a.default.EXCLUSIVE),this.on("i18n:seen",(e=>{if(!this._vue)return;this._vue.$children[0].phrases.push(e)})),this.dialog.on("hide",this.destroyDialog,this),this.dialog.on("resize",(()=>{this._vue&&(this._vue.$children[0].maximized=this.dialog.maximized)})),this.dialog.show()}onDisable(){this.dialog.hide()}buildDialog(){return this._dialog?this._dialog:(this._vue=new this.vue.Vue({el:Object(u.createElement)("div"),render:e=>e("translation-ui",this.getData())}),this._dialog=this._vue.$el)}destroyDialog(){this._vue&&this._vue.$destroy(),this._dialog=this._vue=null}getData(){return this.i18n.loadStrings(),{phrases:[],query:"",faded:!1,maximized:this.dialog.maximized,exclusive:this.dialog.exclusive,getI18n:()=>this.i18n,getKeys:()=>this.i18n.getKeys(),requestKeys:()=>this.i18n.requestKeys(),updatePhrase:(e,s)=>this.i18n.updatePhrase(e,s),listen:(e,s,n)=>this.on(e,s,n),unlisten:(e,s,n)=>this.off(e,s,n),resize:e=>!this.dialog.exclusive&&this.dialog.toggleSize(e),close:e=>!this.dialog.exclusive&&this.dialog.toggleVisible(e),popout:e=>{this.dialog.exclusive||(this.dialog.toggleVisible(e),this.openPopout()||alert(this.i18n.t("popup.error","We tried opening a pop-up window and could not. Make sure to allow pop-ups from Twitch.")))}}}}},,,,,,,,,,,,,,,,,,function(e,s){e.exports=ffzVue}]);
//# sourceMappingURL=avalon.d70258d2f8c30cac6f33.js.map